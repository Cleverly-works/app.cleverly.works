"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5308],{35308:function(e,t,n){n.r(t),n.d(t,{RIGHT_CLICK_IMAGE_COMMAND:function(){return M},default:function(){return N}});var r=n(16835),a=n(46895),i=n(89357),l=n(63786),o=n(67294);let s=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],u=s[Math.floor(Math.random()*s.length)],c=(0,o.createContext)({clientID:0,color:u[1],isCollabActive:!1,name:u[0],yjsDocMap:new Map});var d=function(e){let t=new URLSearchParams;t.append("code",e);for(let n=1;n<arguments.length;n++)t.append("v",arguments[n]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};function f(e){let t=e.transform();return null!==t?new Set([t]):new Set}function g({initialEditor:e,children:t,initialNodes:n,initialTheme:r,skipCollabChecks:i}){let l=(0,o.useRef)(!1),s=(0,o.useContext)(a.YK);null==s&&d(9);let[u,{getTheme:g}]=s,m=(0,o.useMemo)(()=>{let t=r||g()||void 0,i=(0,a.LI)(s,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=u,n)for(let l of n){let o=null,c=null;if("function"!=typeof l){let d=l;l=d.replace,o=d.with,c=d.withKlass||null}let m=e._nodes.get(l.getType());e._nodes.set(l.getType(),{exportDOM:m?m.exportDOM:void 0,klass:l,replace:o,replaceWithKlass:c,transforms:f(l)})}else{let h=e._nodes=new Map(u._nodes);for(let[p,b]of h)e._nodes.set(p,{exportDOM:b.exportDOM,klass:b.klass,replace:b.replace,replaceWithKlass:b.replaceWithKlass,transforms:f(b.klass)})}return e._config.namespace=u._config.namespace,e._editable=u._editable,[e,i]},[]),{isCollabActive:h,yjsDocMap:p}=function(e,t){let n=(0,o.useContext)(c);return null!=e&&(n.name=e),null!=t&&(n.color=t),n}(),b=i||l.current||p.has(e.getKey());return(0,o.useEffect)(()=>{b&&(l.current=!0)},[b]),(0,o.useEffect)(()=>u.registerEditableListener(t=>{e.setEditable(t)}),[e,u]),o.createElement(a.YK.Provider,{value:m},!h||b?t:null)}var m=n(68218),h=n(61084);function p(e,t){return e.getEditorState().read(()=>{let e=(0,h.gI)(t);return null!==e&&e.isSelected()})}var b=n(18824),v=n(67011),C=n(69094),x=n(81934),E=n(66076),_=n(92178),w=n(85893),K=new Set,M=(0,h.fA)("RIGHT_CLICK_IMAGE_COMMAND");function S(e){var t=e.altText,n=e.className,r=e.imageRef,a=e.src,i=e.width,l=e.height,o=e.maxWidth;return!function(e){if(!K.has(e))throw new Promise(function(t){var n=new Image;n.src=e,n.onload=function(){K.add(e),t(null)}})}(a),(0,w.jsx)("img",{className:n||void 0,src:a,alt:t,ref:r,style:{height:l,maxWidth:o,width:i},draggable:"false"})}function N(e){var t=e.className,n=e.src,s=e.altText,u=e.nodeKey,c=e.width,d=e.height,f=e.maxWidth,K=e.resizable,N=e.showCaption,k=e.caption,L=e.captionsEnabled,j=(0,o.useRef)(null),I=(0,o.useRef)(null),R=function(e){let[t]=(0,a.g)(),[n,r]=(0,o.useState)(()=>p(t,e));return(0,o.useEffect)(()=>{let n=!0,a=t.registerUpdateListener(()=>{n&&r(p(t,e))});return()=>{n=!1,a()}},[t,e]),[n,(0,o.useCallback)(n=>{t.update(()=>{let t=(0,h.dL)();(0,h.iO)(t)||(t=(0,h.h5)(),(0,h.oq)(t)),(0,h.iO)(t)&&(n?t.add(e):t.delete(e))})},[t,e]),(0,o.useCallback)(()=>{t.update(()=>{let e=(0,h.dL)();(0,h.iO)(e)&&e.clear()})},[t])]}(u),O=(0,r.Z)(R,3),D=O[0],y=O[1],B=O[2],T=(0,o.useState)(!1),W=T[0],A=T[1],P=(0,a.g)(),q=(0,r.Z)(P,1)[0],G=(0,o.useState)(null),H=G[0],Z=G[1],z=(0,o.useRef)(null),F=(0,o.useState)(function(){return q.isEditable()}),U=F[0],$=F[1];(0,o.useEffect)(function(){return q.registerEditableListener(function(e){$(e)})},[q]);var V=(0,o.useCallback)(function(e){if(D&&(0,h.iO)((0,h.dL)())){e.preventDefault();var t=(0,h.gI)(u);if((0,E.dP)(t))return t.remove(),!0}return!1},[D,u]),X=(0,o.useCallback)(function(e){var t=(0,h.dL)(),n=I.current;if(D&&(0,h.iO)(t)&&1===t.getNodes().length){if(N)return(0,h.oq)(null),e.preventDefault(),k.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1},[k,D,N]),Y=(0,o.useCallback)(function(e){return(z.current===k||I.current===e.target)&&((0,h.oq)(null),q.update(function(){y(!0);var e=q.getRootElement();null!==e&&e.focus()}),!0)},[k,q,y]),J=(0,o.useCallback)(function(e){return!!W||e.target===j.current&&(e.shiftKey?y(!D):(B(),y(!0)),!0)},[W,D,y,B]),Q=(0,o.useCallback)(function(e){q.getEditorState().read(function(){var t=(0,h.dL)();"IMG"===e.target.tagName&&(0,h.OP)(t)&&1===t.getNodes().length&&q.dispatchCommand(M,e)})},[q]);(0,o.useEffect)(function(){var e=!0,t=q.getRootElement(),n=(0,b.qV)(q.registerUpdateListener(function(t){var n=t.editorState;e&&Z(n.read(function(){return(0,h.dL)()}))}),q.registerCommand(h.oj,function(e,t){return z.current=t,!1},h.KB),q.registerCommand(h.Kr,J,h.KB),q.registerCommand(M,J,h.KB),q.registerCommand(h.XI,function(e){return e.target===j.current&&(e.preventDefault(),!0)},h.KB),q.registerCommand(h.MK,V,h.KB),q.registerCommand(h.aR,V,h.KB),q.registerCommand(h.XN,X,h.KB),q.registerCommand(h.Zq,Y,h.KB));return null==t||t.addEventListener("contextmenu",Q),function(){e=!1,n(),null==t||t.removeEventListener("contextmenu",Q)}},[B,q,W,D,u,V,X,Y,J,Q,y]);var ee=function(){q.update(function(){var e=(0,h.gI)(u);(0,E.dP)(e)&&e.setShowCaption(!0)})},et=function(e,t){setTimeout(function(){A(!1)},200),q.update(function(){var n=(0,h.gI)(u);(0,E.dP)(n)&&n.setWidthAndHeight(e,t)})},en=function(){A(!0)},er=(0,v.V)().historyState,ea=D&&(0,h.iO)(H)&&!W,ei=D||W;return(0,w.jsx)(o.Suspense,{fallback:null,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{draggable:ea,children:(0,w.jsx)(S,{className:U&&ei?"focused ".concat((0,h.iO)(H)?"draggable":""," ").concat(t):"".concat(t||""),src:n,altText:s,imageRef:j,width:c,height:d,maxWidth:f})}),N&&(0,w.jsx)("div",{className:"image-caption-container",children:(0,w.jsxs)(g,{initialEditor:k,children:[(0,w.jsx)(C.Nz,{}),(0,w.jsx)(C.Hi,{}),(0,w.jsx)(l.e,{externalHistoryState:er}),(0,w.jsx)(m.B,{contentEditable:(0,w.jsx)(_.f$,{className:"ImageNode__contentEditable"}),placeholder:(0,w.jsx)("div",{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:i.Z})]})}),U&&K&&(0,h.iO)(H)&&ei&&(0,w.jsx)(x.Z,{showCaption:N,setShowCaption:ee,editor:q,buttonRef:I,imageRef:j,maxWidth:f,onResizeStart:en,onResizeEnd:et,captionsEnabled:L})]})})}}}]);