"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1849,8126],{51778:function(e,t,n){n.d(t,{E:function(){return L}});var r=n(59499),o=n(11163),a=n.n(o),i=n(58095),s=n(32836),c=n(42846),l=n(23391),u=n(6812),d=n(30381),p=n.n(d),m=n(26447),f=n(11057),y=n(90629),h=n(15861),v=n(9164),b=n(8602),g=n(25248),x=n(26143),j=n(16835),O=n(61730),w=n(86886),S=n(50135),Z=n(11994),I=n(3896),C=n(42283),P=n(73359),D=n(67294),k=n(18574),_=n(76301),A=n(88085),E=n(10166),T=n(85893);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var R=function(e){var t,n=e.open,r=e.setOpen,o=e.initialFilters,a=e.filters,i=e.setFilters,s=(0,O.Z)("(max-width: 400px)")?4:0,c=(0,I.X)("form_data_".concat(o.filterType),o),l=(0,j.Z)(c,2),u=l[0],d=l[1],p=(0,C.cI)({defaultValues:u}),m=p.control,y=p.handleSubmit,h=p.register,v=p.reset,b=(0,p.watch)(),g=(0,P.t)(_.SW),x=(0,j.Z)(g,2),Z=x[0],E=x[1],q=E.loading,R=E.data,N=(R=void 0===R?{items:[]}:R).items,M=(0,P.t)(_._d,{variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:null===(t=b.customer)||void 0===t?void 0:t.value}}}}}),L=(0,j.Z)(M,2),V=L[0],W=L[1],H=W.loading,U=W.data,z=(U=void 0===U?{items:[]}:U).items,G=(0,P.t)(_.UM),B=(0,j.Z)(G,2),Y=B[0],Q=B[1],K=Q.loading,X=Q.data,ee=(X=void 0===X?{items:[]}:X).items;(0,D.useEffect)(function(){n&&v(u)},[n]),(0,D.useEffect)(function(){var e;d($($({},b),{},{filterType:o.filterType}))},[a]);var et=function(e){try{var t,n,o,a={customerId:null===(t=e.customer)||void 0===t?void 0:t.value,locationId:null===(n=e.location)||void 0===n?void 0:n.value,categoryId:null===(o=e.assetCategory)||void 0===o?void 0:o.value,q:e.search?"%".concat(e.search,"%"):null};i(function(e){return $($({},e),a)})}finally{r(!1)}},en=function(){i(o),v(o),r(!1)};return(0,T.jsx)(F,{keepMounted:!0,open:n,onClose:function(){return r(!1)},children:(0,T.jsx)("form",{onSubmit:y(et),children:(0,T.jsx)(J,{children:(0,T.jsxs)(w.ZP,{container:!0,rowGap:4,children:[(0,T.jsx)(w.ZP,{container:!0,children:(0,T.jsx)(w.ZP,{item:!0,xs:12,children:(0,T.jsx)(S.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"search",inputRef:h})})}),(0,T.jsxs)(w.ZP,{container:!0,columnSpacing:4,rowGap:s,children:[(0,T.jsx)(w.ZP,{item:!0,xs:12,xs2:6,children:(0,T.jsx)(C.Qr,{name:"customer",control:m,render:function(e){var t=e.value,n=e.onChange;return(0,T.jsx)(k.F,{value:t,onChange:function(e,t){return n(t)},label:"Select customer",loading:q,onOpen:function(){return Z()},options:N})}})}),(0,T.jsx)(w.ZP,{item:!0,xs:12,xs2:6,children:(0,T.jsx)(C.Qr,{name:"location",control:m,render:function(e){var t=e.value,n=e.onChange;return(0,T.jsx)(k.F,{value:t,onChange:function(e,t){return n(t)},label:"Select location",loading:H,onOpen:function(){return V()},options:z})}})})]}),(0,T.jsx)(w.ZP,{container:!0,columnSpacing:4,rowGap:s,children:(0,T.jsx)(w.ZP,{item:!0,xs:12,xs2:6,children:(0,T.jsx)(C.Qr,{name:"assetCategory",control:m,render:function(e){var t=e.value,n=e.onChange;return(0,T.jsx)(k.F,{value:t,onChange:function(e,t){return n(t)},label:"Select asset category",loading:K,onOpen:function(){return Y()},options:ee})}})})}),(0,T.jsx)(w.ZP,{container:!0,item:!0,xs:12,children:(0,T.jsxs)(A.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,T.jsx)(f.Z,{variant:"contained",color:"danger",onClick:function(){return en()},children:"Cancel"}),(0,T.jsx)(f.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})})]})})})})};R.defaultProps={open:!1,setOpen:function(){},initialFilters:{},filters:{},setFilters:function(){}};var F=(0,E.Z)(Z.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}}),J=(0,E.Z)(y.Z)(function(){return{padding:"24px",maxWidth:"700px",maxHeight:"100vh",overflowY:"scroll"}});function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var L=function(e){var t=e.hideLink,n=e.hideCustomerInfo,r=e.hideLocationInfo,o=e.showHeader,d=e.initialFilters,j=e.editable,O=e.createFormDefaultValues,w=(0,i.a)(),S=(0,D.useState)(!1),Z=S[0],I=S[1],C=(0,D.useState)(M({},d)),P=C[0],k=C[1],_=(0,c.x)({filters:P}),A=_.initialData,E=_.ref,q=(0,u.a)(l.tG,{variables:M({},A)}),$=q.data,F=($=void 0===$?{assets:[],meta:{aggregate:{totalCount:0}}}:$).assets,J=$.meta,N=q.loading,L=q.refetch,V=function(){w.show({content:(0,T.jsx)(g.R,{offCanvas:w,defaultValues:O}),title:"Add Asset",submit:!0})},W=function(e){w.show({content:(0,T.jsx)(g.R,{assetId:e.id,offCanvas:w,defaultValues:O}),title:"Edit Asset",submit:!0})},H=function(e){var t=[];return j&&t.push({icon:"edit",onClick:function(t){t.stopPropagation(),W(e)},tooltip:"Edit"}),t.push({icon:"info",onClick:function(t){t.stopPropagation(),a().push("/dashboard/assets/view?id=".concat(e.id))},tooltip:"Info"}),t},U=function(e){var t=e.row;a().push("/dashboard/assets/view?id=".concat(t.id))};return(0,T.jsxs)(m.Z,{width:"100%",spacing:2,sx:{height:"calc(100% - 58px)"},children:[o&&(0,T.jsxs)(m.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,T.jsx)(f.Z,{variant:"contained",startIcon:(0,T.jsx)(b.Z,{}),onClick:function(){return I(!0)},children:"Filters"}),j&&(0,T.jsx)(m.Z,{direction:"row",spacing:2,children:(0,T.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:V,children:"Create Asset"})})]}),(0,T.jsxs)(y.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:"100%"},children:[(0,T.jsxs)(m.Z,{direction:"row",justifyContent:"space-between",children:[(0,T.jsx)(h.Z,{ml:2,variant:"h5",sx:{fontWeight:600},children:"Assets"}),j&&!o&&(0,T.jsx)(f.Z,{sx:{mr:2},variant:"contained",color:"secondary",onClick:V,children:"Create Asset"})]}),o&&(0,T.jsx)(R,{initialFilters:d,filters:P,setFilters:k,open:Z,setOpen:I}),(0,T.jsx)(s.i,{autoHeight:!1,loading:N,ref:E,columns:[{minWidth:80,flex:1,field:"name",headerName:"Name",sortable:!1},{minWidth:100,flex:1,field:"description",headerName:"Description",sortable:!1},{minWidth:80,flex:1,field:"categoryName",headerName:"Category",sortable:!1},{minWidth:120,flex:1,field:"locationName",headerName:"Location",sortable:!1,renderCell:function(e){var t=e.row;return(0,T.jsx)(v.r,{color:"secondary",href:"/dashboard/properties/view?id=".concat(t.locationId),children:t.locationName})}},{minWidth:80,flex:1,field:"sublocationName",headerName:"Sublocation",sortable:!1,renderCell:function(e){var n=e.row;return(0,T.jsx)(v.r,{noWrap:t,color:"secondary",href:"/dashboard/properties/view?id=".concat(n.locationId,"&tab=sublocations"),children:n.sublocationName})}},{minWidth:120,flex:1,field:"customerName",headerName:"Customer",sortable:!1,renderCell:function(e){var t=e.row;return(0,T.jsx)(v.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(t.customerId),children:t.customerName})}},{minWidth:60,flex:1,field:"type",headerName:"Type",sortable:!1},{minWidth:60,flex:1,field:"status",headerName:"Status",sortable:!1},{minWidth:100,flex:1,field:"createdAt",headerName:"Created",sortable:!0,sortName:"createdAt"},{width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var t=e.row;return(0,T.jsx)(x.C,{row:t,actionsData:H})}}],rows:F.map(function(e){var t,n,r,o,a,i,s,c,l,u,d,m,f,y,h,v,b;return{id:e.id,customer:{label:null===(t=e.customer)||void 0===t?void 0:t.name,value:null===(n=e.customer)||void 0===n?void 0:n.id},assetCategory:{label:null===(r=e.category)||void 0===r?void 0:r.name,value:null===(o=e.category)||void 0===o?void 0:o.id},description:e.description,name:e.name,location:{label:null===(a=e.location)||void 0===a?void 0:a.name,value:null===(i=e.location)||void 0===i?void 0:i.id},sublocation:{label:null===(s=e.sublocation)||void 0===s?void 0:s.name,value:null===(c=e.sublocation)||void 0===c?void 0:c.id},parent:{label:null===(l=e.parentId)||void 0===l?void 0:l.label,value:null===(u=e.parentId)||void 0===u?void 0:u.value},status:e.status,locationId:null===(d=e.location)||void 0===d?void 0:d.id,customerId:null===(m=e.customer)||void 0===m?void 0:m.id,categoryName:null===(f=e.category)||void 0===f?void 0:f.name,locationName:null===(y=e.location)||void 0===y?void 0:y.name,sublocationName:null===(h=e.sublocation)||void 0===h?void 0:h.name,type:null!==(v=e.parentId)&&void 0!==v&&v.value?"Child":"Parent",customerName:null===(b=e.customer)||void 0===b?void 0:b.name,createdAt:p()(e.createdAt).format("YYYY-MM-DD")}}),meta:J,refetch:L,onRowClick:U,containerHeight:"calc(100% - 32px)",columnVisibilityModel:{locationName:!r,customerName:!n}})]})]})};L.defaultProps={initialFilters:{},hideLink:!1,hideCustomerInfo:!1,hideLocationInfo:!1,showHeader:!0,editable:!0}},69770:function(e,t,n){n.d(t,{F:function(){return L}});var r=n(59499),o=n(27812),a=n(4730),i=n(50029),s=n(64687),c=n.n(s),l=n(67294),u=n(11163),d=n(66252),p=n(12690),m=n(78289),f=n(58965),y=n(9270),h=n(62140),v=n(58786),b=n(92742),g=n(72936),x=n(55863),j=n(37068),O=n(33366),w=n(10367),S=n(85893),Z=function(e){var t=e.status;return(0,S.jsx)(I,{children:(0,S.jsx)("ul",{children:t.map(function(e,t){return(0,S.jsxs)("li",{children:[(0,S.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(t))})})})},I=w.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-1gaw8i-0"})(["ul{list-style:none;float:left;padding-top:15px;}ul li{display:flex;flex-direction:row;align-items:center;float:left;width:120px;font-size:90%;list-style:none;}li span{display:block;float:left;height:12px;width:12px;margin-right:5px;}"]),C=n(62047),P=n(55843),D=n(51466),k=n(58594),_=n(71772),A=n(42283),E=n(19015);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $=function(e){var t=e.setTypes,n=e.setFilters,r=e.setSiteVisit,a=e.types,i=(0,g.x)().hasRole,s=(0,A.cI)({defaultValues:F}),c=s.control,u=s.errors,d=s.register,p=(0,s.watch)("userId");(0,l.useEffect)(function(){n(function(e){return q(q({},e),{},{userId:(null==p?void 0:p.value)||null})})},[p]);var m=function(e,n){n?t([].concat((0,o.Z)(a),[e])):t(a.filter(function(t){return t!==e}))},f=function(e){r(e.target.checked)};return(0,S.jsxs)(y.Z,{children:[(0,S.jsxs)(R,{md:3,children:[(0,S.jsx)(C.Z,{onToggle:function(e){return m("reactive",e)},size:"sm",toggled:a.includes("reactive")}),(0,S.jsx)(P.Z,{marginLeft:"sm"}),(0,S.jsx)(D.Z,{size:"sm",children:"Reactive"})]}),(0,S.jsxs)(R,{md:3,children:[(0,S.jsx)(C.Z,{onToggle:function(e){return m("ppm",e)},size:"sm",toggled:a.includes("ppm")}),(0,S.jsx)(P.Z,{marginLeft:"sm"}),(0,S.jsx)(D.Z,{size:"sm",children:"PPM"})]}),(0,S.jsxs)(R,{md:3,children:[(0,S.jsx)(C.Z,{onToggle:function(e){return m("quote",e)},size:"sm",toggled:a.includes("quote")}),(0,S.jsx)(P.Z,{marginLeft:"sm"}),(0,S.jsx)(D.Z,{size:"sm",children:"Quote"})]}),(0,S.jsxs)(R,{md:3,children:[(0,S.jsx)(C.Z,{onToggle:function(e){return m("cppm",e)},size:"sm",toggled:a.includes("cppm")}),(0,S.jsx)(P.Z,{marginLeft:"sm"}),(0,S.jsx)(D.Z,{size:"sm",children:"Compliance"})]}),(0,S.jsxs)(y.Z,{style:{width:"100%",margin:0},children:[i(E.n)&&(0,S.jsx)(h.Z,{md:6,children:(0,S.jsx)(_.P,q(q({},{control:c,errors:u,register:d}),{},{errors:q({},u),label:"",name:"userId",placeholder:"Select user",type:"user"}))}),(0,S.jsx)(h.Z,{md:6,style:{display:"flex",alignItems:"center"},children:(0,S.jsx)(k.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:f})})]})]})},R=(0,w.ZP)(h.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-3gjja8-0"})(["align-items:center;display:flex;"]),F={userId:null},J=["supplierQuotes"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var L=function(e){var t,n,r,s,w=e.defaultFilters,I=e.defaultView,C=e.locationId,P=e.showCompliance,D=e.showFilters,k=e.showSiteVisits,_=e.supplierId,A=(0,u.useRouter)().query,E=(0,l.useContext)(m.Z),T=(0,x.q)(),q=null===(t=T.admin)||void 0===t?void 0:null===(n=t.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,R=null===(r=T.admin)||void 0===r?void 0:null===(s=r.jobSetting)||void 0===s?void 0:s.jobNumberSuffix,F=(0,g.x)().user,N=(0,d.x)(),L=!1,V=!1;switch(F.accountType){case"supplier":V=!0;break;case"customer":L=!0}var W,H=(0,l.useState)(A.type?["".concat(A.type)]:w),U=H[0],z=H[1],G=(0,l.useState)(k),B=G[0],Y=G[1],Q=(0,l.useState)(null),K=Q[0],X=Q[1],ee="scheduled"===A.type?"PPM":"Bookings";(0,l.useEffect)(function(){return A.type?["".concat(A.type)]:V?z(["ppm"]):z(w)},[w]);var et=(W=(0,i.Z)(c().mark(function e(t,n){var r,i,s,l,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={type:{_in:U},_or:[{_and:[{timingStart:{_gte:t.start}},{timingStart:{_lte:t.end}}]},{_and:[{scheduledAt:{_gte:t.start}},{scheduledAt:{_lte:t.end}}]},{_and:[{siteVisitStart:{_gte:t.start}},{siteVisitStart:{_lte:t.end}}]}]},V&&(r.supplierId={_eq:F.accountId}),_&&(r.supplierId={_eq:_}),L&&(r.customerId={_eq:F.accountId}),C&&(r.locationId={_eq:C}),(P||C)&&(r.Compliances={complianceId:{_is_null:!1}}),K&&(r.customerUserId={_eq:null==K?void 0:K.userId}),B&&(r.siteVisitStart={_is_null:!1}),e.next=10,N.query({query:p.f,variables:{where:r}});case 10:l=(s=void 0===(s=e.sent.data)?{events:[]}:s).events,u=[],l.map(function(e){var t,n=e.supplierQuotes,r=(0,a.Z)(e,J),i=(null==r?void 0:null===(t=r.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||r.title;return u=[].concat((0,o.Z)(u),[M(M({},e),{},{title:i})]),n.length>0&&n.map(function(e){return u=[].concat((0,o.Z)(u),[M(M({},r),{},{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(i," ").concat(e.quoteNumber),siteVisit:!0})])}),u}),n(u.map(function(e){var t=M({},e);return t.start=t.scheduledAt||t.start,t.end=t.scheduledAt||t.end||t.start,t.color=t.siteVisit?"rgb(182, 79, 200)":(0,b.t)(t.status),t}));case 17:case"end":return e.stop()}},e)})),function(e,t){return W.apply(this,arguments)}),en=function(e){E.show({content:(0,S.jsx)(j.g,{jobId:parseInt(e.event.id),toggleShow:E.close,numberPrefix:q,numberSuffix:R}),title:"Job details",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,S.jsxs)(f.Z,{fitParentHeight:!0,open:!0,title:ee,children:[D&&(0,S.jsx)($,{setTypes:z,setFilters:X,setSiteVisit:Y,types:U}),(0,S.jsx)(v.A,{eventClick:en,events:et,initialView:"day"===A.show?"timeGridDay":I}),(0,S.jsx)(y.Z,{children:(0,S.jsx)(h.Z,{md:12,children:(0,S.jsx)(Z,{status:O.yW})})})]})};L.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},58786:function(e,t,n){n.d(t,{A:function(){return a}});var r=n(13625),o=n(85893),a=function(e){var t=e.dateClick,n=e.events,a=e.eventClick,i=e.eventContent,s=(e.hasLoading,e.height),c=e.initialView;return(0,o.jsx)(r.Z,{dateClick:t,eventClick:a,eventContent:i,events:n,hasLoading:!0,height:s,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:c})};a.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},12690:function(e,t,n){n.d(t,{f:function(){return s}});var r,o=n(71383),a=n(75063),i=n(4431),s=(0,a.Ps)(r||(r=(0,o.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      type\n      description\n      end: timingEnd\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      quoteDue\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n              code\n            }\n          }\n        }\n      }\n      supplier: Supplier {\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"])),i.WW,i.MR)},907:function(e,t,n){n.d(t,{M:function(){return N}});var r=n(16835),o=n(67294),a=n(11163),i=n(6812),s=n(50319),c=n(42890),l=n(11640),u=n(78289),d=n(68956),p=n(77439),m=n(58965),f=n(16540),y=n(6788),h=n(99229),v=n(59499),b=n(42283),g=n(79665),x=n(7739),j=n.n(x),O=n(76600),w=n(49501),S=n(84043),Z=n(55563),I=n(28497),C=n(74231),P=(0,C.Ry)().shape({complianceId:(0,C.Ry)().required(),expiryAt:(0,C.hT)().required(),insuranceAmount:(0,C.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),regNum:(0,C.Z_)().required()}),D=n(52220),k=n(66822),_=n(72936),A=n(85893);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){(0,v.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var q=function(e){e.complianceType;var t,n,r=e.defaultValues,a=e.onSubmit,s=(0,_.x)().user,l=(0,b.cI)({defaultValues:T(T({},r),(null==r?void 0:r.meta)||{}),resolver:(0,g.S)(P)}),u=l.control,d=l.errors,p=l.handleSubmit,m=l.register,f=(0,l.watch)("complianceId",{hasInsuranceAmount:null==r?void 0:r.hasInsuranceAmount,regNumExample:null==r?void 0:r.regNumExample,questions:null==r?void 0:r.questions}),y=f&&f.questions,h=(0,i.a)(c.kU,{variables:{adminId:s.adminId}}),v=h.loading,x=h.data,C=(x=void 0===x?{compliance:[]}:x).compliances,E={control:u,errors:d,register:m};return!v&&(0,A.jsxs)(O.Z,{id:"offCanvasForm",handleSubmit:p(a),children:[(0,A.jsx)(w.Z,{label:"Compliance",children:(0,A.jsx)(S.Z,T(T({},E),{},{name:"complianceId",options:(t=j()(C,function(e){return e.category.name}),n=[],Object.keys(t).forEach(function(e){n.push({label:e,options:t[e]})}),n)}))}),(0,A.jsx)(w.Z,{label:"Registration Number",children:(0,A.jsx)(Z.Z,T(T({},E),{},{name:"regNum",placeholder:f.regNumExample&&"eg ".concat(f.regNumExample)}))}),(0,A.jsx)(w.Z,{label:"Expiry"}),(0,A.jsx)(D.M,T(T({},E),{},{name:"expiryAt",placeholderText:"Click to select date"})),f.hasInsuranceAmount&&(0,A.jsx)(w.Z,{label:"Insurance Amount",children:(0,A.jsx)(I.Z,T(T({},E),{},{name:"insuranceAmount"}))}),null==y?void 0:y.map(function(e){var t,n,r,a;return(0,o.createElement)(k.f,T(T({},E),{},{input:null===(t=e.meta)||void 0===t?void 0:t.input,inputType:null===(n=e.meta)||void 0===n?void 0:n.inputType,key:e.id,label:null===(r=e.meta)||void 0===r?void 0:r.label,name:e.name,options:null===(a=e.meta)||void 0===a?void 0:a.options}))}),(null==r?void 0:r.id)&&(0,A.jsx)(Z.Z,T(T({},E),{},{name:"id",type:"hidden"}))]})},$=function(e){var t=e.entity,n=e.entityId,r=e.form,o={complianceId:r.complianceId.value,entityId:n,entity:t,expiryAt:r.expiryAt,insuranceAmount:r.insuranceAmount,regNum:r.regNum};return delete r.complianceId,delete r.expiryAt,delete r.insuranceAmount,delete r.regNum,o.meta=r,o},R=n(65524),F=new Date,J=(0,l.Z)(F,1),N=function(e){var t,n,l,v=e.entity,b=e.entityId,g=(0,a.useRouter)().query,x=(0,o.useContext)(u.Z),j=(0,_.x)().hasRole,O=j("supplier"),w=j("tenant"),S=j("customer"),Z=(0,i.a)(c.Au,{variables:{entity:v,entityId:b}}),I=Z.loading,C=Z.data,P=(C=void 0===C?{job:null}:C).compliances,D=Z.refetch,k=(0,s.D)(c.FD,{onCompleted:function(e){x.close(),D()}}),E=(0,r.Z)(k,1)[0],T=(0,s.D)(c.YW,{onCompleted:function(e){x.close(),D()}}),N=(0,r.Z)(T,1)[0],M=(0,s.D)(c.tC,{onCompleted:function(e){D()}}),L=(0,r.Z)(M,1)[0],V=function(e){var t=$({entity:v,entityId:b,form:e});e.id?N({variables:{id:e.id,changes:t}}):E({variables:{objects:t}})},W=function(e){var t=e.row;x.show({content:(0,A.jsx)(h.G,{entity:"Compliance_Entity",entityId:null==t?void 0:t.id}),submit:!1,title:"Media"})},H=function(e){var t=e.e,n=e.row;t.stopPropagation(),x.show({content:(0,A.jsx)(q,{complianceType:"Account"===v?null:"regulatory",defaultValues:n,onSubmit:V}),title:"Compliance"})},U=function(e){L({variables:{id:e.row.id}})},z=[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Registration number"},{formatter:y.FT,text:"Expiry date"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!!O,formatter:d.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:(t={editClick:function(e,t){return H({e:e,row:t})},mediaClick:function(e,t){return W({row:t})},deleteClick:function(e,t){return U({row:t})}}).editClick,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:t.mediaClick,tooltip:"Media"},{context:"danger",icon:["fas","trash"],onClick:t.deleteClick,tooltip:"Delete"}],text:"Actions"}],G=(0,A.jsx)(p.Z,{content:"Add Compliance",context:"secondary",onClick:function(e){return H({e:e})},size:"sm"});return!I&&(0,A.jsxs)(m.Z,{open:!0,title:"Compliances",toolbar:!O&&!w&&!S&&G,children:["Location"===v&&(0,A.jsx)(R.p,{locationId:b,hideFinance:w}),(0,A.jsx)(f.Z,{columns:z,rows:(l=P,g.overdue&&(l=P.filter(function(e){return new Date(e.expiryAt)<F})),g.upcoming&&(l=P.filter(function(e){return new Date(e.expiryAt)>F&&new Date(e.expiryAt)<J})),null===(n=l)||void 0===n?void 0:n.map(function(e){return{id:e.id,complianceId:{label:e.compliance.name,value:e.compliance.id,hasInsuranceAmount:e.compliance.hasInsuranceAmount,insuranceAmount:e.insuranceAmount,questions:e.compliance.questions,regNumExample:e.compliance.regNumExample},name:e.compliance.name,regNum:e.regNum,expiry:e.expiryAt,expiryAt:e.expiryAt?new Date(e.expiryAt):"",insuranceAmount:e.insuranceAmount,hasInsuranceAmount:e.compliance.hasInsuranceAmount,regNumExample:e.compliance.regNumExample,meta:e.meta,actions:""}}))})]})}},84083:function(e,t,n){n.d(t,{z:function(){return ei}});var r,o,a,i,s,c=n(59499),l=n(50029),u=n(16835),d=n(64687),p=n.n(d),m=n(67294),f=n(66252),y=n(6812),h=n(50319),v=n(71383),b=n(75063),g=(0,b.Ps)(r||(r=(0,v.Z)(["\n  mutation InsertExpense($objects: [Expense_insert_input!]!) {\n    insert_Expense(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),x=(0,b.Ps)(o||(o=(0,v.Z)(["\n  mutation UpdateExpense($id: Int!, $changes: Expense_set_input) {\n    update_Expense_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),j=(0,b.Ps)(a||(a=(0,v.Z)(["\n  mutation UpdateExpense($parentId: Int!, $changes: Expense_set_input) {\n    parentExspense: update_Expense(where: { id: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    childExpenses: update_Expense(where: { parentId: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),O=(0,b.Ps)(i||(i=(0,v.Z)(['\n  query GetExpenses($entity: String, $entityId: Int, $jobId: Int) {\n    expenses: Expense(\n      where: { jobId: { _eq: $jobId }, entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n    ) {\n      id\n      categoryId\n      description\n      amount\n      unit\n      markup\n      vat\n      paid\n      jobId\n      total\n      entity\n      entityId\n      occurredAt\n      recurring\n      category: Category {\n        name\n      }\n      media: Media(where: { entity: { _eq: "Expense" } }) {\n        id\n      }\n    }\n  }\n']))),w=(0,b.Ps)(s||(s=(0,v.Z)(["\n  mutation DeleteExpense($id: Int!) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n  }\n"]))),S=n(52019),Z=n(11082),I=n(68956),C=n(16551),P=n(77439),D=n(33006),k=n(9270),_=n(62140),A=n(86036),E=n(16540),T=n(58965),q=n(34197),$=n(99229),R=n(42283),F=n(79665),J=n(76600),N=n(90951),M=n(28497),L=n(49501),V=n(55563),W=n(32979),H=n(6710),U=n(71772),z=n(74231),G=(0,z.Ry)().shape({amount:(0,z.Rx)().required(),unit:(0,z.Rx)().required(),categoryId:(0,z.Ry)().required(),description:(0,z.Z_)().required(),markup:(0,z.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),paid:(0,z.Z_)().oneOf(["admin","supplier"]).required(),vatMarkup:(0,z.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable()}),B=n(85893);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var K=function(e){e.categories,e.currency;var t=e.defaultValues,n=e.submit,r=e.serviceRateExpenses,o=e.showRecurring;null!=t&&t.vat&&(null==t?void 0:t.vat)!=="20"&&(t.vatMarkup=t.vat,t.vat="custom");var a=(0,R.cI)({defaultValues:Q({vat:"20"},t),resolver:(0,F.S)(G)}),i=a.control,s=a.errors,c=a.handleSubmit,l=a.register,u=(0,a.watch)("vat"),d={control:i,errors:s,register:l};return(0,B.jsxs)(J.Z,{id:"offCanvasForm",handleSubmit:c(n),children:[(0,B.jsx)(N.Z,Q(Q({},d),{},{name:"paid",data:[{id:"admin",label:"Admin",value:"admin"},{id:"supplier",label:"Supplier",value:"supplier"}],legend:"Paid by"})),(0,B.jsx)(M.Z,Q(Q({},d),{},{name:"amount",label:"Unit Cost",vat:"Ex VAT"})),(0,B.jsx)(L.Z,{label:"Units",children:(0,B.jsx)(V.Z,Q(Q({},d),{},{name:"unit"}))}),(0,B.jsx)(N.Z,Q(Q({},d),{},{name:"vat",data:[{id:"default",label:"Default (20%)",value:20},{id:"custom",label:"Custom",value:"custom"}],legend:"VAT"})),"custom"===u&&(0,B.jsx)(W.Z,Q(Q({},d),{},{label:"Custom VAT",name:"vatMarkup"})),r?(0,B.jsx)(V.Z,Q(Q({},d),{},{name:"markup",type:"hidden"})):(0,B.jsx)(W.Z,Q(Q({},d),{},{label:"Markup ".concat(r?"(Service Rate Expenses and Materials : ".concat(r,"%)"):""),name:"markup"})),(0,B.jsx)(U.P,Q(Q({},d),{},{errors:Q({},s),label:"Category",name:"categoryId",type:"expenseCategory"})),(0,B.jsx)(L.Z,{label:"Description",children:(0,B.jsx)(H.Z,Q(Q({},d),{},{name:"description",rows:2}))}),o&&(0,B.jsx)(N.Z,Q(Q({},d),{},{name:"recurring",data:[{id:"recurring",label:"Recurring",value:"recurring"},{id:"nextInvoice",label:"Only for next invoice",value:"nextInvoice"}]})),t.id&&(0,B.jsx)(V.Z,Q(Q({},d),{},{name:"id",type:"hidden"}))]})};K.defaultProps={currency:"GBP",serviceRateExpenses:0,showRecurring:!1};var X=n(41391),ee=n(33908),et=n(11552),en=n(73845),er=n(58095);function eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ea(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ei=function(e){var t,n,r,o,a,i,s=e.currency,c=e.enableUpdate,d=e.entity,v=e.entityId,b=e.job,R=e.jobs,F=e.refetchParent,J=e.tab,N=e.withDetails,M=e.showRecurring,L=(0,f.x)(),V=(0,m.useContext)(S.Z).hasRole,W=(0,er.a)(),H=(0,q.E)(b,"invoiceSent"),U=(0,q.E)(b,"closed"),z=V("customer")&&!H,G=!b||!U&&(V(["admin"])&&!(0,q.E)(b,["validated","unvalidated"])||V(["admin","supplier"])&&!(0,q.E)(b,"reportSent")||c),Y=(0,ee.B)("serviceRateExpenses",null==b?void 0:b.financeLogs,null==b?void 0:null===(t=b.customer)||void 0===t?void 0:null===(n=t.meta)||void 0===n?void 0:null===(r=n.finance)||void 0===r?void 0:r.serviceRateExpenses)||0,Q=J||(!V("admin")&&V("supplier")?"supplier":"admin"),eo=(0,y.a)(O,{variables:{entity:d,entityId:v,jobId:null==b?void 0:b.id},skip:z}),ei=eo.data,es=(ei=void 0===ei?{expenses:[]}:ei).expenses,ec=eo.loading,el=eo.refetch,eu=(0,X.E)(es,0,Q),ed=eu.preparedExpenses,ep=eu.totalExpenses,em=eu.totalExpensesExVAT,ef=(0,h.D)(w,{onCompleted:function(){b&&(0,et.F)(L,b.id),"JobSchedule"===d&&v&&(0,en.j)({client:L,scheduleId:v}),"Location"===d&&v&&(0,en.j)({client:L,locationId:v}),F?F():el()}}),ey=(0,u.Z)(ef,1)[0],eh=(0,h.D)(g,{onCompleted:function(){b&&(0,et.F)(L,b.id),"JobSchedule"===d&&v&&(0,en.j)({client:L,scheduleId:v}),"Location"===d&&v&&(0,en.j)({client:L,locationId:v}),W.close(),F?F():el()}}),ev=(0,u.Z)(eh,1)[0],eb=(0,h.D)(x,{onCompleted:function(){b&&(0,et.F)(L,b.id),"JobSchedule"===d&&v&&(0,en.j)({client:L,scheduleId:v}),"Location"===d&&v&&(0,en.j)({client:L,locationId:v}),W.close(),F?F():el()}}),eg=(0,u.Z)(eb,1)[0],ex=(0,h.D)(j,{onCompleted:function(){b&&(0,et.F)(L,b.id),"JobSchedule"===d&&v&&(0,en.j)({client:L,scheduleId:v}),"Location"===d&&v&&(0,en.j)({client:L,locationId:v}),W.close(),F?F():el()}}),ej=(0,u.Z)(ex,1)[0],eO=(o=(0,l.Z)(p().mark(function e(t){var n,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=7;break}return delete(n=ea({},t)).id,e.next=5,ej({variables:{parentId:t.id,changes:n}});case 5:e.next=10;break;case 7:return r=ea(ea({},t),{},{entity:d,entityId:v,Expenses:{data:R.map(function(e){return ea(ea({},t),{},{jobId:e.id})})}}),e.next=10,ev({variables:{objects:r}});case 10:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),ew=(a=(0,l.Z)(p().mark(function e(t){var n,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("custom"===t.vat&&(t.vat=t.vatMarkup),r=(n=t.unit*t.amount)*(t.markup/100)+n,t.total=r*(t.vat/100)+r,delete t.vatMarkup,t.categoryId=t.categoryId.value,"JobSchedule"!==d){e.next=11;break}return e.next=9,eO(t);case 9:case 14:e.next=18;break;case 11:if(!t.id){e.next=16;break}return e.next=14,eg({variables:{id:t.id,changes:t}});case 16:return e.next=18,ev({variables:{objects:ea(ea({},t),{},{jobId:null==b?void 0:b.id})}});case 18:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),eS=function(e){var t=e.item?ea({},null==e?void 0:e.item):{markup:Y};null!=t&&t.vat&&(t.vat=String(t.vat)),W.show({content:(0,B.jsx)(K,{currency:s,defaultValues:t,entityId:v,submit:ew,serviceRateExpenses:Y,showRecurring:M}),title:"Expenses"})},eZ=function(e,t){e.preventDefault(),e.stopPropagation(),ey({variables:{id:t.item.id}})},eI=function(e){W.show({content:(0,B.jsx)($.G,{entity:"Expenses",entityId:e.item.id}),submit:!1,title:"Media"})},eC=[{text:"Description"},{formatter:function(e){var t=e.row;return(0,Z.Z)(t.total,s)},text:"Total"},{text:"Paid By"},{formatter:I.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){return eS(t)},tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],numberOverlay:"mediaCount",onClick:function(e,t){return eI(t)},tooltip:"Media"},{context:"danger",icon:["fas","trash"],onClick:function(e,t){return eZ(e,t)},tooltip:"Delete"}],hidden:!G,text:"Actions"},{hidden:!0},{hidden:!0}],eP=function(){return(0,B.jsx)(C.Z,{children:(0,B.jsx)(P.Z,{context:"secondary",content:"Add",onClick:eS,size:"sm"})})},eD=function(){return(0,B.jsxs)(B.Fragment,{children:[!N&&(0,B.jsx)(D.Z,{content:"Expenses",tag:"h3"}),(0,B.jsxs)(k.Z,{children:[(0,B.jsx)(_.Z,{md:6,children:(0,B.jsx)(A.Z,{content:"Total",text:(0,Z.Z)(em,s)})}),(0,B.jsx)(_.Z,{md:6,children:(0,B.jsx)(A.Z,{content:"VAT Total",text:(0,Z.Z)(ep,s)})})]}),(0,B.jsx)(E.Z,{columns:eC,loading:ec,rows:null==ed?void 0:ed.map(function(e){var t,n;return{description:e.description,total:e.total,paid:e.paid.charAt(0).toUpperCase()+e.paid.slice(1),actions:"",item:ea(ea(ea({},e),{occurredAt:new Date(e.occurredAt)}),{categoryId:{label:null===(t=e.category)||void 0===t?void 0:t.name,value:e.categoryId}}),mediaCount:null===(n=e.media)||void 0===n?void 0:n.length}})}),G&&!N&&(0,B.jsx)(C.Z,{align:"flex-end",children:(0,B.jsx)(P.Z,{context:"secondary",content:"Add",onClick:eS,size:"sm"})})]})};return N?(0,B.jsx)(T.Z,{toolbar:G&&(0,B.jsx)(eP,{}),open:!0,title:"Expenses",children:eD()}):eD()};ei.defaultProps={currency:"GBP",enableUpdate:!1,withDetails:!0,showRecurring:!1}},41391:function(e,t,n){n.d(t,{E:function(){return i}});var r=n(59499);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var i=function(e,t,n){var r=0,o=0,i=null==e?void 0:e.filter(function(e){return"supplier"===n&&"supplier"===e.paid||"supplier"!==n});return{preparedExpenses:null==i?void 0:i.map(function(e){var i=e.amount;"supplier"!==n&&(i+=e.markup/100*i,i/=1-t/100);var s=i*(e.unit||1),c=s+s*(e.vat/100);return o+=s,r+=c,a(a({},e),{},{id:e.id,name:e.description,unitCost:i,price:s,total:c,unit:e.unit||1,vatAmount:s*(e.vat/100),vatRate:e.vat/100,markup:e.markup})}),totalExpenses:r,totalExpensesExVAT:o}}},33908:function(e,t,n){n.d(t,{B:function(){return o}});var r=n(27812),o=function(e,t,n){if(!t)return null;var o,a=null===(o=(0,r.Z)(t).sort(function(e,t){return e.createdAt-t.createdAt}).find(function(t){return t.type===e}))||void 0===o?void 0:o.value;return a||0===a?a:n||0}},69892:function(e,t,n){n.d(t,{K:function(){return r}});var r=function(e){var t,n,r,o,a,i,s=null==e?void 0:null===(t=e.repeat)||void 0===t?void 0:t.frequency;return{isAnyTime:(null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:null===(r=n[s.toLocaleLowerCase()])||void 0===r?void 0:r.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(o=e.repeat)||void 0===o?void 0:null===(a=o[s.toLocaleLowerCase()])||void 0===a?void 0:a.excludingWeekends}}},9754:function(e,t,n){n.d(t,{p:function(){return c}});var r=n(27812),o=n(30381),a=n.n(o),i=n(81836),s=n(63831),c=function(e,t,n){var o=i.ZP.fromString(e),c=o.origOptions,l=c.freq,u=c.until,d=c.dtstart,p=a()(d),m=o.all();n&&(p.day()===s.p3.Saturday||p.day()===s.p3.Sunday)&&p.add(p.day()===s.p3.Saturday?2:1,"day");var f=1===a()(d).date(),y=p.isSame(d,"month");if(l===i.Di.MONTHLY&&t&&!f&&y){var h=u?(0,r.Z)(m):m.slice(0,-1);return h.unshift(p),h}return l===i.Di.YEARLY&&t?m.map(function(e,t){var r=a()(e);return t>0&&r.startOf("month"),n&&(r.day()===s.p3.Saturday||r.day()===s.p3.Sunday)&&r.add(r.day()===s.p3.Saturday?2:1,"day"),r}):m}},34197:function(e,t,n){n.d(t,{E:function(){return r}});var r=function(e,t){if(Array.isArray(t)){var n,r=null;return t.forEach(function(t){var n,o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});r=(null==o?void 0:o.createdAt)||r}),r}var o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==o?void 0:o.createdAt)||null}},95102:function(e,t,n){n.d(t,{$A:function(){return y},$E:function(){return h},A1:function(){return f},Un:function(){return m},yf:function(){return b},zg:function(){return v}});var r,o,a,i,s,c,l,u,d=n(71383),p=n(75063);(0,p.Ps)(r||(r=(0,d.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"])));var m=(0,p.Ps)(o||(o=(0,d.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']))),f=(0,p.Ps)(a||(a=(0,d.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]))),y=(0,p.Ps)(i||(i=(0,d.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]))),h=(0,p.Ps)(s||(s=(0,d.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),v=(0,p.Ps)(c||(c=(0,d.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])));(0,p.Ps)(l||(l=(0,d.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"])));var b=(0,p.Ps)(u||(u=(0,d.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"])))},53254:function(e,t,n){n.d(t,{U:function(){return b}});var r=n(84059),o=n(26447),a=n(86532),i=n(38895),s=n(22797),c=n(5616),l=n(15861),u=n(11057),d=n(27434),p=n(39702),m=n(94568),f=n(67294),y=n(85893),h=function(e){var t=e.id,n=e.value,h=e.isExpandedByDefault,b=e.collapsible,g=(0,m.a)(),x=(0,f.useState)(h),j=x[0],O=x[1],w=function(){return O(function(e){return!e})},S=function(e){e.stopPropagation();var n=document.querySelector("#qr-".concat(t," > canvas")).toDataURL(),r=document.createElement("a");r.href=n,r.download="".concat(t,".png"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},Z=(0,f.useMemo)(function(){var e={Main:o.Z,Header:o.Z,Body:o.Z};return b&&(e={Main:a.Z,Header:i.Z,Body:s.Z}),e},[b]);return(0,y.jsx)(c.Z,{children:(0,y.jsxs)(Z.Main,{expanded:j,onChange:w,children:[(0,y.jsx)(Z.Header,{expandIcon:(0,y.jsx)(d.Z,{}),children:(0,y.jsxs)(o.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,y.jsx)(l.Z,{variant:"h6",children:"QR Code"}),(0,y.jsx)(u.Z,{disabled:g,disableMinWidth:!0,size:"small",color:"info",variant:"contained",onClick:S,sx:v.downloadButton,children:(0,y.jsx)(p.Z,{sx:v.downloadIcon})})]})}),(0,y.jsx)(Z.Body,{sx:v.body,children:(0,y.jsx)(o.Z,{id:"qr-".concat(t),alignItems:"center",children:(0,y.jsx)(r.Qd,{bgColor:"#ffffff",fgColor:"#000000",value:n,level:"H",size:256})})})]})})},v={downloadIcon:{height:"17px",width:"17px"},downloadButton:{mr:2},body:{marginTop:"20px"}};h.defaultProps={id:"new-qr-code",isExpandedByDefault:!1,collapsible:!0};var b=h},48126:function(e,t,n){n.d(t,{BH:function(){return g},CH:function(){return O},U$:function(){return b},WJ:function(){return w},k3:function(){return j},tf:function(){return x}});var r,o=n(27812),a=n(50029),i=n(64687),s=n.n(i),c=n(81836),l=n(10928),u=n.n(l),d=n(34197),p=n(30381),m=n.n(p),f=n(63831),y=n(9754),h=n(69892),v=n(99245),b=(r=(0,a.Z)(s().mark(function e(t){var n,r,a,i,c,l,u,d,p,b,g,x,j,O,w,S,Z,I,C,P,D,k,_,A,E;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b=t.addJobFunc,g=t.location,x=t.row,j=t.adminId,w=(O=(0,h.K)(null==x?void 0:x.rruleMeta)).isAnyTime,S=O.excludingWeekends,Z=[],Z=Array.isArray(x.dates)?x.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,y.p)(x.frequency,w,S),I=x.costCustomer,C=x.costSupplier,P=(null==g?void 0:null===(n=g.user)||void 0===n?void 0:n.id)||null,D=x.supplier.value,k=null==x?void 0:null===(r=x.rruleMeta)||void 0===r?void 0:null===(a=r.repeat)||void 0===a?void 0:a.frequency,_=null==x?void 0:null===(i=x.rruleMeta)||void 0===i?void 0:null===(c=i.repeat)||void 0===c?void 0:null===(l=c[k.toLocaleLowerCase()])||void 0===l?void 0:l.hourStart,A=null==x?void 0:null===(u=x.rruleMeta)||void 0===u?void 0:null===(d=u.repeat)||void 0===d?void 0:null===(p=d[k.toLocaleLowerCase()])||void 0===p?void 0:p.hourEnd,E=[],Z.forEach(function(e){var t,n,r,a,i,s,c,l={access:g.access,adminId:j,amount:I,assetCategoryId:null===(t=x.assetCategory)||void 0===t?void 0:t.value,costCategoryId:x.costCategory.value,customerId:g.customer[0].account.id,customerUserId:P,description:x.description,jobScheduleId:x.id,locationId:g.id,sublocationId:null===(n=x.sublocation)||void 0===n?void 0:n.value,managerId:g.customer[0].account.managerId,pricing:"fixed",serviceId:x.service.value,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:C,timing:"at",timingStart:e,timingEnd:m()(e).endOf(f._f[k]),title:x.title,type:"ppm",reference:x.reference,reportPassFail:x.reportPassFail,reportPassFailTitle:x.reportPassFailTitle,requireReportRecommendations:x.requireReportRecommendations,anyTimeOption:w,hourStart:_?m()(_).format("HH:mm:ssZ"):null,hourEnd:A?m()(A).format("HH:mm:ssZ"):null,meta:{customerSignature:x.customerSignature,supplierSignature:x.supplierSignature},JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:D}]},Taxonomy:{data:[{entity:"Job",taxonomyId:x.shortDescription.value}].concat((0,o.Z)(x.tags?(0,v.O)(x.tags):[]))}};null!=x&&null!==(r=x.rruleMeta)&&void 0!==r&&null!==(a=r.repeat)&&void 0!==a&&null!==(i=a[k.toLocaleLowerCase()])&&void 0!==i&&i.excludingWeekends&&(l.timingEnd.day()===f.p3.Saturday||l.timingEnd.day()===f.p3.Sunday)&&l.timingEnd.subtract(f.Fs[l.timingEnd.day()],"day"),x.hasCompliance&&null!==(s=x.complianceSelect)&&void 0!==s&&s.value&&(l.Compliances={data:{complianceId:x.complianceSelect.value,entity:"Job",status:"active"}},l.hasCompliance=!0),x.estimatedDuration&&x.estimatedDurationUnit&&(l.estimatedDuration=x.estimatedDuration,l.estimatedDurationUnit=x.estimatedDurationUnit),(null===(c=x.assetSelected)||void 0===c?void 0:c.length)>0&&(l.Assets={data:x.assetSelected.map(function(e){return{status:"active",assetId:e.value}})}),E.push(l)}),e.t0=(null==E?void 0:E.length)>0,!e.t0){e.next=17;break}return e.next=17,b({variables:{adminId:j,objects:E}});case 17:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)}),g=function(e){var t=e.scheduledJobs,n={},r={};return t.forEach(function(e){if(e.jobs&&e.jobs.length>0){var t,o,a=e.jobs.find(function(e){return new Date(e.timingStart)>new Date});((null==a?void 0:a.timingStart)<(null===(t=n)||void 0===t?void 0:t.timingStart)||!(null!==(o=n)&&void 0!==o&&o.timingStart))&&(n=a)}var i=c.Ci.fromString(e.frequency).all(),s=u()(i);(!r.date||s<(null==r?void 0:r.date))&&(r.date=s,r.name=e.meta.serviceName)}),{nextExpire:r,nextJob:n}},x=function(e){var t=e.frequency,n=e.cost;return c.Ci.fromString(t).all().length*n},j=function(e){var t,n=e.jobScheduleId,r=e.jobs;return r&&(t=r.filter(function(e){return e.jobScheduleId===n&&(0,d.E)(e,["reportSent","closed"])}).length),t||0},O=function(e,t){var n=m()(e.timingStart);return n.isSameOrAfter(t.startDate)&&n.isSameOrBefore(t.endDate)},w=function(e){var t=e.assetSelected,n=void 0===t?[]:t,r=e.compliance,o=e.service,a=void 0===o?[]:o,i=e.assetCategory,s=e.dateFilter,c={status:{_neq:"canceled"}};return null!=s&&s.startDate&&null!=s&&s.endDate&&(c.timingStart={_gte:s.startDate,_lte:s.endDate}),(null==n?void 0:n.length)>0&&(c.Assets={id:{_in:n.map(function(e){return e.value})}}),(null==a?void 0:a.length)>0&&(c.Service={id:{_in:a.map(function(e){return null==e?void 0:e.value})}}),null!=i&&i.value&&(c.AssetCategory={id:{_eq:null==i?void 0:i.value}}),"true"===r&&(c.hasCompliance={_eq:!0}),c}},92186:function(e,t,n){n.d(t,{B6:function(){return v},Ms:function(){return f},RV:function(){return y},YW:function(){return h},mJ:function(){return b}});var r,o,a,i,s,c,l,u,d,p=n(71383),m=n(75063);(0,m.Ps)(r||(r=(0,p.Z)(["\n  query GetAssetParents($ids: [Int!]!) {\n    asset: Asset(where: { id: { _in: $ids } }) {\n      id\n      name\n      parent: ParentAsset {\n        id\n        name\n        parent: ParentAsset {\n          id\n          name\n        }\n      }\n    }\n  }\n"])));var f=(0,m.Ps)(o||(o=(0,p.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule(where: { id: { _eq: $id } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),y=(0,m.Ps)(a||(a=(0,p.Z)(['\n  query GetJobSchedule($orderBy: JobSchedule_order_by!, $locationId: Int) {\n    JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: [$orderBy]) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      contract: JobScheduleContract {\n        name\n        invoiceDate\n        startDate\n        contractLength\n        contractValue\n        status\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings(order_by: { createdAt: desc }) {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])));(0,m.Ps)(i||(i=(0,p.Z)(['\n  query GetJobSchedule($id: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $id) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n  }\n'])));var h=(0,m.Ps)(s||(s=(0,p.Z)(['\n  query GetJobCompliance($locationId: Int!, $where: Job_bool_exp!) {\n    jobSchedule: JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: { id: asc }) {\n      frequency\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      sublocation: Sublocation {\n        id\n        name\n      }\n      serviceName: meta(path: "$.serviceName")\n      costCustomer: meta(path: "$.costCustomer")\n      costSupplier: meta(path: "$.costSupplier")\n      frequency\n      jobs: Jobs(where: $where) {\n        id\n        rag\n        timingStart\n      }\n      totalJobs: Jobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n  }\n']))),v=(0,m.Ps)(c||(c=(0,p.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n'])));(0,m.Ps)(l||(l=(0,p.Z)(["\n  query GetStatusLog($entity: String!, $entityId: Int!) {\n    statusLog: StatusLog(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      id\n      createdAt\n      notes\n      status\n    }\n  }\n"]))),(0,m.Ps)(u||(u=(0,p.Z)(["\n  mutation AddJob($objects: [Job_insert_input!]!) {\n    insert_Job(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"])));var b=(0,m.Ps)(d||(d=(0,p.Z)(["\n  mutation MyMutation($objects: [CreateJobInput]!, $adminId: Int!) {\n    createJob(adminId: $adminId, objects: $objects) {\n      data\n    }\n  }\n"])))},18069:function(e,t,n){n.d(t,{K:function(){return E}});var r=n(59499),o=n(16835),a=n(67294),i=n(59922),s=n(73359),c=n(92186),l=n(52019),u=n(16551),d=n(97303),p=n(77439),m=n(58965),f=n(11717),y=n(51466),h=n(40826),v=n(11082),b=n(42283),g=n(76600),x=n(90951),j=n(71772),O=n(55863),w=n(85893);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I=function(e){var t,n,r=e.defaultValues,o=e.setScheduleFilters,a=e.toggleShow,i=(0,O.q)(),s=null==i?void 0:null===(t=i.admin)||void 0===t?void 0:null===(n=t.modules)||void 0===n?void 0:n.assets,c=(0,b.cI)({defaultValues:r}),l=c.control,u=c.errors,d=c.handleSubmit,p=c.register,m=(0,c.watch)("assetCategory",null==r?void 0:r.assetCategory),f={control:l,errors:u,register:p},y=function(e){o(function(){return Z({},e)}),a()};return(0,w.jsxs)(g.Z,{id:"offCanvasForm",handleSubmit:d(y),children:[(0,w.jsx)(x.Z,Z(Z({},f),{},{name:"compliance",data:[{id:"yes",label:"Yes",value:!0},{id:"no",label:"No",value:!1}],legend:"Compliance"})),s&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(j.P,Z(Z({},f),{},{label:"Asset category",locationId:location.id,name:"assetCategory",type:"assetCategory"})),m&&(0,w.jsx)(j.P,Z(Z({},f),{},{label:"Assets",locationId:location.id,name:"assetSelected",type:"asset",isMulti:!0,assetCategoryId:(null==m?void 0:m.value)||null}))]}),(0,w.jsx)(j.P,Z(Z({},f),{},{errors:Z({},u),isMulti:!0,label:"Service",name:"service",type:"service"}))]})},C=n(48126),P=n(10367),D=n(58095),k=n(99751);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var E=function(e){var t=e.clickable,n=e.handleHistory,r=e.locationId,b=(e.showDetails,e.refetchSchedule),g=e.setRefetchSchedule,x=(e.setR,e.customerDetails),j=e.supplierDetails,O=(0,i.useMainContext)(),S=O.setJobScheduleForToolbar,Z=O.scheduleFilters,P=O.setScheduleFilters,_=(0,D.a)(),E=(0,a.useContext)(l.Z).hasRole,$=function(e,t,r){var o=e.e,a=e.row;o.stopPropagation();var i=Z.mode;"string"!=typeof(null==a?void 0:a.id)&&n(a,i,r)},R=(0,s.t)(c.YW),F=(0,o.Z)(R,2),J=F[0],N=F[1],M=N.data,L=(M=void 0===M?{jobSchedule:[]}:M).jobSchedule,V=void 0===L?[]:L,W=N.refetch;(0,a.useEffect)(function(){S(V)},[V,S]),(0,a.useEffect)(function(){Z&&J({variables:{locationId:r,where:(0,C.WJ)(A({},Z))}})},[J,r,Z]),(0,a.useEffect)(function(){b&&(P(!1),g(!1),W())},[W,b,g,P]);var H=function(e){e.stopPropagation(),_.show({content:(0,w.jsx)(I,{defaultValues:Z,toggleShow:_.close,setScheduleFilters:P}),title:"Filter"})},U=function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,w.jsxs)(u.Z,{children:[(0,w.jsx)(d.Z,{border:!1,passHref:!0,to:"/reports/ppm/schedule?locationId=".concat(r),children:(0,w.jsx)(p.Z,A(A({},e),{},{startIcon:"file-pdf"}))}),(0,w.jsx)(p.Z,A(A({},e),{},{onClick:H,startIcon:"filter"}))]})};return(0,w.jsx)(m.Z,{fitParentHeight:!0,open:!0,title:"Schedule",toolbar:(0,w.jsx)(U,{}),children:(0,w.jsx)(f.Z,{dataSource:V,events:"jobs",eventTimeSplitting:"timingStart",flag:"rag",handleClick:t?$:null,handleFetchData:function(e,t){var n=e.startDate,r=e.endDate;P(function(e){return A(A({},e),{},{dateFilter:{startDate:n,endDate:r},mode:t})})},hiddenColumn:["frequency","id","title","description","sublocation","costCustomer","costSupplier","serviceName","jobs"],initialMode:"year",onTitleFormatter:function(e){var t=e.row;return(0,w.jsxs)(T,{children:[(0,w.jsxs)(q,{children:[(0,w.jsxs)(y.Z,{size:"sm",children:[t.compliance&&(0,w.jsx)(h.Z,{context:"info",icon:"clipboard-check"}),t.serviceName]}),t.costCustomer&&E("customer")&&(0,w.jsx)(y.Z,{size:"xs",children:(0,v.Z)(t.costCustomer)}),t.costSupplier&&E("supplier")&&(0,w.jsx)(y.Z,{size:"xs",children:(0,v.Z)(t.costSupplier)}),t.costCustomer&&E("admin")&&t.costCustomer&&x&&(0,w.jsxs)(y.Z,{size:"xs",children:["Customer: ",(0,v.Z)(t.costCustomer)]}),t.costSupplier&&E("admin")&&j&&t.costSupplier&&(0,w.jsxs)(y.Z,{size:"xs",children:["Supplier: ",(0,v.Z)(t.costSupplier)]})]}),(0,w.jsxs)(q,{children:[(0,w.jsx)(y.Z,{size:"sm",children:t.title}),(0,w.jsx)(k.O,{maxLength:40,children:t.description}),t.sublocation&&(0,w.jsxs)(y.Z,{size:"xs",children:["Sublocation: ",t.sublocation.name]})]})]})},title:"serviceName"})})};E.defaultProps={clickable:!0,showDetails:!0};var T=P.ZP.div.withConfig({displayName:"schedule__StyledContainer",componentId:"sc-1swtgpg-0"})(["width:100%;text-align:left;display:flex;column-gap:10px;"]),q=P.ZP.div.withConfig({displayName:"schedule__StyledItem",componentId:"sc-1swtgpg-1"})(["width:50%;"])},56707:function(e,t,n){n.d(t,{J:function(){return rZ}});var r,o,a,i,s,c,l,u,d,p,m,f,y,h,v,b,g=n(67294),x=n(10367),j=n(58965),O=n(86036),w=n(97303),S=n(9270),Z=n(62140),I=n(26186),C=n(77439),P=n(11082),D=n(24588),k=n(59499),_=n(6812),A=n(59922),E=n(92186),T=n(16551),q=n(41564),$=n(51466),R=n(68956),F=n(15214),J=n(11587),N=n(67872),M=n(84083),L=n(58786),V=n(92742),W=n(37068),H=n(58095),U=n(85893),z=function(e){var t,n,r,o,a=e.jobs,i=e.jobSchedule,s=(0,H.a)(),c=(r=i.map(function(e){return e.id}),(o=a.filter(function(e){return r.includes(e.jobScheduleId)})).map(function(e){var t;return{id:e.id,color:(0,V.t)(e.status),start:e.timingStart,end:e.timingEnd||e.timingStart,title:(null===(t=e.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||e.title,description:e.description,status:e.status}})),l=function(e){s.show({content:(0,U.jsx)(W.g,{jobId:parseInt(e.event.id),toggleShow:s.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,U.jsx)(L.A,{eventClick:l,events:c,hasLoading:!0})},G=n(50029),B=n(16835),Y=n(64687),Q=n.n(Y),K=n(30381),X=n.n(K),ee=n(83704),et=n.n(ee),en=n(50319),er=n(71383),eo=n(75063),ea=(0,eo.Ps)(r||(r=(0,er.Z)(["\n  mutation AddJobSchedule($objects: [JobSchedule_insert_input!]!) {\n    insert_JobSchedule(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),ei=(0,eo.Ps)(o||(o=(0,er.Z)(["\n  mutation UpdateJobSchedule($id: Int!, $object: JobSchedule_set_input!) {\n    update_JobSchedule(where: { id: { _eq: $id } }, _set: $object) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),es=(0,eo.Ps)(a||(a=(0,er.Z)(['\n  mutation UpdateJobSchedule(\n    $adminId: Int!\n    $changes: JobSchedule_set_input\n    $currentJobId: Int!\n    $frequencyChanged: Boolean!\n    $hasCreateJobs: Boolean!\n    $id: Int!\n    $job: Job_set_input\n    $jobs: [CreateJobInput]!\n    $today: timestamptz\n    $updateAllJobs: Boolean!\n    $updateCurrentJob: Boolean!\n  ) {\n    update_JobSchedule_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    update_Job(_set: $job, where: { jobScheduleId: { _eq: $id }, timingStart: { _gte: $today } })\n      @include(if: $updateAllJobs) {\n      affected_rows\n    }\n    update_Job_by_pk(pk_columns: { id: $currentJobId }, _set: $job)\n      @include(if: $updateCurrentJob) {\n      id\n    }\n    cancel: update_Job(\n      _set: { status: "canceled" }\n      where: { jobScheduleId: { _eq: $id }, _not: { JobTimings: { status: { _eq: "completed" } } } }\n    ) @include(if: $frequencyChanged) {\n      affected_rows\n    }\n    createJob(adminId: $adminId, objects: $jobs) @include(if: $hasCreateJobs) {\n      data\n    }\n  }\n'])));(0,eo.Ps)(i||(i=(0,er.Z)(["\n  mutation UpdateJobSchedule(\n    $id: Int!\n    $changes: JobScheduleContract_set_input\n    $statusLog: [StatusLog_insert_input!]!\n  ) {\n    update_JobScheduleContract_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_StatusLog(objects: $statusLog) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"])));var ec=n(42283),el=n(79665),eu=n(6054),ed=n(57282),ep=n(76600),em=n(49501),ef=n(6710),ey=n(55563),eh=n(95103),ev=n(58594),eb=n(28497),eg=n(21023),ex=n(69368),ej=n(84808),eO=n(98456),ew=n(9205),eS=n(36968),eZ=n.n(eS),eI=n(63831),eC=n(81836),eP=function(e){var t=e.onDate.date;return X().isMoment(X()(t))||(t=new Date().setMilliseconds(0)),{dtstart:X()(t).toDate()}},eD=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ek=function(e){var t={};switch(e.which){case"First":t.bysetpos=1;break;case"Second":t.bysetpos=2;break;case"Third":t.bysetpos=3;break;case"Fourth":t.bysetpos=4;break;case"Last":t.bysetpos=-1}switch(e.day){case"Monday":t.byweekday=[0];break;case"Tuesday":t.byweekday=[1];break;case"Wednesday":t.byweekday=[2];break;case"Thursday":t.byweekday=[3];break;case"Friday":t.byweekday=[4];break;case"Saturday":t.byweekday=[5];break;case"Sunday":t.byweekday=[6];break;case"Day":t.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":t.byweekday=[0,1,2,3,4];break;case"Weekend day":t.byweekday=[5,6]}return t.bymonth=eD.indexOf(e.month)+1,t};function e_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e_(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eE=function(e){var t,n=e.mode,r=e.on,o=e.onThe;switch(e.excludingWeekends,n){case"on":return eA({freq:eC.Ci.YEARLY},(t=r,{bymonth:eD.indexOf(t.month)+1,bymonthday:t.day}));case"anyTimeOption":return{freq:eC.Ci.YEARLY};default:return eA({freq:eC.Ci.YEARLY},ek(o))}},eT=function(e){var t={};switch(e.which){case"First":t.bysetpos=1;break;case"Second":t.bysetpos=2;break;case"Third":t.bysetpos=3;break;case"Fourth":t.bysetpos=4;break;case"Last":t.bysetpos=-1}switch(e.day){case"Monday":t.byweekday=[0];break;case"Tuesday":t.byweekday=[1];break;case"Wednesday":t.byweekday=[2];break;case"Thursday":t.byweekday=[3];break;case"Friday":t.byweekday=[4];break;case"Saturday":t.byweekday=[5];break;case"Sunday":t.byweekday=[6];break;case"Day":t.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":t.byweekday=[0,1,2,3,4];break;case"Weekend day":t.byweekday=[5,6]}return t};function eq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eR=function(e){var t,n=e.mode,r=e.interval,o=e.on,a=e.onThe,i=e.excludingWeekends;switch(n){case"on":return e$({freq:eC.Ci.MONTHLY,interval:r},(t=o,{bymonthday:t.day}));case"anyTimeOption":return e$(e$({freq:eC.Ci.MONTHLY,interval:r},i&&{byweekday:[eC.Ci.MO,eC.Ci.TU,eC.Ci.WE,eC.Ci.TH,eC.Ci.FR],bysetpos:[1]}),!i&&{bymonthday:[1]});default:return e$({freq:eC.Ci.MONTHLY,interval:r},eT(a))}},eF=n(27812),eJ=n(52628),eN=n.n(eJ);function eM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eM(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eV=function(e){var t=e.mode,n=e.interval,r=e.days,o=e.excludingWeekends;return"anyTimeOption"===t?eL(eL({freq:eC.Ci.WEEKLY,interval:n,bysetpos:[1]},o&&{byweekday:[eC.Ci.MO,eC.Ci.TU,eC.Ci.WE,eC.Ci.TH,eC.Ci.FR]}),!o&&{byweekday:[eC.Ci.MO,eC.Ci.TU,eC.Ci.WE,eC.Ci.TH,eC.Ci.FR,eC.Ci.SA,eC.Ci.SU]}):eL({freq:eC.Ci.WEEKLY,interval:n,byweekday:eN()(r).reduce(function(e,t,n){return t?[].concat((0,eF.Z)(e),[n]):e},[])},o&&{byweekday:[eC.Ci.MO,eC.Ci.TU,eC.Ci.WE,eC.Ci.TH,eC.Ci.FR],bysetpos:[1]})},eW=function(e){var t=e.interval;return e.excludingWeekends,{freq:eC.Ci.DAILY,interval:t}};function eH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var eU=function(e){var t=e.interval,n=e.excludingWeekends;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eH(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({freq:eC.Ci.HOURLY,interval:t},n&&{byweekday:[eC.Ci.MO,eC.Ci.TU,eC.Ci.WE,eC.Ci.TH,eC.Ci.FR],bysetpos:[1]})},ez=function(e){var t=e.frequency,n=e.yearly,r=e.monthly,o=e.weekly,a=e.daily,i=e.hourly;switch(t){case"Yearly":return eE(n);case"Monthly":return eR(r);case"Weekly":return eV(o);case"Daily":return eW(a);case"Hourly":return eU(i);default:return{}}},eG=function(e){var t=e.mode,n=e.after,r=e.onDate.date,o={};return"After"===t&&(o.count=n),"On date"===t&&(o.until=X()(r).toDate()),o},eB=function(e){var t=e.hideStart,n=e.weekStartsOnSunday,r={};return t&&(r.dtstart=null),n&&(r.wkst=eC.Ci.SU),r};function eY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eY(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eK=function(e){var t=e.start,n=e.repeat,r=e.end,o=e.options,a=eQ(eQ(eQ(eQ({},eP(t)),ez(n)),eG(r)),eB(o)),i=new eC.Ci(a);return{rruleString:i.toString(),rruleText:i.toText()}},eX=function(e,t){switch(t.freq){case 0:return"Yearly";case 1:return"Monthly";case 2:return"Weekly";case 3:return"Daily";case 4:return"Hourly";default:return e.repeat.frequency}},e0=function(e,t,n){var r,o;return null!=n&&null!==(r=n.repeat)&&void 0!==r&&null!==(o=r.yearly)&&void 0!==o&&o.mode?n.repeat.yearly.mode:0===t.freq&&t.bymonth?t.bymonthday?"on":"on the":e.repeat.yearly.mode},e1=function(e,t){var n;return 0===t.freq&&t.byweekday?"number"==typeof t.bymonth?eD[t.bymonth-1]:null!==(n=t.bymonth)&&void 0!==n&&n[0]?eD[t.bymonth[0]-1]:void 0:e.repeat.yearly.onThe.month},e2=function(e,t){if(0!==t.freq||!t.byweekday)return e.repeat.yearly.onThe.day;var n=t.byweekday.map(function(e){return e.weekday}).join(",");switch(n){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.yearly.onThe.day}},e6=function(e,t){if(0!==t.freq||!t.byweekday)return e.repeat.yearly.onThe.which;var n="number"==typeof t.bysetpos?t.bysetpos:t.bysetpos[0];switch(n){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.yearly.onThe.which}},e3=function(e,t,n){var r,o;return null!=n&&null!==(r=n.repeat)&&void 0!==r&&null!==(o=r.monthly)&&void 0!==o&&o.mode?n.repeat.monthly.mode:1!==t.freq?e.repeat.monthly.mode:t.bymonthday?"on":"on the"},e5=function(e,t){if(1!==t.freq||!t.byweekday)return e.repeat.monthly.onThe.day;var n=t.byweekday.map(function(e){return e.weekday}).join(",");switch(n){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.monthly.onThe.day}},e9=function(e,t){if(1!==t.freq||!t.bysetpos)return e.repeat.monthly.onThe.which;var n="number"==typeof t.bysetpos?t.bysetpos:t.bysetpos[0];switch(n){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.monthly.onThe.which}},e8=function(e,t){var n=[];return 2!==t.freq?e.repeat.weekly.days:(t.byweekday&&(n=t.byweekday.map(function(e){return e.weekday})),{mon:n.includes(0),tue:n.includes(1),wed:n.includes(2),thu:n.includes(3),fri:n.includes(4),sat:n.includes(5),sun:n.includes(6)})},e4=function(e,t){return t.wkst?6===t.wkst:e.options.weekStartsOnSunday};function e7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e7(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e7(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tt=function(e,t,n){if(!t)return e;try{var r,o,a,i,s,c,l,u,d,p,m,f,y,h,v,b,g,x,j,O,w,S,Z,I,C,P,D,k,_,A,E,T,q,$,R,F,J,N,M,L,V,W,H,U,z,G,B,Y,Q,K,ee,et,en,er,eo,ea,ei,es,ec,el,eu,ed,ep,em,ef,ey,eh,ev=(0,eC.SA)(t).origOptions;r=te(te({},e),{},{start:te(te({},e.start),{},{onDate:{date:X()((G=e,B=ev,B.dtstart?B.dtstart:G.start.onDate.date)),options:te(te({},e.start.onDate.options),{},{weekStartsOnSunday:e4(e,ev)})}}),repeat:te(te({},e.repeat),{},{frequency:eX(e,ev),yearly:te(te({},e.repeat.yearly),{},{mode:e0(e,ev,n),excludingWeekends:null==n?void 0:null===(o=n.repeat)||void 0===o?void 0:null===(a=o.yearly)||void 0===a?void 0:a.excludingWeekends,hourStart:null!=n&&null!==(i=n.repeat)&&void 0!==i&&null!==(s=i.yearly)&&void 0!==s&&s.hourStart?new Date(null==n?void 0:null===(c=n.repeat)||void 0===c?void 0:null===(l=c.yearly)||void 0===l?void 0:l.hourStart):null,hourEnd:null!=n&&null!==(u=n.repeat)&&void 0!==u&&null!==(d=u.yearly)&&void 0!==d&&d.hourEnd?new Date(null==n?void 0:null===(p=n.repeat)||void 0===p?void 0:null===(m=p.yearly)||void 0===m?void 0:m.hourEnd):null,on:{month:(Y=e,Q=ev,0===Q.freq&&Q.bymonthday?"number"==typeof Q.bymonth?eD[Q.bymonth-1]:eD[Q.bymonth[0]-1]:Y.repeat.yearly.on.month),day:(K=e,ee=ev,0===ee.freq&&ee.bymonthday?"number"==typeof ee.bymonthday?ee.bymonthday:ee.bymonthday[0]:K.repeat.yearly.on.day)},onThe:{month:e1(e,ev),day:e2(e,ev),which:e6(e,ev)}}),monthly:te(te({},e.repeat.monthly),{},{mode:e3(e,ev,n),excludingWeekends:null==n?void 0:null===(f=n.repeat)||void 0===f?void 0:null===(y=f.monthly)||void 0===y?void 0:y.excludingWeekends,hourStart:null!=n&&null!==(h=n.repeat)&&void 0!==h&&null!==(v=h.monthly)&&void 0!==v&&v.hourStart?new Date(null==n?void 0:null===(b=n.repeat)||void 0===b?void 0:null===(g=b.monthly)||void 0===g?void 0:g.hourStart):null,hourEnd:null!=n&&null!==(x=n.repeat)&&void 0!==x&&null!==(j=x.monthly)&&void 0!==j&&j.hourEnd?new Date(null==n?void 0:null===(O=n.repeat)||void 0===O?void 0:null===(w=O.monthly)||void 0===w?void 0:w.hourEnd):null,interval:(et=e,en=ev,1!==en.freq?et.repeat.monthly.interval:en.interval),on:{day:(er=e,eo=ev,1===eo.freq&&eo.bymonthday?"number"==typeof eo.bymonthday?eo.bymonthday:eo.bymonthday[0]:er.repeat.monthly.on.day)},onThe:{day:e5(e,ev),which:e9(e,ev)}}),weekly:{mode:null==n?void 0:null===(S=n.repeat)||void 0===S?void 0:null===(Z=S.weekly)||void 0===Z?void 0:Z.mode,excludingWeekends:null==n?void 0:null===(I=n.repeat)||void 0===I?void 0:null===(C=I.weekly)||void 0===C?void 0:C.excludingWeekends,hourStart:null!=n&&null!==(P=n.repeat)&&void 0!==P&&null!==(D=P.weekly)&&void 0!==D&&D.hourStart?new Date(null==n?void 0:null===(k=n.repeat)||void 0===k?void 0:null===(_=k.weekly)||void 0===_?void 0:_.hourStart):null,hourEnd:null!=n&&null!==(A=n.repeat)&&void 0!==A&&null!==(E=A.weekly)&&void 0!==E&&E.hourEnd?new Date(null==n?void 0:null===(T=n.repeat)||void 0===T?void 0:null===(q=T.weekly)||void 0===q?void 0:q.hourEnd):null,interval:(ea=e,ei=ev,2!==ei.freq?ea.repeat.weekly.interval:ei.interval),days:e8(e,ev),options:{weekStartsOnSunday:e4(e,ev)}},daily:{mode:null==n?void 0:null===($=n.repeat)||void 0===$?void 0:null===(R=$.daily)||void 0===R?void 0:R.mode,interval:(es=e,ec=ev,3!==ec.freq?es.repeat.daily.interval:ec.interval),excludingWeekends:null==n?void 0:null===(F=n.repeat)||void 0===F?void 0:null===(J=F.daily)||void 0===J?void 0:J.excludingWeekends,hourStart:null!=n&&null!==(N=n.repeat)&&void 0!==N&&null!==(M=N.daily)&&void 0!==M&&M.hourStart?new Date(null==n?void 0:null===(L=n.repeat)||void 0===L?void 0:null===(V=L.daily)||void 0===V?void 0:V.hourStart):null,hourEnd:null!=n&&null!==(W=n.repeat)&&void 0!==W&&null!==(H=W.daily)&&void 0!==H&&H.hourEnd?new Date(null==n?void 0:null===(U=n.repeat)||void 0===U?void 0:null===(z=U.daily)||void 0===z?void 0:z.hourEnd):null},hourly:{interval:(el=e,eu=ev,4!==eu.freq?el.repeat.daily.interval:eu.interval)}}),end:te(te({},e.end),{},{mode:(ed=e,ep=ev,ep.count||0===ep.count?"After":ep.until?"On date":"After"),after:(em=e,ef=ev,ef.count||0===ef.count?ef.count:em.end.after),onDate:{date:X()((ey=e,eh=ev,eh.until?eh.until:ey.end.onDate.date)),options:te(te({},e.end.onDate.options),{},{weekStartsOnSunday:e4(e,ev)})}}),options:te(te({},e.options),{},{weekStartsOnSunday:e4(e,ev)}),error:null})}catch(eb){return te(te({},e),{},{error:{value:t,message:eb}})}return r},tn=n(41609),tr=n.n(tn),to=n(73955),ta=n.n(to),ti=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=tr()(n)?ta()("rrule-"):n,o={start:{onDate:{date:X()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:t}}},repeat:{frequency:e.repeat?e.repeat[0]:"Yearly",yearly:{mode:e.yearly||"on",on:{month:"Jan",day:1},onThe:{month:"Jan",day:"Monday",which:"First"},options:{modes:e.yearly}},monthly:{mode:e.monthly||"on",interval:1,on:{day:1},onThe:{day:"Monday",which:"First"},options:{modes:e.monthly}},weekly:{interval:1,days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},options:{weekStartsOnSunday:e.weekStartsOnSunday}},daily:{interval:1},hourly:{interval:1},options:{frequency:e.repeat}},end:{mode:e.end?e.end[0]:"After",after:1,onDate:{date:X()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:t}},options:{modes:e.end}},options:{hideStart:void 0===e.hideStart||e.hideStart,hideEnd:e.hideEnd,hideError:e.hideError,weekStartsOnSunday:e.weekStartsOnSunday},error:null};return{id:r,data:o,rrule:eK(o)}},ts=function(e,t){var n=[];for(var r in e)!0===e[r]&&n.push(r);return t.filter(function(e){return n.includes(e.value)})},tc=n(52220),tl=n(313),tu=n(96843),td=n(89345),tp=n(7654),tm=n.n(tp),tf=function(e){return function(t){var n=+t.target.value;!tm()(n)&&!(n>=1e3)&&e({target:{value:n,name:t.target.name}})}};function ty(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function th(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ty(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ty(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tv=function(e){var t=e.data,n=e.defaultOptions,r=e.handleChange,o=e.mainDefaultOptions,a=e.setValue,i=e.setValueParent,s=e.watch,c=s("end.onDate.date"),l=s("start.onDate.date");return(0,g.useEffect)(function(){((0,tu.Z)(c,l)||(0,tl.Z)(c,l))&&"On date"===t.end.mode?i("formErrors",""):i("formErrors","No Error")},[c,l,t.end.mode]),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(em.Z,{label:"End on",children:[(0,U.jsx)(eh.Z,th(th({},n),{},{name:"end.mode",options:eI.ut,onChange:r})),(0,U.jsx)(ey.Z,th(th({},o),{},{name:"formErrors",type:"hidden"}))]}),function(){switch(t.end.mode){case"After":return(0,U.jsx)(em.Z,{label:"Occurrences",children:(0,U.jsx)(ey.Z,th(th({},n),{},{name:"end.after",onChange:tf(r)}))});case"On date":var e=(0,tu.Z)(c,l)||(0,tl.Z)(c,l);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(tc.M,th(th({},n),{},{locale:td.Z,name:"end.onDate.date",placeholder:"End On",shouldCloseOnSelect:!0,onChange:function(e){var t=X()(e).utc(!0).startOf("day").toDate();a("end.onDate.date",new Date(t)),i("end.onDate.date",new Date(t))}})),e&&(0,U.jsx)($.Z,{context:"danger",content:"End On should be less than start date",size:"sm"})]})}}()]})};function tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tb(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tx=function(e){var t=e.defaultOptions,n=e.handleChange,r=e.setValue,o=(0,e.watch)("repeat.daily.mode"),a=function(e){return function(t){r(e,t),n({target:{name:e,value:t}})}},i=function(e){n({target:{name:e.target.name,value:e.target.checked?"anyTimeOption":null}})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(S.Z,{align:"center",children:[(0,U.jsx)(Z.Z,{md:2,children:"every"}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(ey.Z,tg(tg({},t),{},{name:"repeat.daily.interval",onChange:tf(n)}))}),(0,U.jsx)(Z.Z,{md:3,children:"day(s)"})]}),(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(ev.Z,tg(tg({},t),{},{onChange:i,name:"repeat.daily.mode",data:eI.Ib,stacked:!1}))})}),"anyTimeOption"===o&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(em.Z,{label:"Between hours of",children:(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,tg(tg({},t),{},{locale:td.Z,name:"repeat.daily.hourStart",onChange:a("repeat.daily.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,tg(tg({},t),{},{locale:td.Z,name:"repeat.daily.hourEnd",onChange:a("repeat.daily.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})})]})};function tj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tj(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tw=function(e){var t=e.defaultOptions,n=e.handleChange;return(0,U.jsx)(U.Fragment,{children:(0,U.jsxs)(S.Z,{align:"center",children:[(0,U.jsx)(Z.Z,{md:2,children:"every"}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(ey.Z,tO(tO({},t),{},{name:"repeat.hourly.interval",onChange:tf(n)}))}),(0,U.jsx)(Z.Z,{md:3,children:"hour(s)"})]})})},tS=n(90951),tZ=[{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"4",value:"4"},{text:"5",value:"5"},{text:"6",value:"6"},{text:"7",value:"7"},{text:"8",value:"8"},{text:"9",value:"9"},{text:"10",value:"10"},{text:"11",value:"11"},{text:"12",value:"12"},{text:"13",value:"13"},{text:"14",value:"14"},{text:"15",value:"15"},{text:"16",value:"16"},{text:"17",value:"17"},{text:"18",value:"18"},{text:"19",value:"19"},{text:"20",value:"20"},{text:"21",value:"21"},{text:"22",value:"22"},{text:"23",value:"23"},{text:"24",value:"24"},{text:"25",value:"25"},{text:"26",value:"26"},{text:"27",value:"27"},{text:"28",value:"28"},{text:"29",value:"29"},{text:"30",value:"30"},{text:"31",value:"31"}];function tI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tI(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tP=function(e){var t=e.defaultOptions,n=e.handleChange,r=(e.weeklyDays,e.setValue),o=(0,e.watch)("repeat.monthly.mode"),a=function(e){return function(t){r(e,t),n({target:{name:e,value:t}})}},i=function(e){n({target:{name:e.target.name,value:e.target.checked}})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(S.Z,{align:"center",style:{marginBottom:"1rem"},children:[(0,U.jsx)(Z.Z,{md:3,children:"every"}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(ey.Z,tC(tC({},t),{},{name:"repeat.monthly.interval",onChange:tf(n)}))}),(0,U.jsx)(Z.Z,{md:3,children:"month(s)"})]}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(tS.Z,tC(tC({},t),{},{data:eI.c7,name:"repeat.monthly.mode",onChange:n,stacked:!1}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,tC(tC({},t),{},{name:"repeat.monthly.on.day",onChange:tf(n),options:tZ}))})]}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(tS.Z,tC(tC({},t),{},{data:eI.qG,name:"repeat.monthly.mode",onChange:n,stacked:!1}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,tC(tC({},t),{},{name:"repeat.monthly.onThe.which",onChange:n,options:eI.$9}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,tC(tC({},t),{},{name:"repeat.monthly.onThe.day",onChange:n,options:eI.pH}))})]}),(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(tS.Z,tC(tC({},t),{},{onChange:n,name:"repeat.monthly.mode",data:eI.Ib,stacked:!1}))})}),"anyTimeOption"===o&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(ev.Z,tC(tC({},t),{},{data:eI.MF,name:"repeat.monthly.excludingWeekends",onChange:i,stacked:!1}))})}),(0,U.jsx)(em.Z,{label:"Between hours of",children:(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,tC(tC({},t),{},{locale:td.Z,name:"repeat.monthly.hourStart",onChange:a("repeat.monthly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,tC(tC({},t),{},{locale:td.Z,name:"repeat.monthly.hourEnd",onChange:a("repeat.monthly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})},tD=n(84043);function tk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function t_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tk(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tA=function(e){var t=e.currentWeeklyDays,n=e.defaultOptions,r=e.handleChange,o=e.setValue,a=(0,e.watch)("repeat.weekly.mode"),i=function(e){Object.keys(t).forEach(function(e){return t[e]=!1}),e.forEach(function(e){t[e.value]=!0}),o("repeat.weekly.days",ts(t,eI.$i)),r({target:{value:t,name:"repeat.weekly.days"}})},s=function(e){return function(t){o(e,t),r({target:{name:e,value:t}})}},c=function(e){r({target:{name:e.target.name,value:e.target.checked?"anyTimeOption":null}})},l=function(e){r({target:{name:e.target.name,value:e.target.checked}})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(S.Z,{align:"center",style:{marginBottom:"1rem"},children:[(0,U.jsx)(Z.Z,{md:3,children:"every"}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(ey.Z,t_(t_({},n),{},{name:"repeat.weekly.interval",onChange:tf(r)}))}),(0,U.jsx)(Z.Z,{md:3,children:"week(s)"})]}),(0,U.jsx)(tE,t_(t_({},n),{},{isMulti:!0,isDisabled:"anyTimeOption"===a,name:"repeat.weekly.days",onChange:i,options:eI.$i})),(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(ev.Z,t_(t_({},n),{},{onChange:c,name:"repeat.weekly.mode",data:eI.Ib,stacked:!1}))})}),"anyTimeOption"===a&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(ev.Z,t_(t_({},n),{},{data:eI.MF,name:"repeat.weekly.excludingWeekends",onChange:l,stacked:!1}))})}),(0,U.jsx)(em.Z,{label:"Between hours of",children:(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,t_(t_({},n),{},{locale:td.Z,name:"repeat.weekly.hourStart",onChange:s("repeat.weekly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,t_(t_({},n),{},{locale:td.Z,name:"repeat.weekly.hourEnd",onChange:s("repeat.weekly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})},tE=(0,x.ZP)(tD.Z).withConfig({displayName:"weekly__Select",componentId:"sc-aa1s62-0"})(["&& > div:first-of-type{","}&&{margin-bottom:1rem;}"],function(e){return e.isDisabled?"background-color: #cecece !important;":""}),tT=[{text:"Month",value:""},{text:"Jan",value:"Jan"},{text:"Feb",value:"Feb"},{text:"Mar",value:"Mar"},{text:"Apr",value:"Apr"},{text:"May",value:"May"},{text:"Jun",value:"Jun"},{text:"Jul",value:"Jul"},{text:"Aug",value:"Aug"},{text:"Sep",value:"Sep"},{text:"Oct",value:"Oct"},{text:"Nov",value:"Nov"},{text:"Dec",value:"Dec"}];function tq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function t$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tq(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tR=function(e){var t=e.defaultOptions,n=e.handleChange,r=e.setValue,o=(0,e.watch)("repeat.yearly.mode"),a=function(e){return function(t){r(e,t),n({target:{name:e,value:t}})}},i=function(e){n({target:{name:e.target.name,value:e.target.checked}})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(tS.Z,t$(t$({},t),{},{onChange:n,name:"repeat.yearly.mode",data:eI.jT,stacked:!1}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,t$(t$({},t),{},{name:"repeat.yearly.on.month",onChange:n,options:tT}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,t$(t$({},t),{},{name:"repeat.yearly.on.day",onChange:tf(n),options:tZ}))})]}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(tS.Z,t$(t$({},t),{},{onChange:n,name:"repeat.yearly.mode",data:eI.e6,stacked:!1}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,t$(t$({},t),{},{name:"repeat.yearly.onThe.which",onChange:n,options:eI.$9}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,t$(t$({},t),{},{name:"repeat.yearly.onThe.day",onChange:n,options:eI.pH}))}),(0,U.jsx)(Z.Z,{md:3,children:(0,U.jsx)(eh.Z,t$(t$({},t),{},{name:"repeat.yearly.onThe.month",onChange:n,options:tT}))})]}),(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(tS.Z,t$(t$({},t),{},{onChange:n,name:"repeat.yearly.mode",data:eI.CM,stacked:!1}))})}),"anyTimeOption"===o&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(S.Z,{children:(0,U.jsx)(Z.Z,{sm:12,children:(0,U.jsx)(ev.Z,t$(t$({},t),{},{data:eI.MF,name:"repeat.yearly.excludingWeekends",onChange:i,stacked:!1}))})}),(0,U.jsx)(em.Z,{label:"Between hours of",children:(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,t$(t$({},t),{},{locale:td.Z,name:"repeat.yearly.hourStart",onChange:a("repeat.yearly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,U.jsx)(Z.Z,{sm:6,children:(0,U.jsx)(tc.M,t$(t$({},t),{},{locale:td.Z,name:"repeat.yearly.hourEnd",onChange:a("repeat.yearly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})};function tF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tF(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tN=function(e){var t=e.data,n=e.defaultOptions,r=e.handleChange,o=e.setValue,a=e.watch;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(em.Z,{label:"Repeat",children:(0,U.jsx)(eh.Z,tJ(tJ({},n),{},{name:"repeat.frequency",options:eI.y7,onChange:r}))}),function(){switch(t.repeat.frequency){case"Yearly":return(0,U.jsx)(tR,{defaultOptions:n,handleChange:r,setValue:o,watch:a});case"Monthly":return(0,U.jsx)(tP,{defaultOptions:n,handleChange:r,setValue:o,watch:a});case"Weekly":return(0,U.jsx)(tA,{currentWeeklyDays:t.repeat.weekly.days,defaultOptions:n,handleChange:r,setValue:o,watch:a});case"Daily":return(0,U.jsx)(tx,{defaultOptions:n,handleChange:r,setValue:o,watch:a});case"Hourly":return(0,U.jsx)(tw,{defaultOptions:n,handleChange:r})}}()]})};function tM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tM(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tV=function(e){var t=e.defaultValues,n=e.defaultOptions,r=e.setValueParent,o=(e.watchParent,e.setRRuleMeta),a=e.rruleMeta,i=ti({hideStart:!1},null,null),s=(0,g.useState)(tt(i.data,null==t?void 0:t.frequency,a)),c=s[0],l=s[1],u=(0,ec.cI)({defaultValues:{"start.onDate.date":new Date(c.start.onDate.date),"repeat.frequency":c.repeat.frequency,"repeat.yearly.mode":c.repeat.yearly.mode,"repeat.yearly.excludingWeekends":c.repeat.yearly.excludingWeekends,"repeat.yearly.hourStart":c.repeat.yearly.hourStart,"repeat.yearly.hourEnd":c.repeat.yearly.hourEnd,"repeat.yearly.on.month":c.repeat.yearly.on.month,"repeat.yearly.on.day":c.repeat.yearly.on.day,"repeat.yearly.onThe.which":c.repeat.yearly.onThe.which,"repeat.yearly.onThe.day":c.repeat.yearly.onThe.day,"repeat.yearly.onThe.month":c.repeat.yearly.onThe.month,"repeat.monthly.interval":c.repeat.monthly.interval,"repeat.monthly.mode":c.repeat.monthly.mode,"repeat.monthly.excludingWeekends":c.repeat.monthly.excludingWeekends,"repeat.monthly.hourStart":c.repeat.monthly.hourStart,"repeat.monthly.hourEnd":c.repeat.monthly.hourEnd,"repeat.monthly.on.day":c.repeat.monthly.on.day,"repeat.monthly.onThe.which":c.repeat.monthly.onThe.which,"repeat.monthly.onThe.day":c.repeat.monthly.onThe.day,"repeat.weekly.interval":c.repeat.weekly.interval,"repeat.weekly.mode":c.repeat.weekly.mode,"repeat.weekly.excludingWeekends":c.repeat.weekly.excludingWeekends,"repeat.weekly.hourStart":c.repeat.weekly.hourStart,"repeat.weekly.hourEnd":c.repeat.weekly.hourEnd,"repeat.weekly.days":ts(c.repeat.weekly.days,eI.$i),"repeat.daily.interval":c.repeat.daily.interval,"repeat.daily.mode":c.repeat.daily.mode,"repeat.daily.excludingWeekends":c.repeat.daily.excludingWeekends,"repeat.daily.hourStart":c.repeat.daily.hourStart,"repeat.daily.hourEnd":c.repeat.daily.hourEnd,"repeat.hourly.interval":c.repeat.hourly.interval,"end.mode":c.end.mode,"end.after":c.end.after,"end.onDate.date":new Date(c.end.onDate.date)},resolver:(0,el.S)()}),d=u.control,p=u.errors,m=u.register,f=u.setValue,y=u.watch,h={control:d,errors:p,register:m,setValue:f,watch:y},v=y("start.onDate.date",new Date(c.start.onDate.date)),b=y("end.onDate.date",new Date(c.end.onDate.date)),x=(0,eu.Z)(v),j=(0,eu.Z)(b);(0,g.useEffect)(function(){if(v&&v!==x){var e={target:{value:new Date(v),name:"start.onDate.date"}};O(e)}else if(b&&b!==j){var t={target:{value:new Date(b),name:"end.onDate.date"}};O(t)}},[v,b]);var O=function(e){var t=e.target,n=tL({},c);eZ()(n,t.name,t.value),l(tL({},n));var a=eK(n),i=a.rruleString,s=a.rruleText;r("frequency",i),o(tL({},n)),r("frequencyDescription",s)};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(ey.Z,tL(tL({},n),{},{name:"frequency",type:"hidden"})),(0,U.jsxs)(ep.Z,{id:"Form",children:[(0,U.jsx)(em.Z,{label:"Date of first job",children:(0,U.jsx)(tc.M,tL(tL({},h),{},{name:"start.onDate.date",placeholder:"Date of first job",shouldCloseOnSelect:!0,onChange:function(e){var t=X()(e).utc(!0).startOf("day").toDate();f("start.onDate.date",new Date(t)),r("start.onDate.date",new Date(t))}}))}),(0,U.jsx)(tN,{data:c,defaultOptions:h,handleChange:O,setValue:f,watch:y}),(0,U.jsx)(tv,{data:c,defaultOptions:h,handleChange:O,mainDefaultOptions:n,setValue:f,setValueParent:r,watch:y})]})]})},tW=n(71772),tH=n(45697),tU=n(92264),tz=n(74231),tG=(0,tz.Ry)().shape({shortDescription:(0,tz.Ry)().required(),description:(0,tz.Z_)().required(),costCategory:(0,tz.Ry)().required(),service:(0,tz.Ry)().required(),supplier:(0,tz.Ry)().required(),assetCategory:(0,tz.Ry)().nullable(),assetSelected:(0,tz.IX)(),frequency:(0,tz.Z_)().required(),costCustomer:(0,tz.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),costSupplier:(0,tz.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),formErrors:(0,tz.Z_)().required(),estimatedDuration:(0,tz.Rx)().min(0),estimatedDurationUnit:(0,tz.Z_)()}),tB=(0,tz.Ry)().shape({frequencyConfirm:(0,tz.Z_)().oneOf(["yes"]),supplierConfirm:(0,tz.Z_)()});function tY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tY(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tK=function(e){var t,n=e.isDatesChanged,r=e.isSupplierChanged,o=e.onConfirm,a=e.toggleShow,i=(0,ec.cI)({resolver:(0,el.S)(tB)}),s=i.control,c=i.errors,l=i.handleSubmit,u=i.register,d=(t=(0,G.Z)(Q().mark(function e(t){return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o({updateAllJobs:"futureJobs"===t.supplierConfirm,updateCurrentJob:"nextJob"===t.supplierConfirm}),a();case 2:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),p={control:s,errors:c,register:u};return(0,U.jsxs)(ep.Z,{handleSubmit:l(d),children:[n&&(0,U.jsx)(ev.Z,tQ(tQ({},p),{},{data:[{label:"Do you confirm to change frequency?",key:"frequencyConfirm",value:"yes"}],name:"frequencyConfirm"})),r&&(0,U.jsx)(tS.Z,tQ(tQ({},p),{},{legend:"Do you want to change supplier for next job only or all future jobs?",name:"supplierConfirm",data:[{id:"nextJob",label:"Next job only",value:"nextJob"},{id:"futureJobs",label:"All future jobs",value:"futureJobs"}]})),(0,U.jsx)(tU.H,{content:"Update",type:"submit"})]})};tK.propType={form:tH.object,onConfirm:tH.func,toggleShow:tH.func};var tX=n(27940),t0=function(e){var t,n,r=e.defaultValues,o=e.data;if(!((null==r?void 0:null===(t=r.jobs)||void 0===t?void 0:t.length)>0))return{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1};var a=t1(null==r?void 0:r.dates,o.dates)||(null==r?void 0:r.frequency)!==o.frequency,i=o.meta.supplierId!==(null==r?void 0:null===(n=r.supplier)||void 0===n?void 0:n.value);return i||a?{isConfirm:!0,isSupplierChanged:i,isDatesChanged:a}:{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1}},t1=function(e,t){return Array.isArray(e)?!(e.length===t.length&&t.every(function(t,n){var r=t.date,o=t.selected;return e[n].selected===o&&X()(e[n].date).isSame(r)})):!t.every(function(e){return e.selected})};et()(X());var t2,t6=["assetCategory","costCategory","service","shortDescription","supplier"],t3=function(e){var t,n,r,o=e.form,a=e.location,i=e.rruleMeta,s=e.dates,c=e.scheduleJobId;return o.dates=s,o.locationId=a.id,o.sublocationId=(null===(t=o.sublocation)||void 0===t?void 0:t.value)||null,t6.forEach(function(e){o[e]&&o[e].value&&(o[e+"Id"]=o[e].value,o[e+"Name"]=o[e].label),delete o[e]}),o.meta={assetCategoryId:o.assetCategoryId,assetCategoryName:o.assetCategoryName,costCategoryId:o.costCategoryId,costCategoryName:o.costCategoryName,complianceSelect:o.complianceSelect,hasCompliance:!!o.compliance,costCustomer:o.costCustomer,costSupplier:o.costSupplier,description:o.description,serviceId:o.serviceId,serviceName:o.serviceName,shortDescriptionId:o.shortDescriptionId,shortDescriptionName:o.shortDescriptionName,supplierId:o.supplierId,supplierName:o.supplierName,customerSignature:o.customerSignature,supplierSignature:o.supplierSignature,reportPassFail:!!o.reportPassFail,reportPassFailTitle:o.reportPassFailTitle,requireReportRecommendations:!!o.requireReportRecommendations,rruleMeta:i,tags:o.tags,assets:null===(n=o.assetSelected)||void 0===n?void 0:n.map(function(e){return{value:e.value,label:e.label}})},o.tags&&(o.Taxonomy={data:null===(r=o.tags)||void 0===r?void 0:r.map(function(e){return{entity:"JobSchedule",entityId:c,taxonomyId:e.tag.id}})}),o.estimatedDuration&&o.estimatedDurationUnit?o.estimatedDuration=X().duration(o.estimatedDuration,o.estimatedDurationUnit).as("milliseconds"):(delete o.estimatedDuration,delete o.estimatedDurationUnit),delete o.tags,delete o.assetSelected,delete o.assetCategoryId,delete o.assetCategoryName,delete o.compliance,delete o.complianceSelect,delete o.costCategoryId,delete o.costCategoryName,delete o.serviceId,delete o.serviceName,delete o.description,delete o.shortDescriptionId,delete o.shortDescriptionName,delete o.supplierId,delete o.supplierName,delete o.costCustomer,delete o.costSupplier,delete o.reportPassFail,delete o.reportPassFailTitle,delete o.customerSignature,delete o.supplierSignature,delete o.requireReportRecommendations,delete o.sublocation,o},t5=n(32836),t9=n(9754),t8=n(69892);et()(X());var t4=(t2=(0,G.Z)(Q().mark(function e(t){var n,r,o,a,i,s,c,l,u,d,p,m,f,y,h,v,b,g,x,j,O,w,S,Z,I,C,P,D,k;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y=t.adminId,h=t.defaultValues,v=t.form,b=t.location,x=(g=(0,t8.K)(null==v?void 0:null===(n=v.meta)||void 0===n?void 0:n.rruleMeta)).isAnyTime,j=g.excludingWeekends,O=[],O=Array.isArray(v.dates)?v.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,t9.p)(v.frequency,x,j),w=v.meta.costCustomer,S=v.meta.costSupplier,Z=(null==b?void 0:null===(r=b.user)||void 0===r?void 0:r.id)||null,I=v.meta.supplierId,C=null==v?void 0:null===(o=v.meta)||void 0===o?void 0:null===(a=o.rruleMeta)||void 0===a?void 0:null===(i=a.repeat)||void 0===i?void 0:i.frequency,P=null==v?void 0:null===(s=v.meta)||void 0===s?void 0:null===(c=s.rruleMeta)||void 0===c?void 0:null===(l=c.repeat)||void 0===l?void 0:null===(u=l[C.toLocaleLowerCase()])||void 0===u?void 0:u.hourStart,D=null==v?void 0:null===(d=v.meta)||void 0===d?void 0:null===(p=d.rruleMeta)||void 0===p?void 0:null===(m=p.repeat)||void 0===m?void 0:null===(f=m[C.toLocaleLowerCase()])||void 0===f?void 0:f.hourEnd,k=[],O.forEach(function(e){var t,n,r,o,a,i,s,c,l={access:b.access,adminId:y,amount:w,assetCategoryId:v.meta.assetCategoryId,costCategoryId:v.meta.costCategoryId,customerId:b.customer[0].account.id,customerUserId:Z,description:v.meta.description,jobScheduleId:h.id,locationId:b.id,sublocationId:v.sublocationId,managerId:b.customer[0].account.managerId,pricing:"fixed",serviceId:v.meta.serviceId,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:S,timing:"at",timingStart:e,timingEnd:X()(e).endOf(eI._f[C]),title:v.meta.shortDescriptionName,type:"ppm",reference:v.reference,reportPassFail:v.meta.reportPassFail,reportPassFailTitle:v.meta.reportPassFailTitle,requireReportRecommendations:v.meta.requireReportRecommendations,anyTimeOption:x,hourStart:P?X()(P).format("HH:mm:ssZ"):null,hourEnd:D?X()(D).format("HH:mm:ssZ"):null,JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:I}]},Taxonomy:{data:[{entity:"Job",taxonomyId:null===(t=v.meta)||void 0===t?void 0:t.shortDescriptionId}]}};null!=v&&null!==(n=v.meta)&&void 0!==n&&null!==(r=n.rruleMeta)&&void 0!==r&&null!==(o=r.repeat)&&void 0!==o&&null!==(a=o[C.toLocaleLowerCase()])&&void 0!==a&&a.excludingWeekends&&(l.timingEnd.day()===eI.p3.Saturday||l.timingEnd.day()===eI.p3.Sunday)&&l.timingEnd.subtract(eI.Fs[l.timingEnd.day()],"day"),v.meta.hasCompliance&&null!==(i=v.meta.complianceSelect)&&void 0!==i&&i.value&&(l.Compliances={data:{complianceId:v.meta.complianceSelect.value,entity:"Job",status:"active"}},l.hasCompliance=!0),v.estimatedDuration&&v.estimatedDurationUnit&&(l.estimatedDuration=v.estimatedDuration,l.estimatedDurationUnit=v.estimatedDurationUnit),(null===(s=v.meta)||void 0===s?void 0:null===(c=s.assets)||void 0===c?void 0:c.length)>0&&(l.Assets={data:v.meta.assets.map(function(e){return{status:"active",assetId:e.value}})}),k.push(l)}),e.abrupt("return",k);case 14:case"end":return e.stop()}},e)})),function(e){return t2.apply(this,arguments)}),t7=n(72936),ne=n(55863),nt=n(49908);function nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nn(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}et()(X());var no=function(e){var t,n,r,o,a,i,s=e.currentJob,c=e.defaultValues,l=e.location,u=e.onSuccess,d=(0,t7.x)(),p=d.user,m=d.hasRole,f=(0,H.a)(),y=(0,ne.q)(),h=null==y?void 0:null===(t=y.admin)||void 0===t?void 0:null===(n=t.modules)||void 0===n?void 0:n.assets,v=(0,g.useState)(null==c?void 0:c.rruleMeta),b=v[0],x=v[1],O=(0,t8.K)(b),w=O.isAnyTime,I=O.excludingWeekends,C=(0,g.useState)((null==c?void 0:c.dates)||[]),P=C[0],D=C[1],k=(0,g.useRef)(!0),_=(0,ec.cI)({defaultValues:nr(nr({},c),{},{estimatedDuration:X().duration(c.estimatedDuration,"milliseconds").as(c.estimatedDurationUnit)}),resolver:(0,el.S)(tG)}),A=_.control,E=_.errors,T=_.handleSubmit,q=_.register,$=_.setValue,R=_.watch,F=R("frequency"),J=R("shortDescription"),N=R("compliance",null==c?void 0:c.compliance),M=R("service"),L=R("assetCategory",null==c?void 0:c.assetCategory),V=R("tags",null==c?void 0:c.tags),W=(0,eu.Z)(J),z=(0,eu.Z)(L),Y=(0,eu.Z)(M);(0,g.useEffect)(function(){var e,t,n,r,o,a,i,s,c,l,u,d,p,m,f,y,h,v,b;(null==W?void 0:W.value)!==(null==J?void 0:J.value)&&null!=J&&null!==(e=J.meta)&&void 0!==e&&e.template&&[{name:"description",value:null===(a=J.meta)||void 0===a?void 0:null===(i=a.template)||void 0===i?void 0:i.description},{name:"costCategory",value:null===(s=J.meta)||void 0===s?void 0:null===(c=s.template)||void 0===c?void 0:c.costCategorySelected},{name:"service",value:null===(l=J.meta)||void 0===l?void 0:null===(u=l.template)||void 0===u?void 0:u.serviceSelected},{name:"reportPassFail",value:(null==J?void 0:null===(d=J.meta)||void 0===d?void 0:null===(p=d.template)||void 0===p?void 0:p.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==J?void 0:null===(m=J.meta)||void 0===m?void 0:null===(f=m.template)||void 0===f?void 0:f.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==J?void 0:null===(y=J.meta)||void 0===y?void 0:null===(h=y.template)||void 0===h?void 0:h.requireReportRecommendations)||!1},{name:"tags",value:(null==J?void 0:null===(v=J.meta)||void 0===v?void 0:null===(b=v.template)||void 0===b?void 0:b.tags)||[]}].map(function(e){var t;return $(e.name,e.value)}),null!=J&&null!==(t=J.meta)&&void 0!==t&&null!==(n=t.template)&&void 0!==n&&n.customerSignature&&$("customerSignature",!0),null!=J&&null!==(r=J.meta)&&void 0!==r&&null!==(o=r.template)&&void 0!==o&&o.supplierSignature&&$("supplierSignature",!0),L!==z&&z&&$("assetSelected",null),M!==Y&&Y&&$("supplier",null)},[L,c,z,Y,W,M,$,J]),(0,g.useEffect)(function(){if(F){if(Array.isArray(null==c?void 0:c.dates)&&k.current){k.current=!1;return}D((0,t9.p)(F,w,I).map(function(e){return{date:e,selected:!0}}))}},[F,I,null==c?void 0:c.dates,w]);var K,ee,et=(0,en.D)(ea,{onCompleted:function(e){}}),er=(0,B.Z)(et,2),eo=er[0],ei=er[1].loading,eS=(0,en.D)(es,{onCompleted:function(e){}}),eZ=(0,B.Z)(eS,2),eI=eZ[0],eC=eZ[1].loading,eP=(0,ew.WE)(l,"registered"),eD=(0,ed.Z)({postCode:null==eP?void 0:null===(r=eP.address)||void 0===r?void 0:r.postCode,country:null==eP?void 0:null===(o=eP.address)||void 0===o?void 0:null===(a=o.country)||void 0===a?void 0:a.code}),ek=null!=eD&&eD.area?eD.area.toUpperCase():null,e_=(K=(0,G.Z)(Q().mark(function e(t){var n,r,o,a,i;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(delete t.formErrors,n=t3({form:t,location:l,rruleMeta:b,dates:P,scheduleJobId:c.id}),null!=c&&c.id){e.next=8;break}return e.next=5,eo({variables:{objects:[n]}});case 5:u&&u(),e.next=16;break;case 8:if(delete n.Taxonomy,o=(r=t0({defaultValues:c,data:n})).isConfirm,a=r.isDatesChanged,i=r.isSupplierChanged,!o){e.next=14;break}eA({isDatesChanged:a,isSupplierChanged:i,onConfirm:function(){var e=(0,G.Z)(Q().mark(function e(t){var r,o,s,u;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.updateAllJobs,o=t.updateCurrentJob,s=[],u=[],!a){e.next=7;break}return e.next=6,t4({adminId:p.adminId,defaultValues:c,form:n,location:l});case 6:s=e.sent;case 7:return i&&(u={supplierId:n.meta.supplierId}),e.next=10,eE({data:n,frequencyChanged:a,job:u,jobs:s,updateAllJobs:r,updateCurrentJob:o});case 10:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()}),e.next=16;break;case 14:return e.next=16,eE({data:n,frequencyChanged:!1,job:{},jobs:[],updateAllJobs:!1,updateCurrentJob:!1});case 16:case"end":return e.stop()}},e)})),function(e){return K.apply(this,arguments)}),eA=function(e){var t=e.isDatesChanged,n=e.isSupplierChanged,r=e.onConfirm;f.show({content:(0,U.jsx)(tK,{isDatesChanged:t,isSupplierChanged:n,onConfirm:r,toggleShow:f.close}),title:"Confirm",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},eE=(ee=(0,G.Z)(Q().mark(function e(t){var n,r,o,a,i,l,d;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,r=t.frequencyChanged,o=t.job,a=t.jobs,i=t.updateAllJobs,l=t.updateCurrentJob,d=r&&a.length>0,e.next=4,eI({variables:{adminId:p.adminId,currentJobId:(null==s?void 0:s.id)||null,changes:n,frequencyChanged:r,hasCreateJobs:d,id:c.id,job:o,jobs:a,today:new Date,updateAllJobs:i,updateCurrentJob:l}});case 4:u&&u();case 5:case"end":return e.stop()}},e)})),function(e){return ee.apply(this,arguments)}),eT={control:A,errors:E,register:q},eq=function(e,t){D(function(n){return n.map(function(n,r){return r===t?nr(nr({},n),{},{selected:e.target.checked}):n})})},e$=function(e){D(function(t){return t.map(function(t){return nr(nr({},t),{},{selected:e.target.checked})})})},eR=P.map(function(e,t){var n=e.date,r=e.selected;return{date:n,id:t,weekDay:X()(n).format("ddd"),day:X()(n).format("DD"),month:X()(n).format("MMM"),year:X()(n).format("YYYY"),selected:r}});return(0,U.jsxs)(ep.Z,{id:"offCanvasForm",handleSubmit:T(e_),children:[(ei||eC)&&(0,U.jsx)(ej.Z,{sx:{zIndex:1e5},open:!0,children:(0,U.jsx)(eO.Z,{color:"secondary"})}),(0,U.jsxs)(S.Z,{children:[(0,U.jsxs)(Z.Z,{md:6,children:[(0,U.jsx)(tW.P,nr(nr({},eT),{},{isClearable:!0,label:"Sublocation",locationId:l.id,name:"sublocation",type:"sublocation"})),(0,U.jsx)(tX.l,nr(nr({},eT),{},{label:"Short job description",name:"shortDescription",type:"jobTags"})),(0,U.jsx)(em.Z,{label:"Work description",children:(0,U.jsx)(ef.Z,nr(nr({},eT),{},{name:"description",rows:3}))}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(em.Z,{label:"Estimated duration",children:(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(em.Z,{label:"Unit",children:(0,U.jsx)(eh.Z,nr(nr({},eT),{},{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,U.jsx)(em.Z,{label:"Customer reference",children:(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"reference"}))}),(0,U.jsx)(tX.l,nr(nr({},eT),{},{label:"Cost category",name:"costCategory",type:"costCategory"})),(0,U.jsx)(tW.P,nr(nr({},eT),{},{label:"Service",name:"service",type:"service"})),M&&(0,U.jsx)(tW.P,nr(nr({},eT),{},{label:"Supplier",name:"supplier",type:"supplier",area:ek,serviceId:(null==M?void 0:M.value)||null})),h&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(tW.P,nr(nr({},eT),{},{label:"Asset Category",locationId:l.id,name:"assetCategory",type:"assetCategory"})),(0,U.jsx)(na,nr(nr({},eT),{},{isDisabled:!L,label:"Assets",locationId:l.id,assetCategoryId:(null==L?void 0:L.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]}),(0,U.jsx)(ev.Z,nr(nr({},eT),{},{data:[{id:"compliance",label:"Compliance",value:!!N}],name:"compliance"})),N&&(0,U.jsx)(tW.P,nr(nr({},eT),{},{label:"",locationId:l.id,name:"complianceSelect",type:"compliance"})),(0,U.jsx)(tV,{defaultValues:c,defaultOptions:eT,name:"frequencyForm",setValueParent:$,watchParent:R,setRRuleMeta:x,rruleMeta:b}),(0,U.jsx)(em.Z,{label:"Frequency description",children:(0,U.jsx)(ef.Z,nr(nr({},eT),{},{name:"frequencyDescription",rows:3}))}),m("admin")&&(0,U.jsx)(nt.n,{values:V,setValue:$,entityId:null!==(i=null==c?void 0:c.id)&&void 0!==i?i:null,entity:"JobSchedule",name:"tags"}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(eb.Z,nr(nr({},eT),{},{label:"Customer cost per visit",name:"costCustomer",vat:"Ex VAT"}))}),(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(eb.Z,nr(nr({},eT),{},{label:"Supplier cost per visit",name:"costSupplier",vat:"Ex VAT"}))})]}),(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"customerSignature",type:"hidden"})),(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"supplierSignature",type:"hidden"})),(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"reportPassFail",type:"hidden"})),(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"reportPassFailTitle",type:"hidden"})),(0,U.jsx)(ey.Z,nr(nr({},eT),{},{name:"requireReportRecommendations",type:"hidden"}))]}),(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(j.Z,{open:!0,title:"Schedule jobs preview",children:(0,U.jsx)(t5.i,{getRowClassName:function(e){return e.row.id%2==0?"even":"odd"},columnHeaderHeight:35,rowHeight:35,columns:[{width:30,field:"date",renderHeader:function(){return(0,U.jsx)(eg.Z,{title:"To skip or remove jobs from the PPM schedule to be created,\n             deselect the relevant lines below",slotProps:{popper:{sx:{zIndex:1e4}}},children:(0,U.jsx)(ex.Z,{color:"secondary",checked:P.every(function(e){return e.selected}),onChange:function(e){return e$(e)}})})},sortable:!1,renderCell:function(e){var t=e.row;return(0,U.jsx)(ex.Z,{color:"secondary",checked:t.selected,onChange:function(e){return eq(e,t.id)}})}},{flex:1,field:"id",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.id+1}},{flex:1,field:"weekDay",headerName:"Day of week",sortable:!1},{flex:1,field:"day",headerName:"Day of month",sortable:!1},{flex:1,field:"month",headerName:"Month",sortable:!1},{flex:1,field:"year",headerName:"Year",sortable:!1}],rows:eR})})})]}),(0,U.jsx)("input",nr({type:"hidden"},q("tags")))]})},na=(0,x.ZP)(tW.P).withConfig({displayName:"form__StyledSelect",componentId:"sc-sbg7q5-0"})(["&& > div:first-of-type{","}"],function(e){return e.isDisabled?"background-color: #cecece !important;":""}),ni=n(11163),ns=n.n(ni),nc=n(66252),nl=n(72309),nu=n(74975),nd=n(55843),np=n(48126),nm=n(11552),nf=n(69532),ny=n(26447),nh=n(46901),nv=n(15861),nb=n(67720),ng=n(11057);function nx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nx(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nx(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nO(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return nw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nw(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function nw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var nS=function(e){var t,n=e.jobs,r=e.location,o=e.offCanvas,a=e.refetch,i=e.row,s=e.showCreateJobButton,c=e.hideSupplier,l=(0,t7.x)().user,u=(0,nc.x)(),d=(0,g.useState)(!1),p=d[0],m=d[1],f=eC.ZP.fromString(i.frequency).origOptions.dtstart,y=X()(f).isBefore(X()(),"day"),h=(0,en.D)(E.mJ,{onCompleted:(t=(0,G.Z)(Q().mark(function e(t){var n,r,o,i,s,c,l,d;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=(null==t?void 0:null===(n=t.createJob)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:null===(o=r.insert_Job)||void 0===o?void 0:o.returning)||[]).length){e.next=20;break}s=nO(i),e.prev=3,s.s();case 5:if((c=s.n()).done){e.next=12;break}return d=c.value.id,e.next=10,(0,nm.F)(u,d);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),s.e(e.t0);case 17:return e.prev=17,s.f(),e.finish(17);case 20:a();case 21:case"end":return e.stop()}},e,null,[[3,14,17,20]])})),function(e){return t.apply(this,arguments)})}),v=(0,B.Z)(h,1)[0],b=(0,en.D)(ei),x=(0,B.Z)(b,1)[0];n.sort(function(e,t){return e.timingStart>t.timingStart?1:t.timingStart>e.timingStart?-1:0});var w,S=n.filter(function(e){return new Date(e.timingStart)<new Date}).length,Z=S>0?"(".concat(S," Past Occurrence)"):"",I=n.length,P=function(e,t){e.stopPropagation(),o.close(),ns().push("/dashboard/issues/view?id=".concat(t))},D=(w=(0,G.Z)(Q().mark(function e(){return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,m(!0),e.next=4,x({variables:{id:i.id,object:{status:"ppmSupplierContractAdded"}}});case 4:return e.next=6,(0,np.U$)({addJobFunc:v,location:r,row:i,adminId:l.adminId});case 6:a(),o.close();case 8:return e.prev=8,m(!1),e.finish(8);case 11:case"end":return e.stop()}},e,null,[[0,,8,11]])})),function(){return w.apply(this,arguments)}),k=function(e){var t=e.job;return(0,U.jsxs)(T.Z,{children:[(0,U.jsx)(C.Z,{content:(0,nf.B)({value:t.status,textColor:"white"}),context:"dark",size:"sm"}),(0,U.jsx)(C.Z,nj(nj({},{context:"secondary",size:"sm",startIconProps:{size:"lg"}}),{},{onClick:function(e){return P(e,t.number)},startIcon:"eye"}))]})};return(0,U.jsxs)(U.Fragment,{children:[p&&(0,U.jsx)(ej.Z,{sx:{zIndex:1e5},open:!0,children:(0,U.jsx)(eO.Z,{color:"secondary"})}),I<=0&&s?(0,U.jsxs)(ny.Z,{spacing:2,children:[!i.supplier&&(0,U.jsx)(nh.Z,{variant:"filled",severity:"error",children:"Error. There is no supplier currently specified for this item. Please select a supplier before trying to create jobs."}),y&&(0,U.jsx)(nh.Z,{variant:"filled",severity:"warning",color:"info",children:"The specified date of first job has passed. Please edit as required before creating these jobs."}),(0,U.jsxs)(ny.Z,{children:[(0,U.jsx)(nv.Z,{fontSize:16,sx:{alignSelf:"center"},children:"No jobs have been created as yet"}),(0,U.jsx)(nb.Z,{})]}),(0,U.jsx)(ny.Z,{direction:"row",justifyContent:"flex-end",children:(0,U.jsx)(ng.Z,{disabled:p||!i.supplier,onClick:D,variant:"contained",size:"large",children:"Create Jobs"})})]}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)($.Z,{children:"".concat(I," Future Occurrences ").concat(Z)}),(0,U.jsx)(nd.Z,{}),n.map(function(e,t){var n,r;return(0,U.jsxs)(g.Fragment,{children:["".concat((0,nl.Z)(new Date(e.timingStart),{addSuffix:!0})," - ").concat((0,nu.Z)(new Date(e.timingStart),"LLL do yyyy")),(0,U.jsxs)(j.Z,{context:e.rag||"primary",open:t===S,title:"".concat(e.number," - ").concat((null===(n=e.shortJobDesc[0])||void 0===n?void 0:n.taxonomy.name)||e.title),toolbar:(0,U.jsx)(k,{job:e}),children:[(0,U.jsx)(O.Z,{content:"Description",text:e.description}),!c&&(0,U.jsx)(O.Z,{content:"Supplier",text:null===(r=e.supplier)||void 0===r?void 0:r.name})]},e.id),(0,U.jsx)(nd.Z,{marginBottom:"md"})]},t)})]})]})};nS.defaultProps={showCreateJobButton:!0,hideSupplier:!1};var nZ=n(41085),nI=(0,eo.Ps)(s||(s=(0,er.Z)(["\n  query GetScheduledJobInvoices(\n    $type: String\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $orderBy: AccountEntry_order_by!\n  ) {\n    ScheduledJobInvoice: AccountEntry(\n      limit: $limit\n      offset: $offset\n      where: { locationId: { _eq: $locationId }, Invoices: { invoiceType: { _eq: $type } } }\n      order_by: [$orderBy]\n    ) {\n      account: Account {\n        type\n      }\n      id\n      type\n      createdAt\n      debit\n      meta\n      outstandingdays\n      outstandingAmount\n      invoices: Invoices {\n        id\n        invoiceNumber\n      }\n      account: Account {\n        name\n      }\n    }\n    meta: AccountEntry_aggregate(\n      where: { locationId: { _eq: $locationId }, Invoices: { invoiceType: { _eq: $type } } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),nC=(0,eo.Ps)(c||(c=(0,er.Z)(['\n  query GetJobsForinvoice(\n    $type: String\n    $endDate: timestamptz\n    $locationId: Int\n    $startDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        JobTimings: { status: { _eq: "reportSent" } }\n        locationId: { _eq: $locationId }\n        jobScheduleId: { _is_null: false }\n        _and: [\n          {\n            JobTimings: {\n              status: { _eq: "completed" }\n              _and: [{ createdAt: { _gte: $startDate } }, { createdAt: { _lte: $endDate } }]\n            }\n          }\n        ]\n        _not: { JobTimings: { status: { _eq: $type } } }\n      }\n    ) {\n      id\n      number\n      adminId\n      title\n      description\n      quoted\n      reference\n      access\n      costCategory\n      pricing\n      timing\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      timingNormalHours\n      paymentMethod\n      customerSpendThreshold\n      time\n      amount\n      supplierLabourAmount\n      supplierMaterialsAmount\n      type\n      meta\n      source\n      discount\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      admin: Admin {\n        id\n        name\n        meta\n        bankAccounts: BankAccounts {\n          id\n          bank\n          stripeId\n          accountNumber\n          routingNumber\n          bic\n          iban\n          status\n          default\n          createdAt\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      timings: JobTimings(order_by: { createdAt: desc }) {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n        vatId\n      }\n      customer: Customer {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        financial: Financial {\n          id\n          amountOutstanding\n          approvalThreshold\n          arrangementFee\n          createdAt\n          creditLimit\n          creditRating\n          defaultPaymentMethod\n          invoicing\n          serviceRate\n          spendThreshold\n          stripeId\n          totalRevenue\n          unpaidInvoices\n        }\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        expenses: Expenses(where: { entity: { _eq: "Location" } }) {\n          id\n          amount\n          description\n          markup\n          total\n          unit\n          vat\n          paid\n          occurredAt\n          recurring\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n        }\n      }\n      accountEntries: AccountEntries {\n        id\n        type\n      }\n    }\n  }\n']))),nP=(0,eo.Ps)(l||(l=(0,er.Z)(["\n  query GetPpmInvoiceItems($locationId: Int!, $startDate: timestamptz!, $endDate: timestamptz!) {\n    expenses: Expense(\n      where: {\n        locationId: { _eq: $locationId }\n        _and: [{ startDate: { _gte: $startDate } }, { endDate: { _lte: $endDate } }]\n      }\n    ) {\n      id\n      amount\n      unit\n      description\n      paid\n      vat\n      __typename\n    }\n  }\n"]))),nD=(0,eo.Ps)(u||(u=(0,er.Z)(["\n  mutation UpsertExpensesForPpmLocation($objects: [Expense_insert_input!]!) {\n    insert_Expense(\n      objects: $objects\n      on_conflict: { constraint: pk_Expense, update_columns: [description, amount, vat, total] }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),nk=(0,eo.Ps)(d||(d=(0,er.Z)(["\n  mutation DeletePpmInvoiceItems($id: Int!) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n  }\n"])));(0,eo.Ps)(p||(p=(0,er.Z)(["\n  mutation AddPPMInvoice(\n    $accountId: Int!\n    $timings: [JobTiming_insert_input!]!\n    $account: Account_set_input\n    $invoice: [Invoice_insert_input!]!\n  ) {\n    insert_Invoice(objects: $invoice) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $timings) {\n      returning {\n        id\n      }\n    }\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $account) {\n      id\n    }\n  }\n"]))),(0,eo.Ps)(m||(m=(0,er.Z)(["\n  mutation AddPPMInvoice($invoice: [Invoice_insert_input!]!) {\n    insert_Invoice(objects: $invoice) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),(0,eo.Ps)(f||(f=(0,er.Z)(["\n  mutation updateJob($id: Int!, $meta: jsonb!, $status: String) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: { status: $status, meta: $meta }) {\n      id\n    }\n  }\n"])));var n_=(0,eo.Ps)(y||(y=(0,er.Z)(["\n  mutation GenerateCustomerPpmInvoice($invoiceJobInput: CreatePpmInvoiceCustomerInput!) {\n    createPpmInvoiceCustomer(invoiceJobInput: $invoiceJobInput) {\n      data\n      success\n    }\n  }\n"]))),nA=(0,eo.Ps)(h||(h=(0,er.Z)(["\n  mutation GenerateSupplierPpmInvoice($invoiceJobInput: CreatePpmInvoiceSupplierInput!) {\n    createPpmInvoiceSupplier(invoiceJobInput: $invoiceJobInput) {\n      data\n      success\n    }\n  }\n"]))),nE=n(74297),nT=n(16540),nq=n(41391),n$=n(825),nR=n(77651),nF=n(50480),nJ=tz.Ry({dueDate:tz.Z_().required()}),nN=n(46718),nM=n(32979);function nL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nL(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nL(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nW=[{id:"default",label:"Default (20%)",value:20},{id:"custom",label:"Custom",value:"custom"}],nH=function(e){var t=e.defaultValues,n=e.onClose,r=e.onAdd,o=e.onEdit;null!=t&&t.vat&&(null==t?void 0:t.vat)!==20?t.vatRadio="custom":t.vatRadio="20";var a=(0,ec.cI)({defaultValues:t}),i=a.register,s=a.control,c=a.errors,l=a.handleSubmit,u=(0,a.watch)("vatRadio"),d=function(e){var n=nV(nV({},e),{},{id:t.id,index:t.index});"custom"!==n.vatRadio&&(n.vat=Number(n.vatRadio),delete n.vatRadio),t.edit?o(n):r(n)},p={register:i,control:s,errors:c};return(0,U.jsx)(ep.Z,{handleSubmit:l(d),children:(0,U.jsxs)(Z.Z,{md:12,children:[(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:4,children:(0,U.jsx)(em.Z,{label:"Description",children:(0,U.jsx)(ey.Z,nV(nV({},p),{},{name:"description"}))})}),(0,U.jsx)(Z.Z,{md:4,children:(0,U.jsx)(eb.Z,nV(nV({},p),{},{label:"Amount",vat:"Ex VAT",name:"amount"}))}),(0,U.jsx)(Z.Z,{md:4,children:(0,U.jsx)(tS.Z,nV(nV({},p),{},{name:"vatRadio",data:nW,legend:"VAT"}))})]}),"custom"===u&&(0,U.jsx)(S.Z,{justify:"end",children:(0,U.jsx)(Z.Z,{md:4,children:(0,U.jsx)(nM.Z,nV(nV({},p),{},{label:"Custom VAT",name:"vat"}))})}),(0,U.jsxs)(T.Z,{align:"flex-end",children:[(0,U.jsx)(C.Z,{context:"danger",content:"Cancel",size:"sm",onClick:n}),(0,U.jsx)(C.Z,{context:"secondary",content:"Save",size:"sm",type:"submit"})]})]})})};function nU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var nz=function(e){var t=e.defaultValues,n=e.onSubmit,r=e.onDelete,o=(0,g.useState)([]),a=o[0],i=o[1],s=(0,g.useState)(null),c=s[0],l=s[1];(0,g.useEffect)(function(){i(t)},[t]);var u=function(e){var t=[].concat((0,eF.Z)(a),[e]);n(t),l(null)},d=function(e){var t=(0,eF.Z)(a);t[e.index]=e,n(t),l(null)},p=function(e){r(e.id)},m=function(){l(null)},f=function(){l({})},y=[{hidden:!0},{hidden:!0},{text:"Description",formatter:function(e){return e.row.description}},{text:"Amount",formatter:function(e){return e.row.amount}},{text:"VAT",formatter:function(e){return e.row.vat}},{formatter:R.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nU(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({edit:!0},t))},tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:function(e,t){p(t)},tooltip:"Delete"}],text:"Actions"}];return(0,U.jsx)(U.Fragment,{children:c?(0,U.jsx)(nH,{defaultValues:c,onAdd:u,onEdit:d,onClose:m}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(nT.Z,{columns:y,rows:a.map(function(e,t){return{index:t,id:e.id,description:e.description,amount:e.amount,vat:e.vat,actions:""}})}),(0,U.jsx)(T.Z,{align:"flex-end",children:(0,U.jsx)(C.Z,{context:"success",content:"Add Item",size:"sm",onClick:f})})," "]})})},nG=function(e){var t=e.items,n=e.locationId,r=e.startDate,o=e.endDate;return t.map(function(e){return{id:e.id,description:e.description,amount:e.amount,unit:1,markup:0,vat:e.vat,total:e.amount*(1+e.vat/100),locationId:n,startDate:r,endDate:o}})},nB=n(34197),nY=n(33673);function nQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nQ(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nQ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nX={"customer-invoice":"invoiceSent","supplier-invoice":"invoiceSentSupplier"},n0=function(e){var t=e.locationId,n=e.toggleShow,r=e.numberPrefix,o=e.numberSuffix,a=e.mainJobRefetch,i=(0,ec.cI)({defaultValues:{month:new Date},resolver:(0,el.S)(nJ)}),s=i.control,c=i.errors,l=i.handleSubmit,u=i.register,d=i.getValues,p=i.setValue,m=(0,t7.x)().user,f=X()().utcOffset(),y=(0,g.useState)("customer-invoice"),h=y[0],v=y[1],b=(0,g.useState)(null),x=b[0],j=b[1],O=(0,g.useState)(!1),w=O[0],D=O[1],k=(0,g.useState)(!1),A=k[0],E=k[1],q=(0,g.useState)(new Date),R=q[0],J=q[1],N=(0,g.useState)(!1),M=N[0],L=N[1],V=(0,g.useState)([]),W=V[0],H=V[1],z=(0,g.useState)(!1),Y=z[0],K=z[1],ee=(0,_.a)(nC,{variables:{type:nX[h],endDate:A?null:X()(R).endOf("month").add(f,"minutes"),locationId:t,startDate:A?null:X()(R).startOf("month").add(f,"minutes")}}),et=ee.data,er=(et=void 0===et?{jobs:[]}:et).jobs,eo=ee.refetch;(0,g.useEffect)(function(){var e=null==er?void 0:er[0];if(e){var t=h.split("-")[0];p("dueDate",(0,nY.I)({job:e,type:t,invoiceDate:new Date}))}},[er]),(0,g.useEffect)(function(){L(!1)},[er,R]),(0,g.useEffect)(function(){H([])},[R]);var ea,ei,es=(0,_.a)(nP,{variables:{locationId:t,startDate:X()(R).startOf("month").add(f,"minutes"),endDate:X()(R).endOf("month").add(f,"minutes")}}),eu=es.data,ed=(eu=void 0===eu?{expenses:[]}:eu).expenses,em=es.refetch,ef=(0,en.D)(nD,{onCompleted:function(){em()}}),ey=(0,B.Z)(ef,1)[0],eh=(0,en.D)(nk,{onCompleted:function(){em()}}),ev=(0,B.Z)(eh,1)[0],eb=(0,en.D)(n_),eg=(0,B.Z)(eb,1)[0],ej=(0,en.D)(nA),eO=(0,B.Z)(ej,1)[0],ew=(0,en.D)(n_,{onCompleted:function(e){var t=e.createPpmInvoiceCustomer.data.accountEntry.meta;(0,nN.$)(t)}}),eS=(0,B.Z)(ew,1)[0],eZ=(0,en.D)(nA,{onCompleted:function(e){e.createPpmInvoiceSupplier.data.accountEntries.forEach(function(e){var t=e.meta;(0,nN.$)(t)})}}),eI=(0,B.Z)(eZ,1)[0],eC=(ea=(0,G.Z)(Q().mark(function e(n){var r;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,D(!0),r=X()().utcOffset(),"customer-invoice"!==h){e.next=8;break}return e.next=6,eg({variables:{invoiceJobInput:{jobIds:W,userId:m.id,locationId:t,dueDate:new Date(n.dueDate),invoicePeriodStart:X()(R).startOf("month").add(r,"minutes"),invoicePeriodEnd:X()(R).endOf("month").add(r,"minutes")}}});case 6:e.next=11;break;case 8:if("supplier-invoice"!==h){e.next=11;break}return e.next=11,eO({variables:{invoiceJobInput:{jobIds:W,userId:m.id,locationId:t,dueDate:new Date(n.dueDate),invoicePeriodStart:X()(R).startOf("month").add(r,"minutes"),invoicePeriodEnd:X()(R).endOf("month").add(r,"minutes")}}});case 11:eo(),a(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),j(e.t0);case 18:return e.prev=18,D(!1),e.finish(18);case 21:case"end":return e.stop()}},e,null,[[0,15,18,21]])})),function(e){return ea.apply(this,arguments)}),eP=(ei=(0,G.Z)(Q().mark(function e(){var n;return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,D(!0),n=d("dueDate"),"customer-invoice"!==h){e.next=8;break}return e.next=6,eS({variables:{invoiceJobInput:{jobIds:W,userId:m.id,locationId:t,dueDate:n||new Date,invoicePeriodStart:X()(R).startOf("month").add(f,"minutes"),invoicePeriodEnd:X()(R).endOf("month").add(f,"minutes"),preview:!0}}});case 6:e.next=11;break;case 8:if("supplier-invoice"!==h){e.next=11;break}return e.next=11,eI({variables:{invoiceJobInput:{jobIds:W,userId:m.id,locationId:t,dueDate:n||new Date,invoicePeriodStart:X()(R).startOf("month").add(f,"minutes"),invoicePeriodEnd:X()(R).endOf("month").add(f,"minutes"),preview:!0}}});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),j(e.t0);case 16:return e.prev=16,D(!1),e.finish(16);case 19:case"end":return e.stop()}},e,null,[[0,13,16,19]])})),function(){return ei.apply(this,arguments)}),eD=function(){K(!0)},ek=function(){J(d("month"))},e_=function(e,t){var n=t.id;e?H(function(e){return[].concat((0,eF.Z)(e),[n])}):H(function(e){return(0,eF.Z)(e.filter(function(e){return e!==n}))})},eA=function(e){e?(L(!0),H(er.map(function(e){return e.id}))):(L(!1),H([]))},eE=function(e){E(e)},eT=function(e){var n=nG({items:e,locationId:t,startDate:X()(R).startOf("month").add(f,"minutes"),endDate:X()(R).endOf("month").add(f,"minutes")});ey({variables:{objects:n}})},eq=function(e){ev({variables:{id:e}})},e$=[{text:(0,U.jsx)(ex.Z,{defaultChecked:!1,checked:M,onChange:function(e,t){eA(t)}}),formatter:function(e){var t=e.row;return(0,U.jsx)(ex.Z,{defaultChecked:!1,checked:W.includes(t.id),onChange:function(e,n){e_(n,t)}})}},{text:"ID",formatter:function(e){var t;return t=e.row,(0,U.jsx)(n$.D,{id:t.id,number:t.number,numberPrefix:r,numberSuffix:o,openCanvas:!0,type:"ppm",toggleShow:n})}},{text:"Supplier",hidden:"customer-invoice"===h},{text:"Short job description"},{text:"Start date",formatter:function(e){var t=e.row;return(0,U.jsx)("div",{style:{textWrap:"nowrap"},children:t.date})}},{text:"Completed date"},{text:"Customer Amount",hidden:"supplier-invoice"===h},{text:"Supplier Amount",hidden:"customer-invoice"===h},{text:"Customer Expenses",hidden:"supplier-invoice"===h},{text:"Supplier Expenses",hidden:"customer-invoice"===h},{text:"Status"}],eR={control:s,errors:c,register:u},eJ=function(){j(null)};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(ep.Z,{handleSubmit:l(eC),children:[(0,U.jsx)(nR.Z,{anchorOrigin:{vertical:"top",horizontal:"right"},open:!!x,autoHideDuration:6e3,onClose:eJ,children:(0,U.jsx)(nh.Z,{onClose:eJ,severity:"error",variant:"filled",sx:{width:"100%"},children:(null==x?void 0:x.message)||"Oops some error occurred. Please try again later"})}),(0,U.jsxs)(nZ.Z,{handleChange:!1,onTabChange:function(e){v(e)},children:[(0,U.jsx)("div",{active:"customer-invoice"===h,label:"Customer Invoice",children:null}),(0,U.jsx)("div",{active:"supplier-invoice"===h,label:"Supplier Invoice",children:null})]}),(0,U.jsx)(F.Z,{context:"info",content:"Only jobs with sent reports are available to invoice"}),(0,U.jsx)(nd.Z,{}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(Z.Z,{md:3,style:{marginTop:"14px"},children:(0,U.jsx)(tc.M,nK(nK({},eR),{},{dateFormat:"MM/yyyy",name:"month",placeholderText:"Click to select month",showMonthYearPicker:!0,isClearable:!1}))}),(0,U.jsx)(Z.Z,{md:3,style:{alignSelf:"center"},children:(0,U.jsx)(C.Z,{content:"Show jobs",context:"secondary",size:"sm",onClick:ek})}),(0,U.jsx)(Z.Z,{md:6,style:{alignSelf:"center"},children:(0,U.jsx)(nF.Z,{control:(0,U.jsx)(ex.Z,{color:"secondary",defaultChecked:!1,checked:A,onChange:function(e,t){eE(t)}}),label:"Include jobs not invoiced"})})]}),(0,U.jsx)(nT.Z,{columns:e$,rows:er.map(function(e,t){var n,r,o;return{id:e.id,number:e.number,supplier:e.supplier.name,shortJobDesc:(null===(n=e.shortJobDesc)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:null===(o=r.taxonomy)||void 0===o?void 0:o.name)||"-",date:(0,I.Z)(e.timingStart),completedDate:(0,I.Z)((0,nB.E)(e,"completed")),customerAmount:(0,P.Z)(e.amount),supplierAmount:(0,P.Z)(e.supplierLabourAmount+e.supplierMaterialsAmount),expensesCustomer:(0,P.Z)((0,nq.E)(e.expenses,0,"customer").totalExpenses),expensesSupplier:(0,P.Z)((0,nq.E)(e.expenses,0,"supplier").totalExpenses),status:(0,nE.Z)(e.status)}}),loading:w}),er&&er.length>0&&(0,U.jsxs)(S.Z,{style:{marginTop:"5px"},children:[(0,U.jsxs)(Z.Z,{md:5,children:[(0,U.jsx)($.Z,{children:"Due Date:"}),(0,U.jsx)(tc.M,nK(nK({},eR),{},{name:"dueDate",placeholder:"Due date",isClearable:!1}))]}),(0,U.jsx)(Z.Z,{md:7,style:{alignSelf:"center",marginTop:"5px"},children:(0,U.jsxs)(T.Z,{align:"flex-end",children:["customer-invoice"===h&&!Y&&0===ed.length&&(0,U.jsx)(C.Z,{disabled:w,context:"success",content:"Add Invoice Item",onClick:eD,size:"sm"}),(0,U.jsx)(C.Z,{disabled:w,context:"dark",content:"Preview Invoice",onClick:eP,size:"sm"}),(0,U.jsx)(C.Z,{disabled:w,context:"secondary",content:"Generate Invoice",type:"submit",size:"sm"})]})})]})]}),"customer-invoice"===h&&(Y||ed.length>0)&&(0,U.jsx)(nz,{defaultValues:ed,onSubmit:eT,onDelete:eq})]})},n1=n(42846),n2=n(32158);function n6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n6(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n6(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var n5={"customer-invoice":"customerPpmInvoice","supplier-invoice":"supplierPpmInvoice"},n9=function(e){var t,n,r=e.locationId,o=e.numberPrefix,a=e.numberSuffix,i=e.toggleShow,s=(0,H.a)(),c=(0,t7.x)().hasRole,l=(0,g.useState)("customer-invoice"),u=l[0],d=l[1],p=(0,n1.x)({filters:{}}),m=p.initialData,f=p.ref,y=n3({type:n5[u],locationId:r},m),h=(0,_.a)(nI,{variables:y}),v=h.data,b=(v=void 0===v?{ScheduledJobInvoice:[],meta:{aggregate:{totalCount:0}}}:v).ScheduledJobInvoice,x=v.meta,j=h.loading,O=h.refetch,w=(t=(0,G.Z)(Q().mark(function e(t,n){return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),t.stopPropagation(),(0,nN.$)(n3({},n.meta));case 3:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)}),S=[{hidden:!0},{hidden:!0},{text:"Invoice Number"},{text:"Supplier",hidden:"customer-invoice"===u},{text:"Type"},{text:"Date"},{hidden:!0},{hidden:!0},{text:"Amount",formatter:function(e){var t=e.row;return(0,P.Z)(t.debit)}},{hidden:!0},{hidden:!0},{formatter:R.Z,formatterData:[{context:"secondary",icon:["fas","download"],onClick:(n={editClick:function(e,t){return w(e,t)}}).editClick,tooltip:"Download"}],text:"Actions"}],Z=function(e){s.show({content:(0,U.jsx)(n2.u,{type:"customer",accountEntryType:e.itemType,data:e,numberSuffix:a,numberPrefix:o,refetch:O,toggleShow:function(){s.close(),i&&i()}}),title:"Invoice Details",submit:!1})};return(0,U.jsxs)(U.Fragment,{children:[c("admin","superadmin")?(0,U.jsxs)(nZ.Z,{handleChange:!1,onTabChange:function(e){d(e)},children:[(0,U.jsx)("div",{active:"customer-invoice"===u,label:"Customer Invoice",children:null}),(0,U.jsx)("div",{active:"supplier-invoice"===u,label:"Supplier Invoice",children:null})]}):(0,U.jsx)(nZ.Z,{handleChange:!1,onTabChange:function(e){d(e)},children:(0,U.jsx)("div",{active:"customer-invoice"===u,label:"Customer Invoice",children:null})}),(0,U.jsx)(N.t,{columns:S,loading:j,meta:x,ref:f,refetch:O,rows:b.map(function(e){var t,n;return{id:e.id,itemType:e.type,invoiceNumber:null===(t=e.invoices)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.invoiceNumber,supplier:e.account.name,type:(0,nE.Z)(e.account.type),date:(0,I.Z)(e.createdAt),outstandingDays:e.outstandingdays,outstandingAmount:e.outstandingAmount,debit:e.debit,credit:0,meta:e.meta,actions:""}}),rowClick:Z})]})},n8=function(e){var t=e.hasRole,n=e.locationId,r=e.numberPrefix,o=e.numberSuffix,a=e.toggleShow,i=e.mainJobRefetch;return t(["admin","superadmin"])?(0,U.jsxs)(nZ.Z,{handleChange:!1,children:[(0,U.jsx)("div",{active:!0,label:"All Invoices",children:(0,U.jsx)(n9,{locationId:n,numberPrefix:r,numberSuffix:o,toggleShow:a})}),(0,U.jsx)("div",{label:"New Invoice",children:(0,U.jsx)(n0,{locationId:n,toggleShow:a,numberPrefix:r,numberSuffix:o,mainJobRefetch:i})})]}):(0,U.jsx)(nZ.Z,{handleChange:!1,children:(0,U.jsx)("div",{active:!0,label:"All Invoices",children:(0,U.jsx)(n9,{locationId:n,numberPrefix:r,numberSuffix:o,toggleShow:a})})})},n4=n(18069),n7=function(e){var t=e.id,n=e.onSuccess,r=(0,en.D)(E.Ms,{onCompleted:n}),o=(0,B.Z)(r,1)[0],a=function(){o({variables:{id:t}})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)($.Z,{children:"Are you sure you want to delete JobSchedule?"}),(0,U.jsx)(tU.H,{content:"Delete",context:"danger",handleClick:a})]})},re=n(5616),rt=n(96406),rn=n(86886),rr=n(90629),ro=(0,eo.Ps)(v||(v=(0,er.Z)(["\n  query GetJobSchedule(\n    $locationId: Int\n    $orderBy: JobSchedule_order_by!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      where: { locationId: { _eq: $locationId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),ra=(0,eo.Ps)(b||(b=(0,er.Z)(["\n  mutation CopyScheduleItems(\n    $originLocationId: Int!\n    $copyLocationIds: [Int!]!\n    $selectType: String!\n    $scheduleIds: [Int]\n  ) {\n    copyScheduleItems(\n      originLocationId: $originLocationId\n      copyLocationIds: $copyLocationIds\n      selectType: $selectType\n      scheduleIds: $scheduleIds\n    ) {\n      data\n      success\n    }\n  }\n"]))),ri=n(76301),rs=n(6911),rc=tz.Ry({locations:tz.IX().of(tz.Ry({value:tz.Rx().integer().required(),label:tz.Z_().required()}).required()).min(1).required()}),rl=n(3084);function ru(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ru(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rp={item:"createdAt",order:"asc"},rm=function(e){var t,n=e.locationId,r=(0,rl.D)(),o=(0,(0,t7.x)().hasRole)("admin"),a=(0,g.useState)("selectAll"),i=a[0],s=a[1],c=(0,g.useState)([]),l=c[0],u=c[1],d=(0,g.useState)(""),p=d[0],m=d[1],f=(0,n1.x)({initialSort:rp}),y=f.initialData,h=f.ref,v=(0,ec.cI)({defaultValues:{locations:[]},resolver:(0,el.S)(rc)}),b=v.handleSubmit,x=v.control,j=v.errors,O=(0,en.D)(ra,{onCompleted:function(){r.show({content:"Success. This planned maintenance schedule\n        has been copied to the selected locations.\n        Please note that you will still need to click on the relevant\n        item in the location to create the individual jobs."})},onError:function(e){r.show({content:"Error: ".concat(e.message),severity:"error"})}}),w=(0,B.Z)(O,2),S=w[0],Z=w[1].loading,I=(0,_.a)(ro,{variables:rd(rd({},y),{},{locationId:n})}),C=I.data,P=(C=void 0===C?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:C).jobSchedule,D=C.meta,k=I.loading,A=I.refetch,E=(0,_.a)(ri._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==p?"%".concat(p,"%"):null}},limit:50,offset:0}}),T=E.loading,q=E.data,$=(q=void 0===q?{items:[]}:q).items,R=function(e){var t=e.row;return"selectAll"===i||"excludeAll"!==i&&("selectSome"===i?l.includes(t.id):"excludeSome"===i&&!l.includes(t.id))},F=function(e){var t=e.row;return function(e,n){var r=l.includes(t.id)&&1===l.length;return"selectAll"!==i&&"excludeSome"!==i||n?"excludeSome"===i&&n?(r&&s("selectAll"),u(function(e){return e.filter(function(e){return e!==t.id})})):("excludeAll"===i||"selectSome"===i)&&n?(s("selectSome"),u(function(e){return[].concat((0,eF.Z)(e),[t.id])})):"selectSome"!==i||n?void 0:(r&&s("excludeAll"),u(function(e){return e.filter(function(e){return e!==t.id})})):(s("excludeSome"),u(function(e){return[].concat((0,eF.Z)(e),[t.id])}))}},J=P.map(function(e,t){return{index:t,id:e.id,title:e.meta.shortDescriptionName,description:e.meta.description,sublocation:e.sublocation,service:e.meta.serviceName,supplier:e.meta.supplierName,frequencyDescription:e.frequencyDescription}}),N=(t=(0,G.Z)(Q().mark(function e(t){return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("excludeAll"!==i){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,S({variables:{originLocationId:n,copyLocationIds:t.locations.map(function(e){return e.value}),selectType:i,scheduleIds:l}});case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),M=(0,g.useMemo)(function(){return $.map(function(e){var t,n,r=null===(t=e.registeredAddress)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.address;return{label:"".concat(e.label,", ").concat((null==r?void 0:r.addressLine1)||""),value:e.value}})},[$]);return(0,U.jsxs)("form",{id:"offCanvasForm",onSubmit:b(N),children:[Z&&(0,U.jsx)(ej.Z,{sx:{zIndex:1e5},open:!0,children:(0,U.jsx)(eO.Z,{color:"secondary"})}),(0,U.jsxs)(rn.ZP,{container:!0,rowSpacing:4,children:[(0,U.jsx)(rn.ZP,{item:!0,xs:12,children:(0,U.jsx)(ec.Qr,{name:"locations",control:x,render:function(e){var t,n=e.value,r=e.onChange;return(0,U.jsx)(rs.q,{multiple:!0,limitTags:6,color:"secondary",filterSelectedOptions:!0,loading:T,value:n||[],onChange:function(e,t){r(t)},options:M,setSearch:m,textFieldProps:{label:"Select locations",variant:"standard",color:"secondary",error:j.locations,helperText:null===(t=j.locations)||void 0===t?void 0:t.message}})}})}),(0,U.jsx)(rn.ZP,{item:!0,xs:12,children:(0,U.jsx)(rr.Z,{elevation:5,sx:{pb:1},children:(0,U.jsx)(t5.i,{paginationSize:10,ref:h,getRowHeight:function(e){return e.model.sublocation?72:52},getRowClassName:function(e){return e.row.index%2==0?"even":"odd"},loading:k,columns:[{width:50,field:"select",sortable:!1,renderHeader:function(){return(0,U.jsx)(ex.Z,{color:"secondary",checked:"selectAll"===i,onChange:function(e,t){t?(s("selectAll"),u([])):(s("excludeAll"),u([]))}})},renderCell:function(e){var t=e.row;return(0,U.jsx)(ex.Z,{color:"secondary",checked:R({row:t}),onChange:F({row:t})})}},{minWidth:40,width:40,field:"index",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.index+1+y.offset}},{flex:1,field:"job",headerName:"Job",sortable:!1,renderCell:function(e){var t=e.row;return(0,U.jsxs)(ny.Z,{children:[(0,U.jsx)(nv.Z,{fontWeight:700,children:t.title}),(0,U.jsx)(nv.Z,{children:t.description}),t.sublocation&&(0,U.jsxs)(ny.Z,{direction:"row",spacing:1,children:[(0,U.jsx)(nv.Z,{fontWeight:700,children:"Sublocation:"}),(0,U.jsxs)(nv.Z,{children:[" ",t.sublocation.name]})]})]})}},{flex:1,field:"service",headerName:"Service",sortable:!1,renderCell:function(e){var t=e.row;return(0,U.jsxs)(ny.Z,{children:[(0,U.jsx)(nv.Z,{children:t.service}),o&&(0,U.jsxs)(nv.Z,{children:["Assigned to: ",t.supplier]})]})}},{flex:1,field:"frequencyDescription",headerName:"Frequency",sortable:!1}],rows:J,meta:D,refetch:A})})})]})]})};rm.defaultProps={};var rf=n(73073),ry=n(99751);function rh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rh(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rh(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rb={item:"id",order:"asc"},rg=function(e){var t,n,r,o=e.location,a=e.refetch,i=e.setNextJob,s=e.setNextTaskExp,c=e.user,l=e.editable,u=(0,ne.q)(),d=u.admin,p=u.hasUserModule,m=(0,t7.x)().hasRole,f=(0,A.useMainContext)(),y=f.customerDetails,h=f.setCustomerDetails,v=f.supplierDetails,b=f.setSupplierDetails,x=(0,g.useState)(!1),O=x[0],S=x[1],Z=(0,g.useState)(!1),I=Z[0],D=Z[1],k=(0,g.useState)(!0),L=k[0],V=k[1],W=(null==d?void 0:null===(t=d.jobSetting)||void 0===t?void 0:t.jobNumberPrefix)||"",G=(null==d?void 0:null===(n=d.jobSetting)||void 0===n?void 0:n.jobNumberSuffix)||"",B=(0,n1.x)({filters:{},initialSort:rb}),Y=B.initialData,Q=B.ref,K=m("tenant"),X=m("admin"),ee=m("supplier"),et=m("customer"),en=m("customer_user"),er=p("finances"),eo=(0,H.a)(),ea=(0,_.a)(E.RV,{variables:rv({locationId:o.id},Y)}),ei=ea.loading,es=ea.data,ec=(es=void 0===es?{JobSchedule:[],meta:{aggregate:{totalCount:0}}}:es).JobSchedule,el=es.meta,eu=ea.refetch;(0,g.useEffect)(function(){var e=(0,np.BH)({scheduledJobs:ec});s(e.nextExpire),i(e.nextJob)},[ec,i,s]);var ed,ep=(0,_.a)(E.B6,{variables:{locationId:o.id}}),em=ep.data,ef=(em=void 0===em?{jobs:[]}:em).jobs,ey=ep.refetch,eh=ef.length>0,ev=(0,g.useCallback)(function(){eo.close(),eu(),ey(),S(!0)},[eo,ey,eu]),eb=function(e,t,n){D(!1),eo.show({content:(0,U.jsx)(nS,{hideSupplier:K,jobs:ef.filter(function(r){return t?r.jobScheduleId===(null==e?void 0:e.id)&&(0,np.CH)(r,n):r.jobScheduleId===(null==e?void 0:e.id)}),location:o,offCanvas:eo,refetch:a,row:e}),submit:!1,title:"Work orders"})},eg=(0,g.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.stopPropagation(),D(!1);var n=rv({estimatedDuration:54e5,estimatedDurationUnit:"minutes"},t);if("inactive"===o.status){D(!0);return}eo.show({content:(0,U.jsx)(no,{currentJob:ef.find(function(e){return new Date(e.timingStart)>new Date||!(0,nB.E)(e,"completed")}),defaultValues:n,location:o,onSuccess:ev,user:c}),title:"Add item",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},[ev,ef,o,eo,c]),ej=(0,g.useCallback)(function(e){e.stopPropagation(),D(!1),eo.show({content:(0,U.jsx)(n8,{hasRole:m,mainJobRefetch:ev,locationId:o.id,numberPrefix:W,numberSuffix:G,toggleShow:eo.close}),title:"Invoices",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},[ev,m,o.id,W,G,eo]),eO=(0,g.useCallback)(function(e,t){e.stopPropagation(),D(!1),eo.show({content:(0,U.jsx)(rf.G,{expanded:!0,hideExpandIcon:!0,entity:"JobSchedule",entityId:null==t?void 0:t.id,onMediaAdd:function(){return eu()},onMediaRemove:function(){return eu()}}),submit:!1,title:"Media"})},[eo,eu]),ew=(0,g.useCallback)(function(e,t){e.stopPropagation(),D(!1);var n=t.jobs.filter(function(e){return!(0,nB.E)(e,["completed","closed"])});eo.show({content:(0,U.jsx)(M.z,{entity:"JobSchedule",entityId:t.id,jobs:n,withDetails:!1}),submit:!1,title:"Expenses"})},[eo]),eS=(0,g.useCallback)(function(e){e.stopPropagation(),V(!L)},[L]),eZ=(0,g.useCallback)(function(e,t){var n;if(e.stopPropagation(),(null===(n=t.jobs)||void 0===n?void 0:n.length)>0)return!1;eo.show({content:(0,U.jsx)(n7,{id:t.id,onSuccess:ev}),submit:!1,title:"Delete JobSchedule"})},[ev,eo]),eI=(0,g.useCallback)(function(e){e.stopPropagation(),eo.show({content:(0,U.jsx)(rm,{locationId:o.id}),title:"Copy Schedule",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},[o.id,eo]),eC=(0,g.useCallback)(function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,U.jsxs)(T.Z,{children:[(0,U.jsx)(q.Z,{content:"Calendar view",children:(0,U.jsx)(C.Z,rv(rv({},e),{},{context:"info",onClick:function(e){return eS(e)},startIcon:L?"table":"calendar-alt"}))}),!K&&(!en||er)&&(0,U.jsx)(q.Z,{content:"Invoices",children:(0,U.jsx)(C.Z,rv(rv({},e),{},{onClick:function(e){return ej(e)},startIcon:"file-invoice"}))}),(0,U.jsx)(w.Z,{border:!1,to:"/reports/ppm/schedule?locationId=".concat(o.id),onClick:function(e){return e.stopPropagation()},children:(0,U.jsx)(q.Z,{content:"View as PDF",children:(0,U.jsx)(C.Z,rv(rv({},e),{},{startIcon:"file-pdf"}))})}),!et&&!K&&(0,U.jsx)(q.Z,{content:"Add Item",children:(0,U.jsx)(C.Z,rv(rv({},e),{},{context:"primary",onClick:eg,startIcon:"plus"}))}),X&&(0,U.jsx)(ng.Z,{variant:"contained",color:"secondary",sx:{height:"31px"},onClick:eI,children:(0,U.jsx)(rt.Z,{sx:{height:"18px"}})})]})},[eI,eg,ej,eS,er,X,et,en,K,o.id,L]),eP=0,eD=0,ek=function(e){"supplierDetails"===e.target.name?b(!v):"customerDetails"===e.target.name&&h(!y)},e_=(0,g.useMemo)(function(){return[{hidden:!0},{hidden:!0},{formatter:function(e){var t=e.row;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)($.Z,{size:"sm",children:t.title}),(0,U.jsx)(ry.O,{maxLength:40,children:t.description}),t.sublocation&&(0,U.jsxs)($.Z,{size:"xs",children:["Sublocation: ",t.sublocation.label]})]})},text:"Job"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var t=e.row;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)($.Z,{size:"sm",children:t.service.label}),m("admin")&&t.supplier&&(0,U.jsxs)($.Z,{size:"xs",children:["Assigned to: ",t.supplier.label]})]})},text:"Service"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var t,n=e.row;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)($.Z,{size:"sm",children:"".concat(null===(t=n.jobs)||void 0===t?void 0:t.length," Jobs ").concat(n.completeCount," completed")}),(0,U.jsx)($.Z,{size:"xs",children:n.frequencyDescription})]})},text:"Frequency"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var t,n,r=e.row;return(0,U.jsxs)(U.Fragment,{children:[y&&m("admin")&&(0,U.jsxs)($.Z,{size:"sm",children:["Customer ",null!==(t=o.meta)&&void 0!==t&&t.monthlyAmount?"":(0,P.Z)(r.costCustomerSoFar)]}),v&&m("admin")&&(0,U.jsxs)($.Z,{size:"sm",children:["Supplier ",(0,P.Z)(r.costSupplierSoFar)]}),et&&(0,U.jsx)($.Z,{size:"sm",children:null!==(n=o.meta)&&void 0!==n&&n.monthlyAmount?"":(0,P.Z)(r.costCustomerSoFar)}),ee&&(0,U.jsx)($.Z,{size:"sm",children:(0,P.Z)(r.costSupplierSoFar)})]})},text:"Price",hidden:!y&&!v&&m("admin")||K||en&&!er},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:m("customer")||!l,formatter:R.Z,formatterData:function(e){var t;return[{context:"secondary",icon:["fas","file-upload"],numberOverlay:"mediaCount",onClick:function(e,t){return eO(e,t)},tooltip:"Media"},{context:"secondary",icon:["fas","receipt"],onClick:function(e,t){return ew(e,t)},tooltip:"Expenses"},{context:"info",icon:["fas","edit"],onClick:function(e,t){return eg(e,t)},tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:function(e,t){return eZ(e,t)},tooltip:"Delete",disabled:(null==e?void 0:null===(t=e.jobs)||void 0===t?void 0:t.length)>0}]},text:"Actions"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0}]},[y,l,ew,eO,eg,eZ,er,m,et,en,ee,K,null===(r=o.meta)||void 0===r?void 0:r.monthlyAmount,v]),eA=(0,g.useMemo)(function(){return ec.map(function(e){var t,n,r,o,a,i,s,c,l,u=[];eP+=(0,np.tf)({frequency:e.frequency,cost:e.meta.costCustomer}),eD+=(0,np.tf)({frequency:e.frequency,cost:e.meta.costSupplier});var d=null!==(t=e.meta)&&void 0!==t&&t.assetCategoryId?{value:e.meta.assetCategoryId,label:e.meta.assetCategoryName}:null;return(null===(n=e.meta)||void 0===n?void 0:null===(r=n.assets)||void 0===r?void 0:r.length)>0&&(u=e.meta.assets),{id:e.id,tags:e.meta.tags,title:e.meta.shortDescriptionName,description:e.meta.description,costCategory:{value:e.meta.costCategoryId,label:e.meta.costCategoryName},service:{value:e.meta.serviceId,label:e.meta.serviceName},serviceName:e.meta.serviceName,supplier:e.meta.supplierId?{value:e.meta.supplierId,label:e.meta.supplierName}:null,supplierName:e.meta.supplierName,assetCategory:d,assetSelected:u,frequency:e.frequency,frequencyDescription:e.frequencyDescription,jobs:e.jobs,completeCount:(0,np.k3)({jobScheduleId:e.id,jobs:ef}),paymentMethod:e.paymentMethod,shortDescription:{value:e.meta.shortDescriptionId,label:e.meta.shortDescriptionName},hasCompliance:!!e.meta.hasCompliance,complianceSelect:e.meta.complianceSelect,costCustomer:e.meta.costCustomer,costSupplier:e.meta.costSupplier,costCustomerSoFar:(0,np.tf)({frequency:e.frequency,cost:e.meta.costCustomer}),costSupplierSoFar:(0,np.tf)({frequency:e.frequency,cost:e.meta.costSupplier}),jobScheduledExpenses:e.expenses,actions:"",mediaCount:null==e?void 0:null===(o=e.media)||void 0===o?void 0:o.length,reference:e.reference,reportPassFail:e.meta.reportPassFail,reportPassFailTitle:e.meta.reportPassFailTitle,customerSignature:null===(a=e.meta)||void 0===a?void 0:a.customerSignature,supplierSignature:null===(i=e.meta)||void 0===i?void 0:i.supplierSignature,requireReportRecommendations:e.meta.requireReportRecommendations,sublocation:e.sublocation?{label:null===(s=e.sublocation)||void 0===s?void 0:s.name,value:null===(c=e.sublocation)||void 0===c?void 0:c.id}:null,estimatedDuration:e.estimatedDuration,estimatedDurationUnit:e.estimatedDurationUnit,rruleMeta:null===(l=e.meta)||void 0===l?void 0:l.rruleMeta,dates:e.dates}})},[ec]);return(0,U.jsxs)(U.Fragment,{children:[m("admin")&&(0,U.jsxs)(re.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,U.jsx)(nF.Z,{control:(0,U.jsx)(ex.Z,{color:"secondary",name:"customerDetails",checked:y,onChange:ek}),label:"Show customer amounts"}),(0,U.jsx)(nF.Z,{control:(0,U.jsx)(ex.Z,{color:"secondary",name:"supplierDetails",checked:v,onChange:ek}),label:"Show supplier amounts"})]}),(0,U.jsx)(j.Z,{fitParentHeight:!0,open:!0,title:"Items",toolbar:(0,U.jsx)(eC,{}),children:L?(0,U.jsxs)(U.Fragment,{children:[I&&(0,U.jsx)(F.Z,{context:"info",content:"This location is inactive"}),(0,U.jsx)(N.t,{columns:e_,initialSort:rb,loading:ei,meta:el,ref:Q,refetch:a,rowClick:eb,rows:eA}),!K&&(0,U.jsxs)("div",{style:{textAlign:"right",marginTop:"8px"},children:[(X&&y||et&&(!en||er))&&(0,U.jsx)(J.Z,{content:(0,U.jsxs)(U.Fragment,{children:[m("customer")?"Total":"Customer Total",":"," ",(0,U.jsx)("b",{children:null!==(ed=o.meta)&&void 0!==ed&&ed.monthlyAmount?"Monthly: ".concat((0,P.Z)(o.meta.monthlyAmount)):(0,P.Z)(eP)})]}),context:"dark",shape:"round",size:"sm"}),(v||m("supplier"))&&(0,U.jsx)(J.Z,{content:(0,U.jsxs)(U.Fragment,{children:[m("supplier")?"Total":"Supplier Total",":"," ",(0,U.jsx)("b",{children:(0,P.Z)(eD)})]}),context:"dark",shape:"round",size:"sm"})]})]}):(0,U.jsx)(z,{jobs:ef,jobSchedule:ec})}),eh&&(0,U.jsx)(n4.K,{refetchSchedule:O,setRefetchSchedule:S,locationId:o.id,handleHistory:eb,customerDetails:y,supplierDetails:v})]})},rx=n(99229),rj=n(95102);function rO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rO(Object(n),!0).forEach(function(t){(0,k.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rS=function(e){var t=e.defaultValues,n=e.location,r=e.offCanvas,o=e.refetch,a=(0,ec.cI)({defaultValues:t}),i=a.errors,s=a.handleSubmit,c=a.register,l=(0,en.D)(rj.zg,{onCompleted:function(e){o(),r.close()}}),u=(0,B.Z)(l,1)[0],d=function(e){var t=e.monthlyAmount,r=n.meta,o=n.id,a={meta:rw(rw({},void 0===r?{}:r),{},{monthlyAmount:t})};u({variables:{id:o,changes:a}})};return(0,U.jsxs)(ep.Z,{id:"offCanvasForm",handleSubmit:s(d),children:[(0,U.jsx)(em.Z,{label:"Monthly amount",children:(0,U.jsx)(eb.Z,{errors:i,name:"monthlyAmount",register:c,vat:"Ex VAT"})}),(0,U.jsx)($.Z,{size:"xs",content:"Updating the monthly billing figure will overide any per item customer billing"})]})},rZ=function(e){var t,n,r,o,a,i,s=e.location,c=e.refetch,l=e.user,u=(0,t7.x)().hasRole,d=(0,ne.q)().hasUserModule,p=(0,H.a)(),m=(0,g.useState)(null),f=m[0],y=m[1],h=(0,g.useState)(null),v=h[0],b=h[1],x=u("tenant"),D=u("admin"),k=u("customer_user"),_=d("finances"),A=s.meta,E=void 0===A?{}:A,T=function(e){e.stopPropagation(),p.show({content:(0,U.jsx)(rS,{defaultValues:{monthlyAmount:null==E?void 0:E.monthlyAmount},location:s,offCanvas:p,refetch:c}),submit:!0,title:"Billing"})};return(0,U.jsxs)(S.Z,{children:[(0,U.jsxs)(Z.Z,{md:3,children:[(0,U.jsxs)(S.Z,{children:[f&&f.name&&(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(rI,{body:f.name,className:"tile1",colourConfig:{10:"success"},description:f.date&&(0,I.Z)(f.date),rounded:!0,size:"xxs",title:"Next task"})}),v&&v.title&&(0,U.jsx)(Z.Z,{md:6,children:(0,U.jsx)(rI,{body:"".concat(v.title),colourConfig:{10:"success"},description:v.timingStart&&"".concat((0,I.Z)(v.timingStart)),rounded:!0,size:"xxs",title:"Next job"})})]}),(n=s.access,r=s.customer,o=s.id,a=s.name,i=s.user,(0,U.jsxs)(j.Z,{fitParentHeight:!0,title:"Contact",children:[(0,U.jsx)(O.Z,{text:x?r[0].account.manager.fullName:(0,U.jsx)(w.Z,{to:"/dashboard/users/view?id=".concat(r[0].account.managerId),children:r[0].account.manager.fullName}),content:"Assigned to"}),(0,U.jsx)(O.Z,{text:x?r[0].account.name:(0,U.jsx)(w.Z,{to:"/dashboard/customers/view?id=".concat(r[0].account.id),children:r[0].account.name}),content:"Customer"}),(0,U.jsx)(O.Z,{text:(0,U.jsxs)(U.Fragment,{children:[x?(0,U.jsx)(U.Fragment,{children:i?i.fullName:""}):(0,U.jsx)(w.Z,{to:"/dashboard/users/view?id=".concat(i&&i.id),children:i?i.fullName:""}),(0,U.jsx)("br",{}),x?(0,U.jsx)(U.Fragment,{children:i?i.phone:""}):(0,U.jsx)(w.Z,{to:"tel:".concat(i&&i.phone),children:i?i.phone:""})]}),content:"Contact"}),(0,U.jsx)(O.Z,{text:x?a:(0,U.jsx)(w.Z,{to:"/dashboard/properties/view?id=".concat(o,"&tab=details"),children:a}),content:"Location"}),(0,U.jsx)(O.Z,{text:n,content:"Access information"})]})),!x&&(!k||_)&&(0,U.jsx)(j.Z,{toolbar:(0,U.jsx)(C.Z,{context:"info",onClick:T,size:"sm",startIcon:"edit"}),open:!0,title:"Billing",children:(0,U.jsx)(O.Z,{content:"Monthly amount",text:null!=E&&E.monthlyAmount?(0,P.Z)(E.monthlyAmount):(0,P.Z)(0)})}),(0,U.jsx)(rx.G,{showActionButtons:!x,category:"PPM",details:!0,entity:"Location",entityId:s.id,summary:"Documentation"})]}),(0,U.jsx)(Z.Z,{md:9,children:(0,U.jsx)(rg,{location:s,refetch:c,setNextTaskExp:y,setNextJob:b,user:l,editable:D})})]})},rI=(0,x.ZP)(D.Z).withConfig({displayName:"view__StyledTile",componentId:"sc-1fv133-0"})(["min-height:130px;div{font-size:16px;}"])},33673:function(e,t,n){n.d(t,{I:function(){return o}});var r=n(77349),o=function(e){var t,n,o,a,i,s,c,l,u,d=e.job,p=e.type,m=e.invoiceDate,f=parseInt(null===(t=d.admin)||void 0===t?void 0:null===(n=t.meta)||void 0===n?void 0:null===(o=n.finance)||void 0===o?void 0:o.invoiceDueDate)||30;return"customer"===p&&(f=parseInt(null===(a=d.customer)||void 0===a?void 0:null===(i=a.meta)||void 0===i?void 0:null===(s=i.finance)||void 0===s?void 0:s.invoiceDueDate)||parseInt(null===(c=d.admin)||void 0===c?void 0:null===(l=c.meta)||void 0===l?void 0:null===(u=l.finance)||void 0===u?void 0:u.invoiceDueDate)||30),(0,r.Z)(new Date(m),f)}},10504:function(e,t,n){n.d(t,{E:function(){return Y}});var r,o,a,i=n(59499),s=n(27812),c=n(67294),l=n(6812),u=n(42283),d=n(26447),p=n(11057),m=n(90629),f=n(15861),y=n(32836),h=n(9164),v=n(6911),b=n(16835),g=n(79665),x=n(50319),j=n(76600),O=n(55563),w=n(49501),S=n(95103),Z=n(6710),I=n(26380),C=n(74231),P=C.Ry({id:C.Rx(),name:C.Z_(),description:C.Z_(),active:C.Z_().oneOf(["active","inactive"]).required(),locationId:C.Rx().required(),customerId:C.Rx().required()}),D=n(71383),k=n(75063),_=(0,k.Ps)(r||(r=(0,D.Z)(["\n  query GetSublocations($locationId: Int!, $active: Boolean) {\n    sublocations: Sublocation(\n      where: { locationId: { _eq: $locationId }, active: { _eq: $active } }\n    ) {\n      id\n      name\n      description\n      active\n      createdAt\n      updatedAt\n      location: Location {\n        id\n        name\n      }\n    }\n    meta: Sublocation_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]))),A=(0,k.Ps)(o||(o=(0,D.Z)(['\n  query GetSublocationDataForQrCode($locationId: Int!) {\n    sublocation: Sublocation(where: { locationId: { _eq: $locationId }, active: { _eq: true } }) {\n      id\n      name\n      location: Location {\n        id\n        name\n        customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n          account: Account {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n']))),E=(0,k.Ps)(a||(a=(0,D.Z)(["\n  mutation UpsertSublocation($objects: [Sublocation_insert_input!]!) {\n    insert_Sublocation(\n      objects: $objects\n      on_conflict: {\n        constraint: Sublocation_pkey\n        update_columns: [name, description, active, locationId]\n      }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),T=n(5616),q=n(98456),$=n(85893);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var J=function(e){var t=e.defaultValues,n=e.offCanvas,r=(0,u.cI)({defaultValues:t,resolver:(0,g.S)(P)}),o=r.control,a=r.errors,i=r.register,s=r.handleSubmit,c=(0,x.D)(E,{refetchQueries:["GetSublocations"],onCompleted:function(){n&&n.close()}}),l=(0,b.Z)(c,2),d=l[0],p=l[1].loading,m=function(e){var t=F(F({},e),{},{active:"active"===e.active});delete t.customerId,d({variables:{objects:[t]}})},f={control:o,errors:a,register:i};return p?(0,$.jsx)(T.Z,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:(0,$.jsx)(q.Z,{})}):(0,$.jsxs)(j.Z,{id:"offCanvasForm",handleSubmit:s(m),children:[t.id&&(0,$.jsx)(O.Z,F(F({},f),{},{name:"id",type:"hidden"})),(0,$.jsx)(w.Z,{label:"Customer",children:(0,$.jsx)(S.Z,F(F({},f),{},{name:"customerId",options:t.customerOptions}))}),(0,$.jsx)(w.Z,{label:"Property",children:(0,$.jsx)(S.Z,F(F({},f),{},{name:"locationId",options:t.locationOptions}))}),(0,$.jsx)(w.Z,{label:"Name",children:(0,$.jsx)(O.Z,F(F({},f),{},{name:"name"}))}),(0,$.jsx)(w.Z,{label:"Description",children:(0,$.jsx)(Z.Z,F(F({},f),{},{name:"description",rows:3}))}),(0,$.jsx)(w.Z,{label:"Status",children:(0,$.jsx)(S.Z,F(F({},f),{},{name:"active",options:I.bg}))})]})};J.defaultProps={defaultValues:{}};var N=n(35137),M=n(42846),L=n(58095),V=n(26143),W=n(53254),H=n(87043),U=function(e){var t=e.locationId,n=(0,l.a)(A,{variables:{locationId:t}}),r=n.data,o=(r=void 0===r?{sublocation:[]}:r).sublocation,a=n.loading,i=(0,c.useMemo)(function(){var e,t,n,r,i,s,c,l=null!==(e=null==o?void 0:o[0])&&void 0!==e?e:{};return l&&!a?"".concat(H.C1.issueReportUrl,"?locationId=").concat(null==l?void 0:null===(t=l.location)||void 0===t?void 0:t.id,"&locationName=").concat(null==l?void 0:null===(n=l.location)||void 0===n?void 0:n.name,"&sublocationId=").concat(l.id,"&sublocationName=").concat(l.name,"&customerId=").concat(null==l?void 0:null===(r=l.location)||void 0===r?void 0:null===(i=r.customer)||void 0===i?void 0:i[0].account.id,"&customerName=").concat(null==l?void 0:null===(s=l.location)||void 0===s?void 0:null===(c=s.customer)||void 0===c?void 0:c[0].account.name):""},[a,o]);return(0,$.jsx)(d.Z,{children:(0,$.jsx)(W.U,{id:"new-firstSublocation-qr-".concat(t),value:i,collapsible:!1})})};U.defaultProps={};var z=n(55863);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Y=function(e){var t,n=e.location,r=e.customer,o=(0,c.useRef)(),a=(0,L.a)(),i=(0,z.q)(),b=(0,u.cI)({defaultValues:{status:{label:"Active",value:"active"}}}),g=b.control,x=b.watch,j=(0,c.useState)({active:!0}),O=j[0],w=j[1],S=(0,M.x)({filters:O}).initialData,Z=x("status"),I=(0,l.a)(_,{variables:B(B({},S),{},{locationId:n.id})}),C=I.data,P=(C=void 0===C?{sublocations:[],meta:{aggregate:{totalCount:0}}}:C).sublocations,D=C.meta,k=I.loading,A=I.refetch;(0,c.useEffect)(function(){w({active:(null==Z?void 0:Z.value)==="active"})},[null==Z?void 0:Z.value]);var E=function(e){e.stopPropagation();var t={customerOptions:[{value:r.id,text:r.name}],locationOptions:[{value:n.id,text:n.name}],customerId:r.id,locationId:n.id};a.show({content:(0,$.jsx)(J,{defaultValues:t,offCanvas:a}),title:"Add sublocation"})},T=function(e,t){e.stopPropagation();var o={id:t.id,name:t.name,description:t.description,active:t.item.active?"active":"inactive",customerOptions:[{value:r.id,text:r.name}],locationOptions:[{value:n.id,text:n.name}],customerId:r.id,locationId:n.id};a.show({content:(0,$.jsx)(J,{defaultValues:o,offCanvas:a}),title:"Edit sublocation"})},q=function(e){e.stopPropagation(),a.show({content:(0,$.jsx)(U,{locationId:n.id}),title:"Sublocation info",submit:!1})},R=function(e){var t,n;return[{context:"secondary",icon:"edit",onClick:function(t){return T(t,e)},tooltip:"Edit"}].concat((0,s.Z)(null!=i&&null!==(t=i.admin)&&void 0!==t&&null!==(n=t.modules)&&void 0!==n&&n.nonLoggedUser?[{context:"secondary",icon:"info",onClick:q,tooltip:"Info"}]:[]))},F=function(){return P.map(function(e){return{name:e.name,locationName:e.location.name,description:e.description,status:e.active?"Active":"Inactive",actions:"",id:e.id,locationId:e.location.id,item:e}})};return(0,$.jsxs)(d.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,$.jsxs)(d.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,$.jsx)(u.Qr,{name:"status",control:g,render:function(e){var t=e.value,n=e.onChange;return(0,$.jsx)(v.q,{value:t,disableClearable:!0,textFieldProps:{color:"secondary",variant:"standard",label:"Select status"},sx:{width:"200px"},onChange:function(e,t){return n(t)},options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]})}}),(0,$.jsx)(p.Z,{variant:"contained",color:"secondary",onClick:E,children:"Create Sublocation"})]}),(0,$.jsxs)(m.Z,{sx:{padding:"16px 0px",height:"calc(90vh - 52px)"},children:[(0,$.jsx)(f.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Sublocations"}),null!==(t=F())&&void 0!==t&&t.length?(0,$.jsx)(y.i,{ref:o,loading:k,columns:[{headerName:"Name",field:"name",flex:1},{headerName:"Location",field:"locationName",flex:1,minWidth:200,renderCell:function(e){var t=e.row;return(0,$.jsx)(h.r,{color:"secondary",noWrap:!(null!=t&&t.locationId),children:(null==t?void 0:t.locationName)||"-"})}},{headerName:"Description",field:"description",flex:1},{headerName:"Status",field:"status",flex:1},{headerName:"Actions",field:"actions",flex:1,renderCell:function(e){var t=e.row;return(0,$.jsx)(V.C,{row:t,actionsData:R})}}],rows:F(),meta:D,refetch:A,autoHeight:!1,containerHeight:"calc(100% - 52px)"}):!k&&(0,$.jsx)(N.C,{imageSrc:"/static/icons/no_locations_found.svg",title:"No sublocations",subtitleFirstLine:"You currently have no sublocations set up in the system",subtitleSecondLine:"Click\xa0create sublocation\xa0to get started building.",buttonText:"Create sublocation",onAction:E})]})]})};Y.defaultProps={customer:{},location:{}}},49908:function(e,t,n){n.d(t,{n:function(){return E}});var r=n(59499),o=n(27812),a=n(50029),i=n(16835),s=n(64687),c=n.n(s),l=n(96486),u=n(6812),d=n(50319),p=n(96405),m=n(26447),f=n(5616),y=n(23776),h=n(18972),v=n(50135),b=n(98456),g=n(78462),x=n(93946),j=n(14564),O=n(67294),w=n(93362),S=n(10166),Z=n(72936),I=n(33063),C=n(52098),P=n(88284),D=n(85893);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var A=(0,w.D)(),E=function(e){var t=e.entityId,n=e.entity,r=e.values,s=void 0===r?[]:r,j=e.name,w=void 0===j?"tags":j,S=e.setValue,k=(0,Z.x)().user,E=(0,O.useState)(null),q=E[0],$=E[1],R=(0,O.useState)(""),F=R[0],J=R[1],N=(0,O.useState)(""),M=N[0],L=N[1],V=(0,O.useState)(""),W=V[0],H=V[1],U=(0,u.a)(C.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){S(w,e.tags)}}),z=U.data,G=(z=void 0===z?{tags:[]}:z).tags,B=U.loading,Y=U.refetch,Q=(0,u.a)(C.gI,{skip:!q,variables:{entityId:t,entity:n,q:""!==W?"%".concat(W,"%"):null}}),K=Q.data,X=(K=void 0===K?{tags:[]}:K).tags,ee=Q.loading,et=(0,d.D)(C.Zm,{refetchQueries:["GetAllTags"]}),en=(0,i.Z)(et,2),er=en[0],eo=en[1].loading,ea=(0,d.D)(C.LE,{onCompleted:function(){Y()}}),ei=(0,i.Z)(ea,2),es=ei[0],ec=ei[1].loading,el=(0,d.D)(C.cS,{onCompleted:function(){Y()}}),eu=(0,i.Z)(el,2),ed=eu[0],ep=eu[1].loading,em=(0,d.D)(C.g$,{refetchQueries:["GetAllTags"]}),ef=(0,i.Z)(em,2),ey=ef[0],eh=ef[1].loading;(0,O.useEffect)(function(){var e=setTimeout(function(){H(M)},500);return function(){return clearTimeout(e)}},[M]);var ev,eb,eg,ex=function(e){e.stopPropagation(),$(e.currentTarget)},ej=function(){$(null)},eO=(ev=(0,a.Z)(c().mark(function e(r,a){var i,l;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof a){e.next=4;break}J({label:a}),e.next=24;break;case 4:if(!(a&&a.inputValue&&t)){e.next=9;break}es({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:a.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:k.adminId}}}]}}),J(null),e.next=24;break;case 9:if(!(a&&a.value&&t)){e.next=14;break}es({variables:{objects:[{entity:n,entityId:t,taxonomyId:a.value}]}}),J(null),e.next=24;break;case 14:if(!(a&&a.inputValue)){e.next=23;break}return e.next=17,er({variables:{objects:[{type:"tags",status:"active",name:a.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:k.adminId}]}});case 17:l=e.sent.data.insert_Taxonomy,S(w,[].concat((0,o.Z)(s),[{id:null,tag:{id:l.returning[0].id,name:l.returning[0].name,meta:l.returning[0].meta}}])),J(null),e.next=24;break;case 23:a&&a.value&&(S(w,[].concat((0,o.Z)(s),[{id:null,tag:{id:a.value,name:a.label,meta:a.meta}}])),J(null));case 24:case"end":return e.stop()}},e)})),function(e,t){return ev.apply(this,arguments)}),ew=(0,O.useCallback)(function(e,t){var n=A(e,t),r=t.inputValue,o=e.some(function(e){return r===e.label});return""===r||o||n.push({inputValue:r,label:'Add "'.concat(r,'"')}),n},[]),eS=(0,O.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),eZ=function(e){t?ed({variables:{tagEntityId:e}}):S(w,s.filter(function(t,n){return n!==e}))},eI=(eb=(0,a.Z)(c().mark(function e(t){var n,r,o,a,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tagId,r=t.color,e.next=3,ey({variables:{tagId:n,object:{meta:{color:r}}}});case 3:a=e.sent.data.update_Taxonomy_by_pk,i=s.map(function(e){return e.tag.id===n?_(_({},e),{},{tag:_({},a)}):e}),S(w,i);case 7:case"end":return e.stop()}},e)})),function(e){return eb.apply(this,arguments)}),eC=(eg=(0,a.Z)(c().mark(function e(t){var n,r,o,a,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tagId,r=t.name,e.next=3,ey({variables:{tagId:n,object:{name:r}}});case 3:a=e.sent.data.update_Taxonomy_by_pk,i=s.map(function(e){return e.tag.id===n?_(_({},e),{},{tag:_({},a)}):e}),S(r,i);case 7:case"end":return e.stop()}},e)})),function(e){return eg.apply(this,arguments)}),eP=Boolean(q),eD=(0,O.useMemo)(function(){return X.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[X]),ek=(0,O.useMemo)(function(){return l.uniqBy([].concat((0,o.Z)(G),(0,o.Z)(s)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[G,s]);return(0,D.jsxs)(m.Z,{direction:"row",alignItems:"center",children:[(0,D.jsx)(P.P,{tags:ek,handleDeleteTagEntity:eZ}),(0,D.jsx)(T,{id:eP?"tags-popover":void 0,open:eP,anchorEl:q,onClose:ej,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,D.jsxs)(f.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,D.jsx)(y.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,o.Z)(eD),value:F,onChange:eO,onInputChange:function(e,t){L(t)},filterOptions:ew,getOptionLabel:eS,renderOption:function(e,t){return(0,D.jsx)(h.Z,_(_({},e),{},{children:t.label}))},renderInput:function(e){return(0,D.jsx)(v.Z,_(_({},e),{},{variant:"standard",color:"secondary",label:"Search tag",InputProps:_(_({},e.InputProps),{},{endAdornment:(0,D.jsxs)(D.Fragment,{children:[ee||eo||ec?(0,D.jsx)(b.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),B||ep||eh?(0,D.jsx)(m.Z,{width:"100%",alignItems:"center",p:4,children:(0,D.jsx)(b.Z,{color:"secondary"})}):(0,D.jsx)(g.Z,{children:null==ek?void 0:ek.map(function(e,t){var n;return(0,D.jsx)(I.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:eZ,onColorChange:eI,onNameChange:eC})})})]})}),(0,D.jsx)(x.Z,{color:"black",onClick:ex,children:(0,D.jsx)(p.Z,{sx:{height:"16px",width:"16px"}})})]})};E.defaultProps={entityId:null};var T=(0,S.Z)(j.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},99245:function(e,t,n){n.d(t,{O:function(){return r}});var r=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})}},66822:function(e,t,n){n.d(t,{f:function(){return O}});var r=n(59499),o=n(67294),a=n(58594),i=n(28497),s=n(55563),c=n(90951),l=n(95103),u=n(6710),d=n(78289),p=n(23233),m=n(49501),f=n(77439),y=n(40826),h=n(52220),v=n(99229),b=n(85893);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var j={checkbox:a.Z,currencyInput:i.Z,datepicker:h.M,input:s.Z,radio:c.Z,select:l.Z,textArea:u.Z,selectRange:l.Z},O=function(e){var t=e.control,n=e.entity,r=e.entityId,a=e.errors,i=e.input,s=e.inputType,c=e.key,l=e.label,u=e.mediaMeta,h=e.name,g=e.options,O=e.register,w=(0,o.useContext)(d.Z),S="select"===i&&g.length>0,Z=["checkbox","radio"].includes(i)&&g.length>0,I=x(x(x(x({control:t},Z&&{data:g}),S&&{options:g.map(function(e){return x(x({},e),{},{text:e.label})})}),"selectRange"===i&&{range:[10,0]}),{},{errors:a,key:c,label:p.Z.camelize(l),name:h,register:O,type:Z?i:s,minDate:"2020-04-19T08:29:04.839Z"}),C=function(){w.show({content:n&&r&&(0,b.jsx)(v.G,{entity:n,entityId:r,mediaMeta:u,category:"supplierQuestion"}),submit:!1,title:l})},P=j[i];return(0,b.jsx)(b.Fragment,{children:"currencyInput"===i?(0,b.jsx)(m.Z,{label:l,children:(0,b.jsx)(P,x(x({},I),{},{label:""}))}):(0,b.jsx)(b.Fragment,{children:"media"===i?(0,b.jsx)(m.Z,{label:l,children:(0,b.jsx)(f.Z,{context:"info",content:(0,b.jsx)(y.Z,{icon:"file-upload"}),onClick:C,size:"sm"})}):(0,b.jsx)(m.Z,{label:l,children:(0,b.jsx)(P,x({},I))})})})};O.defaultProps={input:"input",options:[],inputType:"text",label:"label"}},88854:function(e,t,n){n.d(t,{Im:function(){return p},RQ:function(){return y},fC:function(){return h},mW:function(){return m},uY:function(){return v},ze:function(){return f}});var r,o,a,i,s,c,l,u=n(71383),d=n(75063),p=(0,d.Ps)(r||(r=(0,u.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n'])));(0,d.Ps)(o||(o=(0,u.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"])));var m=(0,d.Ps)(a||(a=(0,u.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]))),f=(0,d.Ps)(i||(i=(0,u.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]))),y=(0,d.Ps)(s||(s=(0,u.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]))),h=(0,d.Ps)(c||(c=(0,u.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),v=(0,d.Ps)(l||(l=(0,u.Z)(["\n  query GetSLAsForJobManage {\n    slas: SLA(order_by: { name: asc }) {\n      id\n      label: name\n      notes\n    }\n  }\n"])))},27940:function(e,t,n){n.d(t,{l:function(){return y}});var r=n(59499),o=n(4730),a=n(67294),i=n(6812),s=n(88854),c=n(49501),l=n(84043),u=n(85893),d=["control","errors","label","name","register","type","filters"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=function(e,t){var n,r,o,a=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(r=t.errors[t.name])||void 0===r?void 0:r.message)&&(a=!1),["name","type"].forEach(function(n){e[n]!==t[n]&&(a=!1)}),a},y=(0,a.memo)(function(e){var t,n,r,a=e.control,p=e.errors,f=e.label,y=e.name,h=e.register,v=e.type,b=e.filters,g=(0,o.Z)(e,d),x=(r=(n=void 0===(n=(0,i.a)(s.Im,{variables:m(m({isGroup:"assetCategory"===v},b),{},{orderBy:{name:"asc"},type:v})}).data)?{taxonomy:[]}:n).taxonomy,"assetCategory"===v?r.map(function(e){return{label:e.name,options:e.options,childs:e.childs,meta:e.meta}}):r.map(function(e){return{label:e.name,value:e.id,childs:e.childs,meta:e.meta}}));return(0,u.jsx)(c.Z,{id:y,label:f,children:(0,u.jsx)(l.Z,m(m({},{control:a,errors:p,register:h}),{},{cacheOptions:!0,isClearable:!0,options:x,name:y},g))})},f);y.defaultProps={filters:{}}},11552:function(e,t,n){n.d(t,{F:function(){return c}});var r,o=n(50029),a=n(64687),i=n.n(a),s=n(38512),c=(r=(0,o.Z)(i().mark(function e(t,n,r){var o,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={},a={},e.next=4,t.mutate({mutation:s.iU,variables:{jobId:n,invoiceType:"supplier"},skip:r&&"supplier"!==r}).then(function(e){var t;o=null==e?void 0:null===(t=e.data.calculateJobFinance)||void 0===t?void 0:t.data.persistentData});case 4:return e.next=6,t.mutate({mutation:s.iU,variables:{jobId:n,invoiceType:"customerVat"},skip:r&&"supplier"===r}).then(function(e){var t;a=null==e?void 0:null===(t=e.data.calculateJobFinance)||void 0===t?void 0:t.data.persistentData});case 6:return e.abrupt("return",{financeSupplier:o,financeCustomer:a});case 7:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)})},63831:function(e,t,n){n.d(t,{$9:function(){return u},$i:function(){return f},CM:function(){return o},Fs:function(){return v},Ib:function(){return r},MF:function(){return a},_f:function(){return s},c7:function(){return p},e6:function(){return l},jT:function(){return c},p3:function(){return h},pH:function(){return d},qG:function(){return m},ut:function(){return y},y7:function(){return i}});var r=[{id:"anyTimeOption",label:"any time",value:"anyTimeOption"}],o=[{id:"anyTimeOption",label:"any time (during month)",value:"anyTimeOption"}],a=[{id:"excludingWeekends",label:"excluding weekends",value:!0}],i=[{text:"Yearly",value:"Yearly"},{text:"Monthly",value:"Monthly"},{text:"Weekly",value:"Weekly"},{text:"Daily",value:"Daily"},{text:"Hourly",value:"Hourly"}],s={Yearly:"month",Monthly:"month",Weekly:"isoWeek",Daily:"day"},c=[{id:"on",label:"on",value:"on"}],l=[{id:"onThe",label:"on the",value:"on the"}],u=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],d=[{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Day",value:"Day"},{text:"Weekday",value:"Weekday"},{text:"Weekend day",value:"Weekend day"}],p=[{id:"on",label:"on day",value:"on"}],m=[{id:"onThe",label:"on the",value:"on the"}],f=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],y=[{text:"After",value:"After"},{text:"On date",value:"On date"}],h={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},v={0:2,6:1}}}]);