"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7670],{57670:function(e,t,n){n.r(t),n.d(t,{default:function(){return eo}});var a,r,o=n(50029),s=n(16835),i=n(59499),c=n(64687),d=n.n(c),u=n(67294),l=n(66252),p=n(6812),m=n(50319),h=n(11163),y=n.n(h),f=n(83894),b=n(23855),v=n(43703),g=n(69119),I=n(38148),w=n(74975),x=n(10367),Z=[{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"reactiveJobsToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"plannedJobsToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"complianceJobToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"inprogressJobs",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"liveP1Jobs",greaterIsBetter:!0},{type:"chart",name:"chartJobMetrics"}],j=n(86886),O=n(5616),P=n(98456),S=n(63871),T=n(57778),k=n(57616),C=n(35441),D=n(97534),B=n(69496),J=n(30734),$=n(71383),A=n(75063),z=(0,A.Ps)(a||(a=(0,$.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $timezone: String\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $currentUserId: Int\n    $yearStart: timestamptz\n  ) {\n    dashboardTilesData: getDashboard_HomeTiles(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      reactiveJobsToday\n      plannedJobsToday\n      complianceJobToday\n      liveP1Jobs\n      inprogressJobs\n    }\n    chartJobsPerDay: getDashboard_HomeTiles_Jobs_perDay(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      jobsOnThisMonth\n    }\n  }\n"])));function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var E=function(e){var t=e.prevData,n=e.data,a=e.type;return Object.keys(n).reduce(function(e,r){return N(N({},e),{},(0,i.Z)({},r,N(N({},(null==t?void 0:t[r])||{}),{},(0,i.Z)({},a,n[r]))))},{})},_=function(e){var t,n=e.name,a=e.asAt,o=e.userId,s=e.adminId,i=e.accountId,c=e.time,d=(0,A.Ps)(r||(r=(0,$.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n  ) {\n    ",": getDashboard_HomeTiles_","(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      sum\n    }\n  }\n"])),n,n),u=null;switch(c){case"week":u=(0,J.Z)(a,{weeks:1});break;case"month":u=(0,J.Z)(a,{months:1});break;case"threeMonth":u=(0,J.Z)(a,{months:3});break;case"year":u=(0,J.Z)(a,{years:1})}return{query:d,variables:{adminId:s,accountId:i,asAt:u,dayStart:(0,g.Z)(u),monthStart:(0,v.Z)(u),userId:o,yearStart:(0,I.Z)(u)}}},q=n(27812),L=n(7069),R=n(77349),U=n(29383),H=n(96486);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var G="/dashboard",W=function(e){var t,n,a,r,o,s,i=e.asAt,c=e.userTiles,d=e.dashboardTilesData,u=e.userId,l=e.accountId,p=d||{},m=p.complianceJobToday,h=p.inprogressJobs,y=p.liveP1Jobs,f=p.plannedJobsToday,b=p.reactiveJobsToday,v=p.jobsOnThisMonth,g=[],I=[],x=[],Z=[],j=[],O=[];v&&v.length>0&&v.forEach(function(e,t){var n=e.date,a=e.ppmJobsOnThisMonth,r=e.reactiveJobsOnThisMonth,o=new Date(i),s=new Date(n);if(s>=(0,L.Z)(o,8)&&s<=(0,R.Z)(o,7)){if(v[t-1])for(var c=v[t-1].date,d=(0,U.Z)(s,new Date(c)),u=1;u<d;u++)g.push({date:(0,L.Z)(s,u),values:[]}),Z.push({date:(0,L.Z)(s,u),values:[]});g.push({date:s,values:a}),Z.push({date:s,values:r})}if(s>=(0,L.Z)(o,15)&&s<=(0,R.Z)(o,14)){if(v[t-1])for(var l=v[t-1].date,p=(0,U.Z)(s,new Date(l)),m=1;m<p;m++)I.push({date:(0,L.Z)(s,m),values:[]}),j.push({date:(0,L.Z)(s,m),values:[]});I.push({date:s,values:a}),j.push({date:s,values:r})}if(s>=(0,L.Z)(o,31)&&s<=(0,R.Z)(o,30)){if(v[t-1])for(var h=v[t-1].date,y=(0,U.Z)(s,new Date(h)),f=1;f<y;f++)x.push({date:(0,L.Z)(s,f),values:[]}),O.push({date:(0,L.Z)(s,f),values:[]});x.push({date:s,values:a}),O.push({date:s,values:r})}});var P=i?(0,w.Z)(i,"yyyy-MM-dd"):"",S=[{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},title:"Reactive jobs today",description:"Reactive jobs scheduled to happen today",name:"reactiveJobsToday",to:"".concat(G,"/issues?asAt=").concat(P,"&tileName=reactiveJobsToday").concat(u?"&userId=".concat(u):"").concat(l?"&accountId=".concat(l):""),values:{today:(null==b?void 0:b.today)||0,week:(null==b?void 0:b.week)||0,month:(null==b?void 0:b.month)||0,threeMonth:(null==b?void 0:b.threeMonth)||0,year:(null==b?void 0:b.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"PPM jobs today",description:"Planned maintenance jobs scheduled to happen today",name:"plannedJobsToday",to:"".concat(G,"/issues?type=ppm&asAt=").concat(P,"&tileName=plannedJobsToday").concat(u?"&userId=".concat(u):"").concat(l?"&accountId=".concat(l):""),values:{today:(null==f?void 0:f.today)||0,week:(null==f?void 0:f.week)||0,month:(null==f?void 0:f.month)||0,threeMonth:(null==f?void 0:f.threeMonth)||0,year:(null==f?void 0:f.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Live P1 jobs",description:"Jobs with P1 status scheduled for today but not completed",name:"liveP1Jobs",to:"".concat(G,"/issues?asAt=").concat(P,"&tileName=liveP1Jobs").concat(u?"&userId=".concat(u):"").concat(l?"&accountId=".concat(l):""),values:{today:(null==y?void 0:y.today)||0,week:(null==y?void 0:y.week)||0,month:(null==y?void 0:y.month)||0,threeMonth:(null==y?void 0:y.threeMonth)||0,year:(null==y?void 0:y.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Compliance jobs today",description:"Compliance work orders that are scheduled to take place today",name:"complianceJobToday",to:"".concat(G,"/issues?asAt=").concat(P,"&tileName=complianceJobToday").concat(u?"&userId=".concat(u):"").concat(l?"&accountId=".concat(l):""),values:{today:(null==m?void 0:m.today)||0,week:(null==m?void 0:m.week)||0,month:(null==m?void 0:m.month)||0,threeMonth:(null==m?void 0:m.threeMonth)||0,year:(null==m?void 0:m.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,20],danger:[21,40],warning:[41,null]},title:"Jobs in progress",description:"Jobs currently in progress",name:"inprogressJobs",to:"".concat(G,"/issues?asAt=").concat(P,"&tileName=inprogressJobs").concat(u?"&userId=".concat(u):"").concat(l?"&accountId=".concat(l):""),values:{today:(null==h?void 0:h.today)||0,week:(null==h?void 0:h.week)||0,month:(null==h?void 0:h.month)||0,threeMonth:(null==h?void 0:h.threeMonth)||0,year:(null==h?void 0:h.year)||0},greaterIsBetter:!0},{type:"chart",size:[2,1],title:"Jobs metrics",name:"chartJobMetrics",values:{week:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(t=(0,H.orderBy)(g,"date","asc"))&&void 0!==t?t:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(n=(0,H.orderBy)(Z,"date","asc"))&&void 0!==n?n:[]}]}],twoWeeks:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(a=(0,H.orderBy)(I,"date","asc"))&&void 0!==a?a:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(r=(0,H.orderBy)(j,"date","asc"))&&void 0!==r?r:[]}]}],month:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(o=(0,H.orderBy)(x,"date","asc"))&&void 0!==o?o:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(s=(0,H.orderBy)(O,"date","asc"))&&void 0!==s?s:[]}]}]}}],T=S.map(function(e){return e.name}),k={success:[0,10],danger:[11,20],warning:[21,null]},C=c.reduce(function(e,t){var n,a=t.colourConfig,r=t.pinned,o=t.greaterIsBetter,s=t.name,i=S.find(function(e){return e.name===s});return i?[].concat((0,q.Z)(e),[F(F({},i),{},{pinned:null!==(n=null!=r?r:i.pinned)&&void 0!==n&&n,colourConfig:void 0===a?k:a,greaterIsBetter:void 0===o||o})]):e},[]).sort(function(e,t){return T.indexOf(e)-T.indexOf(t)});return{fullTilesList:S,userTilesList:C}},K=n(85893);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Y=(0,f.Z)(new Date),ee=function(e){var t,n,a=e.user;e.theme;var r=(0,h.useRouter)(),c=(0,l.x)(),x=(0,u.useState)(!1),J=x[0],$=x[1],A=(0,u.useState)({}),M=A[0],N=A[1],q=(0,u.useState)(Z),L=q[0],R=q[1],U=(0,u.useState)([]),H=U[0],V=U[1],F=(0,u.useState)([]),G=F[0],Q=F[1],ee=(0,u.useState)(r.query.asAt?(0,f.Z)((0,b.Z)(r.query.asAt)):Y)[0],eo=(0,u.useState)({monthStart:(0,v.Z)(ee),todayEnd:(0,f.Z)(ee),todayStart:(0,g.Z)(ee),yearStart:(0,I.Z)(ee)})[0],es=(0,u.useState)(r.query.userId?r.query.userId:a.id)[0];(0,u.useEffect)(function(){"/dashboard"===y().pathname&&y().push({pathname:"/dashboard",query:X(X({},r.query),{},{asAt:(0,w.Z)(ee,"yyyy-MM-dd"),userId:es})})},[ee,es]);var ei=(0,p.a)(B.iM,{variables:{userId:a.id,accountId:a.accountId}}),ec=ei.data,ed=ei.refetch,eu=(null==ec?void 0:null===(t=ec.accountUser)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.meta)||{},el=(0,m.D)(B.fA),ep=(0,s.Z)(el,1)[0];(0,u.useEffect)(function(){null!=eu&&eu.dashboard&&R(eu.dashboard)},[eu]),(0,u.useEffect)(function(){var e=W({asAt:ee,dashboardTilesData:X({},M),userTiles:L,accountId:a.accountId,userId:es}),t=e.userTilesList,n=e.fullTilesList;Q(t),V(n)},[M]);var em,eh,ey=(0,p.a)(z,{variables:{accountId:a.accountId,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,adminId:a.adminId,asAt:ee,currentUserId:a.id,dayStart:eo.todayStart,monthStart:eo.monthStart,userId:es,yearStart:eo.yearStart},onCompleted:function(e){N(function(t){var n,a;return X(X(X({},t),E({prevData:t,data:null==e?void 0:null===(n=e.dashboardTilesData)||void 0===n?void 0:n[0],type:"today"})),{},{jobsOnThisMonth:null==e?void 0:null===(a=e.chartJobsPerDay)||void 0===a?void 0:a.jobsOnThisMonth})}),ev()}}),ef=ey.loading,eb=ey.refetch,ev=(em=(0,o.Z)(d().mark(function e(){var t,n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(L.map(function(){var e=(0,o.Z)(d().mark(function e(t){var n,r,o,u,l,p,m,h,y;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,!("tile"!==t.type)){e.next=3;break}return e.abrupt("return",{});case 3:return u=(o=_({name:n,asAt:ee,adminId:a.adminId,accountId:a.accountId,userId:es,time:"week"})).query,l=o.variables,e.next=6,c.query({query:u,variables:l});case 6:return m=void 0===(m=e.sent.data)?(0,i.Z)({},n,[{sum:0}]):m,y=(0,s.Z)(m[n],1)[0].sum,e.abrupt("return",(0,i.Z)({},n,y||0));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:n=(0,e.sent).reduce(function(e,t){return X(X({},e),t)},{}),N(function(e){return X(X({},e),E({prevData:e,data:n,type:"week"}))});case 5:case"end":return e.stop()}},e)})),function(){return em.apply(this,arguments)}),eg=function(e){var t=e.tiles,n=e.skipRefetch,r=e.skipRefetchMeta;ep({variables:{userId:a.id,accountId:a.accountId,changes:{meta:X(X({},eu),{},{dashboard:t})}}}).then(function(){n||eb(),r||ed()})},eI=function(e){eg({tiles:L.filter(function(t){return t.name!==e})})},ew=function(e,t){var n=L.map(function(n){return n.name===e?X(X({},n),{},{colourConfig:t}):n});eg({tiles:n,skipRefetch:!0})},ex=(eh=(0,o.Z)(d().mark(function e(t,n){var r,o,u,l,p,m,h;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=_({name:t,asAt:ee,adminId:a.adminId,accountId:a.accountId,userId:es,time:n})).query,u=r.variables,e.next=3,c.query({query:o,variables:u});case 3:p=void 0===(p=e.sent.data)?(0,i.Z)({},t,[{sum:0}]):p,h=(0,s.Z)(p[t],1)[0].sum,N(function(e){return X(X({},e),{},(0,i.Z)({},t,X(X({},e[t]||{}),{},(0,i.Z)({},n,h||0))))});case 8:case"end":return e.stop()}},e)})),function(e,t){return eh.apply(this,arguments)}),eZ=(0,u.useCallback)(function(){var e=[],t=[],n=[],a=[];if(G.forEach(function(e){"tile"===e.type&&e.pinned?t.push(e):"mapChart"===e.type||"chart"===e.type?n.push(e):a.push(e)}),t.length){var r=(0,K.jsx)(ea,{container:!0,spacing:3,className:"firstBlock",children:t.map(function(e,t){var n=e.title,a=e.subtitle,r=e.name,o=e.description,s=e.colourConfig,i=e.values,c=e.valueType,d=e.size,u=e.to,l=e.greaterIsBetter;return(0,K.jsx)(T.Z,{name:r,asAt:ee,className:"firstBlockItem",xs:12,sm3:6,colourConfig:s,title:n,subtitle:a,description:o,to:u,values:i,valueType:c,size:d,greaterIsBetter:l,editable:!0,onEdit:function(){return $(!0)},onVersusChange:ex,onConfigChange:ew})})});e.push(r)}if(n.length){var o=n.map(function(e){var t=e.type,n=e.title,a=e.description,r=e.name,o=e.values,s=e.size;return"chart"===t?(0,K.jsx)(j.ZP,{item:!0,className:"bigTile",children:(0,K.jsx)(k.Z,{asAt:ee,title:n,description:a,showLegend:!0,name:r,data:o,size:s})}):"mapChart"===t?(0,K.jsx)(j.ZP,{item:!0,className:"bigTile",children:(0,K.jsx)(C.Z,{asAt:ee,title:n,description:a,showLegend:!0,name:r,data:o,size:s})}):null});e.push(o)}if(n.length%2==0){var s=a.splice(0,4),i=(0,K.jsx)(ea,{container:!0,spacing:3,className:"secondBlock",children:s.slice(0,4).map(function(e,t){var n=e.title,a=e.subtitle,r=e.name,o=e.description,i=e.colourConfig,c=e.values,d=e.valueType,u=e.size,l=e.to,p=e.greaterIsBetter;return(0,K.jsx)(T.Z,{name:r,asAt:ee,className:"secondBlockItem",sm:12,lg:6,xl:t===s.length-4?12:4,colourConfig:i,title:n,subtitle:a,description:o,to:l,values:c,valueType:d,size:u,greaterIsBetter:p,onVersusChange:ex,onConfigChange:ew})})});e.push(i)}var c=a.map(function(e){var t=e.name,n=e.title,a=e.subtitle,r=e.description,o=e.colourConfig,s=e.values,i=e.valueType,c=e.size,d=e.to,u=e.greaterIsBetter;return(0,K.jsx)(T.Z,{asAt:ee,xs:12,sm3:6,xl:3,className:"restTilesBoxItem",colourConfig:o,name:t,title:n,subtitle:a,description:r,to:d,values:s,valueType:i,size:c,greaterIsBetter:u,editable:!0,onEdit:function(){return $(!0)},deletable:!0,onDelete:eI,onVersusChange:ex,onConfigChange:ew})});H.length>G.length&&c.push((0,K.jsx)(S.Z,{width:"100%",xs:12,sm3:6,xl:3,onAddCard:function(){return $(!0)}}));var d=(0,K.jsx)(er,{container:!0,spacing:3,m:0,sx:{justifyContent:"flex-start"},children:c});return e.push(d),(0,K.jsx)(en,{container:!0,spacing:3,children:e})},[G]);return(0,K.jsxs)(O.Z,{sx:{width:"100%",height:"100%"},children:[(0,K.jsx)(et,{children:ef?(0,K.jsx)(O.Z,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,K.jsx)(P.Z,{})}):eZ()}),(0,K.jsx)(D.Z,{open:J,fullTilesList:H,selectedTiles:L,onSaveTilesList:function(e){return eg({tiles:e})},onClose:function(){return $(!1)}})]})},et=(0,x.ZP)(O.Z).withConfig({displayName:"dashboard__DashboardBox",componentId:"sc-19rttwo-0"})(["width:100%;height:100%;.firstBlock{margin:0;flex-basis:50% !important;max-width:50% !important;min-width:auto;}.firstBlockItem{padding-left:24px;padding-top:24px;}.bigTile{flex-basis:50% !important;max-width:50%;}.secondBlock{margin:0;flex-basis:50% !important;min-width:auto;}.secondBlockItem{flex-basis:50% !important;max-width:50% !important;padding-left:24px;padding-top:24px;}@media (max-width:1550px){.firstBlock{margin:0;flex-basis:100% !important;max-width:100% !important;}.bigTile{flex-basis:100% !important;max-width:100%;}.secondBlock{flex-basis:100% !important;}.restTilesBoxItem{flex-basis:100% !important;}}@media (max-width:800px){.secondBlock{flex-basis:100% !important;}.secondBlockItem{flex-basis:100% !important;max-width:100% !important;}"]),en=(0,x.ZP)(j.ZP).withConfig({displayName:"dashboard__SecondRowBox",componentId:"sc-19rttwo-1"})(["align-content:flex-start;height:auto;min-height:400px;justify-content:space-between;"]),ea=(0,x.ZP)(j.ZP).withConfig({displayName:"dashboard__FirstBox",componentId:"sc-19rttwo-2"})(["display:flex;flex-wrap:wrap;min-width:824px;justify-content:space-between;align-content:space-between;"]),er=(0,x.ZP)(j.ZP).withConfig({displayName:"dashboard__RestTilesBox",componentId:"sc-19rttwo-3"})(["justify-content:space-between;"]),eo=(0,x.Zz)(ee)}}]);