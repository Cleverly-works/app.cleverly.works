"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7277],{39179:function(e,n,t){t.d(n,{I:function(){return v}});var o=t(59499),r=t(4730),i=t(26447),a=t(15861),u=t(90948),c=t(5616),s=t(50135),d=t(85893),l=["leftLabel","rightLabel","error"];function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var v=function(e){var n=e.leftLabel,t=e.rightLabel,o=e.error,u=(0,r.Z)(e,l);return(0,d.jsxs)(i.Z,{direction:"row",alignItems:"center",children:[(0,d.jsx)(f,{sx:{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"},error:o,children:(0,d.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},children:n})}),(0,d.jsx)(b,m(m({},u),{},{variant:"outlined",size:"small",error:o})),(0,d.jsx)(f,{sx:{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"},error:o,children:(0,d.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},variant:"body2",fontWeight:700,children:t})})]})},f=(0,u.ZP)(c.Z)(function(e){var n=e.theme;return{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:e.error?n.palette.danger.main:"#D9D9D9",minwidth:"28px",height:"28px",padding:"0 5px"}}),b=(0,u.ZP)(s.Z)(function(e){return e.theme,{height:"28px","& .MuiInputBase-root ":{borderRadius:"0px","&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#D9D9D9"}},"& .MuiInputBase-input":{padding:"4px 14px"},"& .MuiOutlinedInput-notchedOutline":{borderBottomWidth:"2px",borderTopWidth:"2px"}}}})},77301:function(e,n,t){t.d(n,{K:function(){return o}});var o=function(e){return 1}},95618:function(e,n,t){t.d(n,{N:function(){return o}});var o=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:n.onEditClick,to:"".concat(e,"manage"),tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:n.onDeleteClick,tooltip:"Delete"}]}},50558:function(e,n,t){t.d(n,{il:function(){return i},j$:function(){return o},wo:function(){return r}});var o=function(e,n){if(Array.isArray(n)){var t,o,r=null;return n.forEach(function(n){var t,o,i=null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});r=(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.fullName)||r}),r}var i=null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.fullName)||null},r=function(e,n){if(Array.isArray(n)){var t,o=null;return n.forEach(function(n){var t,r=null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});o=(null==r?void 0:r.id)||o}),o}var r=null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.id)||null},i=function(e,n){return!e||e>n}},42626:function(e,n,t){t.d(n,{Io:function(){return p},Lq:function(){return d},yG:function(){return l}});var o=t(59499),r=t(27812),i=t(74297),a=t(26186),u=t(64951);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var d=function(e,n){var t=e.itemType,o=e.paymentStatus;return"paymentReceipt"===t?n.COLOUR.black:"creditNote"===t?n.COLOUR.dark:"paid"===o?n.COLOUR.success:"partial"===o?n.COLOUR.female:n.COLOUR.danger},l=function(e,n){var t=n||{},o=t.numberPrefix,r=void 0===o?"":o,c=t.numberSuffix,s=void 0===c?"":c;return e.map(function(e){var n,t,o,c,d,l,p,m,v,f,b,y,h,g,j,x,I=(null==e?void 0:null===(n=e.reconciliations)||void 0===n?void 0:null===(t=n.aggregate)||void 0===t?void 0:null===(o=t.sum)||void 0===o?void 0:o.amount)||null,Z=null===(c=e.invoices)||void 0===c?void 0:c[0],w=null;return["invoice","proformaInvoice"].includes(e.type)?w="".concat((0,u.y)(null==Z?void 0:null===(j=Z.Job)||void 0===j?void 0:j.type)," ").concat(r," ").concat(null==Z?void 0:null===(x=Z.Job)||void 0===x?void 0:x.number," ").concat(s," / ").concat(null==Z?void 0:Z.invoiceNumber):"ppmInvoice"===e.type&&(w="PM / ".concat((null==Z?void 0:Z.invoiceNumber)||"")),{itemType:(0,i.Z)(e.type),invoice:w,reference:(null===(d=e.meta)||void 0===d?void 0:d.paymentReference)||(null==Z?void 0:null===(l=Z.Job)||void 0===l?void 0:l.reference),date:(0,a.Z)(e.createdAt),daysOutstanding:null==e?void 0:e.outstandingdays,status:null==Z?void 0:null===(p=Z.Job)||void 0===p?void 0:p.status,service:null==Z?void 0:null===(m=Z.Job)||void 0===m?void 0:null===(v=m.service)||void 0===v?void 0:v.name,address:null==Z?void 0:null===(f=Z.Job)||void 0===f?void 0:null===(b=f.location)||void 0===b?void 0:b.name,sublocation:null==Z?void 0:null===(y=Z.Job)||void 0===y?void 0:null===(h=y.sublocation)||void 0===h?void 0:h.name,debit:e.debit,credit:e.credit,balance:e.balance,reconciledAmount:null!=I?I:0,amountOutstanding:e.outstandingAmount,paymentStatus:e.paymentStatus,comment:null===(g=e.meta)||void 0===g?void 0:g.comment}})},p=function(e){var n=e.accountId,t=e.from,o=void 0===t?null:t,i=e.jobNumber,a=e.locationId,u=e.outstandingLevel,c=e.to,d=void 0===c?null:c,l=e.type,p=e.invoicesForJobOnly,m={},v={},f=[],b=[],y=[];return a&&(f=[{_or:[{locationId:{_eq:a}},{PaymentReconciliations:{locationId:{_eq:a}}}]}]),l&&(m.type={_in:[].concat((0,r.Z)(l),["ppmInvoice","invoice"])},m.paymentStatus={_in:(0,r.Z)(l)}),n&&(m.accountId={_eq:n}),u&&(m.outstandingdays={_gte:u.split("-")[0]||null,_lte:u.split("-")[1]||null}),(d||o)&&(y=[{_and:[{_or:[{_and:[{createdAt:{_gte:o}},{createdAt:{_lte:d}}]}]}]}]),i&&(b=void 0!==p&&p?[{Invoices:{Job:{number:{_ilike:i}}}}]:[{_or:[{Invoices:{invoiceNumber:{_eq:i}}},{Invoices:{Job:{number:{_ilike:i}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{invoiceNumber:{_eq:i}}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{Job:{number:{_ilike:i}}}}}}]}]),(f.length>0||b.length>0||y.length>0)&&(v={_and:[].concat((0,r.Z)(f),(0,r.Z)(b),(0,r.Z)(y))}),s(s({},m),v)}},4021:function(e,n,t){t.d(n,{q:function(){return W}});var o=t(59499),r=t(27812),i=t(50029),a=t(16835),u=t(64687),c=t.n(u),s=t(67294),d=t(6812),l=t(50319),p=t(72628),m=t(42283),v=t(79665),f=t(10367),b=t(98456),y=t(77651),h=t(46901),g=t(73987),j=t(16551),x=t(55563),I=t(77439),Z=t(40826),w=t(11082),O=t(26186),q=t(9270),_=t(76600),S=t(62140),P=t(49501),A=t(28497),D=t(6710),R=t(62047),T=t(11587),k=t(825),C=t(52220),$=t(77301),E=t(27952),N=t(74231),Q=(0,N.Ry)().shape({dateReceived:(0,N.hT)().required(),paymentReference:(0,N.Z_)().required(),amountReceived:(0,N.Rx)().required(),comment:(0,N.Z_)(),connectedAmount:(0,N.IX)().of((0,N.Ry)().shape({id:(0,N.Rx)().required(),outstandingAmount:(0,N.Rx)().required(),amount:(0,N.Rx)().max((0,N.iH)("outstandingAmount")).min(0).required(),meta:(0,N.Ry)()})).required()}),L=t(42626),U=t(42846),J=t(67872),F=t(85893);function M(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?M(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function V(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return B(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return B(e,n)}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(u)throw i}}}}function B(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}var W=function(e){var n,t=e.type,o=e.accountId,u=e.locationId,f=e.adminId,N=e.jobNumber,M=(e.refetch,e.toggleShow),B=e.numberPrefix,W=e.numberSuffix,K=e.invoicesForJobOnly,X=e.xeroUserId,Y=e.xeroCompanyId,ee=e.onSendPaymentToXero,en=(0,s.useContext)(g.Z).user,et=(0,U.x)({filters:null}),eo=et.initialData,er=et.ref,ei=(0,s.useState)(!1),ea=ei[0],eu=ei[1],ec=(0,s.useState)(0),es=ec[0],ed=ec[1],el=(0,s.useState)({error:!1,message:null}),ep=el[0],em=el[1],ev=(0,s.useState)(!1),ef=ev[0],eb=ev[1],ey=(0,m.cI)({resolver:(0,v.S)(Q)}),eh=ey.control,eg=ey.errors,ej=ey.getValues,ex=ey.handleSubmit,eI=ey.register,eZ=ey.setValue,ew=(0,m.Dq)({control:eh,name:"connectedAmount"}).fields,eO=(0,m.qo)({control:eh,name:"amountReceived",defaultValue:0}),eq=(0,d.a)(p.v8,{variables:z(z({},eo),{},{where:z(z({},(0,L.Io)({accountId:o,locationId:u,adminId:f,jobNumber:N?"".concat(N):null,invoiceNumber:N?Number(N):null,type:["proformaInvoice","partial","unpaid"],invoicesForJobOnly:K})),{},{debit:{_gt:0},outstandingAmount:{_gt:0}}),locationId:u})}),e_=eq.data,eS=(e_=void 0===e_?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:e_).accountEntries,eP=e_.meta,eA=eq.loading,eD=eq.refetch,eR=(0,l.D)(p.Vr,{}),eT=(0,a.Z)(eR,2),ek=eT[0],eC=eT[1].error,e$=(0,l.D)(p._0,{refetchQueries:["GetAccountEntries"]}),eE=(0,a.Z)(e$,1)[0],eN=(n=(0,i.Z)(c().mark(function e(n){var a,u,s,d;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,eb(!0),!(Number(es).toFixed(2)>Number(n.amountReceived).toFixed(2))){e.next=4;break}return e.abrupt("return",em({error:!0,message:"You can not reconcile more than payment amount"}));case 4:if(!(Number(es).toFixed(2)<Number(n.amountReceived).toFixed(2))){e.next=6;break}return e.abrupt("return",em({error:!0,message:"You can not reconcile less than payment amount"}));case 6:if(a=n.connectedAmount.filter(function(e){return e.amount>0}),u={accountId:o,balance:0,credit:parseFloat(n.amountReceived).toFixed(2),currencyId:(0,$.K)(o),debit:0,meta:{paymentReference:n.paymentReference,comment:n.paymentReference},type:"paymentReceipt",paymentStatus:"paymentReceipt",dateReceived:(0,E.v)(n.dateReceived),PaymentReconciliations:{data:a.map(function(e){var n,t=e.amount;return{creditEntity:"PaymentReceipt",debitEntity:"Invoice",debitEntityId:e.id,locationId:e.locationId,amount:t}})}},s=a.reduce(function(e,n){if(n.amount!==n.outstandingAmount)return e;var t=eS.find(function(e){return e.id===n.id}).invoices.map(function(e){return e.Job.id});return[].concat((0,r.Z)(e),(0,r.Z)(t))},[]),!((d=a.reduce(function(e,t){return t.xeroInvoiceId?[].concat((0,r.Z)(e),[{invoiceId:Number(t.invoiceId),invoiceNumber:t.invoiceNumber,xeroInvoiceId:t.xeroInvoiceId,credit:t.amount,dateReceived:(0,E.v)(n.dateReceived)}]):e},[])).length&&Y&&X)){e.next=18;break}return e.prev=11,e.next=14,ee({adminId:f,xeroCompanyId:Y,xeroAccountId:X,payments:d});case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:return e.next=20,ek({variables:{object:u,jobIds:s,changes:{status:"".concat(t,"Paid"),paid:!0},timing:s.map(function(e){return{status:"".concat(t,"Paid"),jobId:e,userId:en.id}})}}).then((0,i.Z)(c().mark(function e(){var n,t,o;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=V(a),e.prev=1,n.s();case 3:if((t=n.n()).done){e.next=9;break}return o=t.value,e.next=7,eE({variables:{id:o.id,changes:{outstandingAmount:o.outstandingAmount-o.amount,balance:o.outstandingAmount-o.amount}}});case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])})));case 20:M();case 21:return e.prev=21,eb(!1),e.finish(21);case 24:case"end":return e.stop()}},e,null,[[0,,21,24],[11,16]])})),function(e){return n.apply(this,arguments)}),eQ={control:eh,errors:eg,register:eI},eL=function(){var e,n=ej();ed((null==n?void 0:null===(e=n.connectedAmount)||void 0===e?void 0:e.reduce(function(e,n){return e+Number(n.amount)},0))||0),em({error:!1,message:""})},eU=function(e,n){eZ(e,n),eL()},eJ=function(e){var n=e.id,t=e.invoiceId,o=e.amount,r=e.index,i=e.locationId,a=e.outstandingAmount,u=e.invoices,c=e.meta,s=e.invoiceNumber,d=Number(a).toFixed(2)===Number(o).toFixed(2)?"success":"info";return a||(d="danger"),(0,F.jsxs)(j.Z,{children:[(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].id"),value:n,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].invoiceId"),value:t,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].invoices"),value:u,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].locationId"),value:i,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].xeroInvoiceId"),value:c.xeroInvoiceId,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].invoiceNumber"),value:s,type:"hidden"})),(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"connectedAmount[".concat(r,"].outstandingAmount"),value:a,type:"hidden"})),(0,F.jsx)(H,z(z({},eQ),{},{context:ea?d:null,name:"connectedAmount[".concat(r,"].amount"),onChange:eL,size:"sm",type:"number",step:"0.01",defaultValue:0})),(0,F.jsx)(I.Z,{context:"light","data-tip":"Button",onClick:function(){eU("connectedAmount[".concat(r,"].amount"),a)},size:"xs",title:"copy amount",children:(0,F.jsx)(Z.Z,{context:"secondary",icon:"clone",size:"lg"})})]})},eF=(0,s.useMemo)(function(){return[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Number",formatter:function(e){var n=e.row;return"ppmInvoice"===n.type?"PM ".concat(n.invoiceNumber):(0,F.jsx)(k.D,{id:n.jobId,number:n.jobNumber,invoiceNumber:n.invoiceNumber,numberPrefix:B,numberSuffix:W,openCanvas:!0,type:n.jobType})}},{sortable:!0,sortName:"createdAt",text:"Date"},{sortable:!0,sortName:"daysOutstanding",text:"Days Outstanding"},{sortable:!0,sortName:"outstandingAmount",text:"Amount Outstanding",formatter:function(e){var n=e.row;return(0,w.Z)(n.outstandingAmount)}},{text:"Reconciled Amount",formatter:function(e){return eJ(e.row)}},{hidden:!0},{hidden:!0}]},[]),eM=function(e){eu(!ea)};return((0,s.useEffect)(function(){eZ("connectedAmount",eS.map(function(e,n){var t,o,r,i,a=null===(t=e.invoices)||void 0===t?void 0:t[0];return{index:n,id:e.id,type:e.type,jobId:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.id,locationId:e.locationId,jobNumber:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.number,jobType:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.type,invoiceNumber:null==a?void 0:a.invoiceNumber,date:(0,O.Z)(e.createdAt),daysOutstanding:e.outstandingdays,outstandingAmount:e.outstandingAmount,amount:0,invoiceId:null==a?void 0:a.id,meta:e.meta}}))},[eS]),(0,s.useEffect)(function(){if(ea){var e=Number(eO);ew.forEach(function(n,t){var o=e>=n.outstandingAmount?Number(n.outstandingAmount).toFixed(2):Number(e).toFixed(2);e-=o,eZ("connectedAmount[".concat(n.index,"].amount"),o)}),eL()}},[eO,ea,ew]),(0,s.useEffect)(function(){eC?em({error:!0,message:null==eC?void 0:eC.message}):em(!1)},[eC]),ef)?(0,F.jsx)(q.Z,{style:{justifyContent:"center",alignItems:"center"},children:(0,F.jsx)(b.Z,{size:30})}):(0,F.jsxs)(_.Z,{id:"offCanvasForm",handleSubmit:ex(eN),children:[(0,F.jsx)(y.Z,{open:null==ep?void 0:ep.error,autoHideDuration:6e3,onClose:function(){em({error:!1,message:null})},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,F.jsx)(h.Z,{onClose:function(){return em({error:!1,message:null})},severity:"error",variant:"filled",sx:{width:"500px"},children:(null==ep?void 0:ep.message)||"Oops some error occurred. Please try again later"})}),(0,F.jsxs)(q.Z,{children:[(0,F.jsxs)(S.Z,{md:6,children:[(0,F.jsx)(P.Z,{label:"Date Received"}),(0,F.jsx)(C.M,z(z({},eQ),{},{name:"dateReceived"}))]}),(0,F.jsx)(S.Z,{md:6,children:(0,F.jsx)(P.Z,{label:"Payment Reference",children:(0,F.jsx)(x.Z,z(z({},eQ),{},{name:"paymentReference"}))})})]}),(0,F.jsxs)(q.Z,{children:[(0,F.jsx)(S.Z,{md:6,children:(0,F.jsx)(G,{align:"center",children:(0,F.jsx)(A.Z,z(z({},eQ),{},{name:"amountReceived",label:"Amount Received",vat:!0}))})}),(0,F.jsx)(S.Z,{md:6,children:(0,F.jsx)(P.Z,{label:"Comment",children:(0,F.jsx)(D.Z,z(z({},eQ),{},{name:"comment",rows:2}))})})]}),(0,F.jsx)(P.Z,{label:"Auto reconcile",children:(0,F.jsx)(R.Z,z(z({},eQ),{},{onToggle:function(e){return eM(e)},size:"sm",toggled:ea}))}),(0,F.jsx)(J.t,{columns:eF,loading:eA,history:!1,meta:eP,ref:er,refetch:eD,rows:ew}),(0,F.jsx)(G,{reverse:!0,pr:!0,children:(0,F.jsx)(T.Z,{content:"Sum: ".concat((0,w.Z)(es)),context:Number(es).toFixed(2)===Number(eO).toFixed(2)?"success":"danger"})})]})},G=(0,f.ZP)(q.Z).withConfig({displayName:"paymentReceivedForm__StyledRow",componentId:"sc-1wl4d2h-0"})(["padding-left:1rem;padding-right:",";flex-flow:",";"],function(e){return e.pr?"5rem":null},function(e){return e.reverse?"row-reverse":null}),H=(0,f.ZP)(x.Z).withConfig({displayName:"paymentReceivedForm__StyledInput",componentId:"sc-1wl4d2h-1"})(["border:1px solid ",";"],function(e){return e.theme.COLOUR[e.context]})},33816:function(e,n,t){t.d(n,{By:function(){return p},Rm:function(){return d},WG:function(){return l},bK:function(){return m}});var o,r,i,a,u,c=t(71383),s=t(75063),d=(0,s.Ps)(o||(o=(0,c.Z)(['\n  query getInvoices($jobId: Int!, $locationId: Int!) {\n    invoices: Invoice(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { entity: { _eq: "Job" } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n      }\n    ) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { AccountEntry: { jobId: { _eq: $jobId } } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n        invoiceType: { _in: ["ProformaInvoiceCustomer", "ProformaInvoiceSupplier"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])));(0,s.Ps)(r||(r=(0,c.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n'])));var l=(0,s.Ps)(i||(i=(0,c.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),p=(0,s.Ps)(a||(a=(0,c.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: { entityId: { _eq: $jobId }, invoiceType: { _eq: $invoiceType } }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),m=(0,s.Ps)(u||(u=(0,c.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      data\n      success\n    }\n  }\n"])))},48501:function(e,n,t){t.d(n,{m:function(){return ej}});var o=t(59499),r=t(6812),i=t(99235),a=t(50029),u=t(16835),c=t(64687),s=t.n(c),d=t(67294),l=t(30381),p=t.n(l),m=t(50319),v=t(51040),f=t(42283),b=t(79665),y=t(78289),h=t(77439),g=t(76600),j=t(9270),x=t(62140),I=t(11587),Z=t(55377),w=t(49501),O=t(55563),q=t(95103),_=t(6710),S=t(16551),P=t(52220),A=t(99229),D=t(52019),R=t(11082),T=t(10367),k=t(68956),C=t(33006),$=t(16540),E=t(95618),N=t(45697),Q=t(74231),L=t(28497),U=t(51466),J=t(94054),F=t(56815),M=t(15861),z=t(85893);function V(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function B(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?V(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var W=function(e){var n,t,o=e.editMode,r=e.onSuccess,c=e.rawData,l=e.quotationId,p=(e.setQuote,e.supplierId),v=e.type,y=e.toggleShow,I=(0,d.useContext)(D.Z).hasRole,S=(0,f.cI)({defaultValues:{description:o?c.description:"",qty:o?c.qty:"",qtyUnit:o?c.qtyUnit:"hours",unitRate:o?c.unitRate:"",item:o?c.item:"",total:o?c.total:""},resolver:(0,b.S)(G),context:{isAdmin:I("admin")}}),P=S.control,A=S.errors,T=S.handleSubmit,k=S.register,C=S.watch,$={control:P,errors:A,register:k},E=C("qty"),N=C("unitRate"),Q=C("total"),V=C("description"),W=(0,m.D)(i.Ih,{onCompleted:function(e){var n=e.insert_SupplierQuoteLineItem.returning[0].id;r&&r(n)}}),H=(0,u.Z)(W,2),K=H[0],X=H[1].loading,Y=(0,m.D)(i.EA,{onCompleted:function(e){var n=e.update_SupplierQuoteLineItem_by_pk.id;r&&r(n)}}),ee=(0,u.Z)(Y,2),en=ee[0],et=ee[1].loadingUpdate,eo=(t=(0,a.Z)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=6;break}return n.supplierTotal=n.qty*n.unitRate,e.next=4,en({variables:{id:null==c?void 0:c.id,changes:n}});case 4:e.next=12;break;case 6:return n.accountId=Number(p),n.type=v,n.quoteId=Number(l),n.supplierTotal=n.qty*n.unitRate,e.next=12,K({variables:{objects:[n]}});case 12:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,z.jsxs)(g.Z,{handleSubmit:T(eo),children:[(0,z.jsx)(j.Z,{children:(0,z.jsx)(x.Z,{md:12,children:(0,z.jsx)(J.Z,{fullWidth:!0,error:!!(null!=A&&A.description),children:(0,z.jsxs)(w.Z,{label:"Description",children:[(0,z.jsx)(_.Z,B(B({},$),{},{name:"description",rows:2})),(null==A?void 0:A.description)&&(0,z.jsx)(F.Z,{sx:{m:0},children:null==A?void 0:null===(n=A.description)||void 0===n?void 0:n.message}),(0,z.jsxs)(M.Z,{children:[V.length,"/500"]})]})})})}),(0,z.jsxs)(j.Z,{children:[(0,z.jsx)(x.Z,{md:4,children:(0,z.jsx)(w.Z,{label:"Quantity",children:(0,z.jsx)(O.Z,B(B({},$),{},{name:"qty",type:"number",step:"0.01"}))})}),"Labour"===v&&(0,z.jsx)(x.Z,{md:4,children:(0,z.jsx)(w.Z,{label:"Quantity Unit",children:(0,z.jsx)(q.Z,B(B({},$),{},{name:"qtyUnit",options:[{text:"Hours",value:"hours",disabled:!1},{text:"Days",value:"days",disabled:!1},{text:"Weeks",value:"weeks",disabled:!1}]}))})}),(0,z.jsx)(x.Z,{md:4,children:(0,z.jsx)(L.Z,B(B({},$),{},{label:I("supplier")?"Unit Rate":"Supplier Unit Rate",name:"unitRate",vat:"Ex VAT"}))})]}),(0,z.jsxs)(U.Z,{children:["Supplier Total: ",(0,R.Z)(E*N)]}),(0,z.jsx)(Z.Z,{}),I("admin")&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.Z,{children:(0,z.jsx)(x.Z,{md:12,children:(0,z.jsx)(L.Z,B(B({},$),{},{label:"Customer Unit Rate",name:"total",vat:"Ex VAT"}))})}),(0,z.jsxs)(U.Z,{children:["Customer Total (Labour Item): ",(0,R.Z)(E*Q)]}),(0,z.jsx)(Z.Z,{})]}),(0,z.jsxs)(j.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,z.jsx)(h.Z,{content:"Cancel",onClick:y,style:{margin:"0 5px"}}),(0,z.jsx)(h.Z,{content:o?"Save":"Add",disabled:X||et,type:"submit"})]}),(0,z.jsx)("div",{style:{clear:"both"}})]})};W.defaultProps={rawData:{}};var G=Q.Ry({qty:Q.Rx().required("Quantity is a required field"),unitRate:Q.Rx().required("Unit rate is a required field"),total:Q.Rx().when("isAdmin",{is:function(e){return!0===e},then:function(){return(0,N.number)().required("Customer Unit Rate is a required field")}}),description:Q.Z_().max(500,"Description must have a maximum of 500 characters.").test("maxLines","Textarea should not exceed 10 lines",function(e){return!e||e.split("\n").length<=10})}),H=t(84808),K=t(98456),X=function(e){var n=e.quotation,t=e.quotationId,o=e.type,a=e.updateTotal,c=e.readOnly,s=(0,d.useContext)(D.Z).hasRole,l=(0,d.useContext)(y.Z),p=(0,r.a)(i.cu,{variables:{quotationId:t,type:o}}),v=p.data,f=(v=void 0===v?{lineItems:[]}:v).lineItems,b=p.loading,g=p.refetch,j=(0,m.D)(i.nc,{onCompleted:function(e){g()}}),x=(0,u.Z)(j,1)[0];(0,d.useEffect)(function(){a(f)},[f]);var I=function(){g(),l.close()},Z=function(e,r){var i;l.show({content:(0,z.jsx)(W,{editMode:!!(null!=r&&r.rawData),onSuccess:I,rawData:null==r?void 0:r.rawData,toggleShow:l.close,quotationId:t,supplierId:null===(i=n.supplier)||void 0===i?void 0:i.id,type:o}),submit:!1,title:"".concat(r?"Edit":"Insert"," ").concat(o," Item")})},w=function(e,n){x({variables:{id:n.id}})},O=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!s(["admin","supplier"]),text:"Qty"},{hidden:!s(["admin","supplier"]),text:"Rate"},{hidden:!s(["admin","supplier"]),text:"Supplier Total"},{hidden:!s(["admin","customer"]),text:"Customer Total"},{hidden:!s(["admin","supplier"])||c,formatter:k.Z,formatterData:(0,E.N)("/dashboard/quotes/",{onEditClick:Z,onDeleteClick:w}),text:"Actions"},{text:"Raw Data",hidden:!0}],q=f.reduce(function(e,n){return e+n.total*n.qty},0),_=f.reduce(function(e,n){return e+n.supplierTotal},0);return b?(0,z.jsx)(H.Z,{sx:{zIndex:1e5},open:!0,children:(0,z.jsx)(K.Z,{color:"secondary"})}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(C.Z,{content:(0,z.jsxs)(Y,{align:"center",justify:"between",children:[(0,z.jsx)("span",{children:o}),s(["admin","supplier"])&&!c&&(0,z.jsx)(h.Z,{content:"Insert ".concat(o," Item"),context:"secondary",onClick:Z,size:"sm"})]}),tag:"h4"}),(0,z.jsx)($.Z,{columns:O,rows:f.map(function(e){return{id:e.id,description:e.description,qty:"Labour"===e.type?"".concat(e.qty," ").concat(e.qtyUnit):e.qty,rate:(0,R.Z)(e.unitRate),supplierTotal:(0,R.Z)(e.supplierTotal),total:(0,R.Z)(e.total*e.qty),action:"",rawData:e}})}),(0,z.jsxs)("div",{style:{textAlign:"right"},children:[s(["admin","supplier"])&&(0,z.jsxs)(ee,{children:["Subtotal - ",o," ",s(["admin"])&&"- Supplier",": ",(0,R.Z)(_)]}),s(["admin","customer"])&&(0,z.jsxs)(ee,{children:["Subtotal - ",o,": ",(0,R.Z)(q)]})]})]})},Y=(0,T.ZP)(j.Z).attrs(function(){return{align:"center",justify:"between"}}).withConfig({displayName:"lineItemTable__StyledRow",componentId:"sc-18sy5kb-0"})(["margin:0 5px;"]),ee=T.ZP.p.withConfig({displayName:"lineItemTable__StyledP",componentId:"sc-18sy5kb-1"})(["margin:0;"]);function en(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function et(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?en(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):en(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;return e.reduce(function(e,t){return"total"===n?e+=t[n]*t.qty:e+=t[n]},0)},er=function(e){var n=e.quotation,t=e.total,r=e.setTotal,i=(e.supplierTotal,e.setSupplierTotal),a=(e.customerTotal,e.setCustomerTotal),u=e.readOnly,c=(0,d.useContext)(D.Z).hasRole,s=function(e,n){return r(function(t){return et(et({},t),{},(0,o.Z)({},e,eo(n,"total")))})},l=function(e,n){return i(function(t){return et(et({},t),{},(0,o.Z)({},e,eo(n,"supplierTotal")))})},p=function(e,n){return a(function(t){return et(et({},t),{},(0,o.Z)({},e,eo(n,"total")))})},m=t.labour+t.materials,v=.2*m;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.Z,{children:(0,z.jsx)(x.Z,{md:12,children:(0,z.jsx)(X,{quotationId:n.id,quotation:n,type:"Labour",updateTotal:function(e){s("labour",e),l("labour",e),p("labour",e)},readOnly:u})})}),(0,z.jsx)(Z.Z,{}),(0,z.jsx)(j.Z,{children:(0,z.jsx)(x.Z,{md:12,children:(0,z.jsx)(X,{quotationId:n.id,quotation:n,type:"Materials",updateTotal:function(e){s("materials",e),l("materials",e),p("materials",e)},readOnly:u})})}),(0,z.jsx)(Z.Z,{}),c(["admin","customer"])&&(0,z.jsx)(j.Z,{children:(0,z.jsxs)(x.Z,{md:12,style:{textAlign:"right"},children:[(0,z.jsxs)("div",{children:["Sub Total: ",(0,R.Z)(m)]}),(0,z.jsxs)("div",{children:["VAT (20%): ",(0,R.Z)(v)]}),(0,z.jsxs)("div",{children:["Total: ",(0,R.Z)(m+v)]})]})})]})},ei=(0,Q.Ry)().shape({totalDuration:(0,Q.Z_)().required(),totalDurationUnit:(0,Q.Z_)().required(),methodStatement:(0,Q.Z_)().required(),startDate:(0,Q.hT)().required(),rebate:(0,Q.Z_)(),notes:(0,Q.Z_)()}),ea=t(52696),eu=t(94568),ec=t(14564),es=t(26447),ed=t(79369),el=t(50558);function ep(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function em(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ep(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ep(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ev=function(e){var n,t,o,r,i,c,l,D,R,T=e.quotation,k=e.status,C=e.user,$=e.hasRole,E=e.onSuccess,N=(0,d.useContext)(y.Z),Q=null==C?void 0:C.quoteThreshold,L=(0,d.useState)({labour:0,materials:0}),U=L[0],J=L[1],F=(0,d.useState)({labour:0,materials:0}),M=F[0],V=F[1],B=(0,d.useState)({labour:0,materials:0}),W=B[0],G=B[1],H=(0,d.useState)(null),K=H[0],X=H[1],Y=(0,eu.s)(),ee=function(e){X(e.currentTarget)},en=function(){X(null)},et=M.labour+M.materials,eo=null==T?void 0:null===(n=T.job)||void 0===n?void 0:null===(t=n.timings)||void 0===t?void 0:t.find(function(e){return e.quoteId===T.id&&e.status==="".concat("admin"===C.accountType?"adminSupplier":C.accountType,"QuoteThresholdApproval")}),ep=null==T?void 0:null===(o=T.job)||void 0===o?void 0:null===(r=o.timings)||void 0===r?void 0:r.find(function(e){return e.quoteId===T.id&&e.status==="".concat("admin"===C.accountType?"adminSupplier":C.accountType,"QuoteThresholdApproved")}),ev=eo&&ep&&(null==eo?void 0:null===(i=eo.meta)||void 0===i?void 0:i.to)===(null==ep?void 0:ep.userId),ef=(0,m.D)(v.HI),eb=(0,u.Z)(ef,1)[0],ey=(0,f.cI)({defaultValues:{totalDuration:(null==T?void 0:T.totalDuration)||"",totalDurationUnit:(null==T?void 0:T.totalDurationUnit)||"hour",startDate:null!=T&&T.startDate?new Date(T.startDate):"",methodStatement:(null==T?void 0:T.methodStatement)||"",rebate:(null==T?void 0:T.rebate)||"",notes:(null==T?void 0:T.notes)||"",siteVisitAt:null!=T&&T.siteVisitAt?new Date(T.siteVisitAt):""},resolver:(0,b.S)(ei)}),eh=ey.control,eg=ey.errors,ej=ey.handleSubmit,ex=ey.register,eI=$("customer")||$("supplier")&&("quotationAccepted"===T.status||"quotationRejected"===T.status||"supplierQuoteSent"===T.status),eZ=(c=(0,a.Z)(s().mark(function e(n){var t,o,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.status=(null==T?void 0:T.job.status)==="quoteSent"?"supplierQuoteUpdated":"supplierQuoteComplete",n.startDate&&(n.startDate=p()(n.startDate).format()),e.next=4,eb({variables:{id:T.id,changes:n,recommend:!1}});case 4:r=(o=e.sent.data.update_SupplierQuote_by_pk).id,i=o.status,E&&E({id:r,status:i});case 7:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)}),ew=(l=(0,a.Z)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.status="supplierQuoteDraft",n.startDate&&(n.startDate=p()(n.startDate).format()),e.next=4,eb({variables:{id:T.id,changes:n,recommend:!1}});case 4:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)}),eO=(D=(0,a.Z)(s().mark(function e(){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n={}).status="supplierQuoteRefused",e.next=4,eb({variables:{id:T.id,changes:n,recommend:!1}});case 4:case"end":return e.stop()}},e)})),function(){return D.apply(this,arguments)}),eq=function(){N.close()},e_=function(){N.show({title:"Upload Risk Assessments",content:(0,z.jsx)(A.G,{entity:"Quotation",entityId:T.id})})},eS=(R=(0,a.Z)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eb({variables:{changes:{recommended:!0},id:T.id,jobId:T.jobId,recommend:!0}});case 2:case"end":return e.stop()}},e)})),function(){return R.apply(this,arguments)}),eP={control:eh,errors:eg,register:ex},eA=$(["admin","supplier"])&&!eI&&(0,z.jsx)(h.Z,{content:"Cancel",onClick:eq,type:"button",style:Y?{padding:"0 8px",marginRight:8,width:"auto"}:null}),eD=$(["admin","supplier"])&&!eI&&(0,z.jsx)(h.Z,{content:"Save",context:"secondary",onClick:ej(ew),style:Y?{padding:"0 8px",marginRight:8,marginBottom:8,width:"auto"}:null}),eR=$(["admin"])&&(0,z.jsx)(h.Z,{content:"Reject quote",context:"danger",onClick:eO,style:Y?{padding:"0 8px",marginRight:8}:null}),eT=function(){if(!eI){if($(["admin"])||$(["supplier"])&&(0,el.il)(Q,et)||$(["supplier"])&&ev)return(0,z.jsx)(h.Z,{content:"Submit quote",type:"submit",style:Y?{padding:"0 8px",marginRight:8}:null});if($(["supplier"])&&!(0,el.il)(Q,et))return(0,z.jsx)(h.Z,{content:"Request approval",onClick:function(){var e;return(0,ea.I_)({type:"quote",role:"admin"===C.accountType?"adminSupplier":C.accountType,jobId:null==T?void 0:null===(e=T.job)||void 0===e?void 0:e.id,quotationId:T.id,accountId:C.accountId,amount:et,offCanvas:N})},style:Y?{padding:"0 8px",marginRight:8}:null})}};return(0,z.jsxs)(g.Z,{handleSubmit:ej(eZ),children:[(0,z.jsx)(j.Z,{children:(0,z.jsxs)(x.Z,{md:12,children:["Status: ",(0,z.jsx)(I.Z,{content:k.text,size:"md",context:k.context}),$("admin")&&(0,z.jsx)(h.Z,{content:"Recommend This Quotation",context:"secondary",onClick:eS,size:"sm"})]})}),(0,z.jsx)(Z.Z,{}),(0,z.jsx)(er,{quotation:T,total:U,setTotal:J,supplierTotal:M,setSupplierTotal:V,customerTotal:W,setCustomerTotal:G,readOnly:eI}),(0,z.jsx)(Z.Z,{}),(0,z.jsxs)(j.Z,{children:[(0,z.jsx)(x.Z,{md:3,children:(0,z.jsx)(w.Z,{label:"Total Duration",children:(0,z.jsx)(O.Z,em(em({},eP),{},{name:"totalDuration",type:"number",readOnly:eI}))})}),(0,z.jsx)(x.Z,{md:3,children:(0,z.jsx)(w.Z,{label:"Total Duration Unit",children:(0,z.jsx)(q.Z,em(em({},eP),{},{name:"totalDurationUnit",options:[{text:"Hour",value:"hour",disabled:!1},{text:"Day",value:"day",disabled:!1},{text:"Week",value:"week",disabled:!1}],readOnly:eI}))})}),(0,z.jsxs)(x.Z,{md:3,children:[(0,z.jsx)(w.Z,{label:"Available Start date"}),(0,z.jsx)(P.M,em(em({},eP),{},{name:"startDate",readOnly:eI}))]})]}),(0,z.jsx)(j.Z,{children:(0,z.jsx)(x.Z,{md:12,children:(0,z.jsx)(w.Z,{label:"Method Statement",children:(0,z.jsx)(_.Z,em(em({},eP),{},{name:"methodStatement",readOnly:eI,rows:2}))})})}),$(["admin","supplier"])&&!eI&&(0,z.jsx)(j.Z,{children:(0,z.jsxs)(x.Z,{md:12,children:[(0,z.jsx)(w.Z,{label:"Risk Assessments & Method Statements"}),(0,z.jsx)(w.Z,{label:"Where RAMS are required, please upload them here.",children:(0,z.jsx)(h.Z,{content:"Upload",context:"secondary",onClick:e_,size:"sm"})})]})}),(0,z.jsx)(j.Z,{justify:Y?"center":"end",style:{margin:"5px 0 30px 0"},children:Y?(0,z.jsxs)(j.Z,{justify:"center",children:[eT(),eR,(0,z.jsx)(h.Z,{onClick:ee,context:"secondary",children:(0,z.jsx)(ed.Z,{})}),(0,z.jsx)(ec.ZP,{open:!!K,anchorEl:K,onClose:en,sx:{zIndex:9999},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,z.jsxs)(es.Z,{flexDirection:"columnn",alignItems:"center",justifyContent:"space-evenly",p:2,children:[eD,eA]})})]}):(0,z.jsxs)(S.Z,{children:[eA,eD,eR,eT()]})}),(0,z.jsx)("div",{style:{clear:"both"}})]})},ef=t(33366),eb=t(72936),ey=t(69496);function eh(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function eg(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eh(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eh(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ej=function(e){var n=e.quotationId,t=e.onSuccess,o=(0,eb.x)(),a=o.hasRole,u=o.user,c=(0,r.a)(i.Ib,{variables:{id:n}}),s=c.data,d=(s=void 0===s?{quotation:{}}:s).quotation,l=c.loading,p=(0,r.a)(ey.nh,{variables:{id:u.id}}).data,m=(p=void 0===p?{user:{}}:p).user,v=ef.E6.find(function(e){return e.value===d.status})||{text:"-",context:"info"};return l?(0,z.jsx)(H.Z,{sx:{zIndex:1e5},open:!0,children:(0,z.jsx)(K.Z,{color:"secondary"})}):(0,z.jsx)(ev,{quotation:d,quotationId:n,user:eg(eg({},u),m),hasRole:a,onSuccess:t,status:v})}},99235:function(e,n,t){t.d(n,{EA:function(){return b},Ib:function(){return p},Ih:function(){return f},JE:function(){return m},cu:function(){return v},nc:function(){return y}});var o,r,i,a,u,c,s=t(71383),d=t(75063),l=t(69496),p=(0,d.Ps)(o||(o=(0,s.Z)(["\n  query GetQuotation($id: Int!) {\n    quotation: SupplierQuote_by_pk(id: $id) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      siteVisitAt\n      job: Job {\n        id\n        status\n        timings: JobTimings(order_by: { id: desc }) {\n          id\n          status\n          notes\n          meta\n          userId\n          quoteId\n          createdAt\n        }\n      }\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n    }\n  }\n"]))),m=(0,d.Ps)(r||(r=(0,s.Z)(['\n  query GetQuotations($accountId: Int, $status: [String!], $q: String, $limit: Int, $offset: Int) {\n    quotations: SupplierQuote(\n      limit: $limit\n      offset: $offset\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n      order_by: { quoteNumber: desc }\n    ) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      type\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      labourTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Labour" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      materialsTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Materials" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      total: SupplierQuoteLineItems_aggregate {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      job: Job {\n        description\n        title\n        type\n        number\n        status\n        customer: Customer {\n          id\n          name\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n        location: Location {\n          addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n            id\n            status\n            address: Address {\n              id\n              name\n              addressLine1\n              postCode\n            }\n          }\n        }\n        timings: JobTimings(order_by: { createdAt: asc }) {\n          id\n          status\n          notes\n          createdAt\n          user: User {\n            ...UserFields\n          }\n        }\n      }\n    }\n    meta: SupplierQuote_aggregate(\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"])),l.Px),v=(0,d.Ps)(i||(i=(0,s.Z)(["\n  query GetQuotationLineItems($quotationId: Int!, $type: String!) {\n    lineItems: SupplierQuoteLineItem(\n      where: { quoteId: { _eq: $quotationId }, type: { _eq: $type } }\n    ) {\n      id\n      description\n      item\n      qty\n      qtyUnit\n      quoteId\n      supplierTotal\n      total\n      type\n      unitRate\n    }\n  }\n"]))),f=(0,d.Ps)(a||(a=(0,s.Z)(["\n  mutation InsertSupplierQuoteLineItem($objects: [SupplierQuoteLineItem_insert_input!]!) {\n    insert_SupplierQuoteLineItem(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),b=(0,d.Ps)(u||(u=(0,s.Z)(["\n  mutation UpdateSupplierQuoteLineItem($id: Int!, $changes: SupplierQuoteLineItem_set_input) {\n    update_SupplierQuoteLineItem_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),y=(0,d.Ps)(c||(c=(0,s.Z)(["\n  mutation DeleteSupplierQuoteLineItem($id: Int!) {\n    delete_SupplierQuoteLineItem_by_pk(id: $id) {\n      id\n    }\n  }\n"])))},51040:function(e,n,t){t.d(n,{Dg:function(){return l},HI:function(){return d},j6:function(){return s}});var o,r,i,a,u=t(71383),c=t(75063),s=(0,c.Ps)(o||(o=(0,u.Z)(["\n  mutation AddQuotation($objects: [SupplierQuote_insert_input!]!) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),d=(0,c.Ps)(r||(r=(0,u.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $recommend: Boolean!\n    $jobId: Int\n  ) {\n    update_SupplierQuote(where: { jobId: { _eq: $jobId } }, _set: { recommended: false })\n      @include(if: $recommend) {\n      returning {\n        id\n      }\n    }\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]))),l=(0,c.Ps)(i||(i=(0,u.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $supplierOffer: [SupplierOffer_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_SupplierOffer(objects: $supplierOffer) {\n      returning {\n        id\n      }\n    }\n  }\n"])));(0,c.Ps)(a||(a=(0,u.Z)(['\n  mutation UpdateQuotation($jobId: Int, $changes: SupplierQuote_set_input) {\n    update_SupplierQuote(\n      where: {\n        jobId: { _eq: $jobId }\n        status: { _neq: "quotationAccepted" }\n        type: { _eq: "quote" }\n      }\n      _set: $changes\n    ) {\n      returning {\n        id\n        jobId\n        status\n      }\n    }\n  }\n'])))},33234:function(e,n,t){t.d(n,{_Z:function(){return m}});var o,r,i,a=t(71383),u=t(50029),c=t(64687),s=t.n(c),d=t(75063),l=t(60036),p=t(94568),m=(i=(0,u.Z)(s().mark(function e(n){var t,o,r,i,a,u,c,d;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.client,o=n.jobId,r=n.type,i=n.getUrl,a=n.preview,u="",e.t0=r,e.next="supplier"===e.t0?5:"customerVat"===e.t0?7:9;break;case 5:return u=f,e.abrupt("break",10);case 7:return u=v,e.abrupt("break",10);case 9:return e.abrupt("return");case 10:return(0,p.a)()||i||(c=window.open("/download","_blank")),d="",e.next=14,t.mutate({mutation:u,variables:{jobId:o,preview:a}}).then(function(e){var n,t,o,r,a,u=e.data.invoice.key;i?d="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(u):(null===(n=c)||void 0===n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(u)),null!==(o=window)&&void 0!==o&&null!==(r=o.Capacitor)&&void 0!==r&&null!==(a=r.Plugins)&&void 0!==a&&a.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(u)}))}).catch(function(e){(0,l.Tb)({message:e,section:"fetch"})});case 14:return e.abrupt("return",d);case 15:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),v=(0,d.Ps)(o||(o=(0,a.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]))),f=(0,d.Ps)(r||(r=(0,a.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"])))},19149:function(e,n,t){t.d(n,{u:function(){return p}});var o=t(59499),r=t(50029),i=t(64687),a=t.n(i),u=t(60036),c=t(94568);function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var l,p=(l=(0,r.Z)(a().mark(function e(n){var t,o,r,i,s,l,p,m,v,f,b,y,h,g,j,x;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h=n.meta,g=n.invoice,j=d(d({},h),{},{title:"Proforma Invoice",amountPaid:null==g?void 0:null===(t=g.amountPaid)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(i=r.sum)||void 0===i?void 0:i.amount,amountDeducted:null==g?void 0:null===(s=g.amountDeducted)||void 0===s?void 0:null===(l=s.reconciliations)||void 0===l?void 0:null===(p=l.aggregate)||void 0===p?void 0:null===(m=p.sum)||void 0===m?void 0:m.amount,reconciledAmount:null==g?void 0:null===(v=g.reconciledAmount)||void 0===v?void 0:null===(f=v.reconciliations)||void 0===f?void 0:null===(b=f.aggregate)||void 0===b?void 0:null===(y=b.sum)||void 0===y?void 0:y.amount}),(0,c.a)()||(x=window.open("/download","_blank")),e.next=5,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(j)}).then(function(e){return e.json()}).then(function(e){var n,t,o,r,i;null===(n=x)||void 0===n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),null!==(o=window)&&void 0!==o&&null!==(r=o.Capacitor)&&void 0!==r&&null!==(i=r.Plugins)&&void 0!==i&&i.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,u.Tb)({message:e,section:"fetch"})});case 5:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},52696:function(e,n,t){t.d(n,{i$:function(){return T},Ii:function(){return k},I_:function(){return C}});var o=t(50029),r=t(64687),i=t.n(r),a=t(16835),u=t(67294),c=t(42283),s=t(79665),d=t(50319),l=t(73987),p=t(76600),m=t(49501),v=t(6710),f=t(38512),b=t(74231),y=t(92034),h=t(27812),g=t(33366),j=function(e,n){var t=(0,h.Z)(null==e?void 0:e.timings).sort(function(e,n){return n.id-e.id});return Array.isArray(n)?t.find(function(e){var t=e.status;return g.iz.find(function(e){return e.value===t&&!n.includes(t)})}):t.find(function(e){var t=e.status;return g.iz.find(function(e){return e.value===t&&t!==n})})},x=t(85893),I=function(e){var n,t,r=e.type,h=e.status,g=e.role,I=e.job,Z=e.quoteId,w=e.toggleShow,O=e.refetch,q=(0,u.useContext)(l.Z).user,_=(0,d.D)(f.qD,{onCompleted:function(e){}}),S=(0,a.Z)(_,1)[0],P=(0,d.D)(f.r2,{onCompleted:function(e){}}),A=(0,a.Z)(P,1)[0],D=(0,d.D)(f.k7,{onCompleted:function(e){}}),R=(0,a.Z)(D,1)[0],T=(0,c.cI)({defaultValues:{comments:""},resolver:(0,s.S)((n="QuoteThresholdRejected"===h||"ThresholdRejected"===h,(0,b.Ry)().shape({comments:n&&(0,b.Z_)().required()})))}),k=T.errors,C=T.handleSubmit,$=T.register,E=(t=(0,o.Z)(i().mark(function e(n){var t,o,a,u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a={id:I.id,status:"quote"===r?"QuoteThresholdApproved"===h?"".concat(g,"QuoteThresholdRejected"):"".concat(g,"QuoteThresholdApproved"):"ThresholdApproved"===h?"".concat(g,"ThresholdRejected"):"".concat(g,"ThresholdApproved"),userId:q.id,quoteId:"quote"===r?Z:void 0},R({variables:a}),u={notes:n.comments,status:"".concat(g).concat(h),jobId:I.id,userId:q.id,quoteId:Z},A({variables:{objects:[u]}}),S({variables:{id:I.id,changes:{status:"quote"===r?null===(t=j(I))||void 0===t?void 0:t.status:null===(o=(0,y.e)(I))||void 0===o?void 0:o.status}}}),w&&w(),O&&O();case 7:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,x.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:C(E),children:(0,x.jsx)(m.Z,{label:"Comments",children:(0,x.jsx)(v.Z,{errors:k,name:"comments",register:$,rows:3})})})},Z=t(59499),w=t(71772),O=t(72936),q=t(51040),_=(0,b.Ry)().shape({manager:(0,b.Ry)().shape({value:(0,b.Rx)().integer().required(),label:(0,b.Z_)()}).required()});function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach(function(n){(0,Z.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var A,D,R=function(e){var n,t=e.role,r=e.type,u=e.quotations,l=e.jobId,m=e.quotationId,v=e.accountId,b=e.amount,y=e.toggleShow,h=(0,O.x)().user,g=(0,d.D)(f.r2,{onCompleted:function(e){}}),j=(0,a.Z)(g,1)[0],I=(0,d.D)(f.qD,{onCompleted:function(e){}}),Z=(0,a.Z)(I,1)[0],S=(0,d.D)(q.HI),A=(0,a.Z)(S,1)[0],D=(0,c.cI)({resolver:(0,s.S)(_),defaultValues:{manager:[]}}),R=D.errors,T=D.handleSubmit,k=D.register,C=D.control,$=(n=(0,o.Z)(i().mark(function e(n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("issue"!==r){e.next=5;break}return e.next=3,j({variables:{objects:[{status:"".concat(t,"ThresholdApproval"),jobId:l,userId:h.id,quoteId:m,meta:{to:n.manager.value}}]}});case 3:case 8:e.next=14;break;case 5:if(!("quote"===r&&"adminCustomer"===t)){e.next=10;break}return e.next=8,Promise.all(u.map(function(){var e=(0,o.Z)(i().mark(function e(o){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:l,userId:h.id,quoteId:o.id,meta:{to:n.manager.value}}]}});case 2:return e.next=4,A({variables:{id:o.id,changes:{status:"waitingThresholdApproval"},recommend:!1}});case 4:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()));case 10:return e.next=12,j({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:l,userId:h.id,quoteId:m,meta:{to:n.manager.value}}]}});case 12:return e.next=14,A({variables:{id:m,changes:{status:"waitingThresholdApproval"},recommend:!1}});case 14:return e.next=16,Z({variables:{id:l,changes:{status:"waitingThresholdApproval"}}});case 16:y();case 17:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});return(0,x.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:T($),children:(0,x.jsx)(w.P,P(P({},{control:C,register:k,errors:R}),{},{label:"Please choose an approver from the list below.",accountId:v,userId:h.id,invoiceThreshold:"issue"===r?b:null,quoteThreshold:"quote"===r?b:null,name:"manager",type:"thresholdManagers"}))})},T=(A=(0,o.Z)(i().mark(function e(n){var t,o,r,a,u,c;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.type,o=n.role,r=n.job,a=n.quoteId,u=n.offCanvas,c=n.refetch,u.show({content:(0,x.jsx)(I,{type:t,role:o,job:r,quoteId:a,status:"quote"===t?"QuoteThresholdApproved":"ThresholdApproved",toggleShow:u.show,refetch:c}),title:"Approve threshold"});case 2:case"end":return e.stop()}},e)})),function(e){return A.apply(this,arguments)}),k=(D=(0,o.Z)(i().mark(function e(n){var t,o,r,a,u,c;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.type,o=n.role,r=n.job,a=n.quoteId,u=n.offCanvas,c=n.refetch,u.show({content:(0,x.jsx)(I,{type:t,role:o,job:r,quoteId:a,status:"quote"===t?"QuoteThresholdRejected":"ThresholdRejected",toggleShow:u.show,refetch:c}),title:"Reject threshold"});case 2:case"end":return e.stop()}},e)})),function(e){return D.apply(this,arguments)}),C=function(e){var n=e.type,t=e.role,o=e.quotations,r=e.jobId,i=e.quotationId,a=e.accountId,u=e.amount,c=e.offCanvas;c.show({content:(0,x.jsx)(R,{role:t,type:n,jobId:r,quotations:o,quotationId:i,accountId:a,amount:u,toggleShow:c.show}),title:"Threshold approval"})}},22227:function(e,n,t){t.d(n,{l:function(){return o}});var o=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t}}}]);