"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8126],{69892:function(e,t,n){n.d(t,{K:function(){return a}});var a=function(e){var t,n,a,i,u,r,o=null==e?void 0:null===(t=e.repeat)||void 0===t?void 0:t.frequency;return{isAnyTime:(null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:null===(a=n[o.toLocaleLowerCase()])||void 0===a?void 0:a.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(i=e.repeat)||void 0===i?void 0:null===(u=i[o.toLocaleLowerCase()])||void 0===u?void 0:u.excludingWeekends}}},9754:function(e,t,n){n.d(t,{p:function(){return l}});var a=n(27812),i=n(30381),u=n.n(i),r=n(81836),o=n(63831),l=function(e,t,n){var i=r.ZP.fromString(e),l=i.origOptions,d=l.freq,s=l.until,c=l.dtstart,v=u()(c),f=i.all();n&&(v.day()===o.p3.Saturday||v.day()===o.p3.Sunday)&&v.add(v.day()===o.p3.Saturday?2:1,"day");var y=1===u()(c).date(),m=v.isSame(c,"month");if(d===r.Di.MONTHLY&&t&&!y&&m){var p=s?(0,a.Z)(f):f.slice(0,-1);return p.unshift(v),p}return d===r.Di.YEARLY&&t?f.map(function(e,t){var a=u()(e);return t>0&&a.startOf("month"),n&&(a.day()===o.p3.Saturday||a.day()===o.p3.Sunday)&&a.add(a.day()===o.p3.Saturday?2:1,"day"),a}):f}},34197:function(e,t,n){n.d(t,{E:function(){return a}});var a=function(e,t){if(Array.isArray(t)){var n,a=null;return t.forEach(function(t){var n,i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});a=(null==i?void 0:i.createdAt)||a}),a}var i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==i?void 0:i.createdAt)||null}},48126:function(e,t,n){n.d(t,{BH:function(){return S},CH:function(){return T},U$:function(){return g},WJ:function(){return C},k3:function(){return x},tf:function(){return b}});var a,i=n(27812),u=n(50029),r=n(64687),o=n.n(r),l=n(81836),d=n(10928),s=n.n(d),c=n(34197),v=n(30381),f=n.n(v),y=n(63831),m=n(9754),p=n(69892),h=n(99245),g=(a=(0,u.Z)(o().mark(function e(t){var n,a,u,r,l,d,s,c,v,g,S,b,x,T,C,D,k,I,W,F,O,A,E,M,L;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g=t.addJobFunc,S=t.location,b=t.row,x=t.adminId,C=(T=(0,p.K)(null==b?void 0:b.rruleMeta)).isAnyTime,D=T.excludingWeekends,k=[],k=Array.isArray(b.dates)?b.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,m.p)(b.frequency,C,D),I=b.costCustomer,W=b.costSupplier,F=(null==S?void 0:null===(n=S.user)||void 0===n?void 0:n.id)||null,O=b.supplier.value,A=null==b?void 0:null===(a=b.rruleMeta)||void 0===a?void 0:null===(u=a.repeat)||void 0===u?void 0:u.frequency,E=null==b?void 0:null===(r=b.rruleMeta)||void 0===r?void 0:null===(l=r.repeat)||void 0===l?void 0:null===(d=l[A.toLocaleLowerCase()])||void 0===d?void 0:d.hourStart,M=null==b?void 0:null===(s=b.rruleMeta)||void 0===s?void 0:null===(c=s.repeat)||void 0===c?void 0:null===(v=c[A.toLocaleLowerCase()])||void 0===v?void 0:v.hourEnd,L=[],k.forEach(function(e){var t,n,a,u,r,o,l,d={access:S.access,adminId:x,amount:I,assetCategoryId:null===(t=b.assetCategory)||void 0===t?void 0:t.value,costCategoryId:b.costCategory.value,customerId:S.customer[0].account.id,customerUserId:F,description:b.description,jobScheduleId:b.id,locationId:S.id,sublocationId:null===(n=b.sublocation)||void 0===n?void 0:n.value,managerId:S.customer[0].account.managerId,pricing:"fixed",serviceId:b.service.value,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:W,timing:"at",timingStart:e,timingEnd:f()(e).endOf(y._f[A]),title:b.title,type:"ppm",reference:b.reference,reportPassFail:b.reportPassFail,reportPassFailTitle:b.reportPassFailTitle,requireReportRecommendations:b.requireReportRecommendations,anyTimeOption:C,hourStart:E?f()(E).format("HH:mm:ssZ"):null,hourEnd:M?f()(M).format("HH:mm:ssZ"):null,meta:{customerSignature:b.customerSignature,supplierSignature:b.supplierSignature},JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:O}]},Taxonomy:{data:[{entity:"Job",taxonomyId:b.shortDescription.value}].concat((0,i.Z)(b.tags?(0,h.O)(b.tags):[]))}};null!=b&&null!==(a=b.rruleMeta)&&void 0!==a&&null!==(u=a.repeat)&&void 0!==u&&null!==(r=u[A.toLocaleLowerCase()])&&void 0!==r&&r.excludingWeekends&&(d.timingEnd.day()===y.p3.Saturday||d.timingEnd.day()===y.p3.Sunday)&&d.timingEnd.subtract(y.Fs[d.timingEnd.day()],"day"),b.hasCompliance&&null!==(o=b.complianceSelect)&&void 0!==o&&o.value&&(d.Compliances={data:{complianceId:b.complianceSelect.value,entity:"Job",status:"active"}},d.hasCompliance=!0),b.estimatedDuration&&b.estimatedDurationUnit&&(d.estimatedDuration=b.estimatedDuration,d.estimatedDurationUnit=b.estimatedDurationUnit),(null===(l=b.assetSelected)||void 0===l?void 0:l.length)>0&&(d.Assets={data:b.assetSelected.map(function(e){return{status:"active",assetId:e.value}})}),L.push(d)}),e.t0=(null==L?void 0:L.length)>0,!e.t0){e.next=17;break}return e.next=17,g({variables:{adminId:x,objects:L}});case 17:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),S=function(e){var t=e.scheduledJobs,n={},a={};return t.forEach(function(e){if(e.jobs&&e.jobs.length>0){var t,i,u=e.jobs.find(function(e){return new Date(e.timingStart)>new Date});((null==u?void 0:u.timingStart)<(null===(t=n)||void 0===t?void 0:t.timingStart)||!(null!==(i=n)&&void 0!==i&&i.timingStart))&&(n=u)}var r=l.Ci.fromString(e.frequency).all(),o=s()(r);(!a.date||o<(null==a?void 0:a.date))&&(a.date=o,a.name=e.meta.serviceName)}),{nextExpire:a,nextJob:n}},b=function(e){var t=e.frequency,n=e.cost;return l.Ci.fromString(t).all().length*n},x=function(e){var t,n=e.jobScheduleId,a=e.jobs;return a&&(t=a.filter(function(e){return e.jobScheduleId===n&&(0,c.E)(e,["reportSent","closed"])}).length),t||0},T=function(e,t){var n=f()(e.timingStart);return n.isSameOrAfter(t.startDate)&&n.isSameOrBefore(t.endDate)},C=function(e){var t=e.assetSelected,n=void 0===t?[]:t,a=e.compliance,i=e.service,u=void 0===i?[]:i,r=e.assetCategory,o=e.dateFilter,l={status:{_neq:"canceled"}};return null!=o&&o.startDate&&null!=o&&o.endDate&&(l.timingStart={_gte:o.startDate,_lte:o.endDate}),(null==n?void 0:n.length)>0&&(l.Assets={id:{_in:n.map(function(e){return e.value})}}),(null==u?void 0:u.length)>0&&(l.Service={id:{_in:u.map(function(e){return null==e?void 0:e.value})}}),null!=r&&r.value&&(l.AssetCategory={id:{_eq:null==r?void 0:r.value}}),"true"===a&&(l.hasCompliance={_eq:!0}),l}},99245:function(e,t,n){n.d(t,{O:function(){return a}});var a=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})}},63831:function(e,t,n){n.d(t,{$9:function(){return s},$i:function(){return y},CM:function(){return i},Fs:function(){return h},Ib:function(){return a},MF:function(){return u},_f:function(){return o},c7:function(){return v},e6:function(){return d},jT:function(){return l},p3:function(){return p},pH:function(){return c},qG:function(){return f},ut:function(){return m},y7:function(){return r}});var a=[{id:"anyTimeOption",label:"any time",value:"anyTimeOption"}],i=[{id:"anyTimeOption",label:"any time (during month)",value:"anyTimeOption"}],u=[{id:"excludingWeekends",label:"excluding weekends",value:!0}],r=[{text:"Yearly",value:"Yearly"},{text:"Monthly",value:"Monthly"},{text:"Weekly",value:"Weekly"},{text:"Daily",value:"Daily"},{text:"Hourly",value:"Hourly"}],o={Yearly:"month",Monthly:"month",Weekly:"isoWeek",Daily:"day"},l=[{id:"on",label:"on",value:"on"}],d=[{id:"onThe",label:"on the",value:"on the"}],s=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],c=[{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Day",value:"Day"},{text:"Weekday",value:"Weekday"},{text:"Weekend day",value:"Weekend day"}],v=[{id:"on",label:"on day",value:"on"}],f=[{id:"onThe",label:"on the",value:"on the"}],y=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],m=[{text:"After",value:"After"},{text:"On date",value:"On date"}],p={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},h={0:2,6:1}}}]);