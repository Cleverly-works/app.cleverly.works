"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9229],{6911:function(e,t,n){n.d(t,{q:function(){return f}});var r=n(59499),i=n(4730),o=n(23776),a=n(87918),c=n(50135),s=n(98456),u=n(67294),l=n(85893),d=["loading","setSearch","textFieldProps"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=function(e){var t=e.loading,n=e.setSearch,r=e.textFieldProps,p=(0,i.Z)(e,d),f=(0,u.useState)(""),y=f[0],v=f[1];return(0,u.useEffect)(function(){var e=setTimeout(function(){n(y)},500);return function(){return clearTimeout(e)}},[y,n]),(0,l.jsx)(o.Z,m(m({},p),{},{loading:t,onInputChange:function(e,t){v(t)},getOptionLabel:function(e){return e.label},renderTags:function(e,t){return e.map(function(e,n){return(0,l.jsx)(a.Z,m({size:"small",label:e.label},t({index:n})))})},renderInput:function(e){return(0,l.jsx)(c.Z,m(m(m({},e),r),{},{InputProps:m(m(m({},e.InputProps),r.InputProps||{}),{},{endAdornment:(0,l.jsxs)(l.Fragment,{children:[t?(0,l.jsx)(s.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};f.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}}},92264:function(e,t,n){n.d(t,{H:function(){return u}});var r=n(59499),i=n(55377),o=n(16551),a=n(77439),c=n(85893);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var u=function(e){var t=e.children,n=e.content,u=e.context,l=e.data,d=e.disabled,p=e.handleClick,m=e.size,f=e.type;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.Z,{size:"sm"}),(0,c.jsxs)(o.Z,{align:"flex-end",children:[t,(0,c.jsx)(a.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({content:n,context:u,disabled:d,onClick:p,size:m,type:f},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},52220:function(e,t,n){n.d(t,{M:function(){return d}});var r=n(59499),i=n(4730),o=n(89345),a=n(99505),c=n(55843),s=n(85893),u=["control","errors","name","space"];function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var d=function(e){var t=e.control,n=e.errors,d=e.name,p=e.space,m=(0,i.Z)(e,u);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({control:t,errors:n,locale:o.Z,name:d},m)),p&&(0,s.jsx)(c.Z,{marginBottom:"sm"})]})};d.defaultProps={space:!0}},86901:function(e,t,n){n.d(t,{S:function(){return o}});var r=n(40826),i=n(85893),o=function(e,t){var n=function(){return(0,i.jsx)(r.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},o=function(){return(0,i.jsx)(r.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},a=function(){return(0,i.jsx)(r.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?null!=t&&t.thumbnails&&null!=t&&t.thumbnails.length?n:o:a}},12603:function(e,t,n){n.d(t,{O:function(){return s},t:function(){return c}});var r,i,o=n(71383),a=n(75063),c=(0,a.Ps)(r||(r=(0,o.Z)(["\n  query MEDIAS(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $type: String\n    $adminId: Int\n    $meta: jsonb\n  ) {\n    items: Media_Entity(\n      limit: $limit\n      offset: $offset\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n      order_by: { Medium: { createdAt: desc } }\n    ) {\n      id\n      entity\n      entityId\n      mediaId\n      item: Medium {\n        id\n        visibility\n        caption\n        category\n        createdAt\n        expiryAt\n        filename\n        name\n        type\n        meta\n        userId\n        user: User {\n          id\n          nameFirst\n          nameLast\n        }\n      }\n    }\n    meta: Media_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),s=(0,a.Ps)(i||(i=(0,o.Z)(["\n  query GetPreloadedMediaByEntity(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $adminId: Int\n  ) {\n    items: Media_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: { adminId: { _eq: $adminId }, category: { _eq: $category } }\n      }\n    ) {\n      mediaId\n      media: Medium {\n        id\n        filename\n        caption\n      }\n    }\n  }\n"])))},99229:function(e,t,n){n.d(t,{G:function(){return M}});var r=n(59499),i=n(67294),o=n(6812),a=n(12603),c=n(10367),s=n(78289),u=n(41564),l=n(34953),d=n(62466),p=n(68956),m=n(73373),f=n(58965),y=n(18678),v=n(55377),b=n(16551),h=n(77439),g=n(74297),j=n(4788),O=n(94784),x=n(85011),w=n(86901),P=n(67872),I=n(42846),S=n(72936),Z=n(85893);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var M=function(e){var t=e.carousel,n=e.category,r=e.children,c=e.data,A=(e.details,e.entity),M=e.entityId,C=e.filters,E=(e.limit,e.listView),z=e.mediaMeta,$=e.onMediaAdd,N=e.onMediaRemove,q=(e.pagination,e.showActionButtons),L=e.showEntityColumn,R=e.showItemActions,F=e.summary,U=e.type,T=(0,I.x)({filters:C}),V=T.initialData,B=T.ref,Q=(0,S.x)(),H=Q.hasRole,Y=Q.user,G=(0,i.useContext)(s.Z),J=(0,o.a)(a.t,{variables:D(D({},V),{},{entity:A,entityId:M,category:n,adminId:Y.adminId,meta:z})}),W=J.data,K=(W=void 0===W?{items:[],meta:{aggregate:{totalCount:0}}}:W).items,X=W.meta,ee=J.loading,et=J.refetch,en=function(e){G.close(),c.length||et(),$&&$(e)},er=function(e){G.close(),c.length||et(),N&&N(e)},ei=function(e){e.stopPropagation(),G.show({content:(0,Z.jsx)(x.z,{accept:"image/*",adminId:Y.adminId,category:n,entity:A,entityId:M,expiryShow:!1,mediaMeta:z,multiple:!0,onSuccess:en,type:"image"}),title:"Upload Photos"})},eo=function(e){e.stopPropagation(),G.show({content:(0,Z.jsx)(x.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:Y.adminId,category:n,entity:A,entityId:M,expiryShow:!1,mediaMeta:z,onSuccess:en,type:"document"}),title:"Upload Documents"})},ea=function(e){G.show({content:(0,Z.jsx)(j.d,{mediaId:e.data.id,onSuccess:er}),submit:!1,title:"Delete Media"})},ec=function(e){G.show({content:(0,Z.jsx)(O.z,{media:e.data,toggleShow:G.close}),submit:!1,title:"Media Details",width:"50%"})},es=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,t){return ec(t)},tooltip:"Details"}];H("admin")&&es.push({context:"danger",icon:["fas","trash"],onClick:function(e,t){return ea(t)},tooltip:"Delete"});var eu=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!L,text:"Entity"},{formatter:function(e){var t,n=e.row;return(0,Z.jsx)(_,{children:(null==n?void 0:null===(t=n.authority)||void 0===t?void 0:t.adminOnly)&&(0,Z.jsx)(u.Z,{content:"Admin user only",children:(0,Z.jsx)(l.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,d.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!E,text:"Thumbnails"},{hidden:!R,formatter:p.Z,formatterData:es,text:"Actions"}],el=function(e,t){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t))},ed=[],ep=K.map(function(e){var t=e.entity,n=e.entityId,r=e.id,i=e.item,o=i.caption,a=i.filename,c=i.meta,s=i.name,u=i.type,l=i.user;return{data:i,id:r,userId:null==l?void 0:l.id,file:function(){return(0,Z.jsx)(m.Z,{onClick:function(e){return el(e,a)},children:o||s||a})},entity:t&&"".concat(t,"#").concat(n),authority:c,uploaded:"".concat(null==l?void 0:l.nameFirst," ").concat(null==l?void 0:l.nameLast),thumbnails:(0,w.S)(u,c),actions:""}}),em=(K.forEach(function(e){var t=e.item,n=t.caption,r=t.filename;"image"===t.type&&ed.push({caption:n,filename:r})}),ed),ef=em.length;return(0,Z.jsxs)(f.Z,{fitParentHeight:!0,open:!0,title:F,children:[r,t&&ef>0&&(0,Z.jsx)(k,{children:(0,Z.jsx)(y.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:em.map(function(e){var t=e.caption,n=e.filename;return{node:(0,Z.jsx)(l.Z,{alt:t,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n)}),text:" "}})})}),(0,Z.jsx)(P.t,{columns:eu,loading:ee,fullHeight:!0,paginationSize:!1,meta:X,ref:B,refetch:et,rows:ep}),q&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(v.Z,{size:"sm"}),(0,Z.jsxs)(b.Z,{align:"flex-end",children:[(!U||"document"===U)&&!H("supplier")&&(0,Z.jsx)(h.Z,{content:"Add Document",context:"secondary",onClick:eo,size:"sm"}),(!U||"image"===U||"avatar"===U)&&!H("supplier")&&(0,Z.jsx)(h.Z,{content:"Add ".concat((0,g.Z)(U||"Image")),context:"secondary",onClick:ei,size:"sm"})]})]})]})},_=c.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-evooes-0"})(["width:24px;"]),k=c.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-evooes-1"})(["border:1px solid #eee;"]);M.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},4788:function(e,t,n){n.d(t,{d:function(){return p}});var r=n(16835),i=n(50319),o=n(75847),a=n(84808),c=n(98456),s=n(15861),u=n(26447),l=n(11057),d=n(85893),p=function(e){var t=e.mediaId,n=e.onSuccess,p=(0,i.D)(o.CI,{variables:{id:t},refetchQueries:["MEDIAS"],onCompleted:function(){return n(t)}}),m=(0,r.Z)(p,2),f=m[0],y=m[1].loading;return y?(0,d.jsx)(a.Z,{sx:{zIndex:1e5},open:!0,children:(0,d.jsx)(c.Z,{color:"secondary"})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.Z,{children:"Are you sure you want to delete this?"}),(0,d.jsx)(u.Z,{alignItems:"flex-end",children:(0,d.jsx)(l.Z,{variant:"contained",color:"danger",disabled:y,onClick:function(){return f()},children:"Delete"})})]})}},94784:function(e,t,n){n.d(t,{z:function(){return A}});var r=n(59499),i=n(50029),o=n(16835),a=n(64687),c=n.n(a),s=n(67294),u=n(50319),l=n(75847),d=n(84808),p=n(98456),m=n(26186),f=n(76600),y=n(34953),v=n(16540),b=n(55843),h=n(86901),g=n(47159),j=n(39496),O=n(60036),x=n(72936),w=n(42283),P=n(6911),I=n(85893);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var A=function(e){var t,n=e.media,r=e.toggleShow,a=(0,s.useState)(!1),S=a[0],A=a[1],D=(0,x.x)().hasRole,M=n.caption,_=n.createdAt,k=n.entity,C=n.entityId,E=n.filename,z=n.mediaId,$=n.meta,N=n.name,q=n.id,L=n.visibility,R=n.type,F=n.user,U=(0,w.cI)({defaultValues:{visibility:(0,j.c)(L)}}),T=U.control,V=U.handleSubmit,B=(0,u.D)(l.o7,{refetchQueries:["MEDIAS"],onCompleted:function(e){A(!1),e&&r&&r()}}),Q=(0,o.Z)(B,2),H=Q[0];Q[1].error;var Y,G=(t=(0,i.Z)(c().mark(function e(t){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:H({variables:{changes:{visibility:t.visibility.value},id:q}}).then(function(){return r()});case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),J=[{key:"ID",value:z,hidden:!0},{key:"Name",value:N||E},{key:"Visible to",value:L.join(", ")},{key:"Caption",value:M},{key:"Entity",value:k?"".concat(k,"#").concat(C):"-",hidden:!0},{key:"Type",value:R},{key:"Uploaded by",value:"".concat(null==F?void 0:F.nameFirst," ").concat(null==F?void 0:F.nameLast)},{key:"Created at",value:(0,m.Z)(_)}];"image"===R&&J.push({key:"Thumbnails",value:(0,h.S)(R,$),hidden:!0}),(0,i.Z)(c().mark(function e(){var t,n,r,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),n="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null!=$&&null!==(t=$.original)&&void 0!==t&&t.relativePath?$.original.relativePath:E),r=(0,g.V)(),(i=new window.FormData).append("sizes",r),i.append("url",n),e.next=8,window.fetch("https://aws.cleverly.works/image/process",{method:"POST",body:i}).then(function(e){return e.json()}).then(function(e){var t,n=null,r=Z({},$)||{},i=e.key,o=e.data.find(function(e){return"large"===e.name});i.startsWith("https://cleverly-media.s3.eu-west-2.amazonaws.com")&&(i=i.replace("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/"),"")),n=o?o.relativePath:i,r.original={relativePath:i},r.thumbnails=e.data||null;var a={extension:null===(t=n)||void 0===t?void 0:t.split(".").pop(),filename:n,meta:r};H({variables:{changes:a,id:z}})}).catch(function(e){(0,O.Tb)({message:e,section:"fetch"})});case 8:case"end":return e.stop()}},e)})),null!=$&&$.thumbnails;var W=(0,j.z)(D).options;return S?(0,I.jsx)(d.Z,{sx:{zIndex:1e5},open:!0,children:(0,I.jsx)(p.Z,{color:"secondary"})}):(0,I.jsxs)(f.Z,{id:"offCanvasForm",handleSubmit:V(G),children:["image"===R&&(0,I.jsx)(y.Z,{alt:M||E,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(E)}),(0,I.jsx)(v.Z,{rows:J}),(0,I.jsx)(w.Qr,{name:"visibility",control:T,render:function(e){var t=e.value,n=e.onChange;return(0,I.jsx)(P.q,{value:t,disableClearable:!0,textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,t){return n(t)},options:W})}}),!1,(0,I.jsx)(b.Z,{}),!1]})};A.defaultProps={type:"image"}},85011:function(e,t,n){n.d(t,{z:function(){return z}});var r=n(59499),i=n(50029),o=n(16835),a=n(64687),c=n.n(a),s=n(67294),u=n(42283),l=n(79665),d=n(30381),p=n.n(d),m=n(50319),f=n(75847),y=n(73987),v=n(76600),b=n(49501),h=n(55563),g=n(13439),j=n(51466),O=n(92264),x=n(52220),w=n(49088),P=n(74231),I=(0,P.Ry)().shape({caption:(0,P.Z_)(),dropzone:(0,P.nK)().required()}),S=n(72936),Z=n(6911),A=n(60036),D=n(84808),M=n(98456),_=n(39496),k=n(85893);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z=function(e){var t,n=e.accept,r=e.adminId,a=e.category,d=e.entity,P=e.entityId,C=e.expiryShow,z=e.mediaMeta,$=e.multiple,N=e.onSuccess,q=e.type,L=e.showSubmitButton,R=(0,s.useState)(!1),F=R[0],U=R[1],T=(0,s.useState)(!1),V=T[0],B=T[1],Q=(0,S.x)().hasRole,H=(0,_.z)(Q),Y=H.defaultOption,G=H.options,J=(0,u.cI)({resolver:(0,l.S)(I),defaultValues:{visibility:Y}}),W=J.control,K=J.errors,X=J.handleSubmit,ee=J.register,et=J.reset,en=(0,s.useContext)(y.Z).user,er=(0,m.D)(f.xM,{refetchQueries:["MEDIAS"]}),ei=(0,o.Z)(er,2),eo=ei[0],ea=ei[1].loading,ec=(0,m.D)(f.tv,{refetchQueries:["MEDIAS"]}),es=(0,o.Z)(ec,2),eu=es[0],el=es[1].loading,ed=(t=(0,i.Z)(c().mark(function e(t){var n,o,s,u,l;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.caption,o=t.visibility,s=t.dropzone,u=t.expiryAt,e.prev=1,U(!0),B(!1),e.t0=Promise,e.next=7,s.map(function(){var e=(0,i.Z)(c().mark(function e(t){var i,s,l,d,m,f,y;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return e.next=3,(0,w.V)(t,q);case 3:return s=e.sent,l=null,d=null,"image"===q?(m=s.key,l=(f=s.data.find(function(e){return"large"===e.name}))?f.relativePath:m,d={original:{relativePath:m},thumbnails:s.data||null}):l=s.key,y={adminId:r,category:a,caption:n,expiryAt:u?p()(u).utc().format():null,extension:null===(i=l)||void 0===i?void 0:i.split(".").pop(),userId:en.id,filename:l,meta:E(E({},d),z),type:q,visibility:o.value},e.abrupt("return",y);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:return e.t1=e.sent,e.next=10,e.t0.all.call(e.t0,e.t1);case 10:eo({variables:{objects:e.sent}}).then(function(){var e=(0,i.Z)(c().mark(function e(t){var n,r,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data.insert_Media.returning,!(d&&P)){e.next=6;break}return i=r.map(function(e){return{mediaId:e.id,entity:d,entityId:P}}),e.next=6,eu({variables:{objects:i}});case 6:et(),U(!1),N&&N(r);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=19;break;case 14:e.prev=14,e.t2=e.catch(1),U(!1),B(!0),(0,A.Tb)({message:e.t2,section:"upload"});case 19:case"end":return e.stop()}},e,null,[[1,14]])})),function(e){return t.apply(this,arguments)}),ep={control:W,errors:K,register:ee};return F||ea||el?(0,k.jsx)(D.Z,{sx:{zIndex:1e5},open:!0,children:(0,k.jsx)(M.Z,{color:"secondary"})}):(0,k.jsxs)(v.Z,{id:"offCanvasForm",handleSubmit:X(ed),children:[(0,k.jsx)(b.Z,{label:"Caption",children:(0,k.jsx)(h.Z,E(E({},ep),{},{name:"caption"}))}),C&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(b.Z,{label:"Expiry"}),(0,k.jsx)(x.M,E(E({},ep),{},{name:"expiryAt"}))]}),(0,k.jsx)(b.Z,{label:"Media"}),(0,k.jsx)(u.Qr,E(E({},ep),{},{as:(0,k.jsx)(g.Z,{accept:"image/*"===n?n+", .heic":n,multiple:$}),name:"dropzone"})),(0,k.jsx)(u.Qr,{name:"visibility",control:W,render:function(e){var t=e.value,n=e.onChange;return(0,k.jsx)(Z.q,{value:t,disableClearable:!0,getOptionLabel:function(e){return e.label},textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,t){return n(t)},options:G})}}),V&&(0,k.jsx)(j.Z,{context:"danger",content:"Can not upload Media"}),L&&(0,k.jsx)(O.H,{content:"Submit",type:"submit"})]})};z.defaultProps={accept:g.Z.defaultProps.accept,category:null,expiryShow:!0,mediaMeta:null,showSubmitButton:!1,showAdminOnly:!0,type:"image"}},75847:function(e,t,n){n.d(t,{CI:function(){return d},o7:function(){return p},tv:function(){return l},xM:function(){return u}});var r,i,o,a,c=n(71383),s=n(75063),u=(0,s.Ps)(r||(r=(0,c.Z)(["\n  mutation AddMedia($objects: [Media_insert_input!]!) {\n    insert_Media(objects: $objects) {\n      returning {\n        id\n        filename\n      }\n    }\n  }\n"]))),l=(0,s.Ps)(i||(i=(0,c.Z)(["\n  mutation AddMediaEntity($objects: [Media_Entity_insert_input!]!) {\n    insert_Media_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),d=(0,s.Ps)(o||(o=(0,c.Z)(["\n  mutation DeleteMedia($id: Int!) {\n    delete_Media_by_pk(id: $id) {\n      id\n    }\n  }\n"]))),p=(0,s.Ps)(a||(a=(0,c.Z)(["\n  mutation UpdateMedia($changes: Media_set_input, $id: Int!) {\n    update_Media_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},47159:function(e,t,n){n.d(t,{V:function(){return r}});var r=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])}},49088:function(e,t,n){n.d(t,{V:function(){return s}});var r,i=n(50029),o=n(64687),a=n.n(o),c=n(47159),s=(r=(0,i.Z)(a().mark(function e(t,n){var r,i,o,s,u;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r="cleverly-media",i="https://aws.cleverly.works/aws/s3/upload",(o=new window.FormData).append("file",t,t.name),e.t0=n,e.next="image"===e.t0?7:"document"===e.t0?10:"audio"===e.t0?14:18;break;case 7:return s="https://aws.cleverly.works/image/process",o.append("sizes",(0,c.V)()),e.abrupt("break",19);case 10:case 14:return o.append("bucket",r),o.append("folder","".concat(n,"s")),s=i,e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:return e.next=21,window.fetch(s,{method:"POST",body:o});case 21:return u=e.sent,e.abrupt("return",u.json());case 23:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})},67872:function(e,t,n){n.d(t,{t:function(){return s}});var r=n(67294),i=n(11163),o=n(87043),a=n(16540),c=n(85893),s=(0,r.forwardRef)(function(e,t){var n=e.columns,s=e.history,u=e.initialSort,l=e.loading,d=e.meta,p=e.paginationSize,m=e.refetch,f=e.rowClick,y=e.rows,v=e.xeroPageSize,b=(0,i.useRouter)(),h=b.query,g=void 0===h?{}:h,j=(0,r.useState)(parseInt(null==g?void 0:g.page,10)||1),O=j[0],x=j[1],w=(0,r.useState)(v||o.C1.paginationSize),P=w[0],I=w[1];u||(u={item:"createdAt",order:"desc"});var S=(0,r.useState)({item:u.item,order:u.order}),Z=S[0],A=S[1],D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=b.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},M=function(){A({item:u.item,order:u.order}),x(1);var e=D();b.push(e),I(v||o.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:O,pageSize:P,sort:Z,resetPagination:function(){M()}}});var _=function(e){var t=D(e);s&&b.push(t),x(e),!s&&m&&m()},k=function(e){e!==o.C1.paginationSize&&(I(e),m&&m())},C=function(e){var t;A({item:e.item,order:e.order}),m&&m()};return(0,c.jsx)(a.Z,{columns:n,loading:l,paginationSize:p,pagination:d&&!0,paginationProps:d&&{currentPage:O,onPageChange:_,onPageSizeChange:k,pageCount:Math.ceil(d.aggregate.totalCount/P),perPage:P},rowClick:f,rows:y,sort:Z,setSort:C})});s.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,n){n.d(t,{x:function(){return l}});var r=n(59499),i=n(67294),o=n(96486),a=n(87043),c=function(e){try{return JSON.parse(e)}catch(t){return!1}};function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l=function(e){var t,n,s,l,d,p,m,f,y,v,b,h=e.filters,g=e.newFilters,j=e.initialSort,O=(0,i.useRef)(),x=(0,i.useState)({}),w=x[0],P=x[1],I=(0,i.useState)({}),S=I[0],Z=I[1],A=j||{item:"createdAt",order:"desc"},D=(0,r.Z)({},(null===(t=O.current)||void 0===t?void 0:t.sort.item)||A.item,A.inneritem?(0,r.Z)({},A.inneritem,(null===(n=O.current)||void 0===n?void 0:n.sort.order)||A.order):(null===(s=O.current)||void 0===s?void 0:s.sort.order)||A.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(w,h),t=!(0,o.isEqual)(S,g);if(e&&(P(h),null==O||null===(r=O.current)||void 0===r||r.resetPagination()),t&&(Z(g),null==O||null===(i=O.current)||void 0===i||i.resetPagination()),null!=O&&null!==(n=O.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,i,a,c,s,u,l,d,p,m,f=null!==(a=O.current)&&void 0!==a&&null!==(c=a.sort)&&void 0!==c&&c.item&&null!==(s=O.current)&&void 0!==s&&null!==(u=s.sort)&&void 0!==u&&u.order?{item:null===(l=O.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(p=O.current)||void 0===p?void 0:null===(m=p.sort)||void 0===m?void 0:m.order}:D;O.current.setSort(f)}},[h,g]),{initialData:u(u({},h),{},{newFilters:(null==g?void 0:g.length)>0?g:void 0,limit:(null===(l=O.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=O.current)||void 0===d?void 0:d.pageSize,10)||a.C1.paginationSize,offset:((null===(p=O.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(m=O.current)||void 0===m?void 0:m.pageSize)||a.C1.paginationSize),orderBy:c(null===(f=O.current)||void 0===f?void 0:null===(y=f.sort)||void 0===y?void 0:null===(v=y.item)||void 0===v?void 0:v.replace(/ORDER/i,null===(b=O.current)||void 0===b?void 0:b.sort.order))||D}),initialSort:j,ref:O}}},39496:function(e,t,n){n.d(t,{z:function(){return a},c:function(){return c}});var r=n(27812),i=n(96486),o={ALL:["admin","customer","supplier","tenant"],ADMIN_ONLY:["admin"],ADMIN_CUSTOMER:["admin","customer"],ADMIN_SUPPLIER:["admin","supplier"]},a=function(e){return e("admin")?{defaultOption:{label:"All",value:o.ALL},options:[{label:"All",value:o.ALL},{label:"Admin only",value:o.ADMIN_ONLY},{label:"Admin+customer",value:o.ADMIN_CUSTOMER},{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}]}:e("customer")?{defaultOption:{label:"Admin+customer",value:o.ADMIN_CUSTOMER},options:[{label:"All",value:o.ALL},{label:"Admin+customer",value:o.ADMIN_CUSTOMER}]}:e("supplier")?{defaultOption:{label:"Admin+supplier",value:o.ADMIN_SUPPLIER},options:[{label:"All",value:o.ALL},{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}]}:void 0},c=function(e){var t=(0,r.Z)(e).sort();return i.isEqual(t,o.ALL)?{label:"All",value:o.ALL}:i.isEqual(t,o.ADMIN_ONLY)?{label:"Admin only",value:o.ADMIN_ONLY}:i.isEqual(t,o.ADMIN_CUSTOMER)?{label:"Admin+customer",value:o.ADMIN_CUSTOMER}:i.isEqual(t,o.ADMIN_SUPPLIER)?{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}:void 0}}}]);