"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9404],{26143:function(e,t,n){n.d(t,{C:function(){return P}});var r=n(67294),o=n(93946),i=n(25464),a=n(18972),s=n(57976),l=n(14218),u=n(95429),c=n(91988),d=n(70983),m=n(46761),p=n(91682),y=n(39702),f=n(36804),v=n(51797),b=n(53630),g=n(50748),h=n(23132),x=n(88127),j=n(52186),S=n(59301),O=n(26447),w=n(15861),D=n(85893),I={add:(0,D.jsx)(l.Z,{}),archive:(0,D.jsx)(u.Z,{}),avatar:(0,D.jsx)(c.Z,{}),check:(0,D.jsx)(d.Z,{}),delete:(0,D.jsx)(m.Z,{}),description:(0,D.jsx)(p.Z,{}),download:(0,D.jsx)(y.Z,{}),info:(0,D.jsx)(f.Z,{}),edit:(0,D.jsx)(v.Z,{}),location:(0,D.jsx)(b.Z,{}),unarchive:(0,D.jsx)(g.Z,{}),uploadFile:(0,D.jsx)(h.Z,{}),receipt:(0,D.jsx)(x.Z,{}),visibility:(0,D.jsx)(j.Z,{})},Z={default:(0,D.jsx)(s.Z,{}),defaultHoriz:(0,D.jsx)(S.Z,{}),description:(0,D.jsx)(p.Z,{})},P=function(e){var t=e.actionsData,n=e.icon,s=e.row,l=e.disabled,u=(0,r.useState)(null),c=u[0],d=u[1],m=function(e){e.stopPropagation(),d(e.currentTarget)},p=function(){d(null)};return(0,D.jsxs)("div",{children:[(0,D.jsx)(o.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:l,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:m,children:Z[n]}),(0,D.jsx)(i.Z,{id:"simple-menu",anchorEl:c,keepMounted:!0,open:Boolean(c),onClose:p,PaperProps:{sx:{borderRadius:2}},children:t(s).map(function(e,t){return(0,D.jsx)(a.Z,{disabled:e.disabled,onClick:function(t){e.onClick(t),p()},sx:{pl:3,pr:4},children:(0,D.jsxs)(O.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==I?void 0:I[e.icon])||null,(0,D.jsx)(w.Z,{children:e.tooltip})]})},t)})})]})};P.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},34197:function(e,t,n){n.d(t,{E:function(){return r}});var r=function(e,t){if(Array.isArray(t)){var n,r=null;return t.forEach(function(t){var n,o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});r=(null==o?void 0:o.createdAt)||r}),r}var o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==o?void 0:o.createdAt)||null}},13868:function(e,t,n){n.d(t,{n:function(){return y}});var r=n(59499),o=n(58965),i=n(90951),a=n(28497),s=n(15214),l=n(9270),u=n(62140),c=n(47568),d=n(85893);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e){var t=e.errors,n=e.register,r=e.pricingWatch,m=e.hasServiceRate,y=e.isPPM,f={register:n,errors:t},v=c.Hu.filter(function(e){var t=e.value;return!y||"fixed"===t});return(0,d.jsxs)(o.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,d.jsx)(i.Z,p(p({},f),{},{data:v,legend:"Pricing",name:"pricing"})),"time-materials"===r&&(0,d.jsx)(a.Z,p(p({},f),{},{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===r&&(0,d.jsxs)(d.Fragment,{children:[m?(0,d.jsx)(s.Z,{content:"This customer has a service rate on their account. The customer amounts will be calculated using the relevant service rates.",context:"info"}):(0,d.jsx)(a.Z,p(p({},f),{},{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,d.jsxs)(l.Z,{children:[(0,d.jsx)(u.Z,{sm:12,md:6,children:(0,d.jsx)(a.Z,p(p({},f),{},{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,d.jsx)(u.Z,{sm:12,md:6,children:(0,d.jsx)(a.Z,p(p({},f),{},{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]})]})}},42985:function(e,t,n){n.d(t,{t:function(){return c}});var r=n(59499),o=n(58965),i=n(71772),a=n(27940),s=n(85893);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var c=function(e){var t=e.control,n=e.errors,r={control:t,errors:n,register:e.register};return(0,s.jsxs)(o.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,s.jsx)(a.l,u(u({},r),{},{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,s.jsx)(i.P,u(u({},r),{},{errors:u({},n),name:"serviceSelected",label:"Service",type:"service"}))]})}},59819:function(e,t,n){n.d(t,{X:function(){return I}});var r=n(59499),o=n(67294),i=n(58965),a=n(49501),s=n(95103),l=n(90951),u=n(9270),c=n(62140),d=n(58594),m=n(52220),p=n(47568),y=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],f=n(4135),v=n(43703),b=n(11640),g=n(83894),h=n(69119),x=n(67090),j=function(){var e=(0,f.Z)(new Date),t=(0,v.Z)(new Date),n=(0,f.Z)((0,b.Z)(new Date(t),2)),r=(0,g.Z)(new Date),o=(0,h.Z)(new Date),i=(0,x.Z)(new Date);return{monthEnd:e,nextThreeEnd:n,todayEnd:r,todayStart:o,weekEnd:i}},S=n(85893);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D=p.KB,I=function(e){var t=e.control,n=e.errors,r=e.hasRole,f=e.query,v=e.register,b=e.setValue,g=e.timingWatch,h=e.watch,x={control:t,errors:n,register:v},O=r("customer")&&!r("admin"),I=h("pricing"),Z=h("timingStart"),P=h("timingEnd"),T=h("multipleDays"),_=h("timeSpan"),q=h("timing");(0,o.useEffect)(function(){O&&(D=p.KB.filter(function(e){return"at"!==e.value}),b("timing","between")),_&&E({time:_,setValue:b})},[_]),(0,o.useEffect)(function(){"at"===q&&b("timeSpan","")},[q]);var E=function(e){var t,n,r=e.time,o=e.setValue,i=j(),a=i.monthEnd,s=i.todayStart,l=i.weekEnd,u=i.todayEnd,c=i.nextThreeEnd;switch(r){case"today":t=s,n=u;break;case"thisWeek":t=s,n=l;break;case"thisMonth":t=s,n=a;break;case"nextThreeMonth":t=s,n=c}o("timing","between"),o("timingStart",t),o("timingEnd",n)},C=function(e){var t=new Date,n=new Date(e);return t.getTime()<n.getTime()},k=function(e){var t=Z?new Date(Z):new Date,n=new Date(e);return t.getTime()<n.getTime()};return(0,S.jsxs)(i.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null!=f&&f.id)&&b&&(0,S.jsx)(a.Z,{label:"Select Time span",children:(0,S.jsx)(s.Z,w(w({},x),{},{name:"timeSpan",options:y}))}),(0,S.jsx)(l.Z,w(w({},x),{},{data:D,legend:"Timing",name:"timing"})),(0,S.jsxs)(u.Z,{children:[(0,S.jsxs)(c.Z,{md:12,children:[(0,S.jsx)(a.Z,{label:"Start time"}),(0,S.jsx)(m.M,w(w({},x),{},{dateFormat:"d MMM yyyy HH:mm",maxDate:P?new Date(P):null,minDate:new Date,filterTime:C,name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==g&&(0,S.jsxs)(c.Z,{md:12,children:[(0,S.jsx)(a.Z,{label:"End time"}),(0,S.jsx)(m.M,w(w({},x),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:Z?new Date(Z):new Date,filterTime:k,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),Z instanceof Date&&"fixed"===I&&(0,S.jsx)(d.Z,w(w({},x),{},{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),T&&(0,S.jsx)(a.Z,{label:"End Date",children:(0,S.jsx)(m.M,w(w({},x),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:k,minDate:Z?new Date(Z):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),r("admin")&&(0,S.jsx)(d.Z,w(w({},x),{},{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})}},40527:function(e,t,n){n.d(t,{$z:function(){return p},A5:function(){return x},G2:function(){return g},GU:function(){return h},I2:function(){return y},Pu:function(){return j},a6:function(){return b},eD:function(){return v},lV:function(){return f}});var r=n(59499),o=n(27812),i=n(30381),a=n.n(i),s=n(83704),l=n.n(s),u=n(99245);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}l()(a());var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i={};if(i.assetSelected=null,i.costCategorySelected=null,i.customerSelected=null,i.customerUserSelected=null,i.locationSelected=null,i.sublocationSelected=null,i.managerSelected=null,i.serviceSelected=null,i.siteVisitReq=!1,i.taxonomyId_ShortDesc=null,i.assetCategorySelected=null,i.access=null,i.paymentMethod="invoice",i.reportPassFail=!1,i.reportPassFailTitle="",i.requireReportRecommendations=!1,i.tags=[],e.customer&&(i.customerSelected={value:e.customer.id,label:e.customer.name}),e.location){var a,s,l,c,d,m=e.location.customerAssociations;i.locationSelected={value:e.location.id,label:e.location.name},m&&(i.customerSelected={value:null==m?void 0:null===(s=m[0])||void 0===s?void 0:null===(l=s.customer)||void 0===l?void 0:l.id,label:null==m?void 0:null===(c=m[0])||void 0===c?void 0:null===(d=c.customer)||void 0===d?void 0:d.name})}if(e.asset&&(i.assetSelected={value:e.asset.id,label:e.asset.name},i.assetCategorySelected={value:null===(p=e.asset)||void 0===p?void 0:null===(y=p.Category)||void 0===y?void 0:y.id,label:null===(f=e.asset)||void 0===f?void 0:null===(v=f.Category)||void 0===v?void 0:v.name}),t("admin")&&(i.managerSelected={value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}),null!==(a=i.tags)&&void 0!==a&&a.length&&(i.Taxonomy={data:(0,o.Z)(i.tags?(0,u.O)(i.tags):[])}),t("customer")&&(i.customerUserSelected={value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}),e.parentJob){var p,y,f,v,b,g,h,x,j,S=e.parentJob,O=S.access,w=S.answers,D=S.assetCategory,I=S.assets,Z=S.costCategoryTaxonomy,P=S.customer,T=S.customerUser,_=S.manager,q=S.siteVisitAt,E=S.service,C=S.shortJobDesc,k=S.location,$=S.sublocation;i.access=O,P&&(i.customerSelected={value:P.id,label:P.name}),T&&(i.customerUserSelected={value:T.id,label:"".concat(T.nameFirst," ").concat(T.nameLast)}),k&&(i.locationSelected={value:k.id,label:k.name}),$&&(i.sublocationSelected={value:$.id,label:$.name}),_&&(i.managerSelected={value:_.id,label:"".concat(_.nameFirst," ").concat(_.nameLast),accounts:_.accounts}),(null==I?void 0:I.length)>0&&(i.assetSelected=I.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.jobId}})),D&&(i.assetCategorySelected={value:D.id,label:D.name}),"true"===r&&(i.title="Recall: ".concat((null==S?void 0:null===(b=S.shortJobDesc[0])||void 0===b?void 0:b.taxonomy.name)||S.title),i.description=S.description,i.reference=S.reference,i.source=S.source,i.slaId=S.slaId,i.paymentMethod=S.paymentMethod,i.pricing=S.pricing,i.taxonomyId_ShortDesc={value:C[0].taxonomyId,label:null===(g=C[0])||void 0===g?void 0:null===(h=g.taxonomy)||void 0===h?void 0:h.name,meta:null===(x=C[0])||void 0===x?void 0:null===(j=x.taxonomy)||void 0===j?void 0:j.meta},E&&(i.serviceSelected={value:E.id,label:E.name}),q&&(i.siteVisitReq=!0),i.questions=w.map(function(e){var t;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(t=e.taxonomy)||void 0===t?void 0:t.name}}),Z&&(i.costCategorySelected={value:Z.id,label:Z.name}))}return i},y=function(e){var t,n,r={};return Object.keys(e).map(function(t){var n=e[t];return"number"==typeof n&&(n=n.toString()),["timingStart","timingEnd","quoteDue","quoteDueSupplier","siteVisitStart","siteVisitEnd"].includes(t)&&null!==n&&(n=new Date(n)),r[t]=n,r}),r.siteVisitReq||(r.siteVisitWeekends=!1),delete r.siteVisitReq,r.siteVisitWeekends?r.siteVisitWeekends=!0:r.siteVisitWeekends=!1,e.customer&&(r.customerSelected={value:e.customer.id,label:e.customer.name}),e.customerUser&&(r.customerUserSelected={value:e.customerUser.id,label:"".concat(e.customerUser.nameFirst," ").concat(e.customerUser.nameLast)}),e.location&&(r.locationSelected={value:e.location.id,label:e.location.name,permitsRequired:null==e?void 0:null===(n=e.location)||void 0===n?void 0:n.permitsRequired}),e.sublocation&&(r.sublocationSelected={value:e.sublocation.id,label:e.sublocation.name}),null!==(t=e.issueTypes[0])&&void 0!==t&&t.issue&&(r.issueType={label:e.issueTypes[0].issue.name,value:e.issueTypes[0].issue.id}),e.manager&&(r.managerSelected={value:e.manager.id,label:"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast),accounts:e.manager.accounts}),e.service&&(r.serviceSelected={value:e.service.id,label:e.service.name}),e.assets&&e.assets.length>0?(r.assetSelected=e.assets.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.jobId}}),delete r.assets):r.assetSelected=[],r.assetCategory&&(r.assetCategorySelected={value:r.assetCategory.id,label:r.assetCategory.name},delete r.assetCategory),r.siteVisitReq=!1,e.siteVisitStart&&(r.siteVisitReq=!0),r.shortJobDesc&&r.shortJobDesc.length>0&&(r.taxonomyId_ShortDesc={value:r.shortJobDesc[0].taxonomyId,label:r.shortJobDesc[0].taxonomy.name,meta:r.shortJobDesc[0].taxonomy.meta}),r.questions=r.answers.map(function(e){var t;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(t=e.taxonomy)||void 0===t?void 0:t.name}}),delete r.answers,r.costCategoryTaxonomy?r.costCategorySelected={value:r.costCategoryTaxonomy.id,label:r.costCategoryTaxonomy.name}:r.costCategorySelected=null,r.allowTimingNormalHours=!e.timingNormalHours,e.estimatedDuration&&e.estimatedDurationUnit&&(r.estimatedDuration=a().duration(e.estimatedDuration,"milliseconds").as(e.estimatedDurationUnit)),r},f=function(e){var t,n,r,i,s,l,c,d=e.query,p=e.data,y=e.hasRole,f=e.user,v=e.type;p.title=null,["slaId","customerSpendThreshold"].map(function(e){return p[e]?p[e]=parseInt(p[e]):p[e]=null,p}),delete p.timeSpan,["quoteDue","quoteDueSupplier","timingEnd","timingStart","endDate"].map(function(e){return p[e]&&(p[e]=a()(p[e]).utc().format()),p}),p.siteVisitReq?["siteVisitStart","siteVisitEnd"].map(function(e){return p[e]&&(p[e]=a()(p[e]).format()),p}):(p.siteVisitStart=null,p.siteVisitEnd=null),p.siteVisitWeekends="true"===p.siteVisitWeekends,delete p.siteVisitReq,["costCategory","customer","customerUser","location","manager","service"].map(function(e){return p[e+"Selected"]&&p[e+"Selected"].value&&(p[e+"Id"]=p[e+"Selected"].value),delete p[e+"Selected"],p}),null!==(t=p.sublocationSelected)&&void 0!==t&&t.value?p.sublocationId=null===(r=p.sublocationSelected)||void 0===r?void 0:r.value:p.sublocationId=null,delete p.sublocationSelected,"allowTimingNormalHours"===p.allowTimingNormalHours?p.timingNormalHours=!1:p.timingNormalHours=!0,delete p.allowTimingNormalHours,p.multipleDays&&"fixed"===p.pricing||(p.endDate=null),delete p.multipleDays;var b="";d.quoted?(p.type="quote",p.serviceId=null,p.quoted=!0,p.pricing="fixed",b="quoteNew"):"ppm"===v?p.type="ppm":(p.type="reactive",b=y("admin")?"raised":"pending"),d.id||(p.status=b,p.JobTimings={data:{status:p.status,userId:f.id}},y("admin")?p.adminId=f.accountId:p.adminId=f.adminId||1),d.parentId&&(p.parentId=parseInt(d.parentId)),p.timing&&"at"===p.timing&&(p.timingEnd=null),"foc"===p.quoteCharge&&(p.quoteChargeAmount=null);var g=[];if(p.questions&&(g=JSON.parse(p.questions).map(function(e){return{comments:e.comments,entity:e.entity,taxonomyId:e.taxonomyId}})),!d.id&&p.taxonomyId_ShortDesc&&(p.Taxonomy={data:[{entity:"Job",taxonomyId:p.taxonomyId_ShortDesc.value}].concat((0,o.Z)(g))}),null!==(n=p.tags)&&void 0!==n&&n.length&&(p.Taxonomy={data:[].concat((0,o.Z)(null!==(i=null===(s=p.Taxonomy)||void 0===s?void 0:s.data)&&void 0!==i?i:[]),(0,o.Z)((0,u.O)(p.tags)))}),p.issueType&&(p.Taxonomy={data:[].concat((0,o.Z)(null!==(l=null===(c=p.Taxonomy)||void 0===c?void 0:c.data)&&void 0!==l?l:[]),[{entity:"Job",taxonomyId:p.issueType.value}])}),delete p.taxonomyId_ShortDesc,delete p.questions,p.estimatedDuration&&p.estimatedDurationUnit?p.estimatedDuration=a().duration(p.estimatedDuration,p.estimatedDurationUnit).as("milliseconds"):(delete p.estimatedDuration,delete p.estimatedDurationUnit),p.meta=m(m({},p.meta),{},{customerSignature:p.customerSignature,supplierSignature:p.supplierSignature}),delete p.customerSignature,delete p.supplierSignature,p.assetSelected&&p.assetSelected.length>0){var h=p.assetSelected.map(function(e){return{assetId:e.value,status:"active"}});p.Assets={data:h}}return delete p.assetSelected,p.assetCategoryId=p.assetCategorySelected&&p.assetCategorySelected.value,delete p.assetCategorySelected,delete p.tags,delete p.issueType,p},v=function(e,t){if(t){if(!(null!==(n=e.taxonomyId_ShortDesc)&&void 0!==n&&n.value))return{};var n,r,i,a=JSON.parse(e.questions).map(function(e){return{comments:e.comments,entityId:t,entity:"Job",taxonomyId:e.taxonomyId}});return[{entityId:t,entity:"Job",taxonomyId:e.taxonomyId_ShortDesc.value}].concat((0,o.Z)(null!==(r=e.issueType)&&void 0!==r&&r.value?[{entityId:t,entity:"Job",taxonomyId:e.issueType.value}]:[]),(0,o.Z)((0,u.O)(null!==(i=e.tags)&&void 0!==i?i:[]).map(function(e){return m({entityId:t},e)})),(0,o.Z)(a))}},b=function(e,t){var n={meta:m(m({},e.meta),{},{reporter:m(m({},e.meta.reporter),{},{nameFirst:t.name.split(" ")[0],nameLast:t.name.split(" ")[1]||"",phone:t.phone,email:t.email,shouldSendNotifications:t.shouldSendNotifications})})};return delete t.name,delete t.phone,delete t.email,delete t.shouldSendNotifications,n},g=function(e){return{nameFirst:e.name.split(" ")[0],nameLast:e.name.split(" ")[1]||"",phone:e.phone,email:e.email,meta:{shouldSendNotifications:e.shouldSendNotifications}}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reactive",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{slas:[],customerSlas:[],locationSlas:[]},n=t.slas,r=t.customerSlas,o=t.locationSlas;return n.filter(function(t){return t.subtype===e}).map(function(e){var t=null==o?void 0:o.find(function(t){return t.slaId===e.id&&t.inUse}),n=null==r?void 0:r.find(function(t){return t.slaId===e.id&&t.inUse}),i=(null==t?void 0:t.notes)||(null==n?void 0:n.notes),a=(null==t?void 0:t.onSite)||(null==n?void 0:n.onSite),s=(null==t?void 0:t.onSiteUnit)||(null==n?void 0:n.onSiteUnit),l=(null==t?void 0:t.quoteReturned)||(null==n?void 0:n.quoteReturned),u=(null==t?void 0:t.quoteReturnedUnit)||(null==n?void 0:n.quoteReturnedUnit);return{id:e.id,label:e.label,value:e.id,notes:i||e.notes,onSite:a||e.onSite,onSiteUnit:s||e.onSiteUnit,quoteReturned:l||e.quoteReturned,quoteReturnedUnit:u||e.quoteReturnedUnit,disabled:!!(null!=o&&o.find(function(t){return t.slaId===e.id&&!t.inUse})||null!=r&&r.find(function(t){return t.slaId===e.id&&!t.inUse}))}})},x=function(e,t){var n=[];if(t.Media_Entity){var r,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(t.Media_Entity.data);try{for(o.s();!(r=o.n()).done;){var i=r.value,a=m(m({},i),{},{entityId:e});n.push(a)}}catch(s){o.e(s)}finally{o.f()}delete t.Media_Entity}return n},j=function(e,t,n){return{managerSelected:t("admin")?{value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}:null,access:e.location.access,sublocationSelected:e.sublocation?{value:e.sublocation.id,label:e.sublocation.name}:null,locationSelected:{value:e.location.id,label:e.location.name},customerSelected:{value:e.customer.id,label:e.customer.name},customerUserSelected:{value:e.customerUser.id,label:e.customerUser.name},assetSelected:[{value:e.asset.id,label:e.asset.name}],assetCategorySelected:{value:e.assetCategory.id,label:e.assetCategory.name}}}},78898:function(e,t,n){n.d(t,{V:function(){return c}});var r=n(59499),o=n(67294),i=n(87918),a=n(41796),s=n(85893);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var c=function(e){var t,n=e.chipProps,r=e.tagEntityId,l=e.name,c=e.color,d=e.onDelete,m=(0,o.useMemo)(function(){return d?u(u({},n),{},{onDelete:function(e){e.stopPropagation(),d(r)}}):u({},n)},[n,d,r]);return(0,s.jsx)(i.Z,u(u({},m),{},{size:"small",label:l,sx:{fontSize:"11px",color:(t=c,(0,a.mi)(t,"#FFFFFF")>2.5?"#FFFFFF":"#000"),bgcolor:c,borderRadius:"0px 16px 16px 0px"}}))};c.defaultProps={chipProps:{},onDelete:null,color:"#f2f2f2"}},99245:function(e,t,n){n.d(t,{O:function(){return r}});var r=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})}},66822:function(e,t,n){n.d(t,{f:function(){return S}});var r=n(59499),o=n(67294),i=n(58594),a=n(28497),s=n(55563),l=n(90951),u=n(95103),c=n(6710),d=n(78289),m=n(23233),p=n(49501),y=n(77439),f=n(40826),v=n(52220),b=n(99229),g=n(85893);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var j={checkbox:i.Z,currencyInput:a.Z,datepicker:v.M,input:s.Z,radio:l.Z,select:u.Z,textArea:c.Z,selectRange:u.Z},S=function(e){var t=e.control,n=e.entity,r=e.entityId,i=e.errors,a=e.input,s=e.inputType,l=e.key,u=e.label,c=e.mediaMeta,v=e.name,h=e.options,S=e.register,O=(0,o.useContext)(d.Z),w="select"===a&&h.length>0,D=["checkbox","radio"].includes(a)&&h.length>0,I=x(x(x(x({control:t},D&&{data:h}),w&&{options:h.map(function(e){return x(x({},e),{},{text:e.label})})}),"selectRange"===a&&{range:[10,0]}),{},{errors:i,key:l,label:m.Z.camelize(u),name:v,register:S,type:D?a:s,minDate:"2020-04-19T08:29:04.839Z"}),Z=function(){O.show({content:n&&r&&(0,g.jsx)(b.G,{entity:n,entityId:r,mediaMeta:c,category:"supplierQuestion"}),submit:!1,title:u})},P=j[a];return(0,g.jsx)(g.Fragment,{children:"currencyInput"===a?(0,g.jsx)(p.Z,{label:u,children:(0,g.jsx)(P,x(x({},I),{},{label:""}))}):(0,g.jsx)(g.Fragment,{children:"media"===a?(0,g.jsx)(p.Z,{label:u,children:(0,g.jsx)(y.Z,{context:"info",content:(0,g.jsx)(f.Z,{icon:"file-upload"}),onClick:Z,size:"sm"})}):(0,g.jsx)(p.Z,{label:u,children:(0,g.jsx)(P,x({},I))})})})};S.defaultProps={input:"input",options:[],inputType:"text",label:"label"}},88854:function(e,t,n){n.d(t,{Im:function(){return m},RQ:function(){return f},fC:function(){return v},mW:function(){return p},uY:function(){return b},ze:function(){return y}});var r,o,i,a,s,l,u,c=n(71383),d=n(75063),m=(0,d.Ps)(r||(r=(0,c.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n'])));(0,d.Ps)(o||(o=(0,c.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"])));var p=(0,d.Ps)(i||(i=(0,c.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]))),y=(0,d.Ps)(a||(a=(0,c.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]))),f=(0,d.Ps)(s||(s=(0,c.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]))),v=(0,d.Ps)(l||(l=(0,c.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),b=(0,d.Ps)(u||(u=(0,c.Z)(["\n  query GetSLAsForJobManage {\n    slas: SLA(order_by: { name: asc }) {\n      id\n      label: name\n      notes\n    }\n  }\n"])))},9105:function(e,t,n){n.d(t,{y:function(){return d}});var r=n(55377),o=n(9270),i=n(62140),a=n(86036),s=n(16551),l=n(77439),u=n(99229),c=n(85893),d=function(e){var t=e.answers,n=e.onEdit,d=e.entity,m=e.entityId,p=function(){n&&n(t)};return(0,c.jsxs)(c.Fragment,{children:[t&&t.length>0&&(0,c.jsx)(r.Z,{content:"Questions"}),t&&t.map(function(e){var t,n,s,l=e.meta;return(null==l?void 0:l.input)==="media"?(0,c.jsx)(o.Z,{children:(0,c.jsxs)(i.Z,{md:6,children:[(0,c.jsx)(u.G,{entity:d,entityId:m,showItemActions:!1,showActionButtons:!1,summary:null==l?void 0:l.label,category:"supplierQuestion",mediaMeta:{taxonomyId:e.id}}),(0,c.jsx)(r.Z,{})]})}):(0,c.jsx)(a.Z,{content:(null===(t=e.taxonomy)||void 0===t?void 0:t.name)||e.name,text:e.comments||(null===(n=e.taxonomy_entity)||void 0===n?void 0:null===(s=n[0])||void 0===s?void 0:s.comments)},e.id||e.taxonomyId)}),t&&t.length>0&&n&&(0,c.jsx)(s.Z,{align:"flex-end",children:(0,c.jsx)(l.Z,{content:"Edit Answers",size:"sm",context:"secondary",onClick:p})}),t&&t.length>0&&(0,c.jsx)(r.Z,{})]})}},19957:function(e,t,n){n.d(t,{D:function(){return j}});var r=n(59499),o=n(42283),i=n(79665),a=n(76600),s=n(9270),l=n(62140),u=n(16551),c=n(77439),d=n(66822),m=n(74231);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=function(e,t){var n=t.object,r=t.string,o={};return null==e||e.forEach(function(e){var t;null!==(t=e.meta)&&void 0!==t&&t.required&&(o[e.name]=r().required())}),n().shape(y({},o))},v=function(e){var t=e.map(function(e){return y(y({},e),{},{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),n=(0,m.Ry)().shape({}),r=f(t,{object:m.Ry,string:m.Z_});return n.concat(r)},b=n(67294),g=n(85893);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var j=function(e){var t,n=e.entity,r=e.entityId,m=e.onSuccess,p=e.questions,y=e.hasChangeStatus,f=(0,o.cI)({defaultValues:(t={},p.forEach(function(e){var n=e.comments,r=e.taxonomyId,o=e.name;t["".concat(o,"/id=").concat(r)]=n}),t),resolver:(0,i.S)(v(p))}),h=f.control,j=f.errors,S=f.handleSubmit,O={control:h,errors:j,register:f.register},w=function(e,t){var o=Object.keys(e).map(function(t){return{taxonomyId:parseInt(t.split("/id=")[1]),name:t.split("/id=")[0],comments:String(e[t]),entity:n,entityId:r}});m&&m(o,t)};return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(a.Z,{id:y?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:S(function(e){return w(e,"supplierQuestionsSubmitted")}),children:(0,g.jsxs)(s.Z,{children:[p.map(function(e){var t,o,i,a;return(0,g.jsx)(l.Z,{md:12,children:(0,b.createElement)(d.f,x(x({},O),{},{input:null===(t=e.meta)||void 0===t?void 0:t.input,inputType:null===(o=e.meta)||void 0===o?void 0:o.inputType,key:e.taxonomyId,label:null===(i=e.meta)||void 0===i?void 0:i.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(a=e.meta)||void 0===a?void 0:a.options,entity:n,entityId:r,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),y&&(0,g.jsx)(l.Z,{md:12,children:(0,g.jsxs)(u.Z,{align:"flex-end",children:[(0,g.jsx)(c.Z,{content:"Save",context:"success",onClick:S(function(e){return w(e,"supplierQuestionsDraft")}),size:"sm"}),(0,g.jsx)(c.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};j.defaultProps={hasChangeStatus:!1}},27940:function(e,t,n){n.d(t,{l:function(){return f}});var r=n(59499),o=n(4730),i=n(67294),a=n(6812),s=n(88854),l=n(49501),u=n(84043),c=n(85893),d=["control","errors","label","name","register","type","filters"];function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var y=function(e,t){var n,r,o,i=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(r=t.errors[t.name])||void 0===r?void 0:r.message)&&(i=!1),["name","type"].forEach(function(n){e[n]!==t[n]&&(i=!1)}),i},f=(0,i.memo)(function(e){var t,n,r,i=e.control,m=e.errors,y=e.label,f=e.name,v=e.register,b=e.type,g=e.filters,h=(0,o.Z)(e,d),x=(r=(n=void 0===(n=(0,a.a)(s.Im,{variables:p(p({isGroup:"assetCategory"===b},g),{},{orderBy:{name:"asc"},type:b})}).data)?{taxonomy:[]}:n).taxonomy,"assetCategory"===b?r.map(function(e){return{label:e.name,options:e.options,childs:e.childs,meta:e.meta}}):r.map(function(e){return{label:e.name,value:e.id,childs:e.childs,meta:e.meta}}));return(0,c.jsx)(l.Z,{id:f,label:y,children:(0,c.jsx)(u.Z,p(p({},{control:i,errors:m,register:v}),{},{cacheOptions:!0,isClearable:!0,options:x,name:f},h))})},y);f.defaultProps={filters:{}}},11552:function(e,t,n){n.d(t,{F:function(){return l}});var r,o=n(50029),i=n(64687),a=n.n(i),s=n(38512),l=(r=(0,o.Z)(a().mark(function e(t,n,r){var o,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={},i={},e.next=4,t.mutate({mutation:s.iU,variables:{jobId:n,invoiceType:"supplier"},skip:r&&"supplier"!==r}).then(function(e){var t;o=null==e?void 0:null===(t=e.data.calculateJobFinance)||void 0===t?void 0:t.data.persistentData});case 4:return e.next=6,t.mutate({mutation:s.iU,variables:{jobId:n,invoiceType:"customerVat"},skip:r&&"supplier"===r}).then(function(e){var t;i=null==e?void 0:null===(t=e.data.calculateJobFinance)||void 0===t?void 0:t.data.persistentData});case 6:return e.abrupt("return",{financeSupplier:o,financeCustomer:i});case 7:case"end":return e.stop()}},e)})),function(e,t,n){return r.apply(this,arguments)})},47568:function(e,t,n){n.d(t,{Hu:function(){return r},KB:function(){return o},M2:function(){return i}});var r=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],o=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],i=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]}}]);