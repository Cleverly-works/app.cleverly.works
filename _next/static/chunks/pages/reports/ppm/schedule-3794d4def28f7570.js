(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7945],{9164:function(e,n,t){"use strict";t.d(n,{r:function(){return d}});var o=t(59499),r=t(41664),i=t.n(r),a=t(23795),c=t(85893);function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var d=function(e){var n=e.children,t=e.href,o=e.noWrap,r=e.target,s=e.sx,d=void 0===s?{}:s;return o?(0,c.jsx)(c.Fragment,{children:n}):t?(0,c.jsx)(i(),{href:t,target:r,passHref:!0,children:(0,c.jsx)(a.Z,l(l({sx:d},e),{},{children:n}))}):(0,c.jsx)(a.Z,l(l({sx:d},e),{},{children:n}))};d.defaultProps={onClick:function(e){e.stopPropagation()}}},92186:function(e,n,t){"use strict";t.d(n,{B6:function(){return y},Ms:function(){return h},RV:function(){return b},YW:function(){return f},mJ:function(){return g}});var o,r,i,a,c,s,l,d,u,p=t(71383),m=t(75063);(0,m.Ps)(o||(o=(0,p.Z)(["\n  query GetAssetParents($ids: [Int!]!) {\n    asset: Asset(where: { id: { _in: $ids } }) {\n      id\n      name\n      parent: ParentAsset {\n        id\n        name\n        parent: ParentAsset {\n          id\n          name\n        }\n      }\n    }\n  }\n"])));var h=(0,m.Ps)(r||(r=(0,p.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule(where: { id: { _eq: $id } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),b=(0,m.Ps)(i||(i=(0,p.Z)(['\n  query GetJobSchedule($orderBy: JobSchedule_order_by!, $locationId: Int) {\n    JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: [$orderBy]) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      contract: JobScheduleContract {\n        name\n        invoiceDate\n        startDate\n        contractLength\n        contractValue\n        status\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings(order_by: { createdAt: desc }) {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])));(0,m.Ps)(a||(a=(0,p.Z)(['\n  query GetJobSchedule($id: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $id) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n  }\n'])));var f=(0,m.Ps)(c||(c=(0,p.Z)(['\n  query GetJobCompliance($locationId: Int!, $where: Job_bool_exp!) {\n    jobSchedule: JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: { id: asc }) {\n      frequency\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      sublocation: Sublocation {\n        id\n        name\n      }\n      serviceName: meta(path: "$.serviceName")\n      costCustomer: meta(path: "$.costCustomer")\n      costSupplier: meta(path: "$.costSupplier")\n      frequency\n      jobs: Jobs(where: $where) {\n        id\n        rag\n        timingStart\n      }\n      totalJobs: Jobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n  }\n']))),y=(0,m.Ps)(s||(s=(0,p.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n'])));(0,m.Ps)(l||(l=(0,p.Z)(["\n  query GetStatusLog($entity: String!, $entityId: Int!) {\n    statusLog: StatusLog(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      id\n      createdAt\n      notes\n      status\n    }\n  }\n"]))),(0,m.Ps)(d||(d=(0,p.Z)(["\n  mutation AddJob($objects: [Job_insert_input!]!) {\n    insert_Job(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"])));var g=(0,m.Ps)(u||(u=(0,p.Z)(["\n  mutation MyMutation($objects: [CreateJobInput]!, $adminId: Int!) {\n    createJob(adminId: $adminId, objects: $objects) {\n      data\n    }\n  }\n"])))},18069:function(e,n,t){"use strict";t.d(n,{K:function(){return J}});var o=t(59499),r=t(16835),i=t(67294),a=t(59922),c=t(73359),s=t(92186),l=t(52019),d=t(16551),u=t(97303),p=t(77439),m=t(58965),h=t(11717),b=t(51466),f=t(40826),y=t(11082),g=t(42283),j=t(76600),v=t(90951),x=t(71772),w=t(55863),S=t(85893);function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var D=function(e){var n,t,o=e.defaultValues,r=e.setScheduleFilters,i=e.toggleShow,a=(0,w.q)(),c=null==a?void 0:null===(n=a.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,s=(0,g.cI)({defaultValues:o}),l=s.control,d=s.errors,u=s.handleSubmit,p=s.register,m=(0,s.watch)("assetCategory",null==o?void 0:o.assetCategory),h={control:l,errors:d,register:p},b=function(e){r(function(){return P({},e)}),i()};return(0,S.jsxs)(j.Z,{id:"offCanvasForm",handleSubmit:u(b),children:[(0,S.jsx)(v.Z,P(P({},h),{},{name:"compliance",data:[{id:"yes",label:"Yes",value:!0},{id:"no",label:"No",value:!1}],legend:"Compliance"})),c&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.P,P(P({},h),{},{label:"Asset category",locationId:location.id,name:"assetCategory",type:"assetCategory"})),m&&(0,S.jsx)(x.P,P(P({},h),{},{label:"Assets",locationId:location.id,name:"assetSelected",type:"asset",isMulti:!0,assetCategoryId:(null==m?void 0:m.value)||null}))]}),(0,S.jsx)(x.P,P(P({},h),{},{errors:P({},d),isMulti:!0,label:"Service",name:"service",type:"service"}))]})},_=t(48126),I=t(10367),Z=t(58095),C=t(99751);function k(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function $(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?k(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var J=function(e){var n=e.clickable,t=e.handleHistory,o=e.locationId,g=(e.showDetails,e.refetchSchedule),j=e.setRefetchSchedule,v=(e.setR,e.customerDetails),x=e.supplierDetails,w=(0,a.useMainContext)(),O=w.setJobScheduleForToolbar,P=w.scheduleFilters,I=w.setScheduleFilters,k=(0,Z.a)(),J=(0,i.useContext)(l.Z).hasRole,F=function(e,n,o){var r=e.e,i=e.row;r.stopPropagation();var a=P.mode;"string"!=typeof(null==i?void 0:i.id)&&t(i,a,o)},N=(0,c.t)(s.YW),z=(0,r.Z)(N,2),E=z[0],A=z[1],L=A.data,M=(L=void 0===L?{jobSchedule:[]}:L).jobSchedule,G=void 0===M?[]:M,B=A.refetch;(0,i.useEffect)(function(){O(G)},[G,O]),(0,i.useEffect)(function(){P&&E({variables:{locationId:o,where:(0,_.WJ)($({},P))}})},[E,o,P]),(0,i.useEffect)(function(){g&&(I(!1),j(!1),B())},[B,g,j,I]);var R=function(e){e.stopPropagation(),k.show({content:(0,S.jsx)(D,{defaultValues:P,toggleShow:k.close,setScheduleFilters:I}),title:"Filter"})},W=function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,S.jsxs)(d.Z,{children:[(0,S.jsx)(u.Z,{border:!1,passHref:!0,to:"/reports/ppm/schedule?locationId=".concat(o),children:(0,S.jsx)(p.Z,$($({},e),{},{startIcon:"file-pdf"}))}),(0,S.jsx)(p.Z,$($({},e),{},{onClick:R,startIcon:"filter"}))]})};return(0,S.jsx)(m.Z,{fitParentHeight:!0,open:!0,title:"Schedule",toolbar:(0,S.jsx)(W,{}),children:(0,S.jsx)(h.Z,{dataSource:G,events:"jobs",eventTimeSplitting:"timingStart",flag:"rag",handleClick:n?F:null,handleFetchData:function(e,n){var t=e.startDate,o=e.endDate;I(function(e){return $($({},e),{},{dateFilter:{startDate:t,endDate:o},mode:n})})},hiddenColumn:["frequency","id","title","description","sublocation","costCustomer","costSupplier","serviceName","jobs"],initialMode:"year",onTitleFormatter:function(e){var n=e.row;return(0,S.jsxs)(q,{children:[(0,S.jsxs)(T,{children:[(0,S.jsxs)(b.Z,{size:"sm",children:[n.compliance&&(0,S.jsx)(f.Z,{context:"info",icon:"clipboard-check"}),n.serviceName]}),n.costCustomer&&J("customer")&&(0,S.jsx)(b.Z,{size:"xs",children:(0,y.Z)(n.costCustomer)}),n.costSupplier&&J("supplier")&&(0,S.jsx)(b.Z,{size:"xs",children:(0,y.Z)(n.costSupplier)}),n.costCustomer&&J("admin")&&n.costCustomer&&v&&(0,S.jsxs)(b.Z,{size:"xs",children:["Customer: ",(0,y.Z)(n.costCustomer)]}),n.costSupplier&&J("admin")&&x&&n.costSupplier&&(0,S.jsxs)(b.Z,{size:"xs",children:["Supplier: ",(0,y.Z)(n.costSupplier)]})]}),(0,S.jsxs)(T,{children:[(0,S.jsx)(b.Z,{size:"sm",children:n.title}),(0,S.jsx)(C.O,{maxLength:40,children:n.description}),n.sublocation&&(0,S.jsxs)(b.Z,{size:"xs",children:["Sublocation: ",n.sublocation.name]})]})]})},title:"serviceName"})})};J.defaultProps={clickable:!0,showDetails:!0};var q=I.ZP.div.withConfig({displayName:"schedule__StyledContainer",componentId:"sc-1swtgpg-0"})(["width:100%;text-align:left;display:flex;column-gap:10px;"]),T=I.ZP.div.withConfig({displayName:"schedule__StyledItem",componentId:"sc-1swtgpg-1"})(["width:50%;"])},99751:function(e,n,t){"use strict";t.d(n,{O:function(){return p}});var o=t(59499),r=t(4730),i=t(67294),a=t(9164),c=t(15861),s=t(85893),l=["maxLength","children","href","fontSize"];function d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?d(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var p=function(e){var n=e.maxLength,t=e.children,o=e.href,d=e.fontSize,p=(0,r.Z)(e,l),m=(0,i.useState)(!1),h=m[0],b=m[1],f=function(e){e.stopPropagation(),b(!h)},y=(null==t?void 0:t.length)>n?"".concat(t.slice(0,n),"..."):t,g=h?t:y,j=o?(0,s.jsx)(a.r,{color:"secondary",href:o,children:g}):g;return(0,s.jsxs)(c.Z,u(u({fontSize:d},p),{},{children:[j,!h&&(null==t?void 0:t.length)>n&&(0,s.jsx)(c.Z,{underline:"none",fontSize:d,sx:{cursor:"pointer",display:"inline-block",fontWeight:600,color:"rgba(0, 0, 0, 0.5)"},onClick:f,children:"more"}),h&&t.length>n&&(0,s.jsx)(c.Z,{underline:"none",fontSize:d,sx:{cursor:"pointer",display:"inline-block",fontWeight:600,color:"rgba(0, 0, 0, 0.5)"},onClick:f,children:" | less"})]}))};p.defaultProps={maxLength:100,children:""}},56122:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return T}});var o,r,i=t(10367),a=t(85893),c=function(e){var n=e.children;return(0,a.jsx)(s,{id:"printContainer",children:n})},s=i.ZP.div.withConfig({displayName:"page__StyledContainer",componentId:"sc-cvoy6e-0"})(["background:white;width:21cm;min-height:29.7cm;display:block;margin:0 auto;margin-bottom:0.5cm;padding:0.5cm;box-shadow:0 0 0.5cm rgba(0,0,0,0.5);font-family:'lato';font-size:10pt;color:black;"]),l=t(50029),d=t(64687),u=t.n(d),p=t(67294),m=t(60036),h=t(16551),b=t(77439),f=t(72936),y=function(e){var n,t=e.location,o=e.jobScheduleForToolBar,r=e.customerDetails,i=e.supplierDetails,c=e.endDate,s=(0,f.x)().user,d=(0,p.useState)(!1),y=d[0],g=d[1],j=function(){window.history.back()},v=(n=(0,l.Z)(u().mark(function e(){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),n={location:t.name,ppmDate:new Date,jobSchedule:o,customerDetails:r,supplierDetails:i,adminId:s.accountId,year:c},e.next=4,window.fetch("".concat("https://aws.cleverly.works","/pdf/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){var n=window.open("/download","_blank");g(!1),n.location.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key))}).catch(function(e){(0,m.Tb)({message:e,section:"fetch"})});case 4:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)});return(0,a.jsxs)(h.Z,{align:"center",children:[(0,a.jsx)(b.Z,{context:"secondary",content:"".concat(y?"Generating PDF":"Download"),disabled:y,"data-cy":"downloadPDF",onClick:v}),(0,a.jsx)(b.Z,{context:"secondary",content:"Back","data-cy":"backButton",onClick:j})]})},g=t(9270),j=t(62140),v=t(51466),x=t(6812),w=t(71383),S=t(75063),O=(0,S.Ps)(o||(o=(0,w.Z)(['\n  query GetLogo($adminId: Int!) {\n    account: Account_by_pk(id: $adminId) {\n      id\n      media: Media(\n        where: { entity: { _eq: "Account" }, Medium: { category: { _eq: "invoiceLogo" } } }\n        limit: 1\n        order_by: { createdAt: desc }\n      ) {\n        id\n        item: Medium {\n          id\n          filename\n        }\n      }\n    }\n  }\n']))),P=t(34953),D=function(){var e,n,t,o=(0,f.x)(),r=o.hasRole,i=o.user,c=(0,x.a)(O,{variables:{adminId:r("admin")?i.adminId:i.accountId}}).data,s=(c=void 0===c?{account:[]}:c).account;return null!=s&&s.media&&(null==s?void 0:null===(e=s.media)||void 0===e?void 0:e.length)!==0?(0,a.jsx)(P.Z,{alt:"logo",src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null==s?void 0:null===(n=s.media[0])||void 0===n?void 0:null===(t=n.item)||void 0===t?void 0:t.filename),onError:function(e){return e.target.src="/static/logo/cleverly-full-logo-black.png"},width:100}):null},_=function(e){var n=e.lines,t=e.reportName,o=(e.showDivider,e.supplier);return(0,a.jsxs)(g.Z,{className:"reportHeader",children:[(0,a.jsx)(j.Z,{md:9,children:(0,a.jsx)(D,{})}),(0,a.jsxs)(j.Z,{md:3,children:[(0,a.jsx)(v.Z,{context:"black",weight:"bold",children:t}),o&&(0,a.jsx)(v.Z,{context:"black",weight:"bold",children:"Supplier: ".concat(o)}),null==n?void 0:n.map(function(e,n){return(0,a.jsx)(v.Z,{context:"black",size:"sm",children:e})})]})]})},I=(0,S.Ps)(r||(r=(0,w.Z)(["\n  query GetLocationDetails($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      name\n    }\n  }\n"]))),Z=t(11163),C=t(59922),k=t(18069),$=t(26186),J=function(e){var n=e.location,t=[];return t.push("Location: ".concat(null==n?void 0:n.name)),t.push("Date:  ".concat((0,$.Z)(new Date))),t},q=function(){var e=(0,Z.useRouter)().query,n=(0,C.useMainContext)(),t=n.customerDetails,o=n.supplierDetails,r=n.jobScheduleForToolBar,i=n.scheduleFilters,s=(0,x.a)(I,{variables:{id:e.locationId}}).data,l=(s=void 0===s?{}:s).location;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y,{location:l,jobScheduleForToolBar:r,customerDetails:t,supplierDetails:o,endDate:i.dateFilter.endDate}),(0,a.jsxs)(c,{children:[(0,a.jsx)(_,{lines:J({location:l}),reportName:"PPM Schedule",showDivider:!0}),(0,a.jsx)("div",{style:{zoom:"75%"},children:(0,a.jsx)(k.K,{clickable:!1,locationId:e.locationId,showDetails:!1,customerDetails:t,supplierDetails:o})})]})]})},T=function(){return(0,a.jsx)(q,{})}},94360:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/ppm/schedule",function(){return t(56122)}])}},function(e){e.O(0,[3662,9809,2283,212,1336,1564,5370,6540,9241,6075,4990,1717,9945,1772,8126,9774,2888,179],function(){return e(e.s=94360)}),_N_E=e.O()}]);