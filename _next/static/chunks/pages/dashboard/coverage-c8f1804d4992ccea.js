(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7528],{92264:function(e,t,n){"use strict";n.d(t,{H:function(){return u}});var r=n(59499),o=n(55377),i=n(16551),c=n(77439),s=n(85893);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var u=function(e){var t=e.children,n=e.content,u=e.context,l=e.data,d=e.disabled,f=e.handleClick,p=e.size,v=e.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:"sm"}),(0,s.jsxs)(i.Z,{align:"flex-end",children:[t,(0,s.jsx)(c.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({content:n,context:u,disabled:d,onClick:f,size:p,type:v},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},23446:function(e,t,n){"use strict";n.d(t,{NG:function(){return f},NK:function(){return d},OW:function(){return p},sM:function(){return l}});var r,o,i,c,s,a=n(71383),u=n(75063),l=(0,u.Ps)(r||(r=(0,a.Z)(["\n  query GetPostcodeAreas(\n    $countryId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: PostcodeArea_order_by!\n  ) {\n    postcodeAreas: PostcodeArea(\n      limit: $limit\n      offset: $offset\n      where: { countryId: { _eq: $countryId }, name: { _ilike: $q } }\n      order_by: [$orderBy]\n    ) {\n      id\n      area\n      name\n      status\n      country: Country {\n        id\n        name\n        code\n      }\n    }\n    meta: PostcodeArea_aggregate(where: { countryId: { _eq: $countryId }, name: { _ilike: $q } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),d=(0,u.Ps)(o||(o=(0,a.Z)(["\n  query GetPostcodeArea($id: Int!) {\n    postcodeArea: PostcodeArea_by_pk(id: $id) {\n      id\n      area\n      name\n      status\n      country: Country {\n        id\n        name\n        code\n      }\n    }\n  }\n"])));(0,u.Ps)(i||(i=(0,a.Z)(["\n  mutation AddPostcodeArea($areas: [PostcodeArea_insert_input!]!) {\n    insert_PostcodeArea(objects: $areas) {\n      returning {\n        id\n      }\n    }\n  }\n"])));var f=(0,u.Ps)(c||(c=(0,a.Z)(["\n  mutation InsertPostCodeArea($objects: [PostcodeArea_Entity_insert_input!]!) {\n    insert_PostcodeArea_Entity(\n      objects: $objects\n      on_conflict: {\n        constraint: PostcodeArea_Entity_postcodeAreaId_entityId_entity_key\n        update_columns: status\n      }\n    ) {\n      returning {\n        id\n        status\n      }\n    }\n  }\n"]))),p=(0,u.Ps)(s||(s=(0,a.Z)(["\n  mutation UpdateEntityAssign($id: Int!, $changes: PostcodeArea_Entity_set_input) {\n    update_PostcodeArea_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"])))},67872:function(e,t,n){"use strict";n.d(t,{t:function(){return a}});var r=n(67294),o=n(11163),i=n(87043),c=n(16540),s=n(85893),a=(0,r.forwardRef)(function(e,t){var n=e.columns,a=e.history,u=e.initialSort,l=e.loading,d=e.meta,f=e.paginationSize,p=e.refetch,v=e.rowClick,g=e.rows,y=e.xeroPageSize,b=(0,o.useRouter)(),m=b.query,O=void 0===m?{}:m,j=(0,r.useState)(parseInt(null==O?void 0:O.page,10)||1),h=j[0],P=j[1],w=(0,r.useState)(y||i.C1.paginationSize),_=w[0],S=w[1];u||(u={item:"createdAt",order:"desc"});var x=(0,r.useState)({item:u.item,order:u.order}),Z=x[0],C=x[1],I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=b.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},k=function(){C({item:u.item,order:u.order}),P(1);var e=I();b.push(e),S(y||i.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:h,pageSize:_,sort:Z,resetPagination:function(){k()}}});var A=function(e){var t=I(e);a&&b.push(t),P(e),!a&&p&&p()},$=function(e){e!==i.C1.paginationSize&&(S(e),p&&p())},E=function(e){var t;C({item:e.item,order:e.order}),p&&p()};return(0,s.jsx)(c.Z,{columns:n,loading:l,paginationSize:f,pagination:d&&!0,paginationProps:d&&{currentPage:h,onPageChange:A,onPageSizeChange:$,pageCount:Math.ceil(d.aggregate.totalCount/_),perPage:_},rowClick:v,rows:g,sort:Z,setSort:E})});a.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,n){"use strict";n.d(t,{x:function(){return l}});var r=n(59499),o=n(67294),i=n(96486),c=n(87043),s=function(e){try{return JSON.parse(e)}catch(t){return!1}};function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l=function(e){var t,n,a,l,d,f,p,v,g,y,b,m=e.filters,O=e.newFilters,j=e.initialSort,h=(0,o.useRef)(),P=(0,o.useState)({}),w=P[0],_=P[1],S=(0,o.useState)({}),x=S[0],Z=S[1],C=j||{item:"createdAt",order:"desc"},I=(0,r.Z)({},(null===(t=h.current)||void 0===t?void 0:t.sort.item)||C.item,C.inneritem?(0,r.Z)({},C.inneritem,(null===(n=h.current)||void 0===n?void 0:n.sort.order)||C.order):(null===(a=h.current)||void 0===a?void 0:a.sort.order)||C.order);return(0,o.useEffect)(function(){var e=!(0,i.isEqual)(w,m),t=!(0,i.isEqual)(x,O);if(e&&(_(m),null==h||null===(r=h.current)||void 0===r||r.resetPagination()),t&&(Z(O),null==h||null===(o=h.current)||void 0===o||o.resetPagination()),null!=h&&null!==(n=h.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,o,c,s,a,u,l,d,f,p,v=null!==(c=h.current)&&void 0!==c&&null!==(s=c.sort)&&void 0!==s&&s.item&&null!==(a=h.current)&&void 0!==a&&null!==(u=a.sort)&&void 0!==u&&u.order?{item:null===(l=h.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(f=h.current)||void 0===f?void 0:null===(p=f.sort)||void 0===p?void 0:p.order}:I;h.current.setSort(v)}},[m,O]),{initialData:u(u({},m),{},{newFilters:(null==O?void 0:O.length)>0?O:void 0,limit:(null===(l=h.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=h.current)||void 0===d?void 0:d.pageSize,10)||c.C1.paginationSize,offset:((null===(f=h.current)||void 0===f?void 0:f.currentPage)-1||0)*((null===(p=h.current)||void 0===p?void 0:p.pageSize)||c.C1.paginationSize),orderBy:s(null===(v=h.current)||void 0===v?void 0:null===(g=v.sort)||void 0===g?void 0:null===(y=g.item)||void 0===y?void 0:y.replace(/ORDER/i,null===(b=h.current)||void 0===b?void 0:b.sort.order))||I}),initialSort:j,ref:h}}},3896:function(e,t,n){"use strict";n.d(t,{X:function(){return p}});var r,o,i=n(71383),c=n(16835),s=n(59499),a=n(67294),u=n(6812),l=n(50319),d=n(75063),f=n(55863);function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,f.q)().user,o=(0,a.useState)(function(){try{switch(n){case"network":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),i=o[0],d=o[1],p=function(t){try{var o=t instanceof Function?t(i):t;switch(d(o),n){case"network":b({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,s.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(c){}};(0,u.a)(v,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&d(r.filters[e]||t)}});var y=(0,l.D)(g),b=(0,c.Z)(y,1)[0];return[i,p]}var v=(0,d.Ps)(r||(r=(0,i.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]))),g=(0,d.Ps)(o||(o=(0,i.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"])))},77329:function(e,t,n){"use strict";n.d(t,{O:function(){return r},v:function(){return o}});var r=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],o=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},12964:function(e,t,n){"use strict";n.d(t,{J:function(){return S}});var r=n(59499),o=n(16835),i=n(4730),c=n(11163),s=n(67294),a=n(9270),u=n(62140),l=n(42283),d=n(76600),f=n(58965),p=n(49501),v=n(75903),g=n(77439),y=n(92264),b=n(3896),m=n(85893);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){var t=e.initialValues,n=e.renderFilters,r=e.setFilters,i=e.lastQuery,c=e.filters,O=(0,b.X)("form_data_".concat(t.filterType),t),h=(0,o.Z)(O,2),P=h[0],w=h[1],_=(0,l.cI)({defaultValues:P||t}),S=_.control,x=_.errors,Z=_.handleSubmit,C=_.register,I=_.reset,k=_.watch,A=_.setValue,$=k(),E=j(j({},$),{},{filterType:t.filterType});(0,s.useEffect)(function(){I(E)},[I]),(0,s.useEffect)(function(){w(E)},[c]);var D=function(e){var n=e.query;if(n!==i){var o={q:"%".concat(n,"%")||0},c=/^\d+$/.test(n);"id"in t&&(o.id=c?Number(n):null),"meta"in t&&(o.meta=c?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(o.jobNumber=c?String(n):null,o.invoiceNumber=c?Number(n):null),r(function(e){return j(j({},e),o)})}},F=function(e){Object.keys(t).map(function(e){return A(e,null)}),r(t),I(t),D("")};return(0,m.jsx)(d.Z,{handleSubmit:Z(D),children:(0,m.jsxs)(f.Z,{title:"Filters",children:[(0,m.jsxs)(a.Z,{children:[(0,m.jsx)(u.Z,{sm:12,lg:12,children:(0,m.jsx)(p.Z,{label:"",children:(0,m.jsx)(v.Z,{errors:x,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:C,type:"search"})})}),(0,m.jsx)(u.Z,{sm:12,lg:12,children:n({control:S,errors:x,initialValues:t,register:C,setFilters:r,watch:k,setValue:A,reset:I})})]}),(0,m.jsx)(y.H,{content:"Search",context:"secondary",handleClick:D,type:"submit",children:(0,m.jsx)(g.Z,{content:"Clear",context:"danger",onClick:F,size:"sm"})})]})})},P=["FiltersComp","initialFilters","TableComp"];function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var S=function(e){var t=e.FiltersComp,n=e.initialFilters,r=e.TableComp,l=(0,i.Z)(e,P),d=(0,b.X)("form_data_".concat(n.filterType),n),f=(0,o.Z)(d,2),p=f[0],v=f[1],g=(0,s.useState)(p||n),y=g[0],O=g[1],j=(0,c.useRouter)().query.show;return(0,s.useEffect)(function(){v(y)},[y,v]),(0,m.jsx)(a.Z,{children:(0,m.jsxs)(u.Z,{sm:12,lg:12,children:[(0,m.jsx)(h,{initialValues:n,renderFilters:function(e){return(0,m.jsx)(t,_(_(_({},e),l),{},{show:j}))},setFilters:O,filters:y}),(0,m.jsx)(r,_({filters:y,initialFilters:n},l))]})})}},39892:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(19076),o=n(12964),i=n(11163),c=n.n(i),s=n(6812),a=n(23446),u=n(74297),l=n(58965),d=n(67872),f=n(42846),p=n(85893),v={item:"area",order:"asc"},g=function(e){var t=e.filters,n=(0,f.x)({filters:t,initialSort:v}),r=n.initialData,o=n.ref,i=(0,s.a)(a.sM,{variables:r}),g=i.data,y=(g=void 0===g?{areas:[],meta:{aggregate:{totalCount:0}}}:g).postcodeAreas,b=g.meta,m=i.loading,O=i.refetch,j=function(e){c().push("".concat("/dashboard/coverage/","view?id=").concat(e.id))};return(0,p.jsx)(l.Z,{open:!0,title:"Coverage Areas",children:(0,p.jsx)(d.t,{columns:[{hidden:!0},{text:"Postcode"},{sortable:!0,sortName:"area",text:"Area"},{text:"Country"},{text:"# Services"},{text:"# Suppliers"},{text:"Status"}],initialSort:v,loading:m,meta:b,ref:o,refetch:O,rowClick:j,rows:y?y.map(function(e){var t,n,r;return{id:e.id,postcode:e.area,area:e.name,country:null===(t=e.country)||void 0===t?void 0:t.name,servicesCount:(null===(n=e.services)||void 0===n?void 0:n.length)||0,suppliersCount:(null===(r=e.suppliers)||void 0===r?void 0:r.length)||0,status:(0,u.Z)(e.status)}}):[]})})},y=n(59499),b=n(9270),m=n(62140),O=n(95103),j=n(77329);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var w=function(e){var t=e.errors,n=e.register,r=e.setFilters;return(0,p.jsx)(b.Z,{children:(0,p.jsx)(m.Z,{md:6,children:(0,p.jsx)(O.Z,{errors:t,name:"countryId",onChange:function(e){return r(function(t){return P(P({},t),{},{countryId:e.target.value||null})})},options:j.O,register:n})})})},_={countryId:null,q:null,filterType:"coverage_table"},S=function(){return(0,p.jsx)(o.J,{FiltersComp:w,initialFilters:_,TableComp:g})},x=function(){return(0,p.jsx)(r.Z,{pageHeading:{heading:"Coverage"},View:(0,p.jsx)(S,{})})}},39582:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/coverage",function(){return n(39892)}])}},function(e){e.O(0,[3662,2283,1336,6540,8209,9774,2888,179],function(){return e(e.s=39582)}),_N_E=e.O()}]);