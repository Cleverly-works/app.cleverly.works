(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5524,1772],{53344:function(e,n,t){"use strict";t.d(n,{Q:function(){return r}});var r=function(e){var n,t,r=e&&e.length>0&&e.find(function(e){var n;return(null===(n=e.medium)||void 0===n?void 0:n.category)==="avatar"});if(!r)return null;var o="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r.medium.filename),i=null==r?void 0:null===(n=r.medium)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.thumbnails;if(null!=i&&i.length){var a=i.find(function(e){return"small"===e.name});null!=a&&a.relativePath&&(o="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(a.relativePath))}return o}},46165:function(e,n,t){"use strict";t.d(n,{g:function(){return D}});var r,o=t(67294),i=t(10367),a=t(78289),s=t(74147),c=t(9270),u=t(62140),d=t(65414),l=t(55843),m=t(45481),p=t(97303),f=t(33006),y=t(40826),h=t(55171),v=t.n(h),g=t(6812),b=t(71383),x=(0,t(75063).Ps)(r||(r=(0,b.Z)(["\n  query GetLog($entityId: bigint!, $entityName: String!) {\n    activity: audit_Activity(\n      where: { _and: [{ entityid: { _eq: $entityId } }, { entity: { _eq: $entityName } }] }\n    ) {\n      eventId\n      userId\n      user: User {\n        fullName\n      }\n      sessionUserName\n      transactionStart\n      statementStart\n      applicationName\n      clientAddr\n      clientPort\n      action\n      changedFields\n    }\n  }\n"]))),_=t(58965),j=t(26186),I=t(86036),Z=t(49501),$={U:"Update",I:"Insert",D:"Delete"},q=t(85893),w=function(e){var n=e.entityId,t=e.entityName,r=(0,g.a)(x,{variables:{entityId:n,entityName:t}}),o=r.loading,i=r.data,a=(i=void 0===i?{activity:[]}:i).activity;return!o&&(0,q.jsx)(c.Z,{children:(0,q.jsx)(u.Z,{md:12,children:a.map(function(e){var n,t;return(0,q.jsxs)(_.Z,{title:"".concat((null===(n=e.user)||void 0===n?void 0:n.fullName)||"Backend"," - ").concat((0,j.Z)(e.transactionStart,!0)),children:[(0,q.jsx)(I.Z,{content:"Action:",text:$[t=e.action]||"-"}),(0,q.jsx)(l.Z,{}),(0,q.jsx)(Z.Z,{label:"Changed:",children:(0,q.jsx)(v(),{collapsed:!0,displayDataTypes:!1,src:e.changedFields||"-"})}),(0,q.jsx)(I.Z,{content:"Application:",text:e.applicationName||"-"})]},e.userId)})})})},O=t(99229),P=t(93673),S=t(825),k=t(86559),A=t(72936),C=function(e){var n,t,r,o,i=e.job,a=e.numberPrefix,s=e.numberSuffix,c=(0,A.x)().hasRole;return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(I.Z,{content:"Type",text:(null===(n=P.x.find(function(e){return e.value===i.type}))||void 0===n?void 0:n.text)||"-"}),(0,q.jsx)(I.Z,{content:"Order",text:(0,q.jsx)(S.D,{id:i.id,number:i.number,invoiceNumber:null==i?void 0:null===(t=i.invoices)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.invoiceNumber,type:i.type,numberPrefix:a,numberSuffix:s,isQuote:i.quoted})}),c("admin")&&i.source&&(0,q.jsx)(I.Z,{content:"Source",text:null===(o=k.Y.find(function(e){return e.value===i.source}))||void 0===o?void 0:o.text})]})};C.defaultProps={numberPrefix:"",numberSuffix:""};var D=function(e){var n=e.avatar,t=e.editable,r=e.entity,i=e.entityName,f=e.icons,y=e.job,h=e.linkTitleTo,v=e.log,g=e.numberPrefix,b=e.numberSuffix,x=e.prefix,_=(0,o.useContext)(a.Z),j=(0,o.useState)(n),I=j[0],Z=j[1],$=function(e){_.close(),null!=e&&e.filename?Z("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null==e?void 0:e.filename)):Z(null)},P=function(){_.show({content:(0,q.jsx)(O.G,{category:"avatar",entity:i,entityId:null==r?void 0:r.id,filters:{category:"avatar"},limit:1,onMediaAdd:$,onMediaRemove:$,type:"image"}),title:"Avatar"})},S=function(){return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(M,{context:"primary",icon:"building"}),h?(0,q.jsx)(G,{border:!1,passHref:!0,to:h,children:null==r?void 0:r.name}):null==r?void 0:r.name]})},k=function(){_.show({content:(0,q.jsx)(w,{entityId:Number(null==v?void 0:v.entityId),entityName:null==v?void 0:v.entityName}),submit:!1,title:"Log Details",width:"50%"})};return(0,q.jsxs)(U,{children:[(0,q.jsx)(s.Z,{children:(0,q.jsxs)(c.Z,{children:[(0,q.jsx)(u.Z,{md:3,children:(0,q.jsx)(d.Z,{action:t?"Edit":null,actionClick:P,content:(null==r?void 0:r.name)||"test",context:"primary",gmail:null==r?void 0:r.email,src:I})}),(0,q.jsxs)(u.Z,{md:9,children:[(0,q.jsx)(L,{content:(0,q.jsx)(S,{}),noMargin:!0}),(null==r?void 0:r.description)&&(0,q.jsx)(T,{content:null==r?void 0:r.description,noMargin:!0}),(null==r?void 0:r.website)&&(0,q.jsxs)(F,{href:null==r?void 0:r.website,rel:"nofollow noopener noreferrer",target:"_blank",children:[(0,q.jsx)(M,{context:"primary",icon:"window-maximize"}),"Visit website"]})]}),y&&(0,q.jsx)(u.Z,{md:12,children:(0,q.jsx)(C,{job:y,numberPrefix:g,numberSuffix:b})})]})}),(0,q.jsx)(l.Z,{marginTop:"sm"}),f&&(0,q.jsxs)(N,{children:[f.map(function(e){var n=e.icon,t=e.onClick,r=e.to;return(0,q.jsxs)("div",{children:[t&&(0,q.jsx)(E,{onClick:t,children:(0,q.jsx)(m.Z,{icon:n,prefix:x})}),r&&(0,q.jsx)(p.Z,{border:!1,passHref:!0,to:r,children:(0,q.jsx)(m.Z,{icon:n,prefix:x})})]},n)}),v&&(0,q.jsx)(E,{onClick:k,children:(0,q.jsx)(m.Z,{icon:"history",size:"lg"})})]})]})},U=i.ZP.div.withConfig({displayName:"profileHeader__StyledHeader",componentId:"sc-ssc7qm-0"})(["background-color:#fff;border:1px solid #eee;box-shadow:rgba(45,62,80,0.12) 0 1px 5px 0;margin-bottom:0.5rem;padding:1rem 0;"]),L=(0,i.ZP)(f.Z).withConfig({displayName:"profileHeader__StyledHeading",componentId:"sc-ssc7qm-1"})(["font-size:1rem;margin-top:0.5rem;"]),T=(0,i.ZP)(f.Z).withConfig({displayName:"profileHeader__StyledDescription",componentId:"sc-ssc7qm-2"})(["font-size:0.9rem;margin-top:0.5rem;"]),F=i.ZP.a.withConfig({displayName:"profileHeader__StyledLink",componentId:"sc-ssc7qm-3"})(["margin-bottom:1rem;"]),M=(0,i.ZP)(y.Z).withConfig({displayName:"profileHeader__StyledIcon",componentId:"sc-ssc7qm-4"})(["margin-right:0.5rem;"]),G=(0,i.ZP)(p.Z).withConfig({displayName:"profileHeader__StyledTitle",componentId:"sc-ssc7qm-5"})(["display:inline;"]),N=i.ZP.div.withConfig({displayName:"profileHeader__StyledIconContainer",componentId:"sc-ssc7qm-6"})(["display:flex;justify-content:center;"]),E=i.ZP.div.withConfig({displayName:"profileHeader__Click",componentId:"sc-ssc7qm-7"})(["cursor:pointer;"]);D.defaultProps={avatar:"",editable:!0,numberPrefix:"",numberSuffix:""}},76301:function(e,n,t){"use strict";t.d(n,{Ak:function(){return N},Cj:function(){return J},K4:function(){return er},Qn:function(){return M},RJ:function(){return Q},SW:function(){return F},T_:function(){return B},UH:function(){return T},UM:function(){return en},Ve:function(){return X},_d:function(){return R},_f:function(){return et},by:function(){return V},cz:function(){return D},he:function(){return G},j$:function(){return E},kB:function(){return K},kU:function(){return Y},kx:function(){return H},nD:function(){return L},nP:function(){return ei},pY:function(){return eo},qd:function(){return U},t1:function(){return z},yR:function(){return W},zR:function(){return ee}});var r,o,i,a,s,c,u,d,l,m,p,f,y,h,v,g,b,x,_,j,I,Z,$,q,w,O,P,S,k,A=t(71383),C=t(75063),D=(0,C.Ps)(r||(r=(0,A.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]))),U=(0,C.Ps)(o||(o=(0,A.Z)(["\n  query GetAccountsForSelect($q: String, $type: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: $type } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),L=(0,C.Ps)(i||(i=(0,A.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),T=(0,C.Ps)(a||(a=(0,A.Z)(["\n  query GetAssetsForSelect($locationId: Int, $q: String, $categoryId: Int, $bookable: String) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n      parent: ParentAsset {\n        id\n        name\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          name\n          filename\n          meta\n          category\n          type\n        }\n      }\n    }\n  }\n"]))),F=(0,C.Ps)(s||(s=(0,A.Z)(['\n  query GetCustomersForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']))),M=(0,C.Ps)(c||(c=(0,A.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]))),G=(0,C.Ps)(u||(u=(0,A.Z)(['\n  query GetManagersForSelect($userId: Int, $accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),N=(0,C.Ps)(d||(d=(0,A.Z)(['\n  query GetManagersForSelect(\n    $userId: Int\n    $accountId: Int!\n    $q: String\n    $invoiceThreshold: numeric\n    $quoteThreshold: numeric\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n        _and: [\n          {\n            _or: [\n              { invoiceThreshold: { _gt: $invoiceThreshold } }\n              { invoiceThreshold: { _is_null: true } }\n            ]\n          }\n          {\n            _or: [\n              { quoteThreshold: { _gt: $quoteThreshold } }\n              { quoteThreshold: { _is_null: true } }\n            ]\n          }\n        ]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),E=(0,C.Ps)(l||(l=(0,A.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]))),R=(0,C.Ps)(m||(m=(0,A.Z)(['\n  query GetPropertiesForSelect($where: Location_bool_exp, $limit: Int, $offset: Int) {\n    items: Location(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n      access\n      permitsRequired\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']))),H=(0,C.Ps)(p||(p=(0,A.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),z=(0,C.Ps)(f||(f=(0,A.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String) {\n    items: SLA(\n      where: { name: { _ilike: $q }, type: { _eq: $type }, adminId: { _eq: $adminId } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),B=(0,C.Ps)(y||(y=(0,A.Z)(["\n  query GetSlasForSelectNew($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    items: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n    }\n  }\n"]))),V=(0,C.Ps)(h||(h=(0,A.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp, $limit: Int, $offset: Int) {\n    items: Account(where: $where, limit: $limit, offset: $offset, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),W=(0,C.Ps)(v||(v=(0,A.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),Q=(0,C.Ps)(g||(g=(0,A.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),J=(0,C.Ps)(b||(b=(0,A.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),X=(0,C.Ps)(x||(x=(0,A.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),Y=(0,C.Ps)(_||(_=(0,A.Z)(['\n  query GetCompliancesForSelect($q: String, $locationId: Int) {\n    items: Taxonomy(where: { type: { _eq: "complianceCategory" } }, order_by: { name: asc }) {\n      label: name\n      options: Compliances(\n        where: {\n          name: { _ilike: $q }\n          Compliance_Entities: { Location: { id: { _eq: $locationId } } }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),K=(0,C.Ps)(j||(j=(0,A.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"]))),ee=(0,C.Ps)(I||(I=(0,A.Z)(["\n  query GetSublocationsForSelect($locationId: Int!, $q: String, $limit: Int, $offset: Int) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]))),en=(0,C.Ps)(Z||(Z=(0,A.Z)(['\n  query GetTaxonomy($q: String, $id: Int, $limit: Int, $offset: Int) {\n    items: Taxonomy(\n      where: {\n        id: { _eq: $id }\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),et=(0,C.Ps)($||($=(0,A.Z)(["\n  query GetTaxonomyForSelect(\n    $where: Taxonomy_bool_exp\n    $limit: Int\n    $offset: Int\n    $orderBy: Taxonomy_order_by!\n  ) {\n    items: Taxonomy(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      value: id\n      label: name\n    }\n  }\n"])));(0,C.Ps)(q||(q=(0,A.Z)(['\n  query GetTagsForTask($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']))),(0,C.Ps)(w||(w=(0,A.Z)(['\n  query GetTagsForEntity(\n    $entityId: Int\n    $entity: String!\n    $q: String!\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    tags: Taxonomy(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: "active" }\n        type: { _eq: "taskTags" }\n        _not: { Taxonomy_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']))),(0,C.Ps)(O||(O=(0,A.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n'])));var er=(0,C.Ps)(P||(P=(0,A.Z)(["\n  query GetCustomerManagers($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: { Account_Users: { accountId: { _eq: $accountId } }, fullName: { _ilike: $q } }\n      order_by: { fullName: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n"]))),eo=(0,C.Ps)(S||(S=(0,A.Z)(["\n  query GetServiceSchedulesForSelect(\n    $q: String\n    $serviceId: Int\n    $entity: service_schedule_entity\n    $entityId: Int\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: ServiceSchedule(\n      where: {\n        name: { _ilike: $q }\n        serviceId: { _eq: $serviceId }\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),ei=(0,C.Ps)(k||(k=(0,A.Z)(['\n  query GetPropertyById($id: Int!) {\n    item: Location_by_pk(id: $id) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n'])))},71772:function(e,n,t){"use strict";t.d(n,{P:function(){return $}});var r=t(59499),o=t(50029),i=t(4730),a=t(64687),s=t.n(a),c=t(67294),u=t(10367),d=t(66252),l=t(76301),m=t(78289),p=t(52019),f=t(49501),y=t(9270),h=t(62140),v=t(84043),g=t(77439),b=t(85893),x=["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"];function _(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var I=function(e,n){var t,r,o,i=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(i=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(t){e[t]!==n[t]&&(i=!1)}),i},Z=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,o=e.entity,i=e.entityId,a=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,u=e.taxonomyGroupType,d=e.customerId,m=e.customerRole,p=e.type,f=e.userId,y=e.invoiceThreshold,h=e.quoteThreshold,v=p;switch(m&&(v="".concat(p,"_").concat(m)),v){case"address":return{query:l.cz,variables:{entity:o,entityId:i}};case"asset":return{query:l.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:l.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:l.nD,variables:{id:a}};case"assetSublocation":return{query:l.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"compliance":return{query:l.kU,variables:{locationId:s}};case"coverage":return{query:l.j$};case"customer":return{query:l.SW};case"job":return{query:l.Qn,variables:{locationId:s}};case"manager":return{query:l.he,variables:{accountId:n,userId:f}};case"thresholdManagers":return{query:l.Ak,variables:{accountId:n,userId:f,invoiceThreshold:y,quoteThreshold:h}};case"product":return{query:l.UH,variables:{category:"product",locationId:s}};case"property":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:l.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:l.kx};case"sla":return{query:l.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:l.zR,variables:{locationId:s}};case"supplier":var g={type:{_eq:"supplier"}};return t&&(g.PostcodeAreas={PostcodeArea:{area:{_eq:t}},entity:{_eq:"Account"},status:{_eq:"active"}}),c&&(g.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:c}},t&&(g.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:t}}})),{query:l.by,variables:{where:g}};case"user":return{query:l.yR,variables:{accountId:n}};case"usersForBookings":return{query:l.yR,variables:{accountId:f}};case"tenant":return{query:l.RJ};case"taxonomyGroup":return{query:l.Cj,variables:{type:u}};case"expenseCategory":return{query:l.Ve};default:return{query:l.qd}}},$=(0,c.memo)(function(e){var n,t=e.AddForm,r=e.accountId,a=e.area,u=e.assetCategoryId,l=e.control,_=e.entity,I=e.entityId,$=e.errors,w=e.id,O=e.isClearable,P=e.isDisabled,S=e.label,k=e.locationId,A=e.name,C=e.serviceId,D=e.taxonomyGroupType,U=e.customerId,L=e.customerRole,T=e.type,F=e.userId,M=e.invoiceThreshold,G=e.quoteThreshold,N=(0,i.Z)(e,x),E=(0,d.x)(),R=(0,c.useState)(!1),H=R[0],z=R[1],B=(0,c.useState)(),V=B[0],W=B[1],Q=(0,c.useState)(!1),J=Q[0],X=Q[1],Y=(0,c.useContext)(m.Z),K=(0,c.useContext)(p.Z).hasRole,ee=(0,c.useState)(!1),en=ee[0],et=ee[1];(0,c.useEffect)(function(){return et(!1),X(!1),function(){}},[r,u,_,I,k,C,T,U,L,F]);var er=(n=(0,o.Z)(s().mark(function e(){var n,t,o,i,c,d,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!J){e.next=3;break}return et(!0),e.abrupt("return",null);case 3:return z(!0),t=(n=Z({accountId:r,area:a,assetCategoryId:u,entity:_,entityId:I,hasRole:K,id:w,locationId:k,serviceId:C,taxonomyGroupType:D,customerId:U,customerRole:L,type:T,userId:F,invoiceThreshold:M,quoteThreshold:G})).query,i=void 0===(o=n.variables)?{}:o,e.next=7,E.query({query:t,variables:j({},i)});case 7:W((d=void 0===(d=e.sent.data)?{items:[]}:d).items),z(!1),X(!0),et(!0);case 15:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),eo=function(){Y.show({content:(0,b.jsx)("div",{children:(0,b.jsx)(t,{})}),title:"Add form"})};return(0,b.jsx)(f.Z,{id:A,label:S,children:(0,b.jsxs)(y.Z,{children:[(0,b.jsx)(h.Z,{md:t?11:12,children:(0,b.jsx)(v.Z,j({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:l,errors:$,isDisabled:P,isClearable:O,isLoading:H,menuIsOpen:en,options:V,onFocus:er,onBlur:function(){et(!1)},name:A,searchable:!0},N),N.defaultValue)}),t&&(0,b.jsx)(h.Z,{md:1,children:(0,b.jsx)(q,{children:(0,b.jsx)(g.Z,{content:null,startIcon:"plus",size:"sm",onClick:eo})})})]})})},I),q=u.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-v7qj9m-0"})(["position:relative;right:25px;top:2px;"]);$.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},32836:function(e,n,t){"use strict";t.d(n,{i:function(){return $}});var r=t(59499),o=t(67294),i=t(11163),a=t(83148),s=t(26447),c=t(15861),u=t(90948),d=t(5616),l=t(41796),m=t(87361),p=t(42096),f=t(87043),y=t(61730),h=t(58886),v=t(70872),g=t(85893);function b(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?b(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _=function(e){var n=e.currentPage,t=e.totalCount,r=e.pageSize,o=e.onPageChange,i=(0,y.Z)("(max-width:400px)"),a=(0,y.Z)("(max-width:500px)");return(0,g.jsx)(j,{mb:2,page:n,count:Math.ceil(t/r),onChange:function(e,n){return o(n)},variant:"outlined",shape:"rounded",size:i?"small":"medium",hidePrevButton:1===n,hideNextButton:n===Math.ceil(t/r),siblingCount:a?0:1,renderItem:function(e){return(0,g.jsx)(h.Z,x({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};_.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}};var j=(0,u.ZP)(v.Z)(function(e){var n,t=e.hidePrevButton,o=e.hideNextButton,i=e.theme;return n={},(0,r.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(n,"& button.Mui-selected",x(x({color:i.palette.white.main,backgroundColor:i.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{}),t?{borderRadius:"5px 0 0 5px"}:{})),n});function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var $=(0,o.forwardRef)(function(e,n){var t=e.columns,r=e.history,a=e.initialSort,u=e.meta,d=e.refetch,l=e.paginationSize,y=e.containerHeight,h=e.noResultsMessage,v=e.autoHeight,b=(0,i.useRouter)(),x=b.query,j=void 0===x?{}:x,I=(0,o.useState)(parseInt(null==j?void 0:j.page,10)||1),$=I[0],O=I[1],P=(0,o.useState)(l||f.C1.paginationSize),S=P[0],k=P[1];a||(a={item:"createdAt",order:"desc"});var A=(0,o.useState)({item:a.item,order:a.order}),C=A[0],D=A[1],U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=b.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var r=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(r)},L=function(){D({item:a.item,order:a.order}),O(1);var e=U();b.push(e),k(l||f.C1.paginationSize)};(0,o.useImperativeHandle)(n,function(){return{currentPage:$,pageSize:S,sort:C,resetPagination:function(){L()}}});var T=function(e){var n=U(e);r&&b.push(n),O(e),!r&&d&&d()},F=function(e){e&&e.field&&e.sort?(D({item:t.find(function(n){return n.field===e.field}).sortName||e.field||e.item||a.item,order:e.sort||e.order||a.order}),d&&d()):(D({item:a.item,order:a.order}),d&&d())};return(0,g.jsxs)(q,{containerHeight:y,children:[(0,g.jsx)(w,Z({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:v,sortingMode:"server",onSortModelChange:function(e){return F(e[0])},columns:t,pageSize:S,slots:{columnSortedAscendingIcon:function(){return(0,g.jsx)(m.Z,{})},columnSortedDescendingIcon:function(){return(0,g.jsx)(p.Z,{})},columnUnsortedIcon:function(){return(0,g.jsxs)(s.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,g.jsx)(m.Z,{sx:{marginBottom:"-15px"}}),(0,g.jsx)(p.Z,{})]})},noResultsOverlay:function(){return(0,g.jsx)(s.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,g.jsx)(c.Z,{children:h})})},noRowsOverlay:function(){return(0,g.jsx)(s.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,g.jsx)(c.Z,{children:h})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/S)>1&&(0,g.jsx)(_,{currentPage:$,totalCount:u.aggregate.totalCount,pageSize:S,onPageChange:T})]})});$.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var q=(0,u.ZP)(d.Z)(function(e){return{height:e.containerHeight,display:"flex",flexDirection:"column"}}),w=(0,u.ZP)(a.s)(function(e){var n,t=e.theme,o=e.hideHeader,i=(e.rows,e.loading,e.rowHeight),a=e.isPdf;return n={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(n,"&.MuiDataGrid-root",Z({color:t.palette.black.main,border:"none"},a&&{"@media print":{display:"block"}})),(0,r.Z)(n,"& .MuiDataGrid-main",Z({},a&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-columnHeaders",Z(Z({},o&&{display:"none"}),{},{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(n,"& .MuiDataGrid-virtualScroller",Z(Z({},o&&{marginTop:"0 !important"}),a&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(n,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerContent",Z({},a&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerRenderZone",Z({},a&&{position:"relative"})),(0,r.Z)(n,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,r.Z)(n,"& .MuiDataGrid-row",Z({},a&&{minHeight:"".concat(i,"cm !important"),maxHeight:"".concat(i,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cell",Z({},a&&{minHeight:"".concat(i,"cm !important"),maxHeight:"".concat(i,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,l.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,l.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,l.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,l.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),n})},19796:function(e,n,t){"use strict";t.d(n,{H:function(){return B}});var r,o,i=t(59499),a=t(27812),s=t(67294),c=t(6812),u=t(42283),d=t(79665),l=t(69368),m=t(26447),p=t(15861),f=t(98456),y=t(5616),h=t(94054),v=t(56815),g=t(50135),b=t(76600),x=t(49501),_=t(95103),j=t(55563),I=t(90951),Z=t(3915),$=t(18902),q=t(74231),w=(0,q.Ry)().shape({nameFirst:(0,q.Z_)().required(),nameLast:(0,q.Z_)().required(),email:(0,q.Z_)().required().email(),phone:(0,q.Z_)().required(),status:(0,q.Z_)().when("$hasRole",function(e){return e?(0,q.Z_)().oneOf(["active","inactive"]).required():void 0}),invoiceThreshold:(0,q.Rx)().nullable(!0).transform(function(e){return isNaN(e)?null:e}),quoteThreshold:(0,q.Rx)().nullable(!0).transform(function(e){return isNaN(e)?null:e}),role:(0,q.Z_)().when(["$hasRole","$hasOneOwner","accountId"],function(e,n,t){if(e)return n?(0,q.Z_)().oneOf(["owner"],"Each account must have a designated owner.\n          If you would like to change the account type on this user,\n          please create another user account and designate this new account as an owner."):t&&t.length>0&&(0,q.Z_)().required()}),position:(0,q.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,q.Z_)()}),isContact:(0,q.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,q.Z_)().oneOf(["yes","no"]).required()}),location:(0,q.IX)().when("$hasLocation",function(e){return e?(0,q.IX)().of((0,q.Rx)().integer().required()).required():void 0})}),O=t(72936),P=t(69496),S=t(42846),k=t(60092),A=t(63928),C=t(50480),D=t(85893),U=function(e){var n=e.name,t=e.control,r=e.permissions,o=e.styles;return(0,D.jsxs)(y.Z,{sx:o,children:[(0,D.jsx)(p.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,D.jsx)(m.Z,{spacing:1,direction:"row",children:r.map(function(e){return(0,D.jsx)(u.Qr,{name:"".concat(n?n+".":"").concat(e.name),control:t,render:function(n){var t=n.value,r=n.onChange;return(0,D.jsx)(C.Z,{color:"dark.main",control:(0,D.jsx)(l.Z,{color:"secondary",checked:t,onChange:function(e){return r(e.target.checked)}}),label:e.label})}})})})]})};U.defaultProps={permissions:[]};var L={customer_user:[{label:"Job reports",name:"jobReports"},{label:"PPM Schedules",name:"ppmSchedules"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}]},T=t(71383),F=t(75063),M=(0,F.Ps)(r||(r=(0,T.Z)(["\n  query GetUserEditOffCanvas($userId: Int!, $accountId: Int, $includeAccount: Boolean!) {\n    user: User_by_pk(id: $userId) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      accounts: Account_Users(where: { accountId: { _eq: $accountId } })\n        @include(if: $includeAccount) {\n        id\n        role\n        position\n        isContact\n        status\n        modules\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n  }\n"]))),G=(0,F.Ps)(o||(o=(0,T.Z)(['\n  query FindOwnersByAccount($accountId: Int, $userId: Int) {\n    accountUsers: Account_User(\n      where: { role: { _eq: "owner" }, accountId: { _eq: $accountId }, userId: { _neq: $userId } }\n    ) {\n      id\n      role\n    }\n  }\n']))),N=t(32836);function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(Object(t),!0).forEach(function(n){(0,i.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var H=["customer_user"],z=["customer_user","tenant_user"],B=function(e){var n,t=e.userId,r=e.accountId,o=e.accountType,i=e.submit,q=(0,O.x)(),C=q.hasRole,T=q.user,F=(0,S.x)({filters:{}}),E=F.initialData,B=F.ref,V=(0,s.useState)(!0),W=V[0],Q=V[1],J=(0,s.useState)(""),X=J[0],Y=J[1],K=(0,s.useState)(null),ee=K[0],en=K[1],et=(0,u.cI)({defaultValues:{id:t,accountId:r},resolver:(0,d.S)(w),context:{hasRole:(0,A.t4)(o,C),hasLocation:!H.includes(T.role)&&H.includes(X),hasOneOwner:W}}),er=et.control,eo=et.errors,ei=et.handleSubmit,ea=et.register,es=et.watch,ec=et.reset,eu=et.setValue,ed=es("role"),el=es("location");(0,s.useEffect)(function(){Y("".concat(o,"_").concat(ed))},[o,ed]);var em=(0,c.a)(M,{skip:!t,variables:{userId:t,accountId:r,includeAccount:!!r},onCompleted:function(e){var n,t=e.user,i={id:t.id,accountId:t.accountId,nameFirst:t.nameFirst||"",nameLast:t.nameLast||"",email:t.email||"",phone:t.phone||"",invoiceThreshold:t.invoiceThreshold,quoteThreshold:t.quoteThreshold,role:"",position:"",isContact:"",status:"active",meta:t.meta},a=null===(n=t.accounts)||void 0===n?void 0:n.find(function(e){return e.account.id===r});a&&(i.accountUserId=a.id,i.accountId=a.account.id,i.role=a.role,i.position=a.position,i.isContact=!0===a.isContact?"yes":"no",i.status=a.status,i.location=a.userLocations.map(function(e){return e.accountLocationId}),i.modules=a.modules),ec(i),Y("".concat(o,"_").concat(i.role)),en(i.accountUserId)}}),ep=em.data,ef=(ep=void 0===ep?{}:ep).user,ey=em.loading;(0,c.a)(G,{skip:!r,variables:{accountId:r,userId:t},onCompleted:function(e){Q(!(e.accountUsers.length>0))}});var eh=(0,c.a)(P.ZA,{variables:R(R({},E),{},{accountId:r})}),ev=eh.data,eg=(ev=void 0===ev?{location:[],meta:{aggregate:{totalCount:0}}}:ev).location,eb=ev.meta,ex=eh.loading,e_=eh.refetch,ej=(0,a.Z)($.I);switch(o){case"supplier":ej.push({text:"Operative",value:"contractor"});break;case"admin":ej.push({text:"Helpdesk",value:"helpdesk"})}var eI={control:er,errors:eo,register:ea},eZ=function(e){i(e,null==ef?void 0:ef.meta)},e$=(0,s.useCallback)(function(e){return function(n){n.target.checked?eu("location",[].concat((0,a.Z)(null!=el?el:[]),[e])):eu("location",el.filter(function(n){return n!==e}))}},[el,eu]),eq=(0,s.useMemo)(function(){return[{sortable:!1,minWidth:10,field:"id",headerName:"",renderCell:function(e){var n=e.row;return(0,D.jsx)(l.Z,{color:"secondary",checked:null==el?void 0:el.includes(n.id),onChange:e$(n.id)})}},{sortable:!1,flex:1,field:"name",headerName:"Name"},{sortable:!1,flex:1,field:"address",headerName:"Address",renderCell:function(e){var n=e.row;return n.address?(0,D.jsxs)(m.Z,{children:[(0,D.jsx)(p.Z,{children:n.address.addressLine1}),(0,D.jsx)(p.Z,{children:n.address.postCode})]}):(0,D.jsx)(p.Z,{children:"Please add"})}}]},[el,e$]);if(ey)return(0,D.jsx)(m.Z,{widht:"100%",alignItems:"center",children:(0,D.jsx)(f.Z,{color:"secondary"})});var ew={id:(0,A.t4)(o,C)};return(0,D.jsxs)(b.Z,{id:"offCanvasForm",handleSubmit:ei(eZ),children:[(0,D.jsx)(Z.q,R({},eI)),r&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(y.Z,{children:[(0,A.t4)(o,C)&&(0,D.jsx)(h.Z,{fullWidth:!0,error:eo.role,children:(0,D.jsxs)(x.Z,{label:"Role",children:[(0,D.jsx)(_.Z,R(R({},eI),{},{name:"role",options:ej})),(0,D.jsx)(v.Z,{sx:{margin:0},children:null===(n=eo.role)||void 0===n?void 0:n.message})]})}),(0,D.jsx)(x.Z,{label:"Position / Job title",children:(0,D.jsx)(j.Z,R(R({},eI),{},{name:"position"}))}),(0,A.pP)({accountType:o,role:ed,hasRole:C})&&(null==ef?void 0:ef.id)!==T.id&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(x.Z,{label:"Threshold limit / Invoice",children:(0,D.jsx)(g.Z,{inputRef:ea,inputProps:{min:0},size:"small",name:"invoiceThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(k.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})}),(0,D.jsx)(x.Z,{label:"Threshold limit / Quote",children:(0,D.jsx)(g.Z,{inputRef:ea,inputProps:{min:0},size:"small",name:"quoteThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(k.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})})]}),(0,D.jsx)(I.Z,R(R({},eI),{},{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),z.includes(X)&&t!==T.id&&(0,D.jsx)(U,{name:"modules",control:er,permissions:L[X],styles:{mb:2}})]}),(0,D.jsx)(y.Z,{children:H.includes(X)&&t!==T.id&&(0,D.jsxs)(x.Z,{label:"Locations",children:[(0,D.jsx)(N.i,{columnVisibilityModel:ew,columns:eq,loading:ex,meta:eb,ref:B,refetch:e_,rows:eg.map(function(e){var n;return{id:e.accountLocations[0].id,name:e.name,address:null===(n=e.addresses[0])||void 0===n?void 0:n.address}})}),(0,D.jsx)("input",R(R({},ea("location")),{},{type:"hidden"}))]})})]}),t&&(0,D.jsx)(j.Z,R(R({},eI),{},{name:"id",type:"hidden"})),r&&(0,D.jsx)(j.Z,R(R({},eI),{},{name:"accountId",type:"hidden"})),ee&&(0,D.jsx)(j.Z,R(R({},eI),{},{name:"accountUserId",type:"hidden"}))]})}},63928:function(e,n,t){"use strict";t.d(n,{pP:function(){return d},qF:function(){return c},t4:function(){return u},te:function(){return s}});var r=t(27812),o=t(59499),i=t(19015);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var s=function(e,n,t){var r={};return e.id?(r.id=parseInt(e.id),r.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},n),invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null},e.accountUserId?(r.updateAccountUser=!0,r.accountUserId=parseInt(e.accountUserId),r.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status,modules:e.modules}):(r.accountUserId=0,r.updateAccountUser=!1)):(r.role=e.role||"user",r.position=e.position,r.isContact="yes"===e.isContact,r.status=e.status,r.accountId=e.accountId,r.modules=e.modules,t?r.userId=t.id:r.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0},invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null}}),r},c=function(e){return{accountUserId:e.accountUserId,objects:e.location.map(function(n){return{accountUserId:e.accountUserId,accountLocationId:n}})}},u=function(e,n){return"customer"!==e&&"supplier"!==e||n([].concat((0,r.Z)(i.td),(0,r.Z)(i.Sf),(0,r.Z)(i.n),(0,r.Z)(i.nx)))},d=function(e){var n=e.accountType,t=e.role,r=e.hasRole;return r(["admin_owner","customer_owner","supplier_owner"])?!["admin_owner","customer_owner","supplier_owner"].includes("".concat(n,"_").concat(t)):r(["customer_manager","supplier_manager"])?["admin_user","customer_user","supplier_user"].includes("".concat(n,"_").concat(t)):!!r(["admin_manager"])&&["admin_user","customer_user","supplier_user","customer_manager","supplier_manager"].includes("".concat(n,"_").concat(t))}},3915:function(e,n,t){"use strict";t.d(n,{q:function(){return v}});var r=t(27812),o=t(59499),i=t(9270),a=t(62140),s=t(49501),c=t(55563),u=t(70982),d=t(95103),l=t(26380),m=t(72936),p=t(19015),f=t(85893);function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var v=function(e){var n=e.errors,t=e.prefix,o=e.register,y=(0,m.x)().hasRole,v={errors:n,register:o};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(i.Z,{children:[(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"First name",children:(0,f.jsx)(c.Z,h(h({},v),{},{name:"".concat(t,"nameFirst")}))})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"Last name",children:(0,f.jsx)(c.Z,h(h({},v),{},{name:"".concat(t,"nameLast")}))})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsxs)(s.Z,{label:"Email",children:[(0,f.jsx)(c.Z,h(h({},v),{},{name:"".concat(t,"email"),type:"email"})),n["".concat(t,"email")]&&"duplicate"===n["".concat(t,"email")].type&&(0,f.jsx)(u.Z,{message:n["".concat(t,"email")].message})]})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"Mobile",children:(0,f.jsx)(c.Z,h(h({},v),{},{name:"".concat(t,"phone")}))})})]}),y([].concat((0,r.Z)(p.td),(0,r.Z)(p.Sf),(0,r.Z)(p.n),(0,r.Z)(p.nx)))&&(0,f.jsx)(s.Z,{label:"Status",children:(0,f.jsx)(d.Z,h(h({},v),{},{name:"".concat(t,"status"),options:l.bg}))}),(0,f.jsx)(c.Z,h(h({},v),{},{name:"".concat(t,"userId"),type:"hidden"}))]})};v.defaultProps={prefix:""}},69496:function(e,n,t){"use strict";t.d(n,{$E:function(){return L},AX:function(){return Z},I4:function(){return I},JA:function(){return q},MT:function(){return k},Px:function(){return O},WF:function(){return w},ZA:function(){return M},a8:function(){return P},fA:function(){return U},fo:function(){return $},ge:function(){return F},iM:function(){return D},nE:function(){return A},nh:function(){return C},r1:function(){return S},tW:function(){return G},uz:function(){return T}});var r,o,i,a,s,c,u,d,l,m,p,f,y,h,v,g,b,x,_=t(71383),j=t(75063),I=(0,j.Ps)(r||(r=(0,_.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),Z=(0,j.Ps)(o||(o=(0,_.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),$=(0,j.Ps)(i||(i=(0,_.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),q=(0,j.Ps)(a||(a=(0,_.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),w=(0,j.Ps)(s||(s=(0,_.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]))),O=(0,j.Ps)(c||(c=(0,_.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]))),P=(0,j.Ps)(u||(u=(0,_.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]))),S=(0,j.Ps)(d||(d=(0,_.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]))),k=(0,j.Ps)(l||(l=(0,_.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]))),A=(0,j.Ps)(m||(m=(0,_.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),C=(0,j.Ps)(p||(p=(0,_.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]))),D=(0,j.Ps)(f||(f=(0,_.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]))),U=(0,j.Ps)(y||(y=(0,_.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),L=(0,j.Ps)(h||(h=(0,_.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]))),T=(0,j.Ps)(v||(v=(0,_.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]))),F=(0,j.Ps)(g||(g=(0,_.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']))),M=(0,j.Ps)(b||(b=(0,_.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),G=(0,j.Ps)(x||(x=(0,_.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"])))},3654:function(e,n,t){"use strict";t.d(n,{i:function(){return v}});var r=t(50029),o=t(16835),i=t(64687),a=t.n(i),s=t(93645),c=t(50319),u=t(69496),d=t(77439),l=t(27812),m=t(59499);function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach(function(n){(0,m.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var y=function(e,n){var t=Object.values(e.integration.google).filter(function(e){return e.profile.email!==n});return Object.assign({},e,{integration:f(f({},e.integration),{},{google:(0,l.Z)(t)})})},h=t(85893),v=function(e){var n,t,i=e.credentials,l=i.id,m=i.type,p=e.isLoggedIn,f=e.refetch,v=e.meta,g=e.email,b=(0,c.D)(u.a8,{onCompleted:f}),x=(0,o.Z)(b,1)[0],_=(0,c.D)(u.$E,{onCompleted:f}),j=(0,o.Z)(_,1)[0],I=(0,c.D)(u.uz,{onCompleted:f}),Z=(0,o.Z)(I,1)[0],$=(n=(0,r.Z)(a().mark(function e(n){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.code){e.next=8;break}if("admin"!==m){e.next=6;break}return e.next=4,x({variables:{code:n.code,id:l,type:m}});case 4:e.next=8;break;case 6:return e.next=8,x({variables:{code:n.code,id:l,type:m}});case 8:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),q=(t=(0,r.Z)(a().mark(function e(){var n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=y(v,g),e.t0=m,e.next="admin"===e.t0?4:"user"===e.t0?7:10;break;case 4:return e.next=6,j({variables:{accountId:l,set:{meta:n}}});case 6:case 9:case 10:return e.abrupt("break",11);case 7:return e.next=9,Z({variables:{userId:l,meta:n}});case 11:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)}),w=function(e){};return p?(0,h.jsx)(s.GoogleLogout,{clientId:"69900974658-9rikek80a7b20gcigfeo3fv0r3qilqtp.apps.googleusercontent.com",onLogoutSuccess:q,onFailure:w,render:function(e){return(0,h.jsx)(d.Z,{context:"secondary",content:"Sign Out",onClick:e.onClick,size:"sm"})}}):(0,h.jsx)(s.GoogleLogin,{accessType:"offline",prompt:"select_account",clientId:"69900974658-9rikek80a7b20gcigfeo3fv0r3qilqtp.apps.googleusercontent.com",isSignedIn:!0,onSuccess:$,onFailure:$,render:function(e){return(0,h.jsx)(d.Z,{context:"secondary",content:"Sign In",onClick:e.onClick,size:"sm"})},responseType:"code",scope:"https://mail.google.com"})}},74122:function(e,n,t){"use strict";t.d(n,{e:function(){return p}});var r=t(50029),o=t(16835),i=t(64687),a=t.n(i),s=t(50319),c=t(69496),u=t(77439),d=t(85893),l=function(e){var n=e.signOutHandler;return(0,d.jsx)(u.Z,{context:"secondary",content:"Sign Out",onClick:n,size:"sm"})},m=function(e){var n=e.handleLogin;return(0,d.jsx)(u.Z,{context:"secondary",content:"Sign In",onClick:n,size:"sm"})},p=function(e){var n,t,i=e.credentials,u=i.id,p=i.type,f=e.isLoggedIn,y=e.refetch,h=e.email,v=(0,s.D)(c.r1),g=(0,o.Z)(v,1)[0],b=(0,s.D)(c.MT,{onCompleted:y}),x=(0,o.Z)(b,1)[0],_=(n=(0,r.Z)(a().mark(function e(){var n,t,r,o,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){var n=e.url,t=e.title,r=e.w,o=e.h,i=void 0!==window.screenLeft?window.screenLeft:window.screenX,a=void 0!==window.screenTop?window.screenTop:window.screenY,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,u=s/window.screen.availWidth,d=(s-r)/2/u+i,l=(c-o)/2/u+a,m=window.open(n,t,"\n\n        width=".concat(r/u,",\n        height=").concat(o/u,",\n        top=").concat(l,",\n        left=").concat(d,"\n        "));window.focus&&m.focus()},e.next=3,g({variables:{id:u,type:p}});case 3:if(!(t=e.sent).error){e.next=8;break}return e.abrupt("return",console.error("Error:",t.error));case 8:(i=(null==t?void 0:null===(r=t.data)||void 0===r?void 0:r.genenrateMSURL).url)&&n({url:i,title:"microsoft",h:690,w:650});case 10:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),j=(t=(0,r.Z)(a().mark(function e(){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x({variables:{id:u,type:p,email:h}});case 2:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)});return f?(0,d.jsx)(l,{signOutHandler:j}):(0,d.jsx)(m,{handleLogin:_})}},93673:function(e,n,t){"use strict";t.d(n,{x:function(){return r}});var r=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},86559:function(e,n,t){"use strict";t.d(n,{Y:function(){return r}});var r=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},26380:function(e,n,t){"use strict";t.d(n,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},18902:function(e,n,t){"use strict";t.d(n,{I:function(){return r}});var r=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]},17715:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eK}});var r,o,i,a,s,c,u,d=t(19076),l=t(67294),m=t(11163),p=t(6812),f=t(69496),y=t(52019),h=t(9270),v=t(62140),g=t(53344),b=t(59499),x=t(71383),_=t(75063),j=(0,_.Ps)(r||(r=(0,x.Z)(["\n  mutation addHoliday($objects: [Holiday_insert_input!]!) {\n    insert_Holiday(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),I=(0,_.Ps)(o||(o=(0,x.Z)(["\n  mutation updateHoliday($changes: Holiday_set_input = {}, $id: Int!) {\n    update_Holiday_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),Z="{ User: { id: { _eq: $userId } }, meta: $meta }\norder_by: { startDate: asc, endDate: asc }",$=(0,_.Ps)(i||(i=(0,x.Z)(["\n  query GetHoliday($userId: Int!, $meta: jsonb_comparison_exp = {},$limit: Int,$offset: Int) {\n    Holiday(\n      limit: $limit\n      offset: $offset\n      where: ","\n    ) {\n      createdAt\n      endDate\n      id\n      notes\n      startDate\n      status\n      userId\n      AlternativeUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n      }\n      User {\n        id\n        nameFirst\n        nameLast\n        fullName\n      }\n    }\n    meta: Holiday_aggregate(where:",") {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"])),Z,Z);(0,_.Ps)(a||(a=(0,x.Z)(['\n  query Holiday($startDate: timestamptz = "", $endDate: timestamptz = "", $userId: Int) {\n    events: Holiday(\n      where: {\n        _and: { startDate: { _gte: $startDate }, endDate: { _lte: $endDate } }\n        User: { id: { _eq: $userId } }\n      }\n    ) {\n      startDate\n      endDate\n      createdAt\n      id\n      notes\n      status\n      userId\n      User {\n        id\n        nameFirst\n        nameLast\n        fullName\n      }\n      AlternativeUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n      }\n    }\n  }\n'])));var q=t(78289),w=t(26186),O=t(34613),P=t(68956),S=t(16551),k=t(77439),A=t(58965),C=t(67872),D=t(50029),U=t(16835),L=t(64687),T=t.n(L),F=t(50319),M=t(42283),G=t(79665),N=t(76600),E=t(49501),R=t(95103),H=t(6710),z=t(52220),B=t(71772),V=t(26380),W=t(74231),Q=t(72936),J=t(85893);function X(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?X(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):X(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var K=function(e){var n,t,r=e.defaultValues,o=e.userId,i=e.onSuccess,a=(0,Q.x)(),s=a.hasRole,c=a.user,u=s(["admin","superadmin"])&&!o,d=(0,M.cI)({defaultValues:r,resolver:(0,G.S)((0,W.Ry)().shape({startDate:(0,W.hT)().required(),endDate:(0,W.hT)().required().min((0,W.iH)("startDate"),"start date should be greater than end date"),meta:(0,W.Z_)(),notes:(0,W.Z_)(),alternativeUser:(0,W.Ry)().required(),user:u?(0,W.Ry)().required():(0,W.Ry)(),status:(0,W.Z_)().oneOf(["active","inactive"]).required()}))}),l=d.control,m=d.errors,p=d.handleSubmit,f=d.register,y=(0,F.D)(j,{onCompleted:function(){i&&i()}}),h=(0,U.Z)(y,1)[0],v=(0,F.D)(I,{onCompleted:function(){i&&i()}}),g=(0,U.Z)(v,1)[0],b=(t=(0,D.Z)(T().mark(function e(n){var t;return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n).alternativeUserId=n.alternativeUser.value,t.user&&t.user.value?t.userId=t.user.value:t.userId=o,delete t.alternativeUser,t.user&&delete t.user,!r.id){e.next=10;break}return e.next=8,g({variables:{id:r.id,changes:t}});case 8:e.next=12;break;case 10:return e.next=12,h({variables:{objects:[t]}});case 12:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),x={control:l,errors:m,register:f};return(0,J.jsxs)(N.Z,{id:"offCanvasForm",handleSubmit:p(b),children:[u&&(0,J.jsx)(B.P,Y(Y({},x),{},{errors:Y({},m),accountId:c.accountId,label:"User",name:"user",type:"user"})),(0,J.jsx)(B.P,Y(Y({},x),{},{errors:Y({},m),accountId:c.accountId,label:"Alternative User",name:"alternativeUser",type:"user"})),(0,J.jsx)(E.Z,{label:"Start date",children:(0,J.jsx)(z.M,Y(Y({},x),{},{dateFormat:"d MMM yyyy HH:mm",name:"startDate",placeholderText:"Click to select start date",showTimeSelect:!0}))}),(0,J.jsx)(E.Z,{label:"End date",children:(0,J.jsx)(z.M,Y(Y({},x),{},{name:"endDate",dateFormat:"d MMM yyyy HH:mm",placeholderText:"Click to select end date",showTimeSelect:!0}))}),(0,J.jsx)(E.Z,{label:"Status",children:(0,J.jsx)(R.Z,Y(Y({},x),{},{name:"status",options:V.bg}))}),(0,J.jsx)(E.Z,{label:"Notes",children:(0,J.jsx)(H.Z,Y(Y({},x),{},{name:"notes"}))})]})},ee=t(45697),en=function(e){var n=e.row,t=e.initialDate;return n?{id:n.id,alternativeUser:{value:n.AlternativeUser.id,label:n.AlternativeUser.fullName},user:{value:n.User.id,label:n.User.fullName},startDate:new Date(n.startDate),endDate:new Date(n.endDate),status:n.status.toLowerCase(),notes:n.notes}:{status:"active",startDate:t,endDate:t}};en.propTypes={row:ee.object,initialDate:ee.date};var et=t(42846);function er(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var eo=function(e){var n=e.userId,t=(0,et.x)({filters:{}}),r=t.initialData,o=t.ref,i=(0,l.useContext)(q.Z),a=(0,p.a)($,{variables:function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?er(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):er(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({userId:parseInt(n)},r)}),s=a.data,c=(s=void 0===s?{Holiday:[],meta:{aggregate:{totalCount:0}}}:s).Holiday,u=s.meta,d=a.refetch,m=a.loading,f=function(){d(),i.close()},y=function(e,t){e.stopPropagation(),i.show({content:(0,J.jsx)(K,{defaultValues:en({row:t}),userId:n,onSuccess:f}),title:t?"Edit":"Add Holiday"})},h=[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return"".concat((0,w.Z)(n.startDate)," ").concat((0,O.Z)(n.startDate))},sortable:!0,sortName:"startDate",text:"Start date"},{formatter:function(e){var n=e.row;return"".concat((0,w.Z)(n.endDate)," ").concat((0,O.Z)(n.endDate))},text:"End date"},{formatter:function(e){return e.row.AlternativeUser.fullName},text:"Alternative User"},{text:"Status"},{formatter:function(e){var n=e.row;return(0,w.Z)(n.createdAt)},text:"Created At"},{formatter:P.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:y,tooltip:"Edit"}],text:"Actions"}],v=function(){return(0,J.jsx)(S.Z,{children:(0,J.jsx)(k.Z,{context:"secondary",content:"Add Holiday",onClick:y,size:"sm"})})};return(0,J.jsx)(A.Z,{toolbar:(0,J.jsx)(v,{}),open:!0,title:"Holidays",children:(0,J.jsx)(C.t,{columns:h,loading:m,meta:u,ref:o,refetch:d,rows:c.map(function(e){return{id:e.id,userId:e.userId,AlternativeUser:e.AlternativeUser,User:e.User,notes:e.notes,startDate:e.startDate,endDate:e.endDate,status:e.status,createdAt:e.createdAt,actions:""}})})})},ei=(0,_.Ps)(s||(s=(0,x.Z)(["\n  query GetLogs($id: Int!) {\n    logs: audit_Session(order_by: { createdAt: desc }, where: { userId: { _eq: $id } }) {\n      id\n      app\n      appVersion\n      createdAt\n      userAgent\n    }\n    meta: audit_Session_aggregate {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),ea=t(86036),es=function(e){var n=e.log;return(0,J.jsxs)(N.Z,{id:"offCanvasForm",children:[(0,J.jsx)(ea.Z,{content:"App:",text:n.app}),(0,J.jsx)(ea.Z,{content:"Date:",text:n.createdAt}),(0,J.jsx)(ea.Z,{content:"App Version:",text:n.appVersion}),(0,J.jsx)(ea.Z,{content:"User Agent:",text:n.userAgent})]})},ec=function(e){var n=e.userId,t=(0,et.x)({filters:{}}).ref,r=(0,l.useContext)(q.Z),o=(0,p.a)(ei,{variables:{id:parseInt(n)}}),i=o.data,a=(i=void 0===i?{logs:[],meta:{aggregate:{totalCount:0}}}:i).logs,s=i.meta,c=o.loading,u=o.refetch,d=function(e){r.show({content:(0,J.jsx)(es,{log:e}),submit:!1,title:"Log Details"})};return!c&&(0,J.jsx)(A.Z,{open:!0,title:"User Logs",children:(0,J.jsx)(C.t,{columns:[{hidden:!0},{text:"App"},{text:"Date"},{hidden:!0,text:"User Agent"},{text:"App Version"}],history:!1,loading:c,meta:s,ref:t,refetch:u,rowClick:d,rows:a.map(function(e){return{id:e.id,app:e.app,createdAt:(0,w.Z)(e.createdAt,!0),userAgent:e.userAgent,appVersion:e.appVersion}})})})},eu=t(46165),ed=t(62466),el=t(74297),em=t(16540),ep=t(27812),ef=(0,_.Ps)(c||(c=(0,x.Z)(["\n  mutation addAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),ey=(0,_.Ps)(u||(u=(0,x.Z)(["\n  mutation UpdateAccountUser($id: Int!, $changes: Account_User_set_input) {\n    update_Account_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),eh=t(55563),ev=t(90951),eg=t(18902),eb=(0,W.Ry)().shape({accountSelected:(0,W.Ry)().required(),position:(0,W.Z_)().required(),role:(0,W.Z_)().required(),isContact:(0,W.Z_)().oneOf(["yes","no"]).required(),status:(0,W.Z_)().oneOf(["active","inactive"]).required()});function ex(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function e_(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ex(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ex(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ej=function(e){var n,t,r=e.defaultValues,o=e.onSuccess,i=(0,M.cI)({defaultValues:r,resolver:(0,G.S)(eb)}),a=i.control,s=i.errors,c=i.handleSubmit,u=i.register,d=i.watch,l=(0,F.D)(ef,{onCompleted:function(e){var n=e.insert_Account_User.returning[0].id;o&&o(n)}}),m=(0,U.Z)(l,1)[0],p=(0,F.D)(ey,{onCompleted:function(e){var n=e.update_Account_User_by_pk.id;o&&o(n)}}),f=(0,U.Z)(p,1)[0],y=d("accountSelected"),h=(t=(0,D.Z)(T().mark(function e(n){var t;return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n).isContact="yes"===t.isContact,t.accountId=t.accountSelected.value,delete t.accountSelected,!r.id){e.next=9;break}return e.next=7,f({variables:{id:r.id,changes:t}});case 7:e.next=11;break;case 9:return e.next=11,m({variables:{objects:[t]}});case 11:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),v="supplier"===((null==y?void 0:y.type)||(null==y?void 0:null===(n=y.account)||void 0===n?void 0:n.type))?[].concat((0,ep.Z)(eg.I),[{text:"Operative",value:"contractor"}]):eg.I,g={control:a,errors:s,register:u};return(0,J.jsxs)(N.Z,{id:"offCanvasForm",handleSubmit:c(h),children:[(0,J.jsx)(B.P,e_(e_({},g),{},{errors:e_({},s),label:"Account",name:"accountSelected"})),!!y&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(E.Z,{label:"Role",children:(0,J.jsx)(R.Z,e_(e_({},g),{},{name:"role",options:v}))}),(0,J.jsx)(E.Z,{label:"Position / Job title",children:(0,J.jsx)(eh.Z,e_(e_({},g),{},{name:"position"}))}),(0,J.jsx)(ev.Z,e_(e_({},g),{},{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),(0,J.jsx)(E.Z,{label:"Status",children:(0,J.jsx)(R.Z,e_(e_({},g),{},{name:"status",options:V.bg}))}),r.id?(0,J.jsx)(eh.Z,e_(e_({},g),{},{name:"id",type:"hidden"})):(0,J.jsx)(eh.Z,e_(e_({},g),{},{name:"userId",type:"hidden"}))]})]})},eI=function(e){var n=e.refetch,t=e.user,r=(0,l.useContext)(y.Z).hasRole,o=(0,l.useContext)(q.Z),i=Object.assign({},t);i.name="".concat(i.nameFirst," ").concat(i.nameLast);var a=function(){n(),o.close()},s=function(e,n){var r,i;e.stopPropagation(),null!==(r=n)&&void 0!==r&&r.id?(n.isContact=null===(i=n)||void 0===i?void 0:i.isContact.toLowerCase(),n.role=n.role.toLowerCase(),n.status=n.status.toLowerCase()):((n={}).isContact="no",n.status="active",n.userId=t.id),o.show({content:(0,J.jsx)(ej,{defaultValues:n,onSuccess:a}),title:n.id?"Edit":"Assign Account"})},c=[{hidden:!0},{formatter:(0,ed.Z)("","accountId","name","url"),text:"Account"},{text:"Type"},{text:"Role"},{text:"Position"},{text:"Contact"},{text:"Status"},{hidden:!0},{hidden:!r("admin"),formatter:P.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:s,tooltip:"Edit"}],text:"Actions"},{hidden:!0},{hidden:!0}],u=function(){return(0,J.jsx)(S.Z,{children:(0,J.jsx)(k.Z,{context:"secondary",content:"Assign Account",onClick:s,size:"sm"})})};return(0,J.jsx)(A.Z,{toolbar:r("admin")&&(0,J.jsx)(u,{}),open:!0,title:"Accounts",children:(0,J.jsx)(em.Z,{columns:c,rows:i.accounts.filter(function(e){return null!==e.account}).map(function(e){return{id:e.id,name:e.account.name,type:(0,el.Z)(e.account.type),role:(0,el.Z)(e.role),position:e.position||"N/A",isContact:e.isContact?"Yes":"No",status:(0,el.Z)(e.status),accountId:e.account.id,actions:"",url:"tenant"===e.account.type.toLowerCase()?"":"/dashboard/".concat(e.account.type.toLowerCase(),"s/view"),accountSelected:{label:e.account.name,type:e.account.type,value:e.account.id}}})})})},eZ=t(19796);function e$(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var eq=function(e){var n,t,r=e.refetch,o=e.user,i=(0,Q.x)(),a=i.user.id,s=i.hasRole,c=(0,l.useContext)(q.Z),u=Object.assign({},o),d=(0,F.D)(f.AX,{onCompleted:function(e){c.close(),r()}}),m=(0,U.Z)(d,1)[0],p=function(e){var n=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e$(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e$(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},e);delete n.userId,m({variables:{accountUserId:0,changes:n,id:n.id,updateAccountUser:!1}})},y=function(e){e.stopPropagation(),c.show({content:(0,J.jsx)(eZ.H,{userId:o.id,submit:p}),title:"Edit user"})},h=function(){return(0,J.jsx)(S.Z,{children:(0,J.jsx)(k.Z,{context:"secondary",content:"Edit",onClick:y,size:"sm"})})};u.name="".concat(u.nameFirst," ").concat(u.nameLast);var v=(null==u?void 0:null===(n=u.accounts)||void 0===n?void 0:n.filter(function(e){return!!e.account}))||[],g=s(["superadmin","admin"])||u.id===a;return(0,J.jsxs)(A.Z,{toolbar:s("admin")&&(0,J.jsx)(h,{}),open:!0,title:"Details",children:[(0,J.jsx)(ea.Z,{content:"Name",text:u.name}),g&&(0,J.jsx)(ea.Z,{content:"Email",text:u.email}),(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(ea.Z,{content:"Position",text:""}),v.length>1?v.map(function(e){return(0,J.jsx)(ea.Z,{content:"",text:"".concat(e.account.name,": ").concat(e.position||"N/A")})}):(0,J.jsx)(ea.Z,{content:"",text:(null===(t=v[0])||void 0===t?void 0:t.position)||"N/A"})]}),g&&(0,J.jsx)(ea.Z,{content:"Phone",text:u.phone}),(0,J.jsx)(ea.Z,{content:"Status",text:u.status}),(0,J.jsx)(ea.Z,{content:"Date Added",text:(0,w.Z)(u.createdAt)})]})},ew=t(34953),eO=t(51466),eP=t(74122),eS=t(3654);function ek(e){var n,t,r,o,i,a,s,c,u,d,l=(0,p.a)(f.nh,{variables:{id:e}}),m=l.loading,y=l.data,h=l.refetch,v={};v=null==y?void 0:null===(n=y.user)||void 0===n?void 0:n.meta;var g={google:!1,microsoft:!1,sage:!1};return m||(g={google:!!(null!==(t=v)&&void 0!==t&&null!==(r=t.integration)&&void 0!==r&&null!==(o=r.google)&&void 0!==o&&null!==(i=o.tokens)&&void 0!==i&&i.access_token),microsoft:!!(null!==(a=v)&&void 0!==a&&null!==(s=a.integration)&&void 0!==s&&null!==(c=s.microsoft)&&void 0!==c&&c.id),sage:!!(null!==(u=v)&&void 0!==u&&null!==(d=u.modules)&&void 0!==d&&d.sageIntegration&&v.modules.sageIntegration.length>0)}),{loading:m,data:{integration:g,meta:v},refetch:h}}ek.propTypes={accountId:ee.number.isRequired};var eA=function(e){var n=e.id,t=ek(n),r=t.data,o=r.integration,i=r.meta,a=t.refetch;return(0,J.jsxs)(A.Z,{fitParentHeight:!0,open:!0,title:"Integrations",children:[(0,J.jsxs)(h.Z,{align:"center",children:[(0,J.jsx)(v.Z,{md:2,children:(0,J.jsx)(ew.Z,{alt:"Microsoft Outlook",src:"/static/logo/Microsoft_Outlook-Logo.svg"})}),(0,J.jsxs)(v.Z,{md:6,children:[(0,J.jsx)(eO.Z,{content:"Microsoft Outlook"}),(0,J.jsx)(eO.Z,{content:"Add asset bookings to your calendar",size:"sm"})]}),(0,J.jsx)(v.Z,{md:4,children:(0,J.jsx)(eP.e,{credentials:{id:n,type:"user"},isLoggedIn:o.microsoft,refetch:a})})]}),(0,J.jsxs)(h.Z,{align:"center",children:[(0,J.jsx)(v.Z,{md:2,children:(0,J.jsx)(ew.Z,{alt:"Google Calendar",src:"/static/logo/Google_Calendar-Logo.svg"})}),(0,J.jsxs)(v.Z,{md:6,children:[(0,J.jsx)(eO.Z,{content:"Google Calendar"}),(0,J.jsx)(eO.Z,{content:"Add asset bookings to your calendar",size:"sm"})]}),(0,J.jsx)(v.Z,{md:4,children:(0,J.jsx)(eS.i,{credentials:{id:n,type:"user"},isLoggedIn:o.google,refetch:a,meta:i})})]})]})},eC=t(10367),eD=t(76312),eU=t(15214),eL=t(55843),eT=t(13439);function eF(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eM(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eF(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eF(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eG,eN=function(e){var n,t,r,o,i,a,s,c=e.userMeta,u=e.data,d=e.documentSide,l=null,m=eM({},c);null!==(n=m)&&void 0!==n&&n.identityDocument||(m=eM(eM({},m),{},{identityDocument:{}}));var p=u.key,f=u.data.find(function(e){return"large"===e.name});l=f?f.relativePath:p;var y={key:u.key,extension:null===(t=l)||void 0===t?void 0:t.split(".").pop(),thumbnails:u.data||null};switch(d){case"documentFrontSide":s=null===(r=m.identityDocument)||void 0===r?void 0:null===(o=r.front)||void 0===o?void 0:o.key,m.identityDocument=eM(eM({},m.identityDocument),{},{front:y});break;case"documentBackSide":s=null===(i=m.identityDocument)||void 0===i?void 0:null===(a=i.back)||void 0===a?void 0:a.key,m.identityDocument=eM(eM({},m.identityDocument),{},{back:y})}return{meta:m,key:s}},eE=t(49088),eR=(0,W.Ry)().shape({dropzone:(0,W.nK)().required()}),eH=t(34155),ez=(eG=(0,D.Z)(T().mark(function e(n){var t,r,o;return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="cleverly-media",r=eH.env.NEXT_PUBLIC_S3_DELETE_URL,e.next=4,window.fetch(r,{method:"POST",body:{bucket:t,keys:(0,ep.Z)(n)}});case 4:return o=e.sent,e.abrupt("return",o.json());case 6:case"end":return e.stop()}},e)})),function(e){return eG.apply(this,arguments)}),eB=t(60036);function eV(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eW(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eV(Object(t),!0).forEach(function(n){(0,b.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eV(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eQ=function(e){var n,t=e.userId,r=e.onSuccess,o=e.userMeta,i=e.documentSide,a=(0,l.useState)(!1),s=a[0],c=a[1],u=(0,l.useState)(""),d=u[0],m=u[1],p=(0,M.cI)({resolver:(0,G.S)(eR)}),y=p.control,h=p.errors,v=p.handleSubmit,g=p.register,b=(0,F.D)(f.uz,{onCompleted:r,update:function(e,n){var r=n.data.update_User_by_pk.meta;e.readQuery({query:f.JA,variables:{id:t}}),e.writeQuery({query:f.JA,variables:{id:t},data:{meta:r}})}}),x=(0,U.Z)(b,2),_=x[0],j=x[1].loading,I=(n=(0,D.Z)(T().mark(function e(n){var r,a,s,u,d,l;return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.dropzone,e.prev=1,c(!0),!(a=r[0])){e.next=16;break}return e.next=7,(0,eE.V)(a,"image");case 7:if((s=e.sent).success){e.next=10;break}return e.abrupt("return",m(s.message));case 10:if(d=(u=eN({userMeta:o,data:s,documentSide:i})).meta,!(l=u.key)){e.next=14;break}return e.next=14,ez(l);case 14:return e.next=16,_({variables:{userId:t,meta:d}});case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),m(e.t0),(0,eB.Tb)({message:e.t0,section:"upload"});case 22:case"end":return e.stop()}},e,null,[[1,18]])})),function(e){return n.apply(this,arguments)});return s||j?(0,J.jsx)(eJ,{children:(0,J.jsx)(eD.Z,{})}):(0,J.jsxs)(N.Z,{id:"offCanvasForm",handleSubmit:v(I),children:[d.length>0&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(eU.Z,{content:d,context:"warning"}),(0,J.jsx)(eL.Z,{})]}),(0,J.jsx)(E.Z,{label:"Media"}),(0,J.jsx)(M.Qr,eW(eW({},{control:y,errors:h,register:g}),{},{as:(0,J.jsx)(eT.Z,{accept:"image/*, .heic",multiple:!1}),name:"dropzone"}))]})},eJ=eC.ZP.div.withConfig({displayName:"form__StyledLoading",componentId:"sc-rf182i-0"})(["height:85vh;padding:0;margin:0;display:flex;align-items:center;justify-content:center;"]);eQ.defaultProps={accept:eT.Z.defaultProps.accept};var eX=function(e){var n=e.userId,t=e.userMeta,r=(0,l.useContext)(q.Z),o=function(e){r.show({content:(0,J.jsx)(eQ,{userId:n,userMeta:t,onSuccess:r.close,documentSide:e}),title:"Upload Identity Document ".concat("documentFrontSide"===e?"Front":"Back")})},i=[{key:"Identity Card Front",value:null,calcAmount:function(){var e;return(0,J.jsxs)(h.Z,{children:[(0,J.jsx)(v.Z,{sm:6,children:(0,J.jsx)(eO.Z,{size:"sm",children:null!=t&&null!==(e=t.identityDocument)&&void 0!==e&&e.front?"Already Assigned":"Not Assigned"})}),(0,J.jsx)(v.Z,{size:6,children:(0,J.jsx)(k.Z,{context:"secondary",content:"Assign",size:"sm","data-cy":"AssignIdentityDocument",onClick:function(){return o("documentFrontSide")}})})]})},show:!0},{key:"Identity Card Back",value:null,calcAmount:function(){var e;return(0,J.jsxs)(h.Z,{children:[(0,J.jsx)(v.Z,{sm:6,children:(0,J.jsx)(eO.Z,{size:"sm",children:null!=t&&null!==(e=t.identityDocument)&&void 0!==e&&e.back?"Already Assigned":"Not Assigned"})}),(0,J.jsx)(v.Z,{size:6,children:(0,J.jsx)(k.Z,{context:"secondary",content:"Assign",size:"sm","data-cy":"AssignIdentityDocument",onClick:function(){return o("documentBackSide")}})})]})},show:!0}];return(0,J.jsx)(A.Z,{open:!0,title:"Identity document",children:(0,J.jsx)(em.Z,{rows:i})})},eY=function(){var e=(0,l.useContext)(y.Z).hasRole,n=(0,m.useRouter)().query,t=(0,p.a)(f.JA,{variables:{id:parseInt(n.id)}}),r=t.data,o=(r=void 0===r?{user:{}}:r).user,i=t.loading,a=t.refetch;return!i&&(0,J.jsxs)(h.Z,{children:[(0,J.jsxs)(v.Z,{md:6,children:[(0,J.jsx)(eu.g,{avatar:(0,g.Q)(o.media),editable:e("admin"),entity:{name:"".concat(o.nameFirst," ").concat(o.nameLast)},entityName:"User",prefix:"/dashboard/users/"}),(0,J.jsx)(eq,{refetch:a,user:o}),e("supplier")&&(0,J.jsx)(eX,{userId:n.id,userMeta:o.meta}),e("admin")&&(0,J.jsx)(ec,{userId:n.id})]}),(0,J.jsxs)(v.Z,{md:6,children:[(0,J.jsx)(eI,{refetch:a,user:o}),e("admin")&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(eo,{userId:o.id}),(0,J.jsx)(eA,{id:o.id})]})]})]})},eK=function(){return(0,J.jsx)(d.Z,{View:(0,J.jsx)(eY,{})})}},41893:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/users/view",function(){return t(17715)}])}},function(e){e.O(0,[3662,367,2283,212,8890,619,1100,1336,4135,5020,6043,1564,4244,5370,3911,3776,6540,2329,778,4046,1023,3148,2797,9241,653,1207,9142,7725,9229,9774,2888,179],function(){return e(e.s=41893)}),_N_E=e.O()}]);