(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5886],{92264:function(e,t,r){"use strict";r.d(t,{H:function(){return u}});var n=r(59499),i=r(55377),o=r(16551),c=r(77439),a=r(85893);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var u=function(e){var t=e.children,r=e.content,u=e.context,l=e.data,d=e.disabled,f=e.handleClick,p=e.size,v=e.type;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:"sm"}),(0,a.jsxs)(o.Z,{align:"flex-end",children:[t,(0,a.jsx)(c.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({content:r,context:u,disabled:d,onClick:f,size:p,type:v},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},67872:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var n=r(67294),i=r(11163),o=r(87043),c=r(16540),a=r(85893),s=(0,n.forwardRef)(function(e,t){var r=e.columns,s=e.history,u=e.initialSort,l=e.loading,d=e.meta,f=e.paginationSize,p=e.refetch,v=e.rowClick,g=e.rows,b=e.xeroPageSize,y=(0,i.useRouter)(),O=y.query,j=void 0===O?{}:O,m=(0,n.useState)(parseInt(null==j?void 0:j.page,10)||1),h=m[0],w=m[1],P=(0,n.useState)(b||o.C1.paginationSize),S=P[0],x=P[1];u||(u={item:"createdAt",order:"desc"});var Z=(0,n.useState)({item:u.item,order:u.order}),_=Z[0],C=Z[1],k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,r=void 0===t?{}:t;if(e>1?r.page=e:delete r.page,!(Object.keys(r).length>0))return{};var n=Object.keys(r).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(r[t])}).join("&");return"?".concat(n)},D=function(){C({item:u.item,order:u.order}),w(1);var e=k();y.push(e),x(b||o.C1.paginationSize)};(0,n.useImperativeHandle)(t,function(){return{currentPage:h,pageSize:S,sort:_,resetPagination:function(){D()}}});var E=function(e){var t=k(e);s&&y.push(t),w(e),!s&&p&&p()},z=function(e){e!==o.C1.paginationSize&&(x(e),p&&p())},F=function(e){var t;C({item:e.item,order:e.order}),p&&p()};return(0,a.jsx)(c.Z,{columns:r,loading:l,paginationSize:f,pagination:d&&!0,paginationProps:d&&{currentPage:h,onPageChange:E,onPageSizeChange:z,pageCount:Math.ceil(d.aggregate.totalCount/S),perPage:S},rowClick:v,rows:g,sort:_,setSort:F})});s.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,r){"use strict";r.d(t,{x:function(){return l}});var n=r(59499),i=r(67294),o=r(96486),c=r(87043),a=function(e){try{return JSON.parse(e)}catch(t){return!1}};function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var l=function(e){var t,r,s,l,d,f,p,v,g,b,y,O=e.filters,j=e.newFilters,m=e.initialSort,h=(0,i.useRef)(),w=(0,i.useState)({}),P=w[0],S=w[1],x=(0,i.useState)({}),Z=x[0],_=x[1],C=m||{item:"createdAt",order:"desc"},k=(0,n.Z)({},(null===(t=h.current)||void 0===t?void 0:t.sort.item)||C.item,C.inneritem?(0,n.Z)({},C.inneritem,(null===(r=h.current)||void 0===r?void 0:r.sort.order)||C.order):(null===(s=h.current)||void 0===s?void 0:s.sort.order)||C.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(P,O),t=!(0,o.isEqual)(Z,j);if(e&&(S(O),null==h||null===(n=h.current)||void 0===n||n.resetPagination()),t&&(_(j),null==h||null===(i=h.current)||void 0===i||i.resetPagination()),null!=h&&null!==(r=h.current)&&void 0!==r&&r.setSort&&!(e||t)){var r,n,i,c,a,s,u,l,d,f,p,v=null!==(c=h.current)&&void 0!==c&&null!==(a=c.sort)&&void 0!==a&&a.item&&null!==(s=h.current)&&void 0!==s&&null!==(u=s.sort)&&void 0!==u&&u.order?{item:null===(l=h.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(f=h.current)||void 0===f?void 0:null===(p=f.sort)||void 0===p?void 0:p.order}:k;h.current.setSort(v)}},[O,j]),{initialData:u(u({},O),{},{newFilters:(null==j?void 0:j.length)>0?j:void 0,limit:(null===(l=h.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=h.current)||void 0===d?void 0:d.pageSize,10)||c.C1.paginationSize,offset:((null===(f=h.current)||void 0===f?void 0:f.currentPage)-1||0)*((null===(p=h.current)||void 0===p?void 0:p.pageSize)||c.C1.paginationSize),orderBy:a(null===(v=h.current)||void 0===v?void 0:null===(g=v.sort)||void 0===g?void 0:null===(b=g.item)||void 0===b?void 0:b.replace(/ORDER/i,null===(y=h.current)||void 0===y?void 0:y.sort.order))||k}),initialSort:m,ref:h}}},3896:function(e,t,r){"use strict";r.d(t,{X:function(){return p}});var n,i,o=r(71383),c=r(16835),a=r(59499),s=r(67294),u=r(6812),l=r(50319),d=r(75063),f=r(55863);function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",n=(0,f.q)().user,i=(0,s.useState)(function(){try{switch(r){case"network":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(n){return t}}),o=i[0],d=i[1],p=function(t){try{var i=t instanceof Function?t(o):t;switch(d(i),r){case"network":y({variables:{accountUserId:null==n?void 0:n.accountUserId,filters:(0,a.Z)({},e,i)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(i))}}catch(c){}};(0,u.a)(v,{variables:{accountUserId:null==n?void 0:n.accountUserId},skip:"network"!==r,onCompleted:function(r){var n=r.accountUser;n&&d(n.filters[e]||t)}});var b=(0,l.D)(g),y=(0,c.Z)(b,1)[0];return[o,p]}var v=(0,d.Ps)(n||(n=(0,o.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]))),g=(0,d.Ps)(i||(i=(0,o.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"])))},98185:function(e,t,r){"use strict";r.d(t,{L:function(){return n}});var n=[{disabled:!0,text:"Lead category",value:""},{text:"Contractor",value:"contractor"},{text:"Contact",value:"contact"}]},12964:function(e,t,r){"use strict";r.d(t,{J:function(){return x}});var n=r(59499),i=r(16835),o=r(4730),c=r(11163),a=r(67294),s=r(9270),u=r(62140),l=r(42283),d=r(76600),f=r(58965),p=r(49501),v=r(75903),g=r(77439),b=r(92264),y=r(3896),O=r(85893);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h=function(e){var t=e.initialValues,r=e.renderFilters,n=e.setFilters,o=e.lastQuery,c=e.filters,j=(0,y.X)("form_data_".concat(t.filterType),t),h=(0,i.Z)(j,2),w=h[0],P=h[1],S=(0,l.cI)({defaultValues:w||t}),x=S.control,Z=S.errors,_=S.handleSubmit,C=S.register,k=S.reset,D=S.watch,E=S.setValue,z=D(),F=m(m({},z),{},{filterType:t.filterType});(0,a.useEffect)(function(){k(F)},[k]),(0,a.useEffect)(function(){P(F)},[c]);var I=function(e){var r=e.query;if(r!==o){var i={q:"%".concat(r,"%")||0},c=/^\d+$/.test(r);"id"in t&&(i.id=c?Number(r):null),"meta"in t&&(i.meta=c?{invoiceNumbers:[r]}:null),"jobNumber"in t&&(i.jobNumber=c?String(r):null,i.invoiceNumber=c?Number(r):null),n(function(e){return m(m({},e),i)})}},$=function(e){Object.keys(t).map(function(e){return E(e,null)}),n(t),k(t),I("")};return(0,O.jsx)(d.Z,{handleSubmit:_(I),children:(0,O.jsxs)(f.Z,{title:"Filters",children:[(0,O.jsxs)(s.Z,{children:[(0,O.jsx)(u.Z,{sm:12,lg:12,children:(0,O.jsx)(p.Z,{label:"",children:(0,O.jsx)(v.Z,{errors:Z,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:C,type:"search"})})}),(0,O.jsx)(u.Z,{sm:12,lg:12,children:r({control:x,errors:Z,initialValues:t,register:C,setFilters:n,watch:D,setValue:E,reset:k})})]}),(0,O.jsx)(b.H,{content:"Search",context:"secondary",handleClick:I,type:"submit",children:(0,O.jsx)(g.Z,{content:"Clear",context:"danger",onClick:$,size:"sm"})})]})})},w=["FiltersComp","initialFilters","TableComp"];function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var x=function(e){var t=e.FiltersComp,r=e.initialFilters,n=e.TableComp,l=(0,o.Z)(e,w),d=(0,y.X)("form_data_".concat(r.filterType),r),f=(0,i.Z)(d,2),p=f[0],v=f[1],g=(0,a.useState)(p||r),b=g[0],j=g[1],m=(0,c.useRouter)().query.show;return(0,a.useEffect)(function(){v(b)},[b,v]),(0,O.jsx)(s.Z,{children:(0,O.jsxs)(u.Z,{sm:12,lg:12,children:[(0,O.jsx)(h,{initialValues:r,renderFilters:function(e){return(0,O.jsx)(t,S(S(S({},e),l),{},{show:m}))},setFilters:j,filters:b}),(0,O.jsx)(n,S({filters:b,initialFilters:r},l))]})})}},80434:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var n,i=r(19076),o=r(12964),c=r(11163),a=r.n(c),s=r(6812),u=r(71383),l=(0,r(75063).Ps)(n||(n=(0,u.Z)(["\n  query GetLeads(\n    $type: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Lead_order_by!\n  ) {\n    leads: Lead(\n      limit: $limit\n      offset: $offset\n      where: { type: { _eq: $type }, createdAt: { _eq: $date } }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      meta\n      createdAt\n      updatedAt\n    }\n    meta: Lead_aggregate(where: { type: { _eq: $type }, createdAt: { _eq: $date } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),d=r(26186),f=r(34613),p=r(58965),v=r(67872),g=r(42846),b=r(98185),y=r(85893),O=function(e){var t=e.filters;e.formData,e.showActionButton;var r=(0,g.x)({filters:t}),n=r.initialData,i=r.ref,o=(0,s.a)(l,{variables:n}),c=o.data,u=(c=void 0===c?{leads:[],meta:{aggregate:{totalCount:0}}}:c).leads,O=c.meta,j=o.loading,m=o.refetch,h=function(e){a().push("".concat("/dashboard/leads/","view?id=").concat(e.id))};return(0,y.jsx)(p.Z,{open:!0,title:"Leads",children:(0,y.jsx)(v.t,{columns:[{hidden:!0},{hidden:!0},{text:"Type"},{sortable:!0,sortName:"createdAt",text:"Created"}],loading:j,meta:O,ref:i,refetch:m,rowClick:h,rows:u.map(function(e){var t;return{data:e,id:e.id,type:null===(t=b.L.find(function(t){return t.value===e.type}))||void 0===t?void 0:t.text,createdAt:"".concat((0,d.Z)(e.createdAt)," - ").concat((0,f.Z)(e.createdAt))}})})})};O.defaultProps={showActionButton:!0};var j=r(59499),m=r(9270),h=r(62140),w=r(95103);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,j.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var x=function(e){var t=e.control,r=e.errors,n=e.register,i=e.setFilters;return(0,y.jsx)(m.Z,{children:(0,y.jsx)(h.Z,{md:6,children:(0,y.jsx)(w.Z,S(S({},{control:t,errors:r,register:n}),{},{name:"type",onChange:function(e){return i(function(t){return S(S({},t),{},{type:e.target.value||null})})},options:b.L}))})})},Z={type:null,filterType:"leads_table"},_=function(){return(0,y.jsx)(o.J,{FiltersComp:x,initialFilters:Z,TableComp:O})},C=function(){return(0,y.jsx)(i.Z,{pageHeading:{heading:"Leads"},View:(0,y.jsx)(_,{})})}},91250:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/leads",function(){return r(80434)}])}},function(e){e.O(0,[3662,2283,1336,6540,56,9774,2888,179],function(){return e(e.s=91250)}),_N_E=e.O()}]);