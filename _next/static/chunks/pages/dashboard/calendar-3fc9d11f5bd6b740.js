(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3259],{69770:function(e,t,n){"use strict";n.d(t,{F:function(){return G}});var i=n(59499),s=n(27812),r=n(4730),o=n(50029),c=n(64687),a=n.n(c),l=n(67294),u=n(11163),d=n(66252),p=n(12690),f=n(78289),m=n(58965),h=n(9270),y=n(62140),g=n(58786),v=n(92742),j=n(72936),x=n(55863),b=n(37068),w=n(33366),_=n(10367),O=n(85893),Z=function(e){var t=e.status;return(0,O.jsx)(P,{children:(0,O.jsx)("ul",{children:t.map(function(e,t){return(0,O.jsxs)("li",{children:[(0,O.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(t))})})})},P=_.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-1gaw8i-0"})(["ul{list-style:none;float:left;padding-top:15px;}ul li{display:flex;flex-direction:row;align-items:center;float:left;width:120px;font-size:90%;list-style:none;}li span{display:block;float:left;height:12px;width:12px;margin-right:5px;}"]),S=n(62047),q=n(55843),C=n(51466),I=n(58594),k=n(71772),V=n(42283),A=n(19015);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var T=function(e){var t=e.setTypes,n=e.setFilters,i=e.setSiteVisit,r=e.types,o=(0,j.x)().hasRole,c=(0,V.cI)({defaultValues:N}),a=c.control,u=c.errors,d=c.register,p=(0,c.watch)("userId");(0,l.useEffect)(function(){n(function(e){return D(D({},e),{},{userId:(null==p?void 0:p.value)||null})})},[p]);var f=function(e,n){n?t([].concat((0,s.Z)(r),[e])):t(r.filter(function(t){return t!==e}))},m=function(e){i(e.target.checked)};return(0,O.jsxs)(h.Z,{children:[(0,O.jsxs)(F,{md:3,children:[(0,O.jsx)(S.Z,{onToggle:function(e){return f("reactive",e)},size:"sm",toggled:r.includes("reactive")}),(0,O.jsx)(q.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Reactive"})]}),(0,O.jsxs)(F,{md:3,children:[(0,O.jsx)(S.Z,{onToggle:function(e){return f("ppm",e)},size:"sm",toggled:r.includes("ppm")}),(0,O.jsx)(q.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"PPM"})]}),(0,O.jsxs)(F,{md:3,children:[(0,O.jsx)(S.Z,{onToggle:function(e){return f("quote",e)},size:"sm",toggled:r.includes("quote")}),(0,O.jsx)(q.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Quote"})]}),(0,O.jsxs)(F,{md:3,children:[(0,O.jsx)(S.Z,{onToggle:function(e){return f("cppm",e)},size:"sm",toggled:r.includes("cppm")}),(0,O.jsx)(q.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Compliance"})]}),(0,O.jsxs)(h.Z,{style:{width:"100%",margin:0},children:[o(A.n)&&(0,O.jsx)(y.Z,{md:6,children:(0,O.jsx)(k.P,D(D({},{control:a,errors:u,register:d}),{},{errors:D({},u),label:"",name:"userId",placeholder:"Select user",type:"user"}))}),(0,O.jsx)(y.Z,{md:6,style:{display:"flex",alignItems:"center"},children:(0,O.jsx)(I.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:m})})]})]})},F=(0,_.ZP)(y.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-3gjja8-0"})(["align-items:center;display:flex;"]),N={userId:null},z=["supplierQuotes"];function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var G=function(e){var t,n,i,c,_=e.defaultFilters,P=e.defaultView,S=e.locationId,q=e.showCompliance,C=e.showFilters,I=e.showSiteVisits,k=e.supplierId,V=(0,u.useRouter)().query,A=(0,l.useContext)(f.Z),E=(0,x.q)(),D=null===(t=E.admin)||void 0===t?void 0:null===(n=t.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,F=null===(i=E.admin)||void 0===i?void 0:null===(c=i.jobSetting)||void 0===c?void 0:c.jobNumberSuffix,N=(0,j.x)().user,L=(0,d.x)(),G=!1,J=!1;switch(N.accountType){case"supplier":J=!0;break;case"customer":G=!0}var Q,R=(0,l.useState)(V.type?["".concat(V.type)]:_),M=R[0],U=R[1],H=(0,l.useState)(I),X=H[0],$=H[1],B=(0,l.useState)(null),K=B[0],Y=B[1],ee="scheduled"===V.type?"PPM":"Bookings";(0,l.useEffect)(function(){return V.type?["".concat(V.type)]:J?U(["ppm"]):U(_)},[_]);var et=(Q=(0,o.Z)(a().mark(function e(t,n){var i,o,c,l,u;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={type:{_in:M},_or:[{_and:[{timingStart:{_gte:t.start}},{timingStart:{_lte:t.end}}]},{_and:[{scheduledAt:{_gte:t.start}},{scheduledAt:{_lte:t.end}}]},{_and:[{siteVisitStart:{_gte:t.start}},{siteVisitStart:{_lte:t.end}}]}]},J&&(i.supplierId={_eq:N.accountId}),k&&(i.supplierId={_eq:k}),G&&(i.customerId={_eq:N.accountId}),S&&(i.locationId={_eq:S}),(q||S)&&(i.Compliances={complianceId:{_is_null:!1}}),K&&(i.customerUserId={_eq:null==K?void 0:K.userId}),X&&(i.siteVisitStart={_is_null:!1}),e.next=10,L.query({query:p.f,variables:{where:i}});case 10:l=(c=void 0===(c=e.sent.data)?{events:[]}:c).events,u=[],l.map(function(e){var t,n=e.supplierQuotes,i=(0,r.Z)(e,z),o=(null==i?void 0:null===(t=i.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||i.title;return u=[].concat((0,s.Z)(u),[W(W({},e),{},{title:o})]),n.length>0&&n.map(function(e){return u=[].concat((0,s.Z)(u),[W(W({},i),{},{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(o," ").concat(e.quoteNumber),siteVisit:!0})])}),u}),n(u.map(function(e){var t=W({},e);return t.start=t.scheduledAt||t.start,t.end=t.scheduledAt||t.end||t.start,t.color=t.siteVisit?"rgb(182, 79, 200)":(0,v.t)(t.status),t}));case 17:case"end":return e.stop()}},e)})),function(e,t){return Q.apply(this,arguments)}),en=function(e){A.show({content:(0,O.jsx)(b.g,{jobId:parseInt(e.event.id),toggleShow:A.close,numberPrefix:D,numberSuffix:F}),title:"Job details",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,O.jsxs)(m.Z,{fitParentHeight:!0,open:!0,title:ee,children:[C&&(0,O.jsx)(T,{setTypes:U,setFilters:Y,setSiteVisit:$,types:M}),(0,O.jsx)(g.A,{eventClick:en,events:et,initialView:"day"===V.show?"timeGridDay":P}),(0,O.jsx)(h.Z,{children:(0,O.jsx)(y.Z,{md:12,children:(0,O.jsx)(Z,{status:w.yW})})})]})};G.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},58786:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var i=n(13625),s=n(85893),r=function(e){var t=e.dateClick,n=e.events,r=e.eventClick,o=e.eventContent,c=(e.hasLoading,e.height),a=e.initialView;return(0,s.jsx)(i.Z,{dateClick:t,eventClick:r,eventContent:o,events:n,hasLoading:!0,height:c,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:a})};r.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},12690:function(e,t,n){"use strict";n.d(t,{f:function(){return c}});var i,s=n(71383),r=n(75063),o=n(4431),c=(0,r.Ps)(i||(i=(0,s.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      type\n      description\n      end: timingEnd\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      quoteDue\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n              code\n            }\n          }\n        }\n      }\n      supplier: Supplier {\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"])),o.WW,o.MR)},73980:function(e,t,n){"use strict";n.r(t);var i=n(11163),s=n(19076),r=n(69770),o=n(85893),c=function(){var e=(0,i.useRouter)().query,t=e.type?["".concat(e.type)]:["reactive","quote","cppm"];return(0,o.jsx)(s.Z,{pageHeading:{heading:"Calendar"},children:(0,o.jsx)(r.F,{defaultFilters:t})})};t.default=c},92448:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/calendar",function(){return n(73980)}])}},function(e){e.O(0,[2283,212,8890,619,1100,1336,4135,5020,1564,4244,5370,3911,4046,9241,3681,7725,1772,9774,2888,179],function(){return e(e.s=92448)}),_N_E=e.O()}]);