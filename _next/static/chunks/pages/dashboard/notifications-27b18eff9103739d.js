(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9857],{92264:function(e,t,n){"use strict";n.d(t,{H:function(){return u}});var r=n(59499),i=n(55377),o=n(16551),c=n(77439),s=n(85893);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var u=function(e){var t=e.children,n=e.content,u=e.context,l=e.data,d=e.disabled,f=e.handleClick,p=e.size,g=e.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{size:"sm"}),(0,s.jsxs)(o.Z,{align:"flex-end",children:[t,(0,s.jsx)(c.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({content:n,context:u,disabled:d,onClick:f,size:p,type:g},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},67872:function(e,t,n){"use strict";n.d(t,{t:function(){return a}});var r=n(67294),i=n(11163),o=n(87043),c=n(16540),s=n(85893),a=(0,r.forwardRef)(function(e,t){var n=e.columns,a=e.history,u=e.initialSort,l=e.loading,d=e.meta,f=e.paginationSize,p=e.refetch,g=e.rowClick,v=e.rows,b=e.xeroPageSize,m=(0,i.useRouter)(),j=m.query,y=void 0===j?{}:j,O=(0,r.useState)(parseInt(null==y?void 0:y.page,10)||1),h=O[0],w=O[1],P=(0,r.useState)(b||o.C1.paginationSize),S=P[0],x=P[1];u||(u={item:"createdAt",order:"desc"});var I=(0,r.useState)({item:u.item,order:u.order}),Z=I[0],C=I[1],_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=m.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},k=function(){C({item:u.item,order:u.order}),w(1);var e=_();m.push(e),x(b||o.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:h,pageSize:S,sort:Z,resetPagination:function(){k()}}});var D=function(e){var t=_(e);a&&m.push(t),w(e),!a&&p&&p()},E=function(e){e!==o.C1.paginationSize&&(x(e),p&&p())},N=function(e){var t;C({item:e.item,order:e.order}),p&&p()};return(0,s.jsx)(c.Z,{columns:n,loading:l,paginationSize:f,pagination:d&&!0,paginationProps:d&&{currentPage:h,onPageChange:D,onPageSizeChange:E,pageCount:Math.ceil(d.aggregate.totalCount/S),perPage:S},rowClick:g,rows:v,sort:Z,setSort:N})});a.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,n){"use strict";n.d(t,{x:function(){return l}});var r=n(59499),i=n(67294),o=n(96486),c=n(87043),s=function(e){try{return JSON.parse(e)}catch(t){return!1}};function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l=function(e){var t,n,a,l,d,f,p,g,v,b,m,j=e.filters,y=e.newFilters,O=e.initialSort,h=(0,i.useRef)(),w=(0,i.useState)({}),P=w[0],S=w[1],x=(0,i.useState)({}),I=x[0],Z=x[1],C=O||{item:"createdAt",order:"desc"},_=(0,r.Z)({},(null===(t=h.current)||void 0===t?void 0:t.sort.item)||C.item,C.inneritem?(0,r.Z)({},C.inneritem,(null===(n=h.current)||void 0===n?void 0:n.sort.order)||C.order):(null===(a=h.current)||void 0===a?void 0:a.sort.order)||C.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(P,j),t=!(0,o.isEqual)(I,y);if(e&&(S(j),null==h||null===(r=h.current)||void 0===r||r.resetPagination()),t&&(Z(y),null==h||null===(i=h.current)||void 0===i||i.resetPagination()),null!=h&&null!==(n=h.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,i,c,s,a,u,l,d,f,p,g=null!==(c=h.current)&&void 0!==c&&null!==(s=c.sort)&&void 0!==s&&s.item&&null!==(a=h.current)&&void 0!==a&&null!==(u=a.sort)&&void 0!==u&&u.order?{item:null===(l=h.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(f=h.current)||void 0===f?void 0:null===(p=f.sort)||void 0===p?void 0:p.order}:_;h.current.setSort(g)}},[j,y]),{initialData:u(u({},j),{},{newFilters:(null==y?void 0:y.length)>0?y:void 0,limit:(null===(l=h.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=h.current)||void 0===d?void 0:d.pageSize,10)||c.C1.paginationSize,offset:((null===(f=h.current)||void 0===f?void 0:f.currentPage)-1||0)*((null===(p=h.current)||void 0===p?void 0:p.pageSize)||c.C1.paginationSize),orderBy:s(null===(g=h.current)||void 0===g?void 0:null===(v=g.sort)||void 0===v?void 0:null===(b=v.item)||void 0===b?void 0:b.replace(/ORDER/i,null===(m=h.current)||void 0===m?void 0:m.sort.order))||_}),initialSort:O,ref:h}}},3896:function(e,t,n){"use strict";n.d(t,{X:function(){return p}});var r,i,o=n(71383),c=n(16835),s=n(59499),a=n(67294),u=n(6812),l=n(50319),d=n(75063),f=n(55863);function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,f.q)().user,i=(0,a.useState)(function(){try{switch(n){case"network":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),o=i[0],d=i[1],p=function(t){try{var i=t instanceof Function?t(o):t;switch(d(i),n){case"network":m({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,s.Z)({},e,i)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(i))}}catch(c){}};(0,u.a)(g,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&d(r.filters[e]||t)}});var b=(0,l.D)(v),m=(0,c.Z)(b,1)[0];return[o,p]}var g=(0,d.Ps)(r||(r=(0,o.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]))),v=(0,d.Ps)(i||(i=(0,o.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"])))},12964:function(e,t,n){"use strict";n.d(t,{J:function(){return x}});var r=n(59499),i=n(16835),o=n(4730),c=n(11163),s=n(67294),a=n(9270),u=n(62140),l=n(42283),d=n(76600),f=n(58965),p=n(49501),g=n(75903),v=n(77439),b=n(92264),m=n(3896),j=n(85893);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){var t=e.initialValues,n=e.renderFilters,r=e.setFilters,o=e.lastQuery,c=e.filters,y=(0,m.X)("form_data_".concat(t.filterType),t),h=(0,i.Z)(y,2),w=h[0],P=h[1],S=(0,l.cI)({defaultValues:w||t}),x=S.control,I=S.errors,Z=S.handleSubmit,C=S.register,_=S.reset,k=S.watch,D=S.setValue,E=k(),N=O(O({},E),{},{filterType:t.filterType});(0,s.useEffect)(function(){_(N)},[_]),(0,s.useEffect)(function(){P(N)},[c]);var $=function(e){var n=e.query;if(n!==o){var i={q:"%".concat(n,"%")||0},c=/^\d+$/.test(n);"id"in t&&(i.id=c?Number(n):null),"meta"in t&&(i.meta=c?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(i.jobNumber=c?String(n):null,i.invoiceNumber=c?Number(n):null),r(function(e){return O(O({},e),i)})}},z=function(e){Object.keys(t).map(function(e){return D(e,null)}),r(t),_(t),$("")};return(0,j.jsx)(d.Z,{handleSubmit:Z($),children:(0,j.jsxs)(f.Z,{title:"Filters",children:[(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(u.Z,{sm:12,lg:12,children:(0,j.jsx)(p.Z,{label:"",children:(0,j.jsx)(g.Z,{errors:I,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:C,type:"search"})})}),(0,j.jsx)(u.Z,{sm:12,lg:12,children:n({control:x,errors:I,initialValues:t,register:C,setFilters:r,watch:k,setValue:D,reset:_})})]}),(0,j.jsx)(b.H,{content:"Search",context:"secondary",handleClick:$,type:"submit",children:(0,j.jsx)(v.Z,{content:"Clear",context:"danger",onClick:z,size:"sm"})})]})})},w=["FiltersComp","initialFilters","TableComp"];function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x=function(e){var t=e.FiltersComp,n=e.initialFilters,r=e.TableComp,l=(0,o.Z)(e,w),d=(0,m.X)("form_data_".concat(n.filterType),n),f=(0,i.Z)(d,2),p=f[0],g=f[1],v=(0,s.useState)(p||n),b=v[0],y=v[1],O=(0,c.useRouter)().query.show;return(0,s.useEffect)(function(){g(b)},[b,g]),(0,j.jsx)(a.Z,{children:(0,j.jsxs)(u.Z,{sm:12,lg:12,children:[(0,j.jsx)(h,{initialValues:n,renderFilters:function(e){return(0,j.jsx)(t,S(S(S({},e),l),{},{show:O}))},setFilters:y,filters:b}),(0,j.jsx)(r,S({filters:b,initialFilters:n},l))]})})}},98679:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r,i=n(19076),o=n(12964),c=n(16835),s=n(59499),a=n(67294),u=n(6812),l=n(50319),d=n(71383),f=(0,n(75063).Ps)(r||(r=(0,d.Z)(["\n  query GetNotifications(\n    $limit: Int\n    $offset: Int\n    $orderBy: Notification_order_by!\n    $q: String\n    $type: String\n    $userId: Int!\n  ) {\n    notifications: Notification(\n      limit: $limit\n      offset: $offset\n      where: { Communication: { text: { _ilike: $q } }, userId: { _eq: $userId } }\n      order_by: [$orderBy]\n    ) {\n      id\n      status\n      statusLog\n      createdAt\n      userId\n      communication: Communication {\n        id\n        text\n        type\n        meta\n        accountId\n        jobId\n        locationId\n        job: Job {\n          id\n        }\n        account: Account {\n          id\n          name\n        }\n      }\n    }\n    meta: Notification_aggregate(\n      where: { Communication: { content: { _ilike: $q } }, userId: { _eq: $userId } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),p=n(79704),g=n(73987),v=n(78289),b=n(26186),m=n(58965),j=n(67872),y=n(37068),O=n(42846),h=n(27952),w=n(85893);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x=function(e){var t=e.filters,n=(0,O.x)({filters:t}),r=n.initialData,i=n.ref,o=(0,a.useContext)(g.Z).user,s=(0,a.useContext)(v.Z),d=S(S({},r),{},{userId:o.id}),P=(0,u.a)(f,{variables:S({},d)}),x=P.loading,I=P.data,Z=(I=void 0===I?{notifications:[],meta:{aggregate:{totalCount:0}}}:I).notifications,C=I.meta,_=P.refetch,k=(0,l.D)(p.G,{onCompleted:function(e){_()}}),D=(0,c.Z)(k,1)[0],E=function(e){var t=e.row;return"unread"===t.status?(0,w.jsx)("strong",{children:t.message}):(0,w.jsx)("span",{children:t.message})},N=function(e){var t="read",n={createdAt:(0,h.v)(),status:t,userId:e.userId};D({variables:{id:e.id,changes:{status:t,statusLog:n}}}),e.communication&&e.communication.jobId&&s.show({title:"Job details",content:(0,w.jsx)(y.g,{jobId:e.communication.jobId,toggleShow:s.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,w.jsx)(m.Z,{open:!0,summary:"Notifications",children:(0,w.jsx)(j.t,{columns:[{hidden:!0},{formatter:E,text:"Message"},{text:"Date",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0}],loading:x,meta:C,ref:i,refetch:_,rowClick:N,rows:Z.map(function(e){var t,n,r=e.communication,i=r.text;return null!==(t=r.meta)&&void 0!==t&&null!==(n=t.content)&&void 0!==n&&n.toast&&(i=r.meta.content.toast),{id:e.id,message:i,date:(0,b.Z)(e.createdAt,!0),status:e.status,communication:r}})})})},I=function(){return""},Z={q:null,filterType:"notifications_table"},C=function(){return(0,w.jsx)(o.J,{FiltersComp:I,initialFilters:Z,TableComp:x})},_=function(){return(0,w.jsx)(i.Z,{pageHeading:{heading:"Notifications"},View:(0,w.jsx)(C,{})})}},96896:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/notifications",function(){return n(98679)}])}},function(e){e.O(0,[3662,2283,212,8890,619,1100,1336,4135,5020,1564,4244,3911,6540,4046,1898,7725,9774,2888,179],function(){return e(e.s=96896)}),_N_E=e.O()}]);