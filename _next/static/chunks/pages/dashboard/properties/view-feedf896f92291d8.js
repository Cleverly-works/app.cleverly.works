(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8521],{40876:function(e,n,t){"use strict";var o=t(64836);n.Z=void 0;var i=o(t(64938)),a=t(85893);n.Z=(0,i.default)((0,a.jsx)("path",{d:"M15.88 9.29 12 13.17 8.12 9.29a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41-.39-.38-1.03-.39-1.42 0"}),"ExpandMoreRounded")},39522:function(e,n,t){"use strict";var o=t(64836);n.Z=void 0;var i=o(t(64938)),a=t(85893);n.Z=(0,i.default)((0,a.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"}),"LanguageRounded")},77743:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ni}});var o,i,a,r,s=t(59499),l=t(67294),d=t(6812),c=t(35914),u=t(11163),m=t.n(u),v=t(9270),p=t(62140),h=t(51778),x=t(907),b=t(37559),f=t(44594),j=t(69770),g=t(78295),y=t(12964),I=t(50029),k=t(64687),O=t.n(k),Z=t(55863),w=t(78289),S=t(52019),C=t(73987),_=t(16387),P=t(9205),A=t(55206),E=t(53344),$=t(10367),M=t(58965),L=t(51466),T=t(6788),B=t(85893),D=function(e){var n=e.compliances,t=e.id,o=function(e){e.stopPropagation(),m().push("/dashboard/properties/view?id=".concat(t,"&tab=compliance"))},i=n.length;if(i<=0)return(0,B.jsx)(M.Z,{open:!0,title:"Compliance Score",children:(0,B.jsx)(R,{onClick:o,children:(0,B.jsx)(L.Z,{content:"No compliance records, please add."})})});var a=(0,T.JB)(n),r=(0,T.CV)(n),s=(0,T.kW)(r);return(0,B.jsxs)(M.Z,{open:!0,title:"Compliance Score",children:[i<=0&&(0,B.jsx)(L.Z,{content:"No compliance records, please add."}),(0,B.jsx)(R,{onClick:o,children:(0,B.jsx)(L.Z,{content:r&&"Score ".concat(r," %"),context:s})}),(0,B.jsx)(L.Z,{content:"".concat(i," compliance item").concat(1!==i?"s":"")}),a>0&&(0,B.jsx)(L.Z,{context:"danger",content:"".concat(a," expired")})]})},R=$.ZP.a.withConfig({displayName:"rating__StyledLink",componentId:"sc-1bayrs3-0"})(["cursor:pointer;text-decoration:none;"]),q=t(61584),N=t(99229),F=t(46165),U=t(19958),z=t(41890),W=t(30381),H=t.n(W),V=t(19056),J=function(e){var n,t,o,i,a,r,s=e.property,l=e.offCanvas,d=e.refetch,c="/dashboard/properties/",u=(0,P.WE)(s,"registered"),v=(0,P.WE)(s,"invoice"),p=function(e){e&&d()};return[{id:1,label:"Create location",date:s.createdAt,content:[{id:1,active:s.createdAt&&s.name,data:"Name: ".concat(s.name)},{id:2,active:s.createdAt,data:"Access: ".concat(s.access)}]},{id:2,label:"Complete profile",info:"",date:(null==u?void 0:u.createdAt)||null,actions:[{id:1,active:!0,content:"Main address",context:"secondary",handleClick:function(){var e;l.show({content:(0,B.jsx)(V.H,{addressId:(null==u?void 0:null===(e=u.address)||void 0===e?void 0:e.id)||null,entity:"Location",entityId:s.id,id:(null==u?void 0:u.id)||null,onSubmit:p,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!0,content:"Invoice address",context:"secondary",handleClick:function(){var e;l.show({content:(0,B.jsx)(V.H,{addressId:(null==v?void 0:null===(e=v.address)||void 0===e?void 0:e.id)||null,entity:"Location",entityId:s.id,id:(null==v?void 0:v.id)||null,onSubmit:p,type:"invoice"}),submit:!1,title:"Manage addresses"})},type:"button"}]},{id:3,label:"Add assets",info:"",date:null!==(n=s.assets)&&void 0!==n&&n.length?s.assets[0].createdAt:null,content:[{id:1,active:(null===(t=s.assets)||void 0===t?void 0:t.length)>0,data:"".concat(null===(o=s.assets)||void 0===o?void 0:o.length," assets added")}],actions:[{id:1,active:!0,content:"Submit sublocations",context:"secondary",handleClick:function(){m().push("".concat(c,"view?id=").concat(s.id,"&tab=assets"))},type:"button"},{id:2,active:!0,content:"Submit products",context:"secondary",handleClick:function(){m().push("".concat(c,"view?id=").concat(s.id,"&tab=assets"))},type:"button"},{id:3,active:!0,content:"Submit sensors",context:"secondary",handleClick:function(){m().push("".concat(c,"view?id=").concat(s.id,"&tab=assets"))},type:"button"}]},{id:6,label:"Start issuing work orders",info:"submit work orders",date:null!==(i=s.bookings)&&void 0!==i&&i.length?s.bookings[0].createdAt:null,content:[{id:1,active:(null===(a=s.assets)||void 0===a?void 0:a.length)>0,data:"".concat(null===(r=s.assets)||void 0===r?void 0:r.length," jobs created")}]}]},Q=function(e,n,t){var o=J({property:e,offCanvas:n,refetch:t});return o.forEach(function(e){e.date&&(e.date=H()(e.date).format("D MMM YYYY HH:mm"))}),o},X=t(58095),Y=function(e){var n=e.location,t=e.refetch,o=(0,X.a)();return(0,B.jsx)(M.Z,{open:!0,title:"Profile",children:(0,B.jsx)(z.Z,{items:Q(n,o,t),summary:[]},"stepper-".concat(n.id))})},G=t(53254),K=t(40755),ee=t(87043),en=function(e){var n,t,o,i,a,r,s,d,c,m,h=e.location,x=e.refetch,b=(0,Z.q)(),f=(0,l.useContext)(w.Z),j=(0,l.useContext)(S.Z).hasRole,g=(0,l.useContext)(C.Z).user,y=(0,u.useRouter)().query,k=(0,l.useState)([]),$=k[0],M=k[1],L=(0,l.useState)(!1),T=L[0],R=L[1],z=(0,K.RM)(g.accountId),W="".concat(ee.C1.issueReportUrl,"?locationId=").concat(h.id,"&locationName=").concat(h.name,"&customerId=").concat(null===(n=h.customer[0])||void 0===n?void 0:n.account.id),H=(0,K.BR)({adminId:g.id,xeroClientId:null==y?void 0:y.clientId},[b.admin]),V=H.onCallAuthorize,J=H.onGetXeroContacts;(0,l.useEffect)(function(){var e,n=(e=(0,I.Z)(O().mark(function e(n){var t,o;return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J(n);case 3:o=(0,e.sent).map(function(e){return{label:"".concat(e.name," - ").concat(e.contactID),value:e.contactID}}),R(!1),M(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),R(!0);case 12:case"end":return e.stop()}},e,null,[[0,9]])})),function(n){return e.apply(this,arguments)});null!=z&&z.companyId&&n(z.companyId)},[null==z?void 0:z.companyId]);var Q,X=h.createdAt,en=h.compliances,et=h.customer,eo=h.id,ei=h.supplier,ea=h.user,er=(0,P.WE)(h,"registered"),es=(0,P.WE)(h,"invoice"),el=function(){V(window.location.href)},ed=function(e){var n,t,o,i;e.stopPropagation(),f.show({content:(0,B.jsx)(U.V,{data:h,refetch:x,xeroContactId:null===(n=h.customer)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(o=t.account)||void 0===o?void 0:null===(i=o.meta)||void 0===i?void 0:i.xeroContactId,displayXeroContacts:!!(null!=z&&z.clientId),xeroContacts:$,displaySignin:T,handleXeroAuthorize:el,onClose:f.close}),title:"Edit property"})};return(0,B.jsxs)(v.Z,{children:[(0,B.jsxs)(p.Z,{md:4,children:[(0,B.jsx)(F.g,{avatar:(0,E.Q)(null===(t=h.customer[0].account)||void 0===t?void 0:t.media),entity:{id:h.id,description:h.customer[0].account.name,name:h.name||"Not Specified"},entityName:"Location",icons:[{icon:"edit",onClick:ed}]}),(0,B.jsx)(q.J,{data:{accountName:et.length&&et[0].account.name||ei.length&&ei[0].account.name,country:null==er?void 0:null===(o=er.address)||void 0===o?void 0:null===(i=o.country)||void 0===i?void 0:i.name,createdAt:X,fullName:null==ea?void 0:ea.fullName,position:null==ea?void 0:ea.position,phone:null==ea?void 0:ea.phone,permitsRequired:null==h?void 0:h.permitsRequired,xeroContactId:null===(a=h.customer)||void 0===a?void 0:null===(r=a[0])||void 0===r?void 0:null===(s=r.account)||void 0===s?void 0:null===(d=s.meta)||void 0===d?void 0:d.xeroContactId}}),er&&(0,B.jsx)(_.f,{address:er.address,entity:"Location",entityId:h.id,id:er.id,refetch:x,showMap:!0,title:"Address",type:"registered"}),es&&(0,B.jsx)(_.f,{address:es.address,entity:"Location",entityId:h.id,id:es.id,refetch:x,title:"Invoice Address",type:"invoice"}),j("admin")&&(0,B.jsx)(A.E,{entity:"Location",entityId:h.id,open:!0,title:"Notes"})]}),(0,B.jsx)(p.Z,{md:4,children:(0,B.jsx)(Y,{refetch:x,location:h})}),(0,B.jsxs)(p.Z,{md:4,children:[(0,B.jsx)(N.G,{details:!0,entity:"Location",entityId:eo}),(0,B.jsx)(D,{compliances:en,id:eo}),(null==b?void 0:null===(c=b.admin)||void 0===c?void 0:null===(m=c.modules)||void 0===m?void 0:m.nonLoggedUser)&&(0,B.jsx)(G.U,{id:"location-qr-".concat(h.id),value:W,isExpandedByDefault:!0})]})]})},et=t(92568),eo=function(e){var n,t,o,i,a,r=e.location;return(0,B.jsx)(et.b,{type:"customer",accountId:null===(n=r.customer[0])||void 0===n?void 0:null===(t=n.account)||void 0===t?void 0:t.id,locationId:r.id,meta:null!==(o=null==r?void 0:null===(i=r.customer[0])||void 0===i?void 0:null===(a=i.account)||void 0===a?void 0:a.meta)&&void 0!==o?o:{}})},ei=t(16835),ea=t(50319),er=t(71383),es=t(75063),el=(0,es.Ps)(o||(o=(0,er.Z)(['\n  query GetTenantBookings(\n    $limit: Int\n    $locationId: Int\n    $offset: Int\n    $orderBy: TenantBooking_order_by!\n    $q: Int\n    $userId: Int\n  ) {\n    tenantBookings: TenantBooking(\n      limit: $limit\n      offset: $offset\n      where: { id: { _eq: $q }, locationId: { _eq: $locationId }, userId: { _eq: $userId } }\n      order_by: [$orderBy]\n    ) {\n      id\n      bookingStart\n      bookingEnd\n      notes\n      status\n      createdAt\n      location: Location {\n        id\n        name\n        customer: Account_Locations {\n          id\n          account: Account {\n            id\n            name\n            admin: Admins {\n              id: adminId\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n            contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n              id\n              user: User {\n                id\n                fullName\n              }\n            }\n          }\n        }\n      }\n      user: User {\n        id\n        fullName\n        email\n        phone\n        accountUsers: Account_Users(where: { Account: { type: { _eq: "tenant" } } }) {\n          id\n          accountId\n          modules\n        }\n      }\n    }\n    meta: TenantBooking_aggregate(\n      where: { id: { _eq: $q }, locationId: { _eq: $locationId }, userId: { _eq: $userId } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),ed=(0,es.Ps)(i||(i=(0,er.Z)(["\n  mutation AddTenantBooking(\n    $nameFirst: String\n    $nameLast: String\n    $email: String\n    $phone: String\n    $bookingStart: timestamptz\n    $bookingEnd: timestamptz\n    $notes: String\n    $status: String\n    $locationId: Int!\n    $userId: Int\n    $modules: jsonb\n  ) {\n    createTenant(\n      nameFirst: $nameFirst\n      nameLast: $nameLast\n      email: $email\n      phone: $phone\n      bookingStart: $bookingStart\n      bookingEnd: $bookingEnd\n      notes: $notes\n      status: $status\n      locationId: $locationId\n      userId: $userId\n      modules: $modules\n    ) {\n      data\n      success\n    }\n  }\n"]))),ec=(0,es.Ps)(a||(a=(0,er.Z)(['\n  mutation UpdateTenantBooking(\n    $id: Int!\n    $changes: TenantBooking_set_input\n    $userId: Int!\n    $accountUser: Account_User_set_input\n  ) {\n    update_TenantBooking_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    update_Account_User(\n      where: { userId: { _eq: $userId }, Account: { type: { _eq: "tenant" } } }\n      _set: $accountUser\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n'])));(0,es.Ps)(r||(r=(0,er.Z)(["\n  mutation DeleteTenantBooking($id: Int!) {\n    delete_TenantBooking_by_pk(id: $id) {\n      id\n    }\n  }\n"])));var eu=t(68956),em=t(26186),ev=t(77439),ep=t(67872),eh=t(42283),ex=t(79665),eb=t(76600),ef=t(49501),ej=t(55563),eg=t(6710),ey=t(95103),eI=t(52220),ek=t(71772),eO=t(74231),eZ=(0,eO.Ry)().shape({bookingStart:(0,eO.hT)(),bookingEnd:(0,eO.hT)().nullable(),notes:(0,eO.Z_)(),status:(0,eO.Z_)().oneOf(["active","inactive"]).required()}),ew=t(26380),eS=t(5616),eC=t(15861),e_=t(26447),eP=t(50480),eA=t(69368),eE=function(e){var n=e.name,t=e.control,o=e.permissions,i=e.styles;return(0,B.jsxs)(eS.Z,{sx:i,children:[(0,B.jsx)(eC.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,B.jsx)(e_.Z,{spacing:1,direction:"row",children:o.map(function(e){return(0,B.jsx)(eh.Qr,{name:"".concat(n?n+".":"").concat(e.name),control:t,render:function(n){var t=n.value,o=n.onChange;return(0,B.jsx)(eP.Z,{color:"dark.main",control:(0,B.jsx)(eA.Z,{color:"secondary",checked:t,onChange:function(e){return o(e.target.checked)}}),label:e.label})}})})})]})};eE.defaultProps={permissions:[]};var e$=[{label:"Job reports",name:"jobReports"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}];function eM(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function eL(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eM(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eM(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eT=function(e){var n,t,o,i=e.defaultValues,a=e.submit,r=(0,l.useState)(!1),s=r[0],d=r[1],c=(0,eh.cI)({defaultValues:i&&i,resolver:(0,ex.S)(eZ)}),u=c.control,m=c.errors,h=c.handleSubmit,x=c.register,b=c.watch,f={control:u,errors:m,register:x},j=b("tenantSelected");return(0,B.jsxs)(eb.Z,{id:"offCanvasForm",handleSubmit:h(a),children:[(0,B.jsx)(M.Z,{open:!0,title:"Tenant information",children:s?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(v.Z,{children:[(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(ef.Z,{label:"First name",children:(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"nameFirst"}))})}),(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(ef.Z,{label:"Last name",children:(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"nameLast"}))})}),(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(ef.Z,{label:"Email",children:(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"email",type:"email"}))})}),(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(ef.Z,{label:"Mobile",children:(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"phone"}))})})]}),(0,B.jsx)(ev.Z,{content:"Cancel",context:"secondary",onClick:function(){return d(!1)},size:"sm"})]}):null!=i&&i.id?(0,B.jsxs)("div",{children:[null==i?void 0:null===(n=i.user)||void 0===n?void 0:n.fullName," ",(0,B.jsx)("br",{}),null==i?void 0:null===(t=i.user)||void 0===t?void 0:t.email," ",(0,B.jsx)("br",{}),null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.phone," ",(0,B.jsx)("br",{})]}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(ek.P,eL(eL({},f),{},{errors:eL({},m),label:"Tenant",name:"tenantSelected",type:"tenant"})),j&&(0,B.jsxs)("div",{children:[j.label," ",(0,B.jsx)("br",{}),j.email," ",(0,B.jsx)("br",{}),j.phone," ",(0,B.jsx)("br",{}),(0,B.jsx)("br",{})]}),"or"," ",(0,B.jsx)(ev.Z,{content:"Add new tenant",context:"secondary",onClick:function(){return d(!0)},size:"sm"})]})}),(0,B.jsxs)(M.Z,{open:!0,title:"Booking information",children:[(0,B.jsxs)(v.Z,{children:[(0,B.jsxs)(p.Z,{md:6,children:[(0,B.jsx)(ef.Z,{label:"Booked from"}),(0,B.jsx)(eI.M,eL(eL({},f),{},{name:"bookingStart",placeholderText:"Click to select date"}))]}),(0,B.jsxs)(p.Z,{md:6,children:[(0,B.jsx)(ef.Z,{label:"Booked to"}),(0,B.jsx)(eI.M,eL(eL({},f),{},{name:"bookingEnd",placeholderText:"Click to select date"}))]})]}),(0,B.jsx)(ef.Z,{label:"Notes",children:(0,B.jsx)(eg.Z,eL(eL({},f),{},{name:"notes",rows:3}))}),(0,B.jsx)(ef.Z,{label:"Status",children:(0,B.jsx)(ey.Z,eL(eL({},f),{},{name:"status",options:ew.bg}))})]}),(0,B.jsx)(eE,{name:"modules",control:u,permissions:e$,styles:{mb:2}}),(null==i?void 0:i.id)&&(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"id",type:"hidden"})),(null==i?void 0:i.userId)&&(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"userId",type:"hidden"})),(null==i?void 0:i.locationId)&&(0,B.jsx)(ej.Z,eL(eL({},f),{},{name:"locationId",type:"hidden"}))]})},eB=function(e,n){var t,o,i={id:(null==e?void 0:e.id)||null,bookingStart:null!=e&&e.bookingStart?new Date(e.bookingStart):null,bookingEnd:null!=e&&e.bookingEnd?new Date(e.bookingEnd):null,notes:(null==e?void 0:e.notes)||"",locationId:n,status:(null==e?void 0:e.status)||"active"};return null!=e&&e.id&&null!=e&&e.user?(i.user={id:e.user.id,fullName:e.user.fullName,email:e.user.email,phone:e.user.phone},i.userId=e.user.id,i.modules=(null===(t=e.user.accountUsers)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:o.modules)||{}):(i.email="",i.nameFirst="",i.nameLast="",i.phone=""),i};function eD(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function eR(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eD(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eD(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eq=function(e){var n,t,o,i=e.filters,a=(0,l.useRef)(),r=(0,l.useContext)(w.Z),c=i.locationId,u=(0,d.a)(el,{variables:eR(eR({},i),{},{limit:ee.C1.paginationSize,offset:((null===(n=a.current)||void 0===n?void 0:n.currentPage)-1||0)*ee.C1.paginationSize,orderBy:(0,s.Z)({},null===(t=a.current)||void 0===t?void 0:t.sort.item,null===(o=a.current)||void 0===o?void 0:o.sort.order)})}),m=u.data,v=(m=void 0===m?{tenantBookings:[],meta:{aggregate:{totalCount:0}}}:m).tenantBookings,p=m.meta,h=u.loading,x=u.refetch,b=(0,ea.D)(ed,{onCompleted:function(e){r.close(),x()}}),f=(0,ei.Z)(b,1)[0],j=(0,ea.D)(ec,{onCompleted:function(e){r.close(),x()}}),g=(0,ei.Z)(j,1)[0],y=function(e){e.id?g({variables:{id:e.id,changes:{bookingStart:e.bookingStart,bookingEnd:e.bookingEnd,notes:e.notes,status:e.status},userId:e.userId,accountUser:{modules:e.modules}}}):f({variables:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,bookingStart:e.bookingStart,bookingEnd:e.bookingEnd,notes:e.notes,status:e.status,locationId:e.locationId,userId:e.userId,modules:e.modules}})},I=function(e,n){e.stopPropagation();var t=eB(v.find(function(e){return e.id===(null==n?void 0:n.id)}),c);r.show({title:n?"Edit tenant":"Add tenant",content:(0,B.jsx)(eT,{defaultValues:t,submit:y})})},k=[{text:"ID"},{text:"Tenant"},{text:"Email Address"},{text:"Booked from"},{text:"Booked to"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{formatter:eu.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:I,tooltip:"Edit"}],text:"Actions"},{hidden:!0}];return(0,B.jsx)(M.Z,{fitParentHeight:!0,open:!0,title:"Tenant bookings",toolbar:c&&(0,B.jsx)(ev.Z,{content:"Add tenant",context:"secondary",onClick:I,size:"sm"}),children:(0,B.jsx)(ep.t,{columns:k,loading:h,meta:p,ref:a,refetch:x,rows:v.map(function(e){var n=null==e?void 0:e.user;return{id:e.id,name:null==n?void 0:n.fullName,email:null==n?void 0:n.email,bookingStart:e.bookingStart,bookingEnd:e.bookingEnd?e.bookingEnd:"-",status:"active"===e.status?"Active":"Inactive",createdAt:(0,em.Z)(e.createdAt),actions:"",locationId:e.locationId}})})})},eN=t(72936),eF=t(10504),eU=t(61730),ez=t(98456),eW=t(92927),eH=t(29729),eV=t(30363),eJ=t(17386),eQ=t(49397),eX=t(27812),eY=t(21023),eG=t(87109),eK=t(39522),e0=t(40876),e1=t(6911),e3=t(76301);function e2(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function e6(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e2(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var e9=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth,o=e.locationId,i=(0,l.useState)(""),a=i[0],r=i[1],s=(0,l.useState)({label:"All locations",value:"all"}),c=s[0],u=s[1];(0,d.a)(e3.nP,{skip:!o,variables:{id:o},onCompleted:function(e){e.item&&u({label:e.item.label,value:e.item.value})}});var v=(0,d.a)(e3._d,{skip:""===a,variables:{where:{name:{_ilike:""!==a?"%".concat(a,"%"):null}},offset:0,limit:50}}),p=v.data,h=(p=void 0===p?{items:[]}:p).items,x=v.loading,b=function(e,n){if(!(null!=n&&n.value))return null;if("/dashboard/scheduledjob"===m().pathname){if("all"===n.value)return null;m().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))}else"all"===n.value?m().push("/dashboard/scheduledjob"):m().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))};return(0,B.jsx)(eY.Z,{followCursor:!0,title:c.label,children:(0,B.jsx)(e1.q,{loading:x,options:[{label:"All locations",value:"all"}].concat((0,eX.Z)(h)),value:c,onChange:b,setSearch:r,isOptionEqualToValue:function(e,n){return e.value===n.value},popupIcon:(0,B.jsx)(e0.Z,{}),clearIcon:null,textFieldProps:{placeholder:"Location name",InputProps:{startAdornment:(0,B.jsx)(eG.Z,{position:"start",children:(0,B.jsx)(eK.Z,{color:"white.main"})})}},size:"small",sx:e4({withoutRightBorderRadius:n,fullWidth:t})})})},e4=function(e){var n=e.withoutRightBorderRadius;return e6(e6({height:"32px",width:e.fullWidth?"100%":"220px",backgroundColor:"secondary.main",borderRadius:1},n&&{borderTopRightRadius:0,borderBottomRightRadius:0}),{},(0,s.Z)({"& .MuiInputBase-root":{color:"white.main"},"& .MuiOutlinedInput-root.MuiInputBase-sizeSmall":{paddingTop:"4px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},"& .MuiAutocomplete-endAdornment .MuiSvgIcon-root,\n  .MuiInputAdornment-root.MuiInputAdornment-positionStart",{color:"white.main"}))},e5=t(56707);function e8(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function e7(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e8(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e8(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ne=function(){var e,n,t,o,i,a,r,s,I,k,O=(0,eU.Z)("(max-width:600px)"),w=(0,eN.x)(),S=w.hasRole,C=w.user,_=(0,u.useRouter)().query,P=(0,Z.q)(),A=P.admin,E=P.hasUserModule,$=(0,l.useMemo)(function(){return _.tab||"details"},[_.tab]),M=null==A?void 0:null===(e=A.modules)||void 0===e?void 0:e.assets,L=S("admin"),T=S("tenant"),D=S("customer"),R=S("customer_user"),q=E("ppmSchedules"),N=E("finances"),F=E("quotes"),U=(0,l.useState)($),z=U[0],W=U[1],H=(0,l.useState)("slas-work-order"),V=H[0],J=H[1],Q=function(e,n){W(n)},X=function(e,n){J(n)},Y=(0,d.a)(c.t,{skip:!_.id,variables:{id:_.id}}),G=Y.loading,K=Y.data,ee=(K=void 0===K?{location:{}}:K).location,et=Y.refetch;if(!_.id)return null;if(G)return(0,B.jsx)(e_.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,B.jsx)(ez.Z,{color:"secondary"})});if(!ee)return m().push("/404"),!1;var ei={maxWidth:O?"100%":"calc(100vw - 330px)","& .MuiTabs-flexContainer>.MuiTab-root:first-child":e7({},!O&&{borderTopLeftRadius:0,borderBottomLeftRadius:0})};return(0,B.jsxs)(eS.Z,{sx:{width:"100%",height:"100%"},children:[(0,B.jsxs)(e_.Z,{direction:O?"column":"row",children:[(0,B.jsx)(e9,{withoutRightBorderRadius:!O,fullWidth:O,locationId:ee.id}),(0,B.jsxs)(eV.m,{value:z,onChange:Q,changeQuery:!0,sx:ei,children:[(0,B.jsx)(eJ.O,{value:"details",label:"Details",sx:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}),!(!N&&(T||R))&&(0,B.jsx)(eJ.O,{value:"finances",label:"Finances"}),(0,B.jsx)(eJ.O,{value:"sublocations",label:"Sublocations"}),M&&(0,B.jsx)(eJ.O,{value:"assets",label:"Assets"}),(0,B.jsx)(eJ.O,{value:"slas",label:"SLAs"}),(0,B.jsx)(eJ.O,{value:"services",label:"Services"}),(0,B.jsx)(eJ.O,{value:"work-orders",label:"Work Orders"}),!(!F&&R)&&(0,B.jsx)(eJ.O,{value:"quotes",label:"Quotes"}),(0,B.jsx)(eJ.O,{value:"compliance",label:"Compliance"}),(0,B.jsx)(eJ.O,{value:"tenants",label:"Tenants"}),!(!q&&R)&&(0,B.jsx)(eJ.O,{value:"planned-maintenance",label:"Planned Maintenance"})]})]}),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"details"},nn),{},{children:(0,B.jsx)(en,{location:ee,refetch:et})})),!(!N&&(T||R))&&(0,B.jsx)(eQ.x,e7(e7({value:z,index:"finances"},nn),{},{children:(0,B.jsx)(eo,{location:ee})})),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"sublocations"},nn),{},{children:(0,B.jsx)(eF.E,{editable:!T&&!D,location:ee,customer:null===(n=ee.customer[0])||void 0===n?void 0:n.account})})),M&&(0,B.jsx)(eQ.x,e7(e7({value:z,index:"assets"},nn),{},{children:(0,B.jsx)(h.E,{editable:L,hideLocationInfo:!0,hideCustomerInfo:!0,showHeader:!1,initialFilters:{locationId:ee.id,filterType:"location_assets"},createFormDefaultValues:{customer:{label:null===(t=ee.customer[0])||void 0===t?void 0:null===(o=t.account)||void 0===o?void 0:o.name,value:null===(i=ee.customer[0])||void 0===i?void 0:null===(a=i.account)||void 0===a?void 0:a.id},location:{label:ee.name,value:ee.id}}})})),(0,B.jsxs)(eQ.x,e7(e7({value:z,index:"slas"},nn),{},{children:[(0,B.jsxs)(eV.m,{value:V,onChange:X,children:[(0,B.jsx)(eJ.O,{value:"slas-work-order",label:"Details"}),(0,B.jsx)(eJ.O,{value:"slas-quote",label:"Finances"})]}),(0,B.jsx)(eQ.x,e7(e7({value:V,index:"slas-work-order"},nn),{},{children:(0,B.jsx)(eW.H,{title:"Work Order SLAs",subtype:"reactive",isEntity:!0,isLocation:!0,customerId:null===(r=ee.customer[0])||void 0===r?void 0:null===(s=r.account)||void 0===s?void 0:s.id,entity:"Location",entityId:ee.id,containerHeight:"calc(100vh - 180px)"})})),(0,B.jsx)(eQ.x,e7(e7({value:V,index:"slas-quote"},nn),{},{children:(0,B.jsx)(eW.H,{title:"Quote SLAs",subtype:"quote",isEntity:!0,isLocation:!0,customerId:null===(I=ee.customer[0])||void 0===I?void 0:null===(k=I.account)||void 0===k?void 0:k.id,entity:"Location",entityId:ee.id,containerHeight:"calc(100vh - 180px)"})}))]})),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"services"},nn),{},{children:(0,B.jsx)(eH.J,{entity:"Location",entityId:ee.id})})),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"work-orders"},nn),{},{children:(0,B.jsx)(g.A,{columnVisibilityModel:{customerNet:!R||N,amountOutstanding:!R||N},filtersVisibilityModel:{customer:!1,user:S("customer"),supplier:S("admin"),location:!1,manager:!1,customerManager:!1,accountManager:!1},entityRelationToFetch:{locationId:ee.id},initialFilters:{startDate:null,endDate:null,status:null,locationId:null,supplierId:null,filterType:"locations_work_orders_tab"}})})),!(!F&&R)&&(0,B.jsx)(eQ.x,e7(e7({value:z,index:"quotes"},nn),{},{children:(0,B.jsx)(y.J,{FiltersComp:b.r,initialFilters:{customerId:null,supplierId:null,status:null,id:null,locationId:ee.id,filterType:"location_quotes"},TableComp:f.v})})),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"compliance"},nn),{},{children:(0,B.jsxs)(v.Z,{children:[(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(x.M,{data:ee.compliances,entity:"Location",entityId:ee.id,refetch:et,showOverallRating:!0})}),(0,B.jsx)(p.Z,{md:6,children:(0,B.jsx)(j.F,{compliance:!0,locationId:ee.id,showFilters:!1})})]})})),(0,B.jsx)(eQ.x,e7(e7({value:z,index:"tenants"},nn),{},{children:(0,B.jsx)(eq,{filters:{locationId:ee.id}})})),!(!q&&R)&&(0,B.jsx)(eQ.x,e7(e7({value:z,index:"planned-maintenance"},nn),{},{label:"Planned Maintenance",children:(0,B.jsx)(e5.J,{location:ee,refetch:et,user:C})}))]})},nn={sx:{height:"calc(100% - 32px)"},boxSx:{height:"100%"}},nt=t(38033),no=function(){return(0,B.jsx)(ne,{})},ni=no;no.getLayout=function(e){return(0,B.jsx)(nt.Z,{children:e})}},36381:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties/view",function(){return t(77743)}])}},function(e){e.O(0,[3662,367,9809,2283,212,8890,619,1100,1336,4135,5020,6043,1564,4244,5370,3911,3776,6540,2329,778,4046,1023,4253,3148,2797,9241,653,8062,1207,7328,4061,6075,597,2904,3704,4990,2747,9528,1121,1717,7147,3660,7725,8033,9229,26,4195,9201,339,7277,6247,2927,5248,7576,1849,8413,3180,9774,2888,179],function(){return e(e.s=36381)}),_N_E=e.O()}]);