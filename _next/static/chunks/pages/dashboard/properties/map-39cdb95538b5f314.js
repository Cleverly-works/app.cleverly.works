(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3241],{95102:function(e,n,t){"use strict";t.d(n,{$A:function(){return g},$E:function(){return f},A1:function(){return y},Un:function(){return m},yf:function(){return b},zg:function(){return h}});var r,o,i,s,a,c,l,d,p=t(71383),u=t(75063);(0,u.Ps)(r||(r=(0,p.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"])));var m=(0,u.Ps)(o||(o=(0,p.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']))),y=(0,u.Ps)(i||(i=(0,p.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]))),g=(0,u.Ps)(s||(s=(0,p.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]))),f=(0,u.Ps)(a||(a=(0,p.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),h=(0,u.Ps)(c||(c=(0,p.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])));(0,u.Ps)(l||(l=(0,p.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"])));var b=(0,u.Ps)(d||(d=(0,p.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"])))},77050:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var r=t(6812),o=t(95102),i=t(19076),s=t(58965),a=t(59499),c=t(67294),l=t(10367),d=t(42283),p=t(87043),u=[{elementType:"geometry",stylers:[{color:"#75cccf"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#004e49"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#75cccf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#F6F6F4"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#ECEEED"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#a8e3e6"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#ECEEED"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#E8EDEB"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#CAD2D3"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#CAD2D3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#"}]}],m=t(63118),y=t(78289),g=t(8357),f=t(66776),h=t(9205),b=t(37068),x=t(75820),_=t(85893),T=function(e){var n=e.address,t=e.children,r=e.onClick,o=n.bookings.length>0?"pink":"blue";return(0,_.jsx)(x.Z,{icon:"http://maps.google.com/mapfiles/ms/icons/".concat(o,"-dot.png"),onClick:r,position:n,children:t})},j=t(11163),k=t.n(j),v=t(11082),w=t(74297),A=t(55583),C=t(40826),I=function(e){var n=e.address,t=e.onCloseClick,r=n.addressLine1,o=n.bookings,i=n.city,s=n.id,a=n.postCode,c=(0,v.Z)(o.reduce(function(e,n){return e+n.amount},0)),l=function(){k().push("/dashboard/properties/view?id=".concat(s,"&tab=details"))};return(0,_.jsx)(A.Z,{onCloseClick:t,children:(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)($,{children:[(0,_.jsx)(C.Z,{context:"female",size:"lg",icon:"map-marker-alt"}),(0,_.jsxs)(L,{onClick:l,link:!0,children:[r,","," "+i,(0,_.jsx)("br",{}),a]})]}),(0,_.jsx)("br",{}),(0,_.jsxs)($,{children:[(0,_.jsx)(C.Z,{context:"female",size:"lg",icon:"calendar-alt"}),(0,_.jsxs)(L,{children:["Bookings: ",o.length,(0,_.jsx)("ul",{style:{margin:0,paddingLeft:"20px"},children:o.map(function(e,n){var t;return(0,_.jsxs)("li",{children:["No: ",e.id," - ",(t=e.status,(0,w.Z)(t.replace(/([A-Z]+)/g," $1").replace(/([A-Z][a-z])/g," $1")))]},n)})})]})]}),(0,_.jsx)("br",{}),(0,_.jsxs)($,{children:[(0,_.jsx)(C.Z,{context:"female",size:"lg",icon:"shopping-cart"}),(0,_.jsxs)(L,{children:["Spend: ",c]})]})]})})},$=l.ZP.div.withConfig({displayName:"markerTooltip__TooltipRow",componentId:"sc-7xxcu5-0"})(["align-items:center;display:flex;"]),L=l.ZP.div.withConfig({displayName:"markerTooltip__TooltipColumn",componentId:"sc-7xxcu5-1"})(["cursor:",";font-size:0.9rem;margin-left:5px;text-decoration:",";"],function(e){return e.link?"pointer":"auto"},function(e){return e.link?"underline":"none currentcolor solid"});function Z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(t),!0).forEach(function(n){(0,a.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var P=(0,c.memo)(function(e){var n=e.addresses;n=n.map(function(e){var n=(0,h.WE)(e,"registered"),t=(null==n?void 0:n.address)||null,r=(0,h.Of)(t);return O(O(O({},t),e),r)}).filter(function(e){return e.lat&&e.lng});var t=(0,m.Z)(n),r=n.reduce(function(e,n){var t=n.id;return e[t]=!!e[t],e},{}),o=(0,d.cI)(r),i=o.change,s=o.form,a=function(e,n){var t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];Object.keys(s).forEach(function(e){e===n&&(s[e]=t)}),i({target:{id:n,value:t}})},l=(0,c.useContext)(y.Z),x=function(e){if(e.length>0){var n=e.length-1;l.show({title:"Job details",content:(0,_.jsx)(b.g,{jobId:e[n].id,toggleShow:l.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})}};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("p",{children:["Number of properties: ",n.length," properties"]}),(0,_.jsx)(g.Z,{apiKey:p.ie.map,defaultCenter:t,containerHeight:"600px",zoom:11,defaultOptions:{styles:u},children:(0,_.jsx)(f.Z,{averageCenter:!0,enableRetinaIcons:!0,gridSize:60,children:n.length>0&&n.forEach(function(e,n){var t=e.addressLine1,r=e.bookings,o=e.city,i=e.id,c=e.lat,l=e.lng,d=e.postCode;if(c&&l){var p=r.length;return(0,_.jsx)(T,{address:{bookings:r,lat:c,lng:l},onClick:function(e){return p>0?x(r):a(e,i)},children:s[i]&&(0,_.jsx)(I,{address:{addressLine1:t,bookings:r,city:o,id:i,postCode:d},onCloseClick:function(e){return a(e,i,!1)}})},n)}})})}),(0,_.jsxs)(E,{children:[(0,_.jsxs)("span",{children:[(0,_.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),"Uploaded Address"]}),(0,_.jsxs)("span",{children:[(0,_.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/pink-dot.png"}),"Job Booked"]})]})]})},function(e,n){if(e.addresses.length===n.addresses.length)return!0}),E=l.ZP.div.withConfig({displayName:"map__Description",componentId:"sc-1g48jil-0"})(["padding:10px;margin:30px 10px 10px 10px;text-align:center;img{max-width:24px;}img:last-child{margin-left:20px;}"]),N=function(){var e=(0,r.a)(o.Un).data,n=(e=void 0===e?{properties:[]}:e).properties;return(0,_.jsx)(i.Z,{pageHeading:{heading:"Map"},children:(0,_.jsx)(s.Z,{open:!0,title:"Map",children:(0,_.jsx)(P,{addresses:n})})})}},11502:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties/map",function(){return t(77050)}])}},function(e){e.O(0,[2283,212,8890,619,1100,1336,4135,5020,1564,4244,3911,4046,3077,4669,7725,9774,2888,179],function(){return e(e.s=11502)}),_N_E=e.O()}]);