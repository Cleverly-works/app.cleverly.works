(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[832],{15641:function(e,n,t){"use strict";t.d(n,{z:function(){return i}});var r,o=t(71383),i=(0,t(75063).Ps)(r||(r=(0,o.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"])))},92264:function(e,n,t){"use strict";t.d(n,{H:function(){return c}});var r=t(59499),o=t(55377),i=t(16551),a=t(77439),s=t(85893);function u(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var c=function(e){var n=e.children,t=e.content,c=e.context,l=e.data,d=e.disabled,p=e.handleClick,m=e.size,f=e.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:"sm"}),(0,s.jsxs)(i.Z,{align:"flex-end",children:[n,(0,s.jsx)(a.Z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?u(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({content:t,context:c,disabled:d,onClick:p,size:m,type:f},l))]})]})};c.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},71534:function(e,n,t){"use strict";t.d(n,{N:function(){return a}});var r=t(58594),o=t(85893),i=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],a=function(e){var n=e.data,t=e.errors,a=e.name,s=e.onChange,u=e.register;return(0,o.jsx)(r.Z,{errors:t,data:n||i,legend:"",name:a,onChange:s,register:u})};a.defaultProps={name:"assignedToMe"}},75420:function(e,n,t){"use strict";t.d(n,{r:function(){return i}});var r=t(95103),o=t(85893),i=function(e){var n=e.errors,t=e.name,i=e.onChange,a=e.options,s=e.register;return(0,o.jsx)(r.Z,{errors:n,name:t,onChange:i,options:a,register:s})};i.defaultProps={name:"status"}},59636:function(e,n,t){"use strict";t.d(n,{H_:function(){return b},Vw:function(){return I},aL:function(){return v},iU:function(){return O},pf:function(){return g},sW:function(){return _},wd:function(){return x},xY:function(){return y},yT:function(){return h}});var r,o,i,a,s,u,c,l,d,p=t(71383),m=t(75063),f=t(4431),v=(0,m.Ps)(r||(r=(0,p.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]))),g=(0,m.Ps)(o||(o=(0,p.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]))),x=(0,m.Ps)(i||(i=(0,p.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]))),b=(0,m.Ps)(a||(a=(0,p.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]))),y=(0,m.Ps)(s||(s=(0,p.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]))),h=(0,m.Ps)(u||(u=(0,p.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]))),_=(0,m.Ps)(c||(c=(0,p.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),I=(0,m.Ps)(l||(l=(0,p.Z)(['\n  query GetJob($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"])),f.WW,f.MR),O=(0,m.Ps)(d||(d=(0,p.Z)(["\n  mutation calculateJobFinance($jobId: Int!, $invoiceType: String!) {\n    calculateJobFinance(jobId: $jobId, invoiceType: $invoiceType) {\n      data\n    }\n  }\n"])))},69496:function(e,n,t){"use strict";t.d(n,{$E:function(){return Q},AX:function(){return U},I4:function(){return O},JA:function(){return C},MT:function(){return P},Px:function(){return q},WF:function(){return j},ZA:function(){return D},a8:function(){return S},fA:function(){return Z},fo:function(){return $},ge:function(){return k},iM:function(){return L},nE:function(){return R},nh:function(){return w},r1:function(){return A},tW:function(){return F},uz:function(){return T}});var r,o,i,a,s,u,c,l,d,p,m,f,v,g,x,b,y,h,_=t(71383),I=t(75063),O=(0,I.Ps)(r||(r=(0,_.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),U=(0,I.Ps)(o||(o=(0,_.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),$=(0,I.Ps)(i||(i=(0,_.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),C=(0,I.Ps)(a||(a=(0,_.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),j=(0,I.Ps)(s||(s=(0,_.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]))),q=(0,I.Ps)(u||(u=(0,_.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]))),S=(0,I.Ps)(c||(c=(0,_.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]))),A=(0,I.Ps)(l||(l=(0,_.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]))),P=(0,I.Ps)(d||(d=(0,_.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]))),R=(0,I.Ps)(p||(p=(0,_.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),w=(0,I.Ps)(m||(m=(0,_.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]))),L=(0,I.Ps)(f||(f=(0,_.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]))),Z=(0,I.Ps)(v||(v=(0,_.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),Q=(0,I.Ps)(g||(g=(0,_.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]))),T=(0,I.Ps)(x||(x=(0,_.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]))),k=(0,I.Ps)(b||(b=(0,_.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']))),D=(0,I.Ps)(y||(y=(0,_.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),F=(0,I.Ps)(h||(h=(0,_.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"])))},3896:function(e,n,t){"use strict";t.d(n,{X:function(){return m}});var r,o,i=t(71383),a=t(16835),s=t(59499),u=t(67294),c=t(6812),l=t(50319),d=t(75063),p=t(55863);function m(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,p.q)().user,o=(0,u.useState)(function(){try{switch(t){case"network":return n;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||n}}catch(r){return n}}),i=o[0],d=o[1],m=function(n){try{var o=n instanceof Function?n(i):n;switch(d(o),t){case"network":x({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,s.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(a){}};(0,c.a)(f,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==t,onCompleted:function(t){var r=t.accountUser;r&&d(r.filters[e]||n)}});var g=(0,l.D)(v),x=(0,a.Z)(g,1)[0];return[i,m]}var f=(0,d.Ps)(r||(r=(0,i.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]))),v=(0,d.Ps)(o||(o=(0,i.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"])))},33366:function(e,n,t){"use strict";t.d(n,{AK:function(){return u},DJ:function(){return d},E6:function(){return o},cj:function(){return s},hD:function(){return l},iz:function(){return i},l8:function(){return c},yW:function(){return a}});var r=t(60092),o=[{text:"Quotation Requested",value:"supplierQuoteRequested",context:"info"},{text:"Quotation Completed",value:"supplierQuoteComplete",context:"help"},{text:"Draft Quotation",value:"supplierQuoteDraft",context:"info"},{text:"Awaiting threshold approval",value:"waitingThresholdApproval",context:"info"},{text:"Quotation Refused",value:"supplierQuoteRefused",context:"danger"},{text:"Quotation Sent",value:"supplierQuoteSent",context:"success"},{text:"Quotation Accepted",value:"quotationAccepted",context:"success"},{text:"Quotation Rejected",value:"quotationRejected",context:"danger"},{text:"Quotation Updated",value:"supplierQuoteUpdated",context:"success"}],i=[{text:"New Quote",value:"quoteNew",customerText:"Quote issued",supplierText:null},{text:"Sent to Supplier(s)",value:"quoteOffered",customerText:"Quote issued",supplierText:"Quote offered"},{text:"Received from Supplier(s)",value:"quoteReceived",customerText:"Final review",supplierText:"Quote submitted"},{text:"Sent to Customer",value:"quoteSent",customerText:"Awaiting approval",supplierText:"Awaiting approval"},{text:"Quote Accepted",value:"quoteAccepted",customerText:"Quote accepted",supplierText:"Quote accepted"},{text:"Quote Rejected",value:"quoteRejected",customerText:"Quote rejected",supplierText:"Quote rejected"},{text:"Canceled",value:"quoteCancelled",customerText:"Cancelled",supplierText:null},{text:"Closed",value:"quoteClosed",customerText:"Closed",supplierText:"Closed"}],a=[{text:"Pending",value:"pending",colour:r.Q.COLOUR.info},{text:"Raised",value:"raised",colour:r.Q.COLOUR.info},{text:"Offered",value:"offered",colour:r.Q.COLOUR.warning},{text:"Accepted",value:"accepted",colour:r.Q.COLOUR.success},{text:"In Progress",value:"inProgress",colour:r.Q.COLOUR.primary},{text:"Completed",value:"completed",colour:r.Q.COLOUR.muiLightGray},{text:"Awaiting threshold approval",value:"waitingThresholdApproval",colour:r.Q.COLOUR.info},{text:"Report Sent",value:"reportSent",colour:r.Q.COLOUR.muiGray},{text:"Invoice Sent",value:"invoiceSent",colour:r.Q.COLOUR.secondary},{text:"Customer Paid",value:"customerPaid",colour:r.Q.COLOUR.help},{text:"Supplier Paid",value:"supplierPaid",colour:r.Q.COLOUR.help},{text:"Canceled",value:"canceled",colour:r.Q.COLOUR.black},{text:"Closed",value:"closed",colour:r.Q.COLOUR.black},{text:"On Hold",value:"onHold",colour:r.Q.COLOUR.black},{text:"Continued",value:"continued",colour:r.Q.COLOUR.primary},{text:"Paused",value:"paused",colour:r.Q.COLOUR.black}],s=[{label:"Pending",value:"pending"},{label:"Raised",value:"raised"},{label:"Offered",value:"offered"},{label:"Accepted",value:"accepted"},{label:"In Progress",value:"inProgress"},{label:"Completed",value:"completed"},{label:"Awaiting threshold approval",value:"waitingThresholdApproval"},{label:"Report Sent",value:"reportSent"},{label:"Invoice Sent",value:"invoiceSent"},{label:"Customer Paid",value:"customerPaid"},{label:"Supplier Paid",value:"supplierPaid"},{label:"Quote",value:"quote"},{label:"Site Visit",value:"siteVisit"},{label:"Canceled",value:"canceled"},{label:"Closed",value:"closed"},{label:"On Hold",value:"onHold"},{label:"Continued",value:"continued"},{label:"Paused",value:"paused"}],u=[{text:"Uplift Draft",value:"upliftDraft",context:"info"},{text:"Supplier Uplift Requested",value:"supplierUpliftRequested",context:"secondary"},{text:"Uplift Requested Send to Customer",value:"upliftRequestSendCustomer",context:"secondary"},{text:"Uplift Approved",value:"customerUpliftApproved",context:"success"},{text:"Uplift Rejected",value:"customerUpliftRejected",context:"danger"}],c=[{text:"Offered",value:"offered",context:"info"},{text:"Raised",value:"raised",context:"info"},{text:"Pending",value:"pending",context:"info"},{text:"Accepted",value:"accepted",context:"info"},{text:"Uplift Requested by Supplier",value:"supplierUpliftRequested",context:"info"},{text:"Uplift Draft",value:"upliftDraft",context:"info"},{text:"Uplift Requested Send Customer",value:"upliftRequestSendCustomer",context:"info"},{text:"Uplift Requested Approved",value:"customerUpliftApproved",context:"success"},{text:"In Dispute",value:"inDispute",context:"info"},{text:"Resumed",value:"resumed",context:"Danger"},{text:"Quote Sent",value:"quoteSent",context:"info"},{text:"Quote Offered",value:"quoteOffered",context:"info"},{text:"Report Sent Supplier",value:"reportSentSupplier",context:"info"},{text:"Dispute Resolved",value:"disputeResolved",context:"info"},{text:"Validated",value:"validated",context:"success"},{text:"Un Validated",value:"unvalidated",context:"success"},{text:"Paused",value:"paused",context:"info"},{text:"TimingChanged",value:"timingChanged",context:"info"},{text:"Customer Paid",value:"customerPaid",context:"info"},{text:"In Progress",value:"inProgress",context:"info"},{text:"PPM Invoice Created",value:"ppmInvoiceCreated",context:"success"},{text:"Late Arrival",value:"lateArrival",context:"info"},{text:"Pricing Changed",value:"pricingChanged",context:"info"},{text:"Report Sent",value:"reportSent",context:"info"},{text:"Invoice Sent Supplier",value:"invoiceSentSupplier",context:"info"},{text:"Invoice Sent",value:"invoiceSent",context:"info"},{text:"Invoice Sent Customer",value:"invoiceSentCustomer",context:"info"},{text:"Quote Accepted",value:"quoteAccepted",context:"info"},{text:"On Hold",value:"onHold",context:"info"},{text:"Continued",value:"continued",context:"info"},{text:"Quote Received",value:"quoteReceived",context:"info"},{text:"Quote New",value:"quoteNew",context:"info"},{text:"Closed",value:"closed",context:"danger"},{text:"Re posted",value:"reposted",context:"info"},{text:"Supplier Paid",value:"supplierPaid",context:"info"},{text:"Rejected",value:"rejected",context:"info"},{text:"Completed",value:"completed",context:"info"},{text:"Canceled",value:"canceled",context:"danger"}],l=[{value:"complete",text:"Complete"},{value:"returnVisitByAnother",text:"Return Visit By Another"},{value:"returnVisit",text:"Return Visit"},{value:"completeCertificate",text:"Complete Certificate"},{value:"couldNotDo",text:"Could Not Do"}],d=[{text:"Not yet offered",value:"pending",colour:r.Q.COLOUR.muiGray},{text:"Not yet offered",value:"raised",colour:r.Q.COLOUR.muiGray},{text:"Offered",value:"offered",colour:r.Q.COLOUR.warning},{text:"Not yet started",value:"accepted",colour:r.Q.COLOUR.white},{text:"In Progress",value:"inProgress",colour:r.Q.COLOUR.primary},{text:"Completed",value:"completed",colour:r.Q.COLOUR.secondary},{text:"Requires approval",value:"waitingThresholdApproval",colour:r.Q.COLOUR.info},{text:"Completed",value:"reportSent",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"invoiceSent",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"customerPaid",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"supplierPaid",colour:r.Q.COLOUR.secondary},{text:"Quote",value:"quote",colour:r.Q.COLOUR.white},{text:"Not yet started",value:"siteVisit",colour:r.Q.COLOUR.white},{text:"Closed",value:"canceled",colour:r.Q.COLOUR.black},{text:"Closed",value:"closed",colour:r.Q.COLOUR.black},{text:"On Hold",value:"onHold",colour:r.Q.COLOUR.help},{text:"In Progress",value:"continued",colour:r.Q.COLOUR.primary},{text:"Closed",value:"paused",colour:r.Q.COLOUR.black},{text:"Not yet offered",value:"quoteNew",colour:r.Q.COLOUR.muiGray},{text:"Offered",value:"quoteOffered",colour:r.Q.COLOUR.warning},{text:"Completed",value:"quoteReceived",colour:r.Q.COLOUR.secondary},{text:"Requires approval",value:"quoteSent",colour:r.Q.COLOUR.info},{text:"Not yet started",value:"quoteAccepted",colour:r.Q.COLOUR.white},{text:"Closed",value:"quoteRejected",colour:r.Q.COLOUR.black},{text:"Closed",value:"quoteCancelled",colour:r.Q.COLOUR.black},{text:"Closed",value:"quoteClosed",colour:r.Q.COLOUR.black},{text:"Not yet started",value:"ppmNew",colour:r.Q.COLOUR.white}]},12964:function(e,n,t){"use strict";t.d(n,{J:function(){return $}});var r=t(59499),o=t(16835),i=t(4730),a=t(11163),s=t(67294),u=t(9270),c=t(62140),l=t(42283),d=t(76600),p=t(58965),m=t(49501),f=t(75903),v=t(77439),g=t(92264),x=t(3896),b=t(85893);function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _=function(e){var n=e.initialValues,t=e.renderFilters,r=e.setFilters,i=e.lastQuery,a=e.filters,y=(0,x.X)("form_data_".concat(n.filterType),n),_=(0,o.Z)(y,2),I=_[0],O=_[1],U=(0,l.cI)({defaultValues:I||n}),$=U.control,C=U.errors,j=U.handleSubmit,q=U.register,S=U.reset,A=U.watch,P=U.setValue,R=A(),w=h(h({},R),{},{filterType:n.filterType});(0,s.useEffect)(function(){S(w)},[S]),(0,s.useEffect)(function(){O(w)},[a]);var L=function(e){var t=e.query;if(t!==i){var o={q:"%".concat(t,"%")||0},a=/^\d+$/.test(t);"id"in n&&(o.id=a?Number(t):null),"meta"in n&&(o.meta=a?{invoiceNumbers:[t]}:null),"jobNumber"in n&&(o.jobNumber=a?String(t):null,o.invoiceNumber=a?Number(t):null),r(function(e){return h(h({},e),o)})}},Z=function(e){Object.keys(n).map(function(e){return P(e,null)}),r(n),S(n),L("")};return(0,b.jsx)(d.Z,{handleSubmit:j(L),children:(0,b.jsxs)(p.Z,{title:"Filters",children:[(0,b.jsxs)(u.Z,{children:[(0,b.jsx)(c.Z,{sm:12,lg:12,children:(0,b.jsx)(m.Z,{label:"",children:(0,b.jsx)(f.Z,{errors:C,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:q,type:"search"})})}),(0,b.jsx)(c.Z,{sm:12,lg:12,children:t({control:$,errors:C,initialValues:n,register:q,setFilters:r,watch:A,setValue:P,reset:S})})]}),(0,b.jsx)(g.H,{content:"Search",context:"secondary",handleClick:L,type:"submit",children:(0,b.jsx)(v.Z,{content:"Clear",context:"danger",onClick:Z,size:"sm"})})]})})},I=["FiltersComp","initialFilters","TableComp"];function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function U(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var $=function(e){var n=e.FiltersComp,t=e.initialFilters,r=e.TableComp,l=(0,i.Z)(e,I),d=(0,x.X)("form_data_".concat(t.filterType),t),p=(0,o.Z)(d,2),m=p[0],f=p[1],v=(0,s.useState)(m||t),g=v[0],y=v[1],h=(0,a.useRouter)().query.show;return(0,s.useEffect)(function(){f(g)},[g,f]),(0,b.jsx)(u.Z,{children:(0,b.jsxs)(c.Z,{sm:12,lg:12,children:[(0,b.jsx)(_,{initialValues:t,renderFilters:function(e){return(0,b.jsx)(n,U(U(U({},e),l),{},{show:h}))},setFilters:y,filters:g}),(0,b.jsx)(r,U({filters:g,initialFilters:t},l))]})})}},47266:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return H}});var r,o=t(19076),i=t(12964),a=t(50029),s=t(59499),u=t(64687),c=t.n(u),l=t(67294),d=t(11163),p=t.n(d),m=t(66252),f=t(6812),v=t(71383),g=t(75063),x=t(15641),b=t(59636),y=t(4431),h=t(69496),_=(0,g.Ps)(r||(r=(0,v.Z)(['\n  query GetJobs(\n    $assetId: Int\n    $customerId: Int\n    $date: timestamptz\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $paid: Boolean\n    $q: String\n    $status: [String!]\n    $supplierId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _or: [{ hash: { _ilike: $q } }, { reference: { _ilike: $q } }]\n        status: { _in: $status }\n        type: { _eq: "reactive" }\n        assetId: { _eq: $assetId }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        paid: { _eq: $paid }\n        supplierId: { _eq: $supplierId }\n        JobTimings: { status: { _eq: "validated" } }\n        _not: { meta: { _has_key: "revisions" } }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n      }\n      location: Location {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      sla: SLA {\n        id\n        name\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        hash: { _ilike: $q }\n        status: { _in: $status }\n        type: { _eq: "reactive" }\n        assetId: { _eq: $assetId }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n        JobTimings: { status: { _eq: "validated" } }\n        _not: { meta: { _has_key: "revisions" } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),x.z,y.WW,b.aL,b.wd,h.Px),I=t(38512),O=t(62466),U=t(26186),$=t(58965),C=t(16551),j=t(77439),q=t(16540),S=t(58303),A=t(33366),P=t(85893);function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var L=function(e){var n,t,r=e.filters,o=(0,m.x)(),i=(0,l.useState)({item:"SLA",inneritem:"name",order:"asc"}),u=i[0],d=i[1],v=w(w({},r),{},{assetId:r.assetId||null,managerId:r.managerId||null,offset:0,limit:50,orderBy:u.inneritem?(0,s.Z)({},u.item,(0,s.Z)({},u.inneritem,u.order)):(0,s.Z)({},u.item,u.order)}),g=(0,f.a)(_,{variables:v}),x=g.loading,b=g.data,y=(b=void 0===b?{jobs:[],meta:{aggregate:{totalCount:0}}}:b).jobs,h=b.meta,R=g.refetch,L=(n=(0,a.Z)(c().mark(function e(n){var t,r,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.query({query:I.E6,variables:{id:n}});case 2:i=(r=void 0===(r=e.sent.data)?{account:{}}:r).job,(0,S.eW)(o,i);case 7:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),Z=[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Priority"},{text:"Service"},{text:"Job ID"},{formatter:(0,O.Z)("/dashboard/users/view","managerId","manager"),text:"Assigned to"},{formatter:(0,O.Z)("/dashboard/properties/view","propertyId","location"),text:"Location"},{formatter:(0,O.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer"},{formatter:(0,O.Z)("/dashboard/suppliers/view","supplierId","supplier"),text:"Supplier"},{text:"Scheduled",sortable:!0,sortName:"timingStart"},{text:"Created",sortable:!0,sortName:"createdAt"},{text:"Status"}],Q=function(e){p().push("".concat("/dashboard/maintenance/","view?id=").concat(e.id))},T=(t=(0,a.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(y.map(function(e){return L(e.id)}));case 2:R();case 3:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)});return(0,P.jsxs)($.Z,{open:!0,title:"Work Orders Maintenance",children:[(0,P.jsx)(C.Z,{align:"flex-end",children:(0,P.jsx)(j.Z,{content:"Update ".concat(Math.min(50,h.aggregate.totalCount)," of ").concat(h.aggregate.totalCount),context:"secondary",onClick:T,size:"sm"})}),(0,P.jsx)("br",{}),(0,P.jsx)(q.Z,{columns:Z,loading:x,rowClick:Q,rows:y.map(function(e){var n,t,r,o,i,a,s,u=(A.yW.find(function(n){return n.value===e.status})||{text:""}).text,c=e.manager?"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast):"Unassigned",l=e.scheduledAt?(0,U.Z)(e.scheduledAt,!0):(0,U.Z)(e.timingStart,!0);return{id:e.id,propertyId:null===(n=e.location)||void 0===n?void 0:n.id,managerId:null===(t=e.manager)||void 0===t?void 0:t.id,customerId:null===(r=e.customer)||void 0===r?void 0:r.id,supplierId:e.supplier?e.supplier.id:"",priority:(null===(o=e.sla)||void 0===o?void 0:o.name)||"-",service:(null===(i=e.service)||void 0===i?void 0:i.name)||"-",hash:"#"+e.hash,manager:c,location:(null===(a=e.location)||void 0===a?void 0:a.name)||"-",customer:(null===(s=e.customer)||void 0===s?void 0:s.name)||"-",supplier:e.supplier?e.supplier.name:"-",scheduleDate:l,date:(0,U.Z)(e.createdAt),status:u}}),sort:u,setSort:d})]})};L.defaultProps={filters:{assetId:null,customerId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"issues_table_maintenance"}};var Z=t(27812),Q=t(52019),T=t(9270),k=t(62140),D=t(71534),F=t(71772),N=t(75420);function J(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function M(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?J(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):J(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var E=function(e){var n=e.control,t=e.errors,r=e.register,o=e.setFilters,i=(0,l.useContext)(Q.Z).hasRole,a=[{text:"Status",value:""}].concat((0,Z.Z)(A.yW)),s={control:n,errors:t,register:r};return(0,P.jsx)(P.Fragment,{children:i("admin")&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(T.Z,{children:[(0,P.jsx)(k.Z,{md:6,children:(0,P.jsx)(N.r,M(M({},s),{},{onChange:function(e){return o(function(n){return M(M({},n),{},{status:e.target.value||null})})},options:a}))}),(0,P.jsx)(k.Z,{md:6,children:(0,P.jsx)(F.P,M(M({},s),{},{errors:M({},t),label:"",name:"customerId",onChange:function(e){return o(function(n){return M(M({},n),{},{customerId:(null==e?void 0:e.value)||null})})},placeholder:"Select customer",type:"customer"}))})]}),(0,P.jsxs)(T.Z,{children:[(0,P.jsx)(k.Z,{md:6,children:(0,P.jsx)(F.P,M(M({},s),{},{errors:M({},t),label:"",name:"locationId",onChange:function(e){return o(function(n){return M(M({},n),{},{locationId:(null==e?void 0:e.value)||null})})},placeholder:"Select Location",type:"property"}))}),(0,P.jsx)(k.Z,{md:6,children:(0,P.jsx)(F.P,M(M({},s),{},{errors:M({},t),label:"",name:"supplierId",onChange:function(e){return o(function(n){return M(M({},n),{},{supplierId:(null==e?void 0:e.value)||null})})},placeholder:"Select supplier",type:"supplier"}))})]}),(0,P.jsx)(T.Z,{children:(0,P.jsx)(k.Z,{md:6,children:(0,P.jsx)(D.N,M(M({},s),{},{name:"managerId",onChange:function(e){return o(function(n){return M(M({},n),{},{managerId:e.target.checked})})}}))})})]})})},V={customerId:null,locationId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"issues_table_maintenance"},G=function(){return(0,P.jsx)(i.J,{FiltersComp:E,initialFilters:V,TableComp:L})},H=function(){return(0,P.jsx)(o.Z,{pageHeading:{heading:"Maintenance"},View:(0,P.jsx)(G,{})})}},19315:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/maintenance",function(){return t(47266)}])}},function(e){e.O(0,[2283,1336,5370,6540,9241,4337,1772,8303,9774,2888,179],function(){return e(e.s=19315)}),_N_E=e.O()}]);