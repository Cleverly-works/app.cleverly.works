(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503,1772],{1950:function(e,n,t){"use strict";t.d(n,{V:function(){return S}});var r=t(59499),i=t(27812),o=t(26447),a=t(15861),s=t(21023),c=t(93946),u=t(72428),d=t(67294),l=t(9164),m=t(42283),p=t(79665),y=t(50135),f=t(11057),b=t(51797),v=t(46761),g=t(74231),h=g.Ry({name:g.Z_().required(),url:g.Z_().url().required()}),j=t(85893);function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _=function(e){var n=e.noEdit,t=e.noDelete,r=e.onDelete,i=e.id,a=e.isAdded,u=e.url,g=e.name,I=e.onSave,_=(0,d.useState)(a),q=_[0],O=_[1],S=(0,m.cI)({resolver:(0,p.S)(h)}),w=S.control,Z=S.handleSubmit,$=S.errors,A=function(e){e.stopPropagation(),O(!0)},P=function(e){e.stopPropagation(),O(!1),g&&u||r()},D=function(e){I(e),O(!1)};return(0,j.jsx)("form",{children:q?(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(o.Z,{spacing:1,children:[(0,j.jsx)(m.Qr,{control:w,name:"name",defaultValue:g,render:function(e){var n;return(0,j.jsx)(y.Z,x(x({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{},{error:$.name,helperText:null===(n=$.name)||void 0===n?void 0:n.message}))}}),(0,j.jsx)(m.Qr,{control:w,name:"url",defaultValue:u,render:function(e){var n;return(0,j.jsx)(y.Z,x(x({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{},{error:$.url,helperText:null===(n=$.url)||void 0===n?void 0:n.message}))}})]}),(0,j.jsxs)(o.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,j.jsx)(f.Z,{variant:"contained",color:"danger",size:"small",onClick:P,children:"Cancel"}),(0,j.jsx)(f.Z,{variant:"contained",size:"small",onClick:Z(D),children:"Save"})]})]}):(0,j.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,j.jsx)(l.r,{target:"_blank",variant:"body1",color:"secondary",href:u,sx:{textDecoration:"auto",fontWeight:700},children:g}),!n&&(0,j.jsx)(s.Z,{title:"Edit",placement:"top-start",children:(0,j.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:A,children:(0,j.jsx)(b.Z,{sx:{fontSize:"16px"}})})}),!t&&(0,j.jsx)(s.Z,{title:"Delete",placement:"top-start",children:(0,j.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return r(i)},children:(0,j.jsx)(v.Z,{sx:{fontSize:"16px"}})})})]})})};function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}_.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}};var S=function(e){var n=e.values,t=e.setValue,r=e.name,l=e.title,m=e.displayMode,p=e.noDeleteEdit,y=e.titleSx,f=(0,d.useState)([]),b=f[0],v=f[1];(0,d.useEffect)(function(){Array.isArray(n)&&v(n)},[n]);var g=function(e){e.stopPropagation(),v(function(e){return[].concat((0,i.Z)(e),[{name:"",link:"",isAdded:!0}])})},h=function(e,n){var o=(0,i.Z)(b);o.splice(e,1,n),t(r,o)};return(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,j.jsxs)(a.Z,{sx:y,children:[l,":"]}),!m&&(0,j.jsx)(s.Z,{title:"Add new link",placement:"top-start",children:(0,j.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:g,children:(0,j.jsx)(u.Z,{})})})]}),(0,j.jsx)(o.Z,{pl:2,spacing:.8,children:null!=b&&b.length?b.map(function(e,i){var o;return(0,j.jsx)(_,O(O({index:i},e),{},{noEdit:p||m,noDelete:p||m,onDelete:function(){var e=n.filter(function(e,n){return n!==i});t(r,e),v(e)},onSave:function(e){return h(i,e)}}))}):(0,j.jsx)(a.Z,{typography:"subtitle2",children:"No data"})})]})};S.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}}},58969:function(e,n,t){"use strict";t.d(n,{k:function(){return j}});var r=t(59499),i=t(42283),o=t(79665),a=t(76600),s=t(9270),c=t(62140),u=t(49501),d=t(55563),l=t(6710),m=t(95103),p=t(74231),y=(0,p.Ry)().shape({name:(0,p.Z_)(),invoicingEntity:(0,p.Z_)(),addressLine1:(0,p.Z_)().required(),addressLine2:(0,p.Z_)(),addressLine3:(0,p.Z_)(),city:(0,p.Z_)().required(),postCode:(0,p.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,p.Z_)(),countryId:(0,p.Z_)().required()}),f=t(92264),b=t(77329),v=t(85893);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var j=function(e){var n=e.defaultValues,t=(e.onCancel,e.onSubmit),r=e.type,p=(0,i.cI)({defaultValues:h({},n),resolver:(0,o.S)(y)}),g=p.control,j=p.errors,I=p.handleSubmit,x={control:g,errors:j,register:p.register};return(0,v.jsxs)(a.Z,{id:"offCanvasForm",handleSubmit:I(t),children:[(0,v.jsxs)(s.Z,{children:[(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(u.Z,{label:"Address name",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"name"}))})}),"invoice"===r&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(u.Z,{label:"invoicing email",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"invoicingEmail",type:"email"}))})}),(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(u.Z,{label:"Invoicing entity",children:(0,v.jsx)(l.Z,h(h({},x),{},{name:"invoicingEntity",rows:4}))})})]}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"Address Line 1",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"addressLine1"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"Address Line 2",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"addressLine2"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"Address Line 3",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"addressLine3"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"City",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"city"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"Post Code",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"postCode"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"County",children:(0,v.jsx)(d.Z,h(h({},x),{},{name:"county"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(u.Z,{label:"Country",children:(0,v.jsx)(m.Z,h(h({},x),{},{name:"countryId",options:b.O}))})})]}),(0,v.jsx)(s.Z,{justify:"end",children:(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(f.H,{content:"Submit",type:"submit"})})}),(null==n?void 0:n.id)&&(0,v.jsx)(d.Z,h(h({},x),{},{name:"id",type:"hidden"})),(null==n?void 0:n.meta)&&(0,v.jsx)(d.Z,h(h({},x),{},{name:"meta",type:"hidden"}))]})}},38512:function(e,n,t){"use strict";t.d(n,{$6:function(){return k},Ab:function(){return A},E6:function(){return I},FA:function(){return S},TY:function(){return $},Tw:function(){return D},bZ:function(){return P},dL:function(){return q},iU:function(){return T},k7:function(){return Z},mJ:function(){return x},qD:function(){return _},r2:function(){return w},uA:function(){return O},wU:function(){return C}});var r,i,o,a,s,c,u,d,l,m,p,y,f,b,v,g=t(71383),h=t(75063),j=t(4431),I=(0,h.Ps)(r||(r=(0,g.Z)(['\n  query GetJob($adminId: Int!, $number: String!) {\n    job: Job(where: { adminId: { _eq: $adminId }, number: { _eq: $number } }) {\n      id\n      issueReportedDescription\n      number\n      adminId\n      title\n      description\n      reference\n      access\n      costCategory\n      pricing\n      timing\n      timingStart\n      timingEnd\n      timingNormalHours\n      paymentMethod\n      customerSpendThreshold\n      time\n      amount\n      supplierLabourAmount\n      supplierMaterialsAmount\n      source\n      discount\n      timingStatus\n      correctDuration\n      correctStart\n      correctEnd\n      reportPassFail\n      reportPassFailTitle\n      requireReportRecommendations\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      onSiteTimingEnd\n      issueReportedDescription\n      permitsLinks\n      relatedLinks\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n\n      assetCategory: AssetCategory {\n        name\n        id\n      }\n      assets: Assets {\n        id\n        status\n        jobId\n        asset: Asset {\n          id\n          name\n        }\n      }\n      issueTypes: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "issueType" } }\n        }\n      ) {\n        id\n        issue: Taxonomy {\n          id\n          name\n        }\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      ppmInvoices: AccountEntries {\n        Invoices {\n          id\n          invoiceNumber\n          invoiceType\n          meta\n          createdAt\n          accountEntry: AccountEntry {\n            id\n          }\n        }\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        accountEntry: AccountEntry {\n          id\n          meta\n        }\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      customer: Customer {\n        meta\n      }\n      supplierDeposit\n      rebate\n      status\n      workStatus\n      supplierNotes\n      ppm\n      quoted\n      quoteNumber\n      quoteDue\n      quoteDueSupplier\n      scheduledAt\n      createdAt\n      updatedAt\n      supplierId\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      siteVisitStart\n      siteVisitEnd\n      siteVisitWeekends\n      tenantId\n      quoteCharge\n      quoteChargeAmount\n      jobScheduleId\n      type\n      meta\n      customerFinances\n      compliances: Compliances(where: { entity: { _eq: "Job" } }) {\n        id\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n\n      admin: Admin {\n        id\n        name\n        meta\n        bankAccounts: BankAccounts {\n          id\n          bank\n          stripeId\n          accountNumber\n          routingNumber\n          bic\n          iban\n          status\n          default\n          createdAt\n          meta\n        }\n        addresses: Addresses {\n          id\n          registered\n          operating\n          trading\n          invoice\n          status\n          createdAt\n          address: Address {\n            id\n            name\n            addressLine1\n            addressLine2\n            addressLine3\n            city\n            county\n            geo\n            postCode\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n      customer: Customer {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n        financial: Financial {\n          id\n          amountOutstanding\n          approvalThreshold\n          arrangementFee\n          createdAt\n          creditLimit\n          creditRating\n          defaultPaymentMethod\n          invoicing\n          serviceRate\n          spendThreshold\n          stripeId\n          totalRevenue\n          unpaidInvoices\n        }\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        meta\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        amount\n        description\n        markup\n        total\n        unit\n        vat\n        paid\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        permitsRequired\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            countryId\n            country: Country {\n              id\n              name\n              code\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      quotations: SupplierQuotes(\n        where: { status: { _neq: "cancelled" } }\n        order_by: { quoteNumber: asc }\n      ) {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        rebate\n        recommended\n        status\n        totalDuration\n        totalDurationUnit\n        meta\n        updatedAt\n        siteVisitAt\n        type\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          supplierTotal\n          total\n          type\n          unitRate\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        media: Media(where: { entity: { _eq: "Quotation" } }) {\n          id\n        }\n      }\n      report: JobReport {\n        id\n        completion\n        meta\n        notes\n        timing\n        passFailStatus\n        recommendations\n        comments\n        createdAt\n        updatedAt\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          name\n          type\n          filename\n          category\n          meta\n        }\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            name: nameFirst\n            nameFirst\n            nameLast\n            phone\n            status\n            email\n            createdAt\n            fullName\n            accounts: Account_Users {\n              id\n              role\n              position\n              isContact\n              status\n              account: Account {\n                id\n                name\n                type\n              }\n            }\n          }\n        }\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        meta\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      tenant: Tenant {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      tenantUser: TenantUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          meta\n        }\n      }\n      answers: Taxonomy(\n        where: { Taxonomy: { type: { _eq: "jobQuestion" } } }\n        order_by: { taxonomyId: asc }\n      ) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      parentJob: ParentJob {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      childJobs: Jobs {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      compliances: Compliances(where: { entity: { _eq: "Job" } }) {\n        id\n      }\n    }\n  }\n  ',"\n  ","\n"])),j.WW,j.MR),x=(0,h.Ps)(i||(i=(0,g.Z)(["\n  mutation MyMutation($objects: [CreateJobInput]!, $adminId: Int!) {\n    createJob(adminId: $adminId, objects: $objects) {\n      data\n    }\n  }\n"]))),_=(0,h.Ps)(o||(o=(0,g.Z)(["\n  mutation UpdateJob($id: Int!, $changes: Job_set_input) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]))),q=(0,h.Ps)(a||(a=(0,g.Z)(['\n  query GetIssueTypesForSelect {\n    issueTypes: Taxonomy(where: { type: { _eq: "issueType" } }) {\n      value: id\n      label: name\n    }\n  }\n']))),O=(0,h.Ps)(s||(s=(0,g.Z)(['\n  mutation UpdateJob(\n    $jobId: Int!\n    $changes: Job_set_input\n    $deletedAssetIds: [Int!]\n    $assets: [Asset_Entity_insert_input!]!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $hasQuestions: Boolean!\n    $compliances: [Compliance_Entity_insert_input!]!\n    $media: [Media_Entity_insert_input!]!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $changes) {\n      id\n      status\n      number\n    }\n    insert_Media_Entity(objects: $media) {\n      returning {\n        id\n      }\n    }\n    insert_Asset_Entity(objects: $assets) {\n      returning {\n        id\n      }\n    }\n    delete_Asset_Entity(where: { id: { _in: $deletedAssetIds } }) {\n      returning {\n        id\n      }\n    }\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) @include(if: $hasQuestions) {\n      returning {\n        id\n      }\n    }\n    delete_Compliance_Entity(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      returning {\n        id\n      }\n    }\n    insert_Compliance_Entity(objects: $compliances) {\n      returning {\n        id\n      }\n    }\n  }\n']))),S=(0,h.Ps)(c||(c=(0,g.Z)(['\n  mutation UpdateJob(\n    $jobId: Int!\n    $originatorEmail: String!\n    $originatorChanges: User_set_input!\n    $changes: Job_set_input\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $hasQuestions: Boolean!\n  ) {\n    update_User(where: { email: { _eq: $originatorEmail } }, _set: $originatorChanges) {\n      returning {\n        id\n      }\n    }\n\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $changes) {\n      id\n      status\n    }\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) @include(if: $hasQuestions) {\n      returning {\n        id\n      }\n    }\n  }\n']))),w=(0,h.Ps)(u||(u=(0,g.Z)(["\n  mutation AddJob($objects: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $objects) {\n      returning {\n        id\n        status\n        notes\n        createdAt\n      }\n    }\n  }\n"]))),Z=(0,h.Ps)(d||(d=(0,g.Z)(["\n  mutation DeleteJobTiming($id: Int!, $quoteId: Int, $status: String) {\n    delete_JobTiming(\n      where: { jobId: { _eq: $id }, quoteId: { _eq: $quoteId }, status: { _eq: $status } }\n    ) {\n      returning {\n        jobId\n        status\n      }\n    }\n  }\n"]))),$=(0,h.Ps)(l||(l=(0,g.Z)(['\n  query GetJobPredefined(\n    $accountId: Int!\n    $locationId: Int!\n    $parentId: Int!\n    $assetId: Int!\n    $includeAccount: Boolean!\n    $includeLocation: Boolean!\n    $includeParentJob: Boolean!\n    $includeAsset: Boolean!\n  ) {\n    parentJob: Job_by_pk(id: $parentId) @include(if: $includeParentJob) {\n      id\n      title\n      description\n      reference\n      access\n      source\n      slaId\n      paymentMethod\n      pricing\n      customerSpendThreshold\n      amount\n      supplierLabourAmount\n      supplierMaterialsAmount\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      assets: Assets {\n        id\n        status\n        jobId\n        asset: Asset {\n          name\n          id\n        }\n      }\n      assetCategory: AssetCategory {\n        name\n        id\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          meta\n        }\n      }\n      answers: Taxonomy(\n        where: { Taxonomy: { type: { _eq: "jobQuestion" } } }\n        order_by: { taxonomyId: asc }\n      ) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      childJobs: Jobs {\n        createdAt\n        id\n        reference\n        status\n        title\n      }\n      compliances: Compliances(where: { entity: { _eq: "Job" } }) {\n        id\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n      }\n    }\n    customer: Account_by_pk(id: $accountId) @include(if: $includeAccount) {\n      id\n      name\n    }\n    location: Location_by_pk(id: $locationId) @include(if: $includeLocation) {\n      id\n      name\n      customerAssociations: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n        customer: Account {\n          id\n          name\n        }\n      }\n    }\n    asset: Asset_by_pk(id: $assetId) @include(if: $includeAsset) {\n      id\n      name\n      Category {\n        name\n        id\n      }\n    }\n  }\n']))),A=(0,h.Ps)(m||(m=(0,g.Z)(['\n  query GetSLAsForJobManage($customerId: Int!, $locationId: Int!) {\n    customerSlas: SLA_Entity(\n      where: { entityId: { _eq: $customerId }, entity: { _eq: "Account" } }\n    ) {\n      sla: SLA {\n        name\n      }\n      id\n      inUse\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n      createdAt\n      updatedAt\n      notes\n      slaId\n    }\n    locationSlas: SLA_Entity(\n      where: { entityId: { _eq: $locationId }, entity: { _eq: "Location" } }\n    ) {\n      sla: SLA {\n        name\n      }\n      id\n      inUse\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n      createdAt\n      updatedAt\n      notes\n      slaId\n      entity\n    }\n    slas: SLA(where: { status: { _eq: "active" } }, order_by: { name: asc }) {\n      id\n      label: name\n      notes\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n      createdAt\n      updatedAt\n      type\n      subtype\n    }\n  }\n']))),P=(0,h.Ps)(p||(p=(0,g.Z)(["\n  query GetJobFinanceLogs($jobId: Int!) {\n    logs: JobFinanceLog(where: { jobId: { _eq: $jobId } }, order_by: { createdAt: desc }) {\n      id\n      type\n      value\n      difference\n      createdAt\n      meta\n    }\n  }\n"]))),D=(0,h.Ps)(y||(y=(0,g.Z)(["\n  mutation AddJobFinanceLog($objects: [JobFinanceLog_insert_input!]!) {\n    insert_JobFinanceLog(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),C=(0,h.Ps)(f||(f=(0,g.Z)(["\n  mutation AddJob(\n    $timing: [JobTiming_insert_input!]!\n    $financeLog: [JobFinanceLog_insert_input!]!\n    $hasFinanceLog: Boolean!\n    $jobId: Int!\n    $jobChange: Job_set_input\n  ) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        notes\n        createdAt\n      }\n    }\n    insert_JobFinanceLog(objects: $financeLog) @include(if: $hasFinanceLog) {\n      returning {\n        id\n      }\n    }\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $jobChange) @include(if: $hasFinanceLog) {\n      id\n      status\n    }\n  }\n"]))),T=(0,h.Ps)(b||(b=(0,g.Z)(["\n  mutation calculateJobFinance(\n    $jobId: Int\n    $invoiceType: String\n    $customerId: Int\n    $scheduleId: Int\n    $locationId: Int\n  ) {\n    calculateJobFinance(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      customerId: $customerId\n      scheduleId: $scheduleId\n      locationId: $locationId\n    ) {\n      data\n    }\n  }\n"]))),k=(0,h.Ps)(v||(v=(0,g.Z)(["\n  subscription GetJobTimings($adminId: Int!, $number: String!) {\n    timings: JobTiming(\n      where: { Job: { adminId: { _eq: $adminId }, number: { _eq: $number } } }\n      order_by: { id: desc }\n    ) {\n      id\n      status\n      notes\n      meta\n      quoteId\n      createdAt\n      user: User {\n        id\n        fullName\n      }\n    }\n  }\n"])))},59636:function(e,n,t){"use strict";t.d(n,{H_:function(){return g},Vw:function(){return x},aL:function(){return f},iU:function(){return _},pf:function(){return b},sW:function(){return I},wd:function(){return v},xY:function(){return h},yT:function(){return j}});var r,i,o,a,s,c,u,d,l,m=t(71383),p=t(75063),y=t(4431),f=(0,p.Ps)(r||(r=(0,m.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]))),b=(0,p.Ps)(i||(i=(0,m.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]))),v=(0,p.Ps)(o||(o=(0,m.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]))),g=(0,p.Ps)(a||(a=(0,m.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]))),h=(0,p.Ps)(s||(s=(0,m.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]))),j=(0,p.Ps)(c||(c=(0,m.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]))),I=(0,p.Ps)(u||(u=(0,m.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),x=(0,p.Ps)(d||(d=(0,m.Z)(['\n  query GetJob($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"])),y.WW,y.MR),_=(0,p.Ps)(l||(l=(0,m.Z)(["\n  mutation calculateJobFinance($jobId: Int!, $invoiceType: String!) {\n    calculateJobFinance(jobId: $jobId, invoiceType: $invoiceType) {\n      data\n    }\n  }\n"])))},19958:function(e,n,t){"use strict";t.d(n,{V:function(){return G}});var r=t(16835),i=t(50029),o=t(59499),a=t(64687),s=t.n(a),c=t(67294),u=t(45697),d=t(6812),l=t(50319),m=t(95102),p=t(11163),y=t.n(p),f=t(42283),b=t(79665),v=t(76600),g=t(15214),h=t(9270),j=t(62140),I=t(49501),x=t(55563),_=t(6710),q=t(95103),O=t(84043),S=t(50480),w=t(69368),Z=t(11057),$=t(6054),A=t(71772),P=t(85893);function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?D(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var T=function(e){var n=e.accountId,t=e.accountName,r=e.canSelectAccount,i=e.control,o=e.errors,a=e.setValue,s=e.watch,u=n?{value:n,label:t}:s("propertyOwner"),d=(0,$.Z)(u),l=function(e){a("contactUser",null)};(0,c.useEffect)(function(){u!==d&&d&&l(u)},[u]);var m={control:i,errors:o};return(0,P.jsxs)(h.Z,{children:[(0,P.jsx)(j.Z,{md:6,children:(0,P.jsx)(A.P,C(C({},m),{},{defaultValue:n&&{value:n,label:t},errors:C({},o),isDisabled:!r,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,P.jsx)(j.Z,{md:6,children:(0,P.jsx)(A.P,C(C({},m),{},{accountId:(null==u?void 0:u.value)||null,errors:C({},o),isDisabled:!u,label:"Contact Name",name:"contactUser",placeholder:u?"Select":"Select the location owner",type:"user"}))})]})},k=t(34197),R=function(e,n){var t=e.propertyOwner,r=e.contactUser;return e.Account_Locations={data:{accountId:t.value}},delete e.propertyOwner,e.contactUserId=(null==r?void 0:r.value)||null,delete e.contactUser,n&&delete e.Account_Locations,e},E=function(e,n,t,r){var i={location:R(e,!0),locationId:n.locationId,accountId:n.accountId,newAccountId:n.newAccountId,hasChanged:n.hasChanged};r({variables:i})},L=t(74231),U=t(58969),F=t(26380),M=t(72936),J=t(58095);function N(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function V(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?N(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var H="/dashboard/properties/",G=function(e){var n,t,o,a,u=e.accountId,p=e.accountName,$=e.entity,A=e.data,D=e.refetch,C=e.onAddressCreated,N=e.isPropsComponent,G=e.initialValues,W=e.xeroContactId,z=e.displayXeroContacts,Q=e.xeroContacts,B=e.displaySignin,X=e.handleXeroAuthorize,Y=e.onClose,K=(0,J.a)(),ee=(0,M.x)().hasRole,en=(0,c.useState)(!1),et=en[0],er=en[1],ei=null==Q?void 0:Q.find(function(e){return e.value===W}),eo=V(V(V({},A?(location.propertyOwner={label:A.customer[0].account.name,value:A.customer[0].account.id},location.contactUser=(null==A?void 0:A.user)&&A.customer[0].account.id&&{label:A.user.fullName,value:A.user.id},location.access=A.access,location.name=A.name,location.status=A.status,location.permitsRequired=A.permitsRequired,location):{}),G),{},{xeroContact:ei})||{},ea=(0,f.cI)({defaultValues:eo,resolver:(0,b.S)((0,L.Ry)().shape({access:(0,L.Z_)().required(),contactUser:(0,L.Ry)().required(),name:(0,L.Z_)().required(),propertyOwner:(0,L.Ry)().required(),status:ee("admin")&&(0,L.Z_)().required(),permitsRequired:(0,L.O7)()}))}),es=ea.control,ec=ea.errors,eu=ea.handleSubmit,ed=ea.register,el=ea.setValue,em=ea.getValues,ep=ea.watch,ey=(0,d.a)(m.yf,{variables:{id:null==A?void 0:A.id},skip:!(null!=A&&A.id)}).data,ef=(ey=void 0===ey?{property:{}}:ey).property,eb=(o=(0,i.Z)(s().mark(function e(n){var t,r,i,o,a,c,u,d,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var a,s;return t=n.addressFormData,r=n.outerFormData,i={Addresses:{data:{Address:{data:V({},t)},entity:$}}},o=V(V(V({},em()),i),r),ee("customer")&&(o.status="active"),e.next=6,ej({variables:{objects:[R(a=o)]}});case 6:l=void 0===(d=(u=void 0===(u=(c=void 0===(c=e.sent.data)?{}:c).insert_Location)?{}:u).returning)?{}:d,C&&C(l),K.close();case 14:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),ev=(a=(0,i.Z)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:K.show({title:"Add new address",content:(0,P.jsx)(U.k,{onCancel:function(){},onSubmit:function(e){eb({addressFormData:e,outerFormData:n})},type:"text"}),submit:!1});case 1:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),eg=(0,l.D)(m.A1,{onCompleted:function(e){if(!N){var n=e.insert_Location.returning[0].id;K.close(),D?D():y().push("".concat(H,"view?id=").concat(n))}}}),eh=(0,r.Z)(eg,2),ej=eh[0],eI=eh[1].loading,ex=(0,l.D)(m.$A,{onCompleted:function(e){var n=e.update_Location_by_pk.id;K.close(),D?D():y().push("".concat(H,"view?id=").concat(n))}}),e_=(0,r.Z)(ex,2),eq=e_[0],eO=e_[1].loading,eS=(0,l.D)(m.$E),ew=(0,r.Z)(eS,1)[0],eZ=function(e){if(er(!1),A){if("inactive"===e.status&&!(n=ef.jobs).every(function(e){return!!(0,k.E)(e,["completed","closed"])})){er(!0);return}e.xeroContact&&ew({variables:{id:null==A?void 0:null===(o=A.customer[0])||void 0===o?void 0:o.account.id,changes:{meta:V(V({},null==A?void 0:null===(a=A.customer[0])||void 0===a?void 0:a.account.meta),{},{xeroContactId:e.xeroContact.value})}}});var n,t,r,i,o,a,s={locationId:null==A?void 0:A.id,accountId:null==A?void 0:null===(t=A.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==e?void 0:null===(r=e.propertyOwner)||void 0===r?void 0:r.value,hasChanged:(null==A?void 0:null===(i=A.customer[0])||void 0===i?void 0:i.account.id)!==(null==e?void 0:e.propertyOwner.value)};E(V(V({},e),{},{xeroContact:void 0}),s,A.id,eq),Y()}else ev(e),Y()},e$={control:es,errors:ec,register:ed};return(0,P.jsxs)(v.Z,{disabled:eI||eO,id:"offCanvasForm",handleSubmit:eu(eZ),children:[et&&(0,P.jsx)(g.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,P.jsx)(h.Z,{children:(0,P.jsx)(j.Z,{md:12,children:(0,P.jsx)(T,V(V({},e$),{},{accountId:u,accountName:p,canSelectAccount:!u,setValue:el,watch:ep}))})}),(0,P.jsx)(I.Z,{label:"Name",children:(0,P.jsx)(x.Z,V(V({},e$),{},{name:"name"}))}),(0,P.jsx)(I.Z,{label:"Access information",children:(0,P.jsx)(_.Z,V(V({},e$),{},{name:"access",rows:4}))}),ee("admin")&&(0,P.jsx)(I.Z,{label:"Status",children:(0,P.jsx)(q.Z,V(V({},e$),{},{name:"status",options:F.bg}))}),(0,P.jsx)(f.Qr,{name:"permitsRequired",control:es,render:function(e){var n=e.value,t=e.onChange;return(0,P.jsx)(S.Z,{control:(0,P.jsx)(w.Z,{color:"secondary",checked:n||!1,onChange:function(e){return t(e.target.checked)}}),label:"Permits required"})}}),ee("admin")&&void 0!==z&&z&&(0,P.jsx)(I.Z,{label:"Xero Contact",children:B?(0,P.jsx)(Z.Z,{variant:"contained",onClick:function(){X()},children:"Connect to Xero to select Contact"}):(0,P.jsx)(O.Z,V(V({options:Q},e$),{},{name:"xeroContact"}))})]})};T.propTypes={accountId:u.number,accountName:u.string,data:u.object,refetch:u.func,offCanvas:u.func}},95102:function(e,n,t){"use strict";t.d(n,{$A:function(){return f},$E:function(){return b},A1:function(){return y},Un:function(){return p},yf:function(){return g},zg:function(){return v}});var r,i,o,a,s,c,u,d,l=t(71383),m=t(75063);(0,m.Ps)(r||(r=(0,l.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"])));var p=(0,m.Ps)(i||(i=(0,l.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']))),y=(0,m.Ps)(o||(o=(0,l.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]))),f=(0,m.Ps)(a||(a=(0,l.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]))),b=(0,m.Ps)(s||(s=(0,l.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),v=(0,m.Ps)(c||(c=(0,l.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])));(0,m.Ps)(u||(u=(0,l.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"])));var g=(0,m.Ps)(d||(d=(0,l.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"])))},73183:function(e,n,t){"use strict";t.d(n,{f:function(){return Z}});var r=t(59499),i=t(27812),o=t(67294),a=t(26447),s=t(15861),c=t(21023),u=t(93946),d=t(72428),l=t(79665),m=t(90948),p=t(50135),y=t(11057),f=t(42283),b=t(46761),v=t(60092),g=t(74231),h=g.Ry().shape({caption:g.Z_()}),j=t(85893);function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _=(0,m.ZP)(s.Z)({backgroundColor:v.Q.COLOUR.secondary,color:v.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),q=(0,m.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),O=function(e){var n,t=e.noDelete,r=e.onDelete,i=e.isAdded,d=e.media,m=e.caption,g=e.onSave,I=(0,o.useState)(null),O=I[0],S=I[1],w=(0,o.useState)(""),Z=w[0],$=w[1],A=(0,o.useState)(i),P=A[0],D=A[1],C=(0,f.cI)({resolver:(0,l.S)(h)}),T=C.register,k=C.errors,R=C.handleSubmit,E=C.reset,L=function(e){e.stopPropagation(),S(null),E()},U=function(e){e.stopPropagation(),D(!1),r()},F=function(e){O&&(g(x(x({},e),{},{media:O,type:Z})),D(!1))},M=(0,o.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];$(e),S(t)}},[S]);return(0,j.jsx)("form",{children:P?(0,j.jsx)(a.Z,{children:(0,j.jsxs)(a.Z,{rowGap:2,children:[(0,j.jsx)(p.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:T,error:k.name,helperText:null===(n=k.name)||void 0===n?void 0:n.message}),O?(0,j.jsxs)(a.Z,{rowGap:3,children:[(0,j.jsxs)(a.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,j.jsx)(s.Z,{sx:{color:v.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:O.name}),(0,j.jsx)(c.Z,{title:"Delete",placement:"top-start",children:(0,j.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:L,children:(0,j.jsx)(b.Z,{})})})]}),(0,j.jsxs)(a.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,j.jsx)(y.Z,{variant:"contained",color:"danger",size:"small",onClick:U,children:"Cancel"}),(0,j.jsx)(y.Z,{variant:"contained",size:"small",onClick:R(F),children:"Save"})]})]}):(0,j.jsxs)(a.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,j.jsxs)(_,{component:"label",children:["Add image\xa0",(0,j.jsx)(q,{onChange:M("image"),type:"file",accept:"image/*, .heic"})]}),(0,j.jsxs)(_,{component:"label",children:["Add document\xa0",(0,j.jsx)(q,{onChange:M("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,j.jsxs)(a.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,j.jsx)(s.Z,{sx:{color:v.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:m||(null==d?void 0:d.name)||"No caption"}),!t&&(0,j.jsx)(c.Z,{title:"Delete",placement:"top-start",children:(0,j.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:r,children:(0,j.jsx)(b.Z,{sx:{fontSize:"16px"}})})})]})})};function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Z=function(e){var n=e.values,t=e.setValue,r=e.name,l=e.title,m=e.onDeleteExistingMedia,p=(0,o.useState)([]),y=p[0],f=p[1];(0,o.useEffect)(function(){Array.isArray(n)&&f(n)},[n]);var b=function(e){e.stopPropagation(),f(function(e){return[].concat((0,i.Z)(e),[{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},v=function(e,n){var o=(0,i.Z)(y);o.splice(e,1,n),t(r,o)};return(0,j.jsxs)(a.Z,{children:[(0,j.jsxs)(a.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,j.jsxs)(s.Z,{children:[l,":"]}),(0,j.jsx)(c.Z,{title:"Add new attachment",placement:"top-start",children:(0,j.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:b,children:(0,j.jsx)(d.Z,{})})})]}),(0,j.jsx)(a.Z,{pl:2,spacing:.8,children:null!=y&&y.length?y.map(function(e,n){var i;return(0,j.jsx)(O,w(w({index:n},e),{},{onDelete:function(){m&&y[n].mediaId&&m(y[n].mediaId);var e=y.filter(function(e,t){return t!==n});t(r,e),f(e)},onSave:function(e){return v(n,e)}}),e.caption+n)}):(0,j.jsx)(s.Z,{typography:"subtitle2",children:"No data"})})]})};Z.defaultProps={name:"attachments",title:"Attachments"}},76301:function(e,n,t){"use strict";t.d(n,{Ak:function(){return M},Cj:function(){return B},K4:function(){return er},Qn:function(){return U},RJ:function(){return Q},SW:function(){return L},T_:function(){return G},UH:function(){return E},UM:function(){return en},Ve:function(){return X},_d:function(){return N},_f:function(){return et},by:function(){return W},cz:function(){return T},he:function(){return F},j$:function(){return J},kB:function(){return K},kU:function(){return Y},kx:function(){return V},nD:function(){return R},nP:function(){return eo},pY:function(){return ei},qd:function(){return k},t1:function(){return H},yR:function(){return z},zR:function(){return ee}});var r,i,o,a,s,c,u,d,l,m,p,y,f,b,v,g,h,j,I,x,_,q,O,S,w,Z,$,A,P,D=t(71383),C=t(75063),T=(0,C.Ps)(r||(r=(0,D.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]))),k=(0,C.Ps)(i||(i=(0,D.Z)(["\n  query GetAccountsForSelect($q: String, $type: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: $type } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),R=(0,C.Ps)(o||(o=(0,D.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),E=(0,C.Ps)(a||(a=(0,D.Z)(["\n  query GetAssetsForSelect($locationId: Int, $q: String, $categoryId: Int, $bookable: String) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n      parent: ParentAsset {\n        id\n        name\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          name\n          filename\n          meta\n          category\n          type\n        }\n      }\n    }\n  }\n"]))),L=(0,C.Ps)(s||(s=(0,D.Z)(['\n  query GetCustomersForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']))),U=(0,C.Ps)(c||(c=(0,D.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]))),F=(0,C.Ps)(u||(u=(0,D.Z)(['\n  query GetManagersForSelect($userId: Int, $accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),M=(0,C.Ps)(d||(d=(0,D.Z)(['\n  query GetManagersForSelect(\n    $userId: Int\n    $accountId: Int!\n    $q: String\n    $invoiceThreshold: numeric\n    $quoteThreshold: numeric\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n        _and: [\n          {\n            _or: [\n              { invoiceThreshold: { _gt: $invoiceThreshold } }\n              { invoiceThreshold: { _is_null: true } }\n            ]\n          }\n          {\n            _or: [\n              { quoteThreshold: { _gt: $quoteThreshold } }\n              { quoteThreshold: { _is_null: true } }\n            ]\n          }\n        ]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),J=(0,C.Ps)(l||(l=(0,D.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]))),N=(0,C.Ps)(m||(m=(0,D.Z)(['\n  query GetPropertiesForSelect($where: Location_bool_exp, $limit: Int, $offset: Int) {\n    items: Location(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n      access\n      permitsRequired\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']))),V=(0,C.Ps)(p||(p=(0,D.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),H=(0,C.Ps)(y||(y=(0,D.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String) {\n    items: SLA(\n      where: { name: { _ilike: $q }, type: { _eq: $type }, adminId: { _eq: $adminId } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),G=(0,C.Ps)(f||(f=(0,D.Z)(["\n  query GetSlasForSelectNew($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    items: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n    }\n  }\n"]))),W=(0,C.Ps)(b||(b=(0,D.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp, $limit: Int, $offset: Int) {\n    items: Account(where: $where, limit: $limit, offset: $offset, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),z=(0,C.Ps)(v||(v=(0,D.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),Q=(0,C.Ps)(g||(g=(0,D.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),B=(0,C.Ps)(h||(h=(0,D.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),X=(0,C.Ps)(j||(j=(0,D.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),Y=(0,C.Ps)(I||(I=(0,D.Z)(['\n  query GetCompliancesForSelect($q: String, $locationId: Int) {\n    items: Taxonomy(where: { type: { _eq: "complianceCategory" } }, order_by: { name: asc }) {\n      label: name\n      options: Compliances(\n        where: {\n          name: { _ilike: $q }\n          Compliance_Entities: { Location: { id: { _eq: $locationId } } }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),K=(0,C.Ps)(x||(x=(0,D.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"]))),ee=(0,C.Ps)(_||(_=(0,D.Z)(["\n  query GetSublocationsForSelect($locationId: Int!, $q: String, $limit: Int, $offset: Int) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]))),en=(0,C.Ps)(q||(q=(0,D.Z)(['\n  query GetTaxonomy($q: String, $id: Int, $limit: Int, $offset: Int) {\n    items: Taxonomy(\n      where: {\n        id: { _eq: $id }\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),et=(0,C.Ps)(O||(O=(0,D.Z)(["\n  query GetTaxonomyForSelect(\n    $where: Taxonomy_bool_exp\n    $limit: Int\n    $offset: Int\n    $orderBy: Taxonomy_order_by!\n  ) {\n    items: Taxonomy(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      value: id\n      label: name\n    }\n  }\n"])));(0,C.Ps)(S||(S=(0,D.Z)(['\n  query GetTagsForTask($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']))),(0,C.Ps)(w||(w=(0,D.Z)(['\n  query GetTagsForEntity(\n    $entityId: Int\n    $entity: String!\n    $q: String!\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    tags: Taxonomy(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: "active" }\n        type: { _eq: "taskTags" }\n        _not: { Taxonomy_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']))),(0,C.Ps)(Z||(Z=(0,D.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n'])));var er=(0,C.Ps)($||($=(0,D.Z)(["\n  query GetCustomerManagers($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: { Account_Users: { accountId: { _eq: $accountId } }, fullName: { _ilike: $q } }\n      order_by: { fullName: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n"]))),ei=(0,C.Ps)(A||(A=(0,D.Z)(["\n  query GetServiceSchedulesForSelect(\n    $q: String\n    $serviceId: Int\n    $entity: service_schedule_entity\n    $entityId: Int\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: ServiceSchedule(\n      where: {\n        name: { _ilike: $q }\n        serviceId: { _eq: $serviceId }\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),eo=(0,C.Ps)(P||(P=(0,D.Z)(['\n  query GetPropertyById($id: Int!) {\n    item: Location_by_pk(id: $id) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n'])))},71772:function(e,n,t){"use strict";t.d(n,{P:function(){return O}});var r=t(59499),i=t(50029),o=t(4730),a=t(64687),s=t.n(a),c=t(67294),u=t(10367),d=t(66252),l=t(76301),m=t(78289),p=t(52019),y=t(49501),f=t(9270),b=t(62140),v=t(84043),g=t(77439),h=t(85893),j=["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"];function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _=function(e,n){var t,r,i,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(t){e[t]!==n[t]&&(o=!1)}),o},q=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,i=e.entity,o=e.entityId,a=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,u=e.taxonomyGroupType,d=e.customerId,m=e.customerRole,p=e.type,y=e.userId,f=e.invoiceThreshold,b=e.quoteThreshold,v=p;switch(m&&(v="".concat(p,"_").concat(m)),v){case"address":return{query:l.cz,variables:{entity:i,entityId:o}};case"asset":return{query:l.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:l.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:l.nD,variables:{id:a}};case"assetSublocation":return{query:l.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"compliance":return{query:l.kU,variables:{locationId:s}};case"coverage":return{query:l.j$};case"customer":return{query:l.SW};case"job":return{query:l.Qn,variables:{locationId:s}};case"manager":return{query:l.he,variables:{accountId:n,userId:y}};case"thresholdManagers":return{query:l.Ak,variables:{accountId:n,userId:y,invoiceThreshold:f,quoteThreshold:b}};case"product":return{query:l.UH,variables:{category:"product",locationId:s}};case"property":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:l.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:l.kx};case"sla":return{query:l.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:l.zR,variables:{locationId:s}};case"supplier":var g={type:{_eq:"supplier"}};return t&&(g.PostcodeAreas={PostcodeArea:{area:{_eq:t}},entity:{_eq:"Account"},status:{_eq:"active"}}),c&&(g.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:c}},t&&(g.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:t}}})),{query:l.by,variables:{where:g}};case"user":return{query:l.yR,variables:{accountId:n}};case"usersForBookings":return{query:l.yR,variables:{accountId:y}};case"tenant":return{query:l.RJ};case"taxonomyGroup":return{query:l.Cj,variables:{type:u}};case"expenseCategory":return{query:l.Ve};default:return{query:l.qd}}},O=(0,c.memo)(function(e){var n,t=e.AddForm,r=e.accountId,a=e.area,u=e.assetCategoryId,l=e.control,I=e.entity,_=e.entityId,O=e.errors,w=e.id,Z=e.isClearable,$=e.isDisabled,A=e.label,P=e.locationId,D=e.name,C=e.serviceId,T=e.taxonomyGroupType,k=e.customerId,R=e.customerRole,E=e.type,L=e.userId,U=e.invoiceThreshold,F=e.quoteThreshold,M=(0,o.Z)(e,j),J=(0,d.x)(),N=(0,c.useState)(!1),V=N[0],H=N[1],G=(0,c.useState)(),W=G[0],z=G[1],Q=(0,c.useState)(!1),B=Q[0],X=Q[1],Y=(0,c.useContext)(m.Z),K=(0,c.useContext)(p.Z).hasRole,ee=(0,c.useState)(!1),en=ee[0],et=ee[1];(0,c.useEffect)(function(){return et(!1),X(!1),function(){}},[r,u,I,_,P,C,E,k,R,L]);var er=(n=(0,i.Z)(s().mark(function e(){var n,t,i,o,c,d,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!B){e.next=3;break}return et(!0),e.abrupt("return",null);case 3:return H(!0),t=(n=q({accountId:r,area:a,assetCategoryId:u,entity:I,entityId:_,hasRole:K,id:w,locationId:P,serviceId:C,taxonomyGroupType:T,customerId:k,customerRole:R,type:E,userId:L,invoiceThreshold:U,quoteThreshold:F})).query,o=void 0===(i=n.variables)?{}:i,e.next=7,J.query({query:t,variables:x({},o)});case 7:z((d=void 0===(d=e.sent.data)?{items:[]}:d).items),H(!1),X(!0),et(!0);case 15:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),ei=function(){Y.show({content:(0,h.jsx)("div",{children:(0,h.jsx)(t,{})}),title:"Add form"})};return(0,h.jsx)(y.Z,{id:D,label:A,children:(0,h.jsxs)(f.Z,{children:[(0,h.jsx)(b.Z,{md:t?11:12,children:(0,h.jsx)(v.Z,x({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:l,errors:O,isDisabled:$,isClearable:Z,isLoading:V,menuIsOpen:en,options:W,onFocus:er,onBlur:function(){et(!1)},name:D,searchable:!0},M),M.defaultValue)}),t&&(0,h.jsx)(b.Z,{md:1,children:(0,h.jsx)(S,{children:(0,h.jsx)(g.Z,{content:null,startIcon:"plus",size:"sm",onClick:ei})})})]})})},_),S=u.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-v7qj9m-0"})(["position:relative;right:25px;top:2px;"]);O.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},33063:function(e,n,t){"use strict";t.d(n,{T:function(){return b}});var r=t(26447),i=t(93946),o=t(50135),a=t(97212),s=t(98619),c=t(59334),u=t(95537),d=t(96059),l=t(26143),m=t(10166),p=t(67294),y=t(42283),f=t(85893),b=function(e){var n=e.tagEntityId,t=e.tagId,c=e.name,m=e.color,b=e.editable,g=e.onDelete,h=e.onColorChange,j=e.onNameChange,I=(0,y.cI)({defaultValues:{name:c,color:m}}),x=I.register,_=I.handleSubmit,q=(0,p.useState)(null),O=q[0],S=q[1],w=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),g(n)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),S("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),S("changeColor")},tooltip:"Change color"}]},Z=function(e){e.stopPropagation(),S(null)},$=function(e){h({tagId:t,color:e.color}),S(null)},A=function(e){j({tagId:t,name:e.name}),S(null)};return(0,f.jsx)(a.ZP,{disablePadding:!0,secondaryAction:!b||!O&&(0,f.jsx)(l.C,{icon:"defaultHoriz",actionsData:w}),children:O?({changeColor:function(){return(0,f.jsxs)(r.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,f.jsx)("input",{name:"color",ref:x,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,f.jsxs)(r.Z,{direction:"row",alignItems:"center",children:[(0,f.jsx)(i.Z,{size:"small",color:"danger",onClick:Z,children:(0,f.jsx)(u.Z,{})}),(0,f.jsx)(i.Z,{size:"small",color:"success",onClick:_($),children:(0,f.jsx)(d.Z,{})})]})]})},rename:function(){return(0,f.jsxs)(r.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,f.jsx)(o.Z,{name:"name",inputRef:x,variant:"standard",color:"secondary"}),(0,f.jsxs)(r.Z,{direction:"row",alignItems:"center",children:[(0,f.jsx)(i.Z,{size:"small",color:"danger",onClick:Z,children:(0,f.jsx)(u.Z,{})}),(0,f.jsx)(i.Z,{size:"small",color:"success",onClick:_(A),children:(0,f.jsx)(d.Z,{})})]})]})}})[O]():(0,f.jsx)(s.Z,{children:(0,f.jsx)(v,{primary:c,color:m})})},t)};b.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0};var v=(0,m.Z)(c.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},88284:function(e,n,t){"use strict";t.d(n,{P:function(){return l}});var r=t(67294),i=t(26447),o=t(15861),a=t(14564),s=t(78462),c=t(78898),u=t(33063),d=t(85893),l=function(e){var n=e.tags,t=(e.title,e.handleDeleteTagEntity),l=(0,r.useState)(null),m=l[0],p=l[1],y=null==n?void 0:n.slice(0,5),f=(null==n?void 0:n.length)-(null==y?void 0:y.length),b=Boolean(m);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.Z,{direction:"row",spacing:1,children:y.map(function(e,n){var r;return(0,d.jsx)(c.V,{tagEntityId:e.id||n,name:e.tag.name,color:null===(r=e.tag.meta)||void 0===r?void 0:r.color,onDelete:t})})}),f>0&&(0,d.jsxs)(o.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){p(e.currentTarget),e.stopPropagation()},children:["+",f]}),(0,d.jsx)(a.ZP,{id:b?"tags-in-table-popover":void 0,open:b,anchorEl:m,onClose:function(){return p(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,d.jsx)(s.Z,{children:null==n?void 0:n.map(function(e){var n;return(0,d.jsx)(u.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,editable:!1},e.tag.id)})})})]})};l.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},49908:function(e,n,t){"use strict";t.d(n,{n:function(){return C}});var r=t(59499),i=t(27812),o=t(50029),a=t(16835),s=t(64687),c=t.n(s),u=t(96486),d=t(6812),l=t(50319),m=t(96405),p=t(26447),y=t(5616),f=t(23776),b=t(18972),v=t(50135),g=t(98456),h=t(78462),j=t(93946),I=t(14564),x=t(67294),_=t(93362),q=t(10166),O=t(72936),S=t(33063),w=t(52098),Z=t(88284),$=t(85893);function A(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?A(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var D=(0,_.D)(),C=function(e){var n=e.entityId,t=e.entity,r=e.values,s=void 0===r?[]:r,I=e.name,_=void 0===I?"tags":I,q=e.setValue,A=(0,O.x)().user,C=(0,x.useState)(null),k=C[0],R=C[1],E=(0,x.useState)(""),L=E[0],U=E[1],F=(0,x.useState)(""),M=F[0],J=F[1],N=(0,x.useState)(""),V=N[0],H=N[1],G=(0,d.a)(w.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){q(_,e.tags)}}),W=G.data,z=(W=void 0===W?{tags:[]}:W).tags,Q=G.loading,B=G.refetch,X=(0,d.a)(w.gI,{skip:!k,variables:{entityId:n,entity:t,q:""!==V?"%".concat(V,"%"):null}}),Y=X.data,K=(Y=void 0===Y?{tags:[]}:Y).tags,ee=X.loading,en=(0,l.D)(w.Zm,{refetchQueries:["GetAllTags"]}),et=(0,a.Z)(en,2),er=et[0],ei=et[1].loading,eo=(0,l.D)(w.LE,{onCompleted:function(){B()}}),ea=(0,a.Z)(eo,2),es=ea[0],ec=ea[1].loading,eu=(0,l.D)(w.cS,{onCompleted:function(){B()}}),ed=(0,a.Z)(eu,2),el=ed[0],em=ed[1].loading,ep=(0,l.D)(w.g$,{refetchQueries:["GetAllTags"]}),ey=(0,a.Z)(ep,2),ef=ey[0],eb=ey[1].loading;(0,x.useEffect)(function(){var e=setTimeout(function(){H(M)},500);return function(){return clearTimeout(e)}},[M]);var ev,eg,eh,ej=function(e){e.stopPropagation(),R(e.currentTarget)},eI=function(){R(null)},ex=(ev=(0,o.Z)(c().mark(function e(r,o){var a,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof o){e.next=4;break}U({label:o}),e.next=24;break;case 4:if(!(o&&o.inputValue&&n)){e.next=9;break}es({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:A.adminId}}}]}}),U(null),e.next=24;break;case 9:if(!(o&&o.value&&n)){e.next=14;break}es({variables:{objects:[{entity:t,entityId:n,taxonomyId:o.value}]}}),U(null),e.next=24;break;case 14:if(!(o&&o.inputValue)){e.next=23;break}return e.next=17,er({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:A.adminId}]}});case 17:u=e.sent.data.insert_Taxonomy,q(_,[].concat((0,i.Z)(s),[{id:null,tag:{id:u.returning[0].id,name:u.returning[0].name,meta:u.returning[0].meta}}])),U(null),e.next=24;break;case 23:o&&o.value&&(q(_,[].concat((0,i.Z)(s),[{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),U(null));case 24:case"end":return e.stop()}},e)})),function(e,n){return ev.apply(this,arguments)}),e_=(0,x.useCallback)(function(e,n){var t=D(e,n),r=n.inputValue,i=e.some(function(e){return r===e.label});return""===r||i||t.push({inputValue:r,label:'Add "'.concat(r,'"')}),t},[]),eq=(0,x.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),eO=function(e){n?el({variables:{tagEntityId:e}}):q(_,s.filter(function(n,t){return t!==e}))},eS=(eg=(0,o.Z)(c().mark(function e(n){var t,r,i,o,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.tagId,r=n.color,e.next=3,ef({variables:{tagId:t,object:{meta:{color:r}}}});case 3:o=e.sent.data.update_Taxonomy_by_pk,a=s.map(function(e){return e.tag.id===t?P(P({},e),{},{tag:P({},o)}):e}),q(_,a);case 7:case"end":return e.stop()}},e)})),function(e){return eg.apply(this,arguments)}),ew=(eh=(0,o.Z)(c().mark(function e(n){var t,r,i,o,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.tagId,r=n.name,e.next=3,ef({variables:{tagId:t,object:{name:r}}});case 3:o=e.sent.data.update_Taxonomy_by_pk,a=s.map(function(e){return e.tag.id===t?P(P({},e),{},{tag:P({},o)}):e}),q(r,a);case 7:case"end":return e.stop()}},e)})),function(e){return eh.apply(this,arguments)}),eZ=Boolean(k),e$=(0,x.useMemo)(function(){return K.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[K]),eA=(0,x.useMemo)(function(){return u.uniqBy([].concat((0,i.Z)(z),(0,i.Z)(s)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[z,s]);return(0,$.jsxs)(p.Z,{direction:"row",alignItems:"center",children:[(0,$.jsx)(Z.P,{tags:eA,handleDeleteTagEntity:eO}),(0,$.jsx)(T,{id:eZ?"tags-popover":void 0,open:eZ,anchorEl:k,onClose:eI,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,$.jsxs)(y.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,$.jsx)(f.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,i.Z)(e$),value:L,onChange:ex,onInputChange:function(e,n){J(n)},filterOptions:e_,getOptionLabel:eq,renderOption:function(e,n){return(0,$.jsx)(b.Z,P(P({},e),{},{children:n.label}))},renderInput:function(e){return(0,$.jsx)(v.Z,P(P({},e),{},{variant:"standard",color:"secondary",label:"Search tag",InputProps:P(P({},e.InputProps),{},{endAdornment:(0,$.jsxs)($.Fragment,{children:[ee||ei||ec?(0,$.jsx)(g.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),Q||em||eb?(0,$.jsx)(p.Z,{width:"100%",alignItems:"center",p:4,children:(0,$.jsx)(g.Z,{color:"secondary"})}):(0,$.jsx)(h.Z,{children:null==eA?void 0:eA.map(function(e,n){var t;return(0,$.jsx)(S.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:eO,onColorChange:eS,onNameChange:ew})})})]})}),(0,$.jsx)(j.Z,{color:"black",onClick:ej,children:(0,$.jsx)(m.Z,{sx:{height:"16px",width:"16px"}})})]})};C.defaultProps={entityId:null};var T=(0,q.Z)(I.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},52098:function(e,n,t){"use strict";t.d(n,{BU:function(){return f},LE:function(){return v},Zm:function(){return y},cS:function(){return g},g$:function(){return h},gI:function(){return p},lx:function(){return b}});var r,i,o,a,s,c,u,d,l=t(71383),m=t(75063),p=(0,m.Ps)(r||(r=(0,l.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']))),y=(0,m.Ps)(i||(i=(0,l.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]))),f=(0,m.Ps)(o||(o=(0,l.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']))),b=(0,m.Ps)(a||(a=(0,l.Z)(['\n  query GetTagsForSelect($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n'])));(0,m.Ps)(s||(s=(0,l.Z)(['\n  query GetAssignedToForSelect($accountId: Int, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n'])));var v=(0,m.Ps)(c||(c=(0,l.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),g=(0,m.Ps)(u||(u=(0,l.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n    }\n  }\n"]))),h=(0,m.Ps)(d||(d=(0,l.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"])))},45165:function(e,n,t){"use strict";t.d(n,{z:function(){return b}});var r=t(27812),i=t(50029),o=t(16835),a=t(64687),s=t.n(a),c=t(6812),u=t(50319),d=t(30381),l=t.n(d),m=t(12603),p=t(75847);function y(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(e,n)}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw o}}}}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}var b=function(e,n,t,a){var d,f,b,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",g=(0,c.a)(m.O,{variables:{entity:e,entityId:a,category:v,adminId:n},skip:!a}),h=g.data,j=(h=void 0===h?{items:[]}:h).items,I=g.loading,x=(0,u.D)(p.CI,{}),_=(0,o.Z)(x,2),q=_[0],O=_[1].loading,S=(0,u.D)(p.xM,{refetchQueries:["MEDIAS"]}),w=(0,o.Z)(S,2),Z=w[0],$=w[1].loading,A=(0,u.D)(p.tv,{refetchQueries:["MEDIAS"]}),P=(0,o.Z)(A,2),D=P[0],C=P[1].loading,T=function(e){q({variables:{id:e}})},k=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},R=(d=(0,i.Z)(s().mark(function r(i,o){var a,c,u,d,m;return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!o){r.next=13;break}return r.next=3,L(o);case 3:return a=r.sent,c={adminId:n,caption:o.caption,expiryAt:l()().utc().format(),extension:o.media.name.split(".").pop(),userId:t,filename:a.key,type:o.media.type},r.next=7,Z({variables:{objects:c}});case 7:if(d=r.sent.data.insert_Media.returning,!(e&&i)){r.next=13;break}return m=d.map(function(n){return{mediaId:n.id,entity:e,entityId:i}}),r.next=13,D({variables:{objects:m}});case 13:case"end":return r.stop()}},r)})),function(e,n){return d.apply(this,arguments)}),E=(f=(0,i.Z)(s().mark(function i(o){var a,c,u,d,m,p,f,b,v,g,h=arguments;return s().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=h.length>1&&void 0!==h[1]?h[1]:"media",c=null,!(null!=o&&o.length)){i.next=23;break}u=y(o),i.prev=4,u.s();case 6:if((d=u.n()).done){i.next=15;break}if((m=d.value).mediaId){i.next=13;break}return i.next=11,L(m);case 11:g=i.sent,c={Media_Entity:{data:[].concat((0,r.Z)(null!==(p=null===(f=c)||void 0===f?void 0:null===(b=f.Media_Entity)||void 0===b?void 0:b.data)&&void 0!==p?p:[]),[{entity:e,Medium:{data:{adminId:n,caption:null!==(v=null==m?void 0:m.caption)&&void 0!==v?v:null,expiryAt:l()().utc().format(),extension:m.media.name.split(".").pop(),userId:t,category:a,filename:g.key,type:m.media.type}}}])}};case 13:i.next=6;break;case 15:i.next=20;break;case 17:i.prev=17,i.t0=i.catch(4),u.e(i.t0);case 20:return i.prev=20,u.f(),i.finish(20);case 23:return i.abrupt("return",c);case 24:case"end":return i.stop()}},i,null,[[4,17,20,23]])})),function(e){return f.apply(this,arguments)}),L=(b=(0,i.Z)(s().mark(function e(n){var t,r,i,o,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t="cleverly-media",r="https://aws.cleverly.works/aws/s3/upload",(i=new window.FormData).append("file",n.media,n.media.name),e.t0=n.type,e.next="image"===e.t0?7:"document"===e.t0?10:"audio"===e.t0?14:18;break;case 7:return o="https://aws.cleverly.works/image/process",i.append("sizes",k()),e.abrupt("break",19);case 10:case 14:return i.append("bucket",t),i.append("folder","".concat(n.type,"s")),o=r,e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:return e.next=21,window.fetch(o,{method:"POST",body:i});case 21:return a=e.sent,e.abrupt("return",a.json());case 23:case"end":return e.stop()}},e)})),function(e){return b.apply(this,arguments)});return{uploadMedia:R,uploadMediaToS3:L,createMediaInput:E,deleteMediaByEntity:T,loadingAddMediaEntity:C,loadingAddMedia:$,loadingDeleteMedia:O,preloadedMediaLoading:I,preloadedMedia:null!=j&&j.length?j:[]}}},77329:function(e,n,t){"use strict";t.d(n,{O:function(){return r},v:function(){return i}});var r=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],i=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},86559:function(e,n,t){"use strict";t.d(n,{Y:function(){return r}});var r=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},26380:function(e,n,t){"use strict";t.d(n,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},46289:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return e9}});var r=t(59499),i=t(11163),o=t.n(i),a=t(19076),s=t(50029),c=t(16835),u=t(64687),d=t.n(u),l=t(67294),m=t(66252),p=t(73359),y=t(50319),f=t(38512),b=t(75847),v=t(34197),g=t(42283),h=t(79665),j=t(6054),I=t(76600),x=t(9270),_=t(62140),q=t(77439),O=t(6812),S=t(59636),w=t(83863),Z=t(54559),$=t(78289),A=t(26186),P=t(58965),D=t(67872),C=t(37068),T=t(42846),k=t(55863),R=t(85893);function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function L(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var U=(0,w.Z)((0,Z.Z)(new Date,12)),F=(0,l.memo)(function(e){var n,t,r=e.jobId,i=e.locationId,o=e.serviceId,a=(0,T.x)({filters:{}}),s=a.initialData,c=a.ref,u=(0,l.useContext)($.Z),d=(0,k.q)(),m=null===(n=d.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,p=null===(t=d.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,y=(0,O.a)(S.sW,{variables:L(L({jobId:r,locationId:i},s),{},{serviceId:o,startDate:U})}),f=y.data,b=(f=void 0===f?{jobs:[],meta:{aggregate:{totalCount:0}}}:f).jobs,v=f.meta,g=y.loading,h=y.refetch,j=function(e){u.show({content:(0,R.jsx)(C.g,{jobId:e.id,toggleShow:u.close,numberPrefix:m,numberSuffix:p}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,R.jsx)(P.Z,{title:"Job History",children:(0,R.jsx)(D.t,{columns:[{hidden:!0,text:"Id"},{text:"Title"},{text:"Service"},{text:"Date"}],history:!1,loading:g,meta:v,ref:c,refetch:h,rowClick:j,rows:b.map(function(e){var n;return{id:e.id,title:e.title,service:null===(n=e.service)||void 0===n?void 0:n.name,createdDate:(0,A.Z)(e.createdAt)}})})})},function(e,n){var t=!0;return(n.locationId!==e.locationId||n.serviceId!==e.serviceId)&&(t=!1),t}),M=t(27812),J=t(49501),N=t(95103),V=t(71772),H=t(86559),G=t(19015);function W(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?W(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):W(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Q=(0,l.memo)(function(e){var n=e.control,t=e.customerSelectedWatch,r=e.errors,i=e.hasRole,o={control:n,errors:r,register:e.register};return(0,R.jsxs)(P.Z,{dataSet:{"data-cy":"customer"},open:!0,title:"Customer",children:[(0,R.jsx)(V.P,z(z({},o),{},{errors:z({},r),label:"Customer",name:"customerSelected",type:"customer"})),t&&(0,R.jsx)(V.P,z(z({},o),{},{isDisabled:!i([].concat((0,M.Z)(G.td),(0,M.Z)(G.Sf),(0,M.Z)(G.n))),accountId:(null==t?void 0:t.value)||null,errors:z({},r),label:"Contact User",name:"customerUserSelected",type:"user"})),i("admin")&&(0,R.jsx)(J.Z,{label:"Source",children:(0,R.jsx)(N.Z,z(z({},o),{},{name:"source",options:H.Y}))})]})},function(e,n){var t,r;return e.customerSelectedWatch===n.customerSelectedWatch&&!(null!==(t=n.errors.customerSelected)&&void 0!==t&&t.message)&&!(null!==(r=n.errors.customerUserSelected)&&void 0!==r&&r.message)}),B=t(55843),X=t(6710),Y=t(90951),K=t(15214),ee=t(55563),en=t(9105),et=t(27940),er=t(19957),ei=t(40527),eo=t(72936),ea=t(49908);function es(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ec(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?es(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):es(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eu=function(e){var n,t=e.control,r=e.currentAnswers,i=e.errors,o=e.isQuote,a=e.isPPM,s=e.jobId,c=(e.locationSelectedWatch,e.prevTaxonomy),u=e.register,d=e.taxonomyWatch,m=e.watch,p=e.dataSlas,y=e.tagsWatch,f=e.setValue,b=(0,eo.x)().hasRole,v=(0,l.useContext)($.Z),g=(0,l.useState)(r),h=g[0],j=g[1],I=m("slaId");(0,l.useEffect)(function(){d!==c&&d&&Z(null==d?void 0:d.childs)},[d]);var q=(0,ei.GU)(o?"quote":"reactive",p),O=null==q?void 0:null===(n=q.find(function(e){return e.id===Number(I)}))||void 0===n?void 0:n.notes,S={errors:i,register:u,control:t},w=function(e){j(e),v.close()},Z=function(e){e&&e.length>0?v.show({content:(0,R.jsx)(er.D,{onSuccess:w,entity:"Job",entityId:s,questions:e}),title:"Please answer the following questions"}):j([])};return(0,R.jsxs)(P.Z,{dataSet:{"data-cy":"details"},open:!0,title:"Description",children:[(0,R.jsx)(et.l,ec(ec({},S),{},{label:o?"Quote Headline":"Short job description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,R.jsx)(en.y,{answers:h,onEdit:Z}),(0,R.jsx)(B.Z,{}),(0,R.jsx)(J.Z,{label:"Work Description",children:(0,R.jsx)(X.Z,ec(ec({},S),{},{name:"description",rows:3}))}),!a&&(0,R.jsx)(Y.Z,ec(ec({},S),{},{data:q,legend:"Priority",name:"slaId"})),I&&(0,R.jsx)(K.Z,{content:O||"-",context:"light"}),!o&&(0,R.jsxs)(x.Z,{children:[(0,R.jsx)(_.Z,{md:6,children:(0,R.jsx)(J.Z,{label:"Estimated duration",children:(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,R.jsx)(_.Z,{md:6,children:(0,R.jsx)(J.Z,{label:"Unit",children:(0,R.jsx)(N.Z,ec(ec({},S),{},{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,R.jsx)(J.Z,{label:"".concat(b("customer")?"Your reference":"Customer reference"),children:(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"reference"}))}),b("admin")&&(0,R.jsx)(ea.n,{entityId:s,values:y,setValue:f,entity:"Job"}),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"questions",type:"hidden",defaultValue:JSON.stringify(h)})),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"reportPassFail",type:"hidden"})),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"reportPassFailTitle",type:"hidden"})),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"requireReportRecommendations",type:"hidden"})),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"customerSignature",type:"hidden"})),(0,R.jsx)(ee.Z,ec(ec({},S),{},{name:"supplierSignature",type:"hidden"}))]})};eu.defaultProps={isQuote:!1};var ed=t(19958),el=t(76301),em=t(10367);function ep(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ey(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ep(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ep(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ef=["manager","owner"],eb=function(e){var n,t,r=e.assetCategoryWatch,i=e.control,o=e.customerSelectedWatch,a=e.customerUserSelectedWatch,s=e.errors,u=e.locationSelectedWatch,d=e.register,l=e.setValue,m=(0,k.q)(),p=null==m?void 0:null===(n=m.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,y=(0,O.a)(el.kB,{variables:{accountId:null==o?void 0:o.value,userId:null==a?void 0:a.value}}).data,f=(y=void 0===y?{accountUsers:[]}:y).accountUsers,b=function(e){var n=(0,c.Z)(e,1)[0];l("locationSelected",{value:n.id,label:n.name})},v={isClearable:!1,control:i,errors:s,register:d};return(0,R.jsxs)(P.Z,{dataSet:{"data-cy":"location"},open:!0,title:"Location",children:[(0,R.jsx)(V.P,ey(ey({},v),{},{accountId:null==o?void 0:o.value,errors:ey({},s),name:"locationSelected",label:"Property",type:"property",customerRole:f.some(function(e){return ef.includes(e.role)})?null:"user",customerId:null==a?void 0:a.value,AddForm:function(){return(0,R.jsx)(ed.V,{initialValues:{propertyOwner:ey({},o)},isPropsComponent:!0,entity:"Location",onAddressCreated:b})}})),u&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(V.P,ey(ey({},v),{},{isClearable:!0,label:"Sublocation",locationId:u.value,name:"sublocationSelected",type:"sublocation"})),(0,R.jsx)(J.Z,{label:"Access information",children:(0,R.jsx)(X.Z,ey(ey({},v),{},{name:"access",rows:2}))}),p&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(V.P,ey(ey({},v),{},{isClearable:!0,label:"Asset Category",locationId:u.value,id:null==r?void 0:r.value,name:"assetCategorySelected",type:"assetCategory"})),(0,R.jsx)(ev,ey(ey({},v),{},{isClearable:!0,isDisabled:!r,label:"Assets",locationId:u.value,assetCategoryId:(null==r?void 0:r.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]})]})]})},ev=(0,em.ZP)(V.P).withConfig({displayName:"location__StyledSelect",componentId:"sc-18zko7j-0"})(["&& > div:first-of-type{","}&&{margin-bottom:1rem;}"],function(e){return e.isDisabled?"background-color: #cecece !important;":""});function eg(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var eh=(0,l.memo)(function(e){var n=e.control,t=e.errors,i=e.user;return(0,R.jsx)(P.Z,{dataSet:{"data-cy":"manager"},open:!0,title:"Admin User",children:(0,R.jsx)(V.P,{control:n,accountId:i.accountId,errors:function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eg(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eg(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},t),isClearable:!1,label:"Assigned to",name:"managerSelected",type:"user"})})},function(e,n){return!0}),ej=t(58594);function eI(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ex(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eI(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eI(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var e_=["1w","1m","3m","6m","12m"].map(function(e){return{id:e,label:e,value:e}}),eq=[1,2,3,4].map(function(e){return{id:"week"+e,label:e,value:"week"+e}}),eO=function(e){var n,t=e.control,r={control:t,errors:e.errors,register:(e.locationId,e.register)};return(0,R.jsxs)(P.Z,{dataSet:{"data-cy":"ppm"},open:!0,title:"PPM",children:[(0,R.jsx)(ej.Z,ex(ex({},r),{},{data:e_,legend:"Frequency",name:"frequency",stacked:!1})),(0,R.jsx)(J.Z,{label:"Frequency Description",children:(0,R.jsx)(X.Z,ex(ex({},r),{},{name:"frequencyDesc",rows:2}))}),(0,R.jsx)(ej.Z,ex(ex({},r),{},{data:eq,legend:"Week",name:"week",stacked:!1}))]})},eS=t(13868),ew=t(52220),eZ=t(46901),e$=t(30381),eA=t.n(e$);function eP(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eD(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eP(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eP(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eC=function(e){var n=e.control,t=e.errors,r=e.register,i=e.siteVisitWatch,o=e.watch,a=e.quoteReturnedTimingEndSupplier,s=e.quoteReturnedTimingEndCustomer,c={control:n,errors:t,register:r},u=o("siteVisitStart"),d=o("siteVisitEnd"),m=o("siteVisitWeekends"),p=o("quoteDue"),y=o("quoteDueSupplier"),f=function(e){var n=new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},b=function(e){var n=u?new Date(u):new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},v=function(e){var n=e.getDay();return 0!==n&&6!==n},g=(0,l.useMemo)(function(){return eA()(p).isAfter(s,"day")||eA()(y).isAfter(a,"day")},[p,y,s,a]);return(0,R.jsxs)(P.Z,{dataSet:{"data-cy":"quote"},open:!0,title:"Quote information",children:[(0,R.jsx)(J.Z,{label:"Number of Quotes",children:(0,R.jsx)(N.Z,eD(eD({},c),{},{name:"quoteNumber",placeholder:"Select number of quotes",range:[4,1]}))}),g&&(0,R.jsx)(eZ.Z,{color:"info",variant:"filled",sx:{mb:1},children:"Please note, the selected quote return date is later than that required by the relevant SLA. This will trigger a SLA breach."}),(0,R.jsx)(J.Z,{label:"Quote due by Customer",children:(0,R.jsx)(ew.M,eD(eD({},c),{},{name:"quoteDue",placeholder:"Click to select Quote Due Date"}))}),(0,R.jsx)(J.Z,{label:"Quote due from Supplier",children:(0,R.jsx)(ew.M,eD(eD({},c),{},{name:"quoteDueSupplier",placeholder:"Click to select Quote Due Date"}))}),(0,R.jsx)(ej.Z,eD(eD({},c),{},{data:[{id:"siteVisitReq",label:"Site visit required",value:!0}],name:"siteVisitReq"})),i&&(0,R.jsxs)(x.Z,{children:[(0,R.jsx)(_.Z,{md:12,children:(0,R.jsx)(ej.Z,eD(eD({},c),{},{data:[{id:"siteVisitWeekends",label:"Include Weekends",value:!0}],name:"siteVisitWeekends"}))}),(0,R.jsxs)(_.Z,{md:12,children:[(0,R.jsx)(J.Z,{label:"Start time"}),(0,R.jsx)(ew.M,eD(eD({},c),{},{dateFormat:"d MMM yyyy HH:mm",minDate:new Date,maxDate:d?new Date(d):null,filterTime:f,filterDate:!m&&v,name:"siteVisitStart",showTimeSelect:!0,todayButton:!1}))]}),u&&(0,R.jsxs)(_.Z,{md:12,children:[(0,R.jsx)(J.Z,{label:"End time"}),(0,R.jsx)(ew.M,eD(eD({},c),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:u?new Date(u):new Date,filterTime:b,filterDate:!m&&v,name:"siteVisitEnd",showTimeSelect:!0,todayButton:!1}))]})]})]})},eT=t(74231);(0,eT.Ry)().shape({title:(0,eT.Z_)().required(),description:(0,eT.Z_)().required(),access:(0,eT.Z_)(),serviceSelected:(0,eT.Ry)().required(),timingEnd:(0,eT.hT)().required(),timingStart:(0,eT.hT)().required()});var ek=t(42985),eR=t(59819),eE=t(26447),eL=t(50135),eU=t(6911),eF=function(e){var n=e.register,t=e.control,r=(0,p.t)(f.dL),i=(0,c.Z)(r,2),o=i[0],a=i[1],s=a.loading,u=a.data,d=(u=void 0===u?{issueTypes:[]}:u).issueTypes;return(0,R.jsx)(P.Z,{title:"Issue reported",open:!0,children:(0,R.jsxs)(eE.Z,{spacing:3,children:[(0,R.jsx)(g.Qr,{name:"issueType",control:t,render:function(e){var n=e.value,t=e.onChange;return(0,R.jsx)(eU.q,{value:n,disableClearable:!0,loading:s,onOpen:o,textFieldProps:{color:"secondary",variant:"standard",label:"Select issue type"},sx:{width:"200px"},onChange:function(e,n){return t(n)},options:d})}}),(0,R.jsx)(eL.Z,{multiline:!0,name:"issueReportedDescription",inputRef:n})]})})},eM=t(1950),eJ=t(73183),eN=function(e){var n=e.setValue,t=e.permitsLinks,r=e.attachmentsPermits,i=e.showWarning,o=e.onDeleteExistingMedia;return(0,R.jsxs)(eE.Z,{sx:eV.container,children:[i&&(0,R.jsx)(eZ.Z,{variant:"filled",severity:"error",children:"Warning: This site requires a permit for attendance"}),(0,R.jsx)(eM.V,{name:"permitsLinks",setValue:n,values:t,title:"Permits links"}),(0,R.jsx)(eJ.f,{setValue:n,values:r,onDeleteExistingMedia:o,name:"permitsAttachments",title:"Permits attachments"})]})};eN.defaultProps={showWarning:!0};var eV={container:{width:"100%"}},eH=t(92375);function eG(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eW(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eG(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eG(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ez=function(e){var n,t,r,i=e.defaultValues,o=e.preloadedMedia,a=e.deleteMediaByEntity,s=e.job,c=e.onSubmit,u=e.query,d=(0,eo.x)(),m=d.hasRole,p=d.user,y=(0,g.cI)({defaultValues:i,resolver:(0,h.S)((n=u,t=m,r=i.type,(0,eT.Ry)().shape({managerSelected:t("admin")&&(0,eT.Ry)().required(),customerSelected:(0,eT.Ry)().nullable().required(),customerUserSelected:(0,eT.Ry)().required(),source:t("admin")&&(0,eT.Z_)().oneOf(["call","email","portal","other"]).required(),slaId:"ppm"!==r&&(0,eT.Rx)().required(),description:(0,eT.Z_)().required(),taxonomyId_ShortDesc:(0,eT.Ry)().required(),reference:(0,eT.Z_)(),locationSelected:(0,eT.Ry)().required(),access:(0,eT.Z_)().required(),pricing:!n.quoted&&(0,eT.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:!n.quoted&&(0,eT.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),amount:!n.quoted&&(0,eT.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierLabourAmount:!n.quoted&&(0,eT.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMaterialsAmount:!n.quoted&&(0,eT.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),quoteNumber:n.quoted&&(0,eT.Z_)().required(),quoteDue:n.quoted&&(0,eT.hT)().required(),quoteDueSupplier:n.quoted&&(0,eT.hT)().required(),siteVisitStart:n.quoted&&(0,eT.hT)().when("siteVisitReq",{is:"true",then:(0,eT.hT)().required()}),siteVisitEnd:n.quoted&&(0,eT.hT)().when("siteVisitReq",{is:"true",then:(0,eT.hT)().required()}),siteVisitWeekends:n.quoted&&(0,eT.Z_)(),costCategorySelected:t(["admin","customer"])&&!n.quoted&&(0,eT.Ry)().required(),serviceSelected:t(["admin","customer"])&&!n.quoted&&(0,eT.Ry)().required(),timing:!n.quoted&&(0,eT.Z_)().required().oneOf(["at","between"]),timingStart:!n.quoted&&(0,eT.hT)().required(),timingEnd:!n.quoted&&(0,eT.hT)().when("timing",{is:"between",then:(0,eT.hT)().required()}),allowTimingNormalHours:!n.quoted&&(0,eT.Z_)(),reportPassFail:(0,eT.Xg)(),reportPassFailTitle:(0,eT.Z_)().nullable(),customerSignature:(0,eT.Xg)(),supplierSignature:(0,eT.Xg)(),requireReportRecommendations:(0,eT.Xg)(),estimatedDuration:(0,eT.Rx)().min(0),estimatedDurationUnit:(0,eT.Z_)()})))}),b=y.control,v=y.errors,S=y.formState,w=y.handleSubmit,Z=y.register,$=y.setValue,A=y.watch,P=(0,l.useState)(),D=P[0],C=P[1],T=(0,l.useState)(),k=T[0],E=T[1],L=A("tags",i.tags),U=A("customerSelected",i.customerSelected),M=A("customerUserSelected",i.customerUserSelected),J=A("locationSelected",i.locationSelected),N=A("pricing",i.pricing),V=A("serviceSelected",i.serviceSelected),H=A("timing",i.timing),G=A("siteVisitReq",i.siteVisitReq),W=A("taxonomyId_ShortDesc"),z=A("assetCategorySelected",null==i?void 0:i.assetCategorySelected),B=A("slaId"),X=A("permitsLinks"),Y=A("permitsAttachments"),K=(0,j.Z)(U),ee=(0,j.Z)(M),en=(0,j.Z)(J),et=(0,j.Z)(W),er=(0,O.a)(f.Ab,{skip:!(null!=U&&U.value)||!(null!=J&&J.value),variables:{customerId:null==U?void 0:U.value,locationId:null==J?void 0:J.value}}).data;(0,l.useEffect)(function(){if(void 0!==en&&J!==en?[{name:"access",value:(null==J?void 0:J.access)||""},{name:"coordinates",value:null}].forEach(function(e){var n;return $(e.name,e.value)}):U!==K&&K?[{name:"coordinates",value:null},{name:"customerUserSelected",value:null},{name:"locationSelected",value:null}].forEach(function(e){var n;return $(e.name,e.value)}):N&&!u.parentId&&!u.id&&[{name:"customerSpendThreshold",value:null==U?void 0:U.spendThreshold},{name:"amount",value:null==W?void 0:null===(l=W.meta)||void 0===l?void 0:null===(m=l.template)||void 0===m?void 0:m.amount},{name:"supplierLabourAmount",value:null==W?void 0:null===(p=W.meta)||void 0===p?void 0:null===(y=p.template)||void 0===y?void 0:y.supplierLabourAmount},{name:"supplierMaterialsAmount",value:null==W?void 0:null===(f=W.meta)||void 0===f?void 0:null===(b=f.template)||void 0===b?void 0:b.supplierMaterialsAmount}].forEach(function(e){var n;return $(e.name,e.value)}),W!==et&&!u.id&&!u.parentId){[{name:"title",value:null==W?void 0:null===(v=W.meta)||void 0===v?void 0:null===(g=v.template)||void 0===g?void 0:g.title},{name:"description",value:null==W?void 0:null===(h=W.meta)||void 0===h?void 0:null===(j=h.template)||void 0===j?void 0:j.description},{name:"tags",value:(null==W?void 0:null===(I=W.meta)||void 0===I?void 0:null===(x=I.template)||void 0===x?void 0:x.tags)||[]},{name:"costCategorySelected",value:null==W?void 0:null===(_=W.meta)||void 0===_?void 0:null===(q=_.template)||void 0===q?void 0:q.costCategorySelected},{name:"serviceSelected",value:null==W?void 0:null===(O=W.meta)||void 0===O?void 0:null===(S=O.template)||void 0===S?void 0:S.serviceSelected},{name:"reportPassFail",value:(null==W?void 0:null===(w=W.meta)||void 0===w?void 0:null===(Z=w.template)||void 0===Z?void 0:Z.reportPassFail)||!1},{name:"customerSignature",value:(null==W?void 0:null===(A=W.meta)||void 0===A?void 0:null===(P=A.template)||void 0===P?void 0:P.customerSignature)||!1},{name:"supplierSignature",value:(null==W?void 0:null===(D=W.meta)||void 0===D?void 0:null===(C=D.template)||void 0===C?void 0:C.customerSignature)||!1},{name:"reportPassFailTitle",value:null==W?void 0:null===(T=W.meta)||void 0===T?void 0:null===(k=T.template)||void 0===k?void 0:k.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==W?void 0:null===(R=W.meta)||void 0===R?void 0:null===(E=R.template)||void 0===E?void 0:E.requireReportRecommendations)||!1}].forEach(function(e){var n;return $(e.name,e.value)});var e,n,t,r,i,o,a,s,c,d,l,m,p,y,f,b,v,g,h,j,I,x,_,q,O,S,w,Z,A,P,D,C,T,k,R,E,L,F=null==W?void 0:null===(L=W.meta)||void 0===L?void 0:L.template;null!=F&&F.amount||null!=F&&F.supplierLabourAmount||null!=F&&F.supplierMaterialsAmount?$("pricing","fixed"):$("pricing",null)}W!==et&&[{name:"reportPassFail",value:(null==W?void 0:null===(e=W.meta)||void 0===e?void 0:null===(n=e.template)||void 0===n?void 0:n.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==W?void 0:null===(t=W.meta)||void 0===t?void 0:null===(r=t.template)||void 0===r?void 0:r.reportPassFailTitle},{name:"customerSignature",value:(null==W?void 0:null===(i=W.meta)||void 0===i?void 0:null===(o=i.template)||void 0===o?void 0:o.customerSignature)||!1},{name:"supplierSignature",value:(null==W?void 0:null===(a=W.meta)||void 0===a?void 0:null===(s=a.template)||void 0===s?void 0:s.supplierSignature)||!1},{name:"requireReportRecommendations",value:(null==W?void 0:null===(c=W.meta)||void 0===c?void 0:null===(d=c.template)||void 0===d?void 0:d.requireReportRecommendations)||!1}].forEach(function(e){var n;return $(e.name,e.value)}),ee&&(null==M?void 0:M.value)!==(null==ee?void 0:ee.value)&&$("locationSelected",null)},[U,null==M?void 0:M.value,J,K,ee,en,et,N,u.id,u.parentId,$,W]),(0,l.useEffect)(function(){if(B&&!u.quoted){var e,n,t=(0,ei.GU)("reactive",er),r=null==t?void 0:null===(e=t.find(function(e){return e.id===Number(B)}))||void 0===e?void 0:e.onSite,o=null==t?void 0:null===(n=t.find(function(e){return e.id===Number(B)}))||void 0===n?void 0:n.onSiteUnit;if(r&&o){var a=eA()(null==i?void 0:i.createdAt),s=eA()(null==i?void 0:i.createdAt).add(r,o),c=30-a.minute()%30,d=30-s.minute()%30;$("timing","between"),$("timingStart",a.clone().add(c,"minutes").toDate()),$("timingEnd",s.clone().add(d,"minutes").toDate())}}},[er,null==i?void 0:i.createdAt,u.quoted,$,B]),(0,l.useEffect)(function(){if(B&&u.quoted){var e,n,t=(0,ei.GU)("quote",er),r=null==t?void 0:null===(e=t.find(function(e){return e.id===Number(B)}))||void 0===e?void 0:e.quoteReturned,o=null==t?void 0:null===(n=t.find(function(e){return e.id===Number(B)}))||void 0===n?void 0:n.quoteReturnedUnit;if(r&&o){var a=eA()(null==i?void 0:i.createdAt).add(r,o),s=30-a.minute()%30,c=a.clone().add(s,"minutes").toDate(),d=a.clone().add(s,"minutes").subtract(1,"day").toDate();$("quoteDue",c),$("quoteDueSupplier",d),E(c),C(d)}}},[er,null==i?void 0:i.createdAt,u.quoted,$,B]),(0,l.useEffect)(function(){$("permitsAttachments",o.map(function(e){return{mediaId:e.mediaId,caption:e.media.caption,media:null,type:"",isAdded:!1}}))},[o,$]);var ea={control:b,errors:v,register:Z};return(0,R.jsxs)(I.Z,{handleSubmit:w(c),children:[(0,R.jsxs)(x.Z,{children:[(0,R.jsxs)(_.Z,{md:6,children:[m("admin")&&(0,R.jsx)(eh,eW(eW({},ea),{},{user:p})),(0,R.jsx)(Q,eW(eW({},ea),{},{customerSelectedWatch:U,user:p,hasRole:m})),(null==s?void 0:s.type)!=="quote"&&!u.quoted&&(0,R.jsx)(eF,{register:Z,control:b}),J&&m(["admin","customer","tenant"])&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(eu,eW(eW({},ea),{},{dataSlas:er,currentAnswers:i.questions,jobId:null==s?void 0:s.id,locationSelectedWatch:J,taxonomyWatch:W,prevTaxonomy:et,watch:A,isQuote:u.quoted,isPPM:"ppm"===i.type,tagsWatch:L,setValue:$})),!u.quoted&&m(["admin","customer"])&&(0,R.jsx)(ek.t,eW({},ea)),!u.quoted&&m("admin")&&(0,R.jsx)(eS.n,eW(eW({},ea),{},{pricingWatch:N,hasServiceRate:!!(null!=U&&U.serviceRateLabour)||!!(null!=U&&U.serviceRateExpenses),serviceSelectedWatch:V,isPPM:(null==s?void 0:s.type)==="ppm"})),!u.quoted&&(0,R.jsx)(eR.X,eW(eW({},ea),{},{hasRole:m,query:u,setValue:$,timingWatch:H,watch:A}))]})]}),(0,R.jsxs)(_.Z,{md:6,children:[U&&(0,R.jsx)(eb,eW(eW({},ea),{},{setValue:$,assetCategoryWatch:z,customerSelectedWatch:U,customerUserSelectedWatch:M,locationSelectedWatch:J})),(null==J?void 0:J.permitsRequired)&&m(["admin","customer"])&&(0,R.jsx)(eH.s,{title:"Location permits",children:(0,R.jsx)(eN,{setValue:$,permitsLinks:X,attachmentsPermits:Y,onDeleteExistingMedia:a})}),J&&(0,R.jsxs)(R.Fragment,{children:[u.quoted&&(0,R.jsx)(eC,eW(eW({},ea),{},{siteVisitWatch:G,watch:A,quoteReturnedTimingEndSupplier:D,quoteReturnedTimingEndCustomer:k})),u.ppm&&(0,R.jsx)(eO,eW(eW({},ea),{},{locationId:J.value})),!s&&(0,R.jsx)(F,{locationId:J.value,serviceId:(null==V?void 0:V.value)||null})]})]})]}),(0,R.jsx)("input",eW({type:"hidden"},Z("permitsLinks"))),(0,R.jsx)("input",eW({type:"hidden"},Z("permitsAttachments"))),(0,R.jsx)("input",eW({type:"hidden"},Z("tags"))),(0,R.jsx)(q.Z,{content:"Submit",disabled:S.isSubmitting,size:"lg",type:"submit"})]})},eQ=t(11552),eB=t(3084),eX=t(84808),eY=t(98456),eK=t(45165),e0=t(59922);function e1(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function e2(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e1(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var e6=function(e){var n=(0,eo.x)(),t=n.hasRole,r=n.user,i=(0,m.x)(),a=(0,eB.D)(),u=(0,e0.useMainContext)(),g=u.predefinedAssetForWorkOrder,h=u.setPredefinedAssetForWorkOrder,j=(0,l.useState)(!0),I=j[0],x=j[1],_="/dashboard/issues/",q=e.accountId||0,O=e.locationId||0,S=e.parentId||0,w=e.assetId||0,Z=e.recall||null;t("customer")&&(q=r.accountId);var $,A,P,D=(0,p.t)(f.E6,{skip:!e.id,variables:{adminId:r.adminId,number:"".concat(e.id)},onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})}}),C=(0,c.Z)(D,2),T=C[0],k=C[1],E=k.loading,L=k.data,U=(L=void 0===L?{job:null}:L).job,F=U&&U[0],M=(0,eK.z)("Job",r.adminId,r.id,null==F?void 0:F.id,"supportingDocuments"),J=M.createMediaInput,N=M.preloadedMedia,V=M.deleteMediaByEntity,H=M.loadingDeleteMedia,G=(0,p.t)(f.TY,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})},variables:{accountId:q,locationId:O,parentId:S,assetId:w,includeAccount:!!q,includeLocation:!!O,includeParentJob:!!S,includeAsset:!!w}}),W=(0,c.Z)(G,2),z=W[0],Q=W[1],B=Q.loading,X=Q.data,Y=(0,y.D)(b.xM,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})}}),K=(0,c.Z)(Y,2),ee=K[0],en=K[1].loading,et=(0,y.D)(b.tv,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})}}),er=(0,c.Z)(et,2),ea=er[0],es=er[1].loading,ec=(0,y.D)(f.mJ,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:($=(0,s.Z)(d().mark(function n(t){var a,c,u,l,m,p;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=(a=t.createJob.data.insert_Job.returning[0]).id,u=a.number,n.next=3,(0,eQ.F)(i,c);case 3:if(!(S&&"true"===Z)){n.next=11;break}return l={notes:"Marked as dispute because of creating a recall job",status:"inDispute",jobId:e.parentId,userId:r.id},n.next=7,ey({variables:{objects:[l]}});case 7:return p={caption:"report for recall job",expiryAt:null,extension:null==(m=e.report)?void 0:m.split(".").pop(),userId:r.id,filename:m,type:"document"},n.next=11,ee({variables:{objects:p}}).then(function(){var e=(0,s.Z)(d().mark(function e(n){var t,r,i;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={mediaId:n.data.insert_Media.returning[0].id,entity:"Job",entityId:c},e.next=5,ea({variables:{objects:i}});case 5:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}());case 11:o().push("".concat(_,"view?id=").concat(u));case 12:case"end":return n.stop()}},n)})),function(e){return $.apply(this,arguments)})}),eu=(0,c.Z)(ec,2),ed=eu[0],el=eu[1].loading,em=(0,y.D)(f.r2,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})}}),ep=(0,c.Z)(em,2),ey=ep[0],ef=ep[1].loading,eb=(0,y.D)(f.uA,{onCompleted:(A=(0,s.Z)(d().mark(function e(n){var t;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,eQ.F)(i,F.id);case 2:t=n.update_Job_by_pk.number,o().push("".concat(_,"view?id=").concat(t));case 4:case"end":return e.stop()}},e)})),function(e){return A.apply(this,arguments)})}),ev=(0,c.Z)(eb,2),eg=ev[0],eh=ev[1].loading;(0,l.useEffect)(function(){e.id?T():q||O||S?z():x(!1)},[]),(0,l.useEffect)(function(){!E&&F?x(!1):!B&&X&&x(!1)},[E,B]);var ej=(P=(0,s.Z)(d().mark(function n(i){var o,a,s,c,u,l,m,p,y;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=(0,ei.eD)(i,null==F?void 0:F.id),n.next=3,J(i.permitsAttachments,"supportingDocuments");case 3:return s=n.sent,delete i.permitsAttachments,n.next=7,(0,ei.lV)({query:e,data:e2(e2({},e2(e2({},i),{},{meta:null!==(o=null==F?void 0:F.meta)&&void 0!==o?o:{}})),s||{}),hasRole:t,user:r,type:eI.type});case 7:if(c=n.sent,!(!e.id||e.parentId)){n.next=13;break}return n.next=11,ed({variables:{adminId:r.adminId,objects:[c]}});case 11:n.next=20;break;case 13:return m=[],p=eI.assetSelected.map(function(e){return e.assetId}),(null===(u=c.Assets)||void 0===u?void 0:null===(l=u.data)||void 0===l?void 0:l.length)>0&&(m=c.Assets.data.map(function(e){return e2(e2({},e),{},{jobId:F.id})}),delete c.Assets),y=(0,ei.A5)(F.id,c),delete c.Taxonomy,n.next=20,eg({variables:{jobId:F.id,changes:c,compliances:[],deletedAssetIds:p,assets:m,questions:a,media:y,hasQuestions:(null==a?void 0:a.length)>0}});case 20:case"end":return n.stop()}},n)})),function(e){return P.apply(this,arguments)});if((0,l.useEffect)(function(){return function(){h(null)}},[h]),F&&((0,v.E)(F,"accepted")&&!t("admin")||(0,v.E)(F,"inProgress")))return(0,R.jsx)("p",{children:"Work order can't be edited after started by supplier"});var eI={};return g?eI=(0,ei.Pu)(g,t,r):I||(eI=e.id?F?(0,ei.I2)(F):null:(0,ei.$z)(X,t,r,Z)),(0,R.jsxs)(R.Fragment,{children:[(I||E||H||B||en||es||el||ef||eh)&&(0,R.jsx)(eX.Z,{open:!0,sx:{zIndex:1e5},children:(0,R.jsx)(eY.Z,{color:"secondary"})}),!I&&eI&&(0,R.jsx)(ez,{defaultValues:eI,job:e.id?F:null,onSubmit:ej,preloadedMedia:N,deleteMediaByEntity:V,query:e})]})};function e3(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var e9=function(){var e=(0,i.useRouter)().query,n=e.id?"Edit":"Create",t="Work Order";return t=e.quoted?"Quote":t,t=e.ppm?"PPM":t,(0,R.jsx)(a.Z,{pageHeading:{heading:"".concat(n," ").concat(t)},View:(0,R.jsx)(e6,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e3(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},e))})}},20633:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/manage",function(){return t(46289)}])}},function(e){e.O(0,[3662,2283,212,8890,619,1100,1336,4135,5020,6043,1564,4244,5370,3911,3776,6540,4046,1023,2797,9241,653,1207,3704,8476,1813,7725,9229,9404,9774,2888,179],function(){return e(e.s=20633)}),_N_E=e.O()}]);