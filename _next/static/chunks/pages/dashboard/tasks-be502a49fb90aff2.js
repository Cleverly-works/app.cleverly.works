(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5916],{18574:function(e,t,n){"use strict";n.d(t,{F:function(){return D}});var r=n(59499),i=n(10166),o=n(50135),a=n(98456),c=n(16143),s=n(80482),l=n(23776),u=n(27812),d=n(4730),p=n(74061),f=n(6498),m=n(61730),h=n(75438),v=n(15861),b=n(67294),y=n(85893),g=["children"];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=(0,b.createContext)({}),w=(0,b.forwardRef)(function(e,t){var n=(0,b.useContext)(O);return(0,y.jsx)("div",x(x({ref:t},e),n))}),P=(0,b.forwardRef)(function(e,t){var n=e.children,r=(0,d.Z)(e,g),i=[];n.forEach(function(e){i.push(e),i.push.apply(i,(0,u.Z)(e.children||[]))});var o,a,c=(0,f.u)(),s=(0,m.Z)(c.breakpoints.up("sm"),{noSsr:!0}),l=i.length,h=s?36:48,v=function(e){return e.hasOwnProperty("group")?48:h},j=(a=(0,b.useRef)(null),(0,b.useEffect)(function(){null!=a.current&&a.current.resetAfterIndex(0,!0)},[l]),a);return(0,y.jsx)("div",{ref:t,children:(0,y.jsx)(O.Provider,{value:r,children:(0,y.jsx)(p.S_,{itemData:i,height:(l>8?8*h:i.map(v).reduce(function(e,t){return e+t},0))+16,width:"100%",ref:j,outerElementType:w,innerElementType:"ul",itemSize:function(e){return v(i[e])},overscanCount:5,itemCount:l,children:Z})})})});function Z(e){var t=e.data,n=e.index,r=e.style,i=t[n],o=x(x({},r),{},{top:r.top+8});return i.hasOwnProperty("group")?(0,y.jsx)(h.Z,{component:"div",style:o,children:i.group},i.key):(0,y.jsx)(v.Z,x(x({component:"li"},i[0]),{},{noWrap:!0,style:o,children:i[1].label}))}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D=function(e){var t=e.label,n=e.loading,r=e.placeholder,i=e.error,c=e.helperText,s=e.inputProps;return(0,y.jsx)(C,S(S({},e),{},{disableListWrap:!0,PopperComponent:k,ListboxComponent:P,renderInput:function(e){return(0,y.jsx)(o.Z,S(S(S({},e),s),{},{error:i,helperText:c,label:t,placeholder:r,color:"secondary",variant:"standard",InputProps:S(S(S({},e.InputProps),(null==s?void 0:s.InputProps)||{}),{},{endAdornment:(0,y.jsxs)(y.Fragment,{children:[n?(0,y.jsx)(a.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},renderOption:function(e,t,n){return[e,t,n.index]},renderGroup:function(e){return e}}))};D.defaultProps={value:null,onChange:function(){},label:"",loading:!1,error:!1,onOpen:function(){},options:[],inputProps:{},withoutSelectIcon:!1};var k=(0,i.Z)(c.Z)((0,r.Z)({zIndex:"12000 !important"},"& .".concat(s.Z.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}})),C=(0,i.Z)(l.Z)(function(e){return{"& .MuiAutocomplete-root":{cursor:"pointer"},"& .MuiAutocomplete-popper":{zIndex:"12000 "},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":S({},e.withoutSelectIcon&&{display:"none"})}}}})},6911:function(e,t,n){"use strict";n.d(t,{q:function(){return m}});var r=n(59499),i=n(4730),o=n(23776),a=n(87918),c=n(50135),s=n(98456),l=n(67294),u=n(85893),d=["loading","setSearch","textFieldProps"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){var t=e.loading,n=e.setSearch,r=e.textFieldProps,p=(0,i.Z)(e,d),m=(0,l.useState)(""),h=m[0],v=m[1];return(0,l.useEffect)(function(){var e=setTimeout(function(){n(h)},500);return function(){return clearTimeout(e)}},[h,n]),(0,u.jsx)(o.Z,f(f({},p),{},{loading:t,onInputChange:function(e,t){v(t)},getOptionLabel:function(e){return e.label},renderTags:function(e,t){return e.map(function(e,n){return(0,u.jsx)(a.Z,f({size:"small",label:e.label},t({index:n})))})},renderInput:function(e){return(0,u.jsx)(c.Z,f(f(f({},e),r),{},{InputProps:f(f(f({},e.InputProps),r.InputProps||{}),{},{endAdornment:(0,u.jsxs)(u.Fragment,{children:[t?(0,u.jsx)(s.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};m.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}}},92264:function(e,t,n){"use strict";n.d(t,{H:function(){return l}});var r=n(59499),i=n(55377),o=n(16551),a=n(77439),c=n(85893);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var l=function(e){var t=e.children,n=e.content,l=e.context,u=e.data,d=e.disabled,p=e.handleClick,f=e.size,m=e.type;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.Z,{size:"sm"}),(0,c.jsxs)(o.Z,{align:"flex-end",children:[t,(0,c.jsx)(a.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({content:n,context:l,disabled:d,onClick:p,size:f,type:m},u))]})]})};l.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},52220:function(e,t,n){"use strict";n.d(t,{M:function(){return d}});var r=n(59499),i=n(4730),o=n(89345),a=n(99505),c=n(55843),s=n(85893),l=["control","errors","name","space"];function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var d=function(e){var t=e.control,n=e.errors,d=e.name,p=e.space,f=(0,i.Z)(e,l);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({control:t,errors:n,locale:o.Z,name:d},f)),p&&(0,s.jsx)(c.Z,{marginBottom:"sm"})]})};d.defaultProps={space:!0}},9164:function(e,t,n){"use strict";n.d(t,{r:function(){return u}});var r=n(59499),i=n(41664),o=n.n(i),a=n(23795),c=n(85893);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u=function(e){var t=e.children,n=e.href,r=e.noWrap,i=e.target,s=e.sx,u=void 0===s?{}:s;return r?(0,c.jsx)(c.Fragment,{children:t}):n?(0,c.jsx)(o(),{href:n,target:i,passHref:!0,children:(0,c.jsx)(a.Z,l(l({sx:u},e),{},{children:t}))}):(0,c.jsx)(a.Z,l(l({sx:u},e),{},{children:t}))};u.defaultProps={onClick:function(e){e.stopPropagation()}}},73073:function(e,t,n){"use strict";n.d(t,{G:function(){return z}});var r=n(59499),i=n(6812),o=n(12603),a=n(32836),c=n(4788),s=n(94784),l=n(85011),u=n(40826),d=n(85893),p=function(e,t){var n=function(){return(0,d.jsx)(u.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},r=function(){return(0,d.jsx)(u.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},i=function(){return(0,d.jsx)(u.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?null!=t&&t.thumbnails&&null!=t&&t.thumbnails.length?n:r:i},f=n(42846),m=n(72936),h=n(21023),v=n(5616),b=n(86532),y=n(38895),g=n(15861),j=n(22797),x=n(26447),O=n(11057),w=n(58886),P=n(90948),Z=n(70872),I=n(67294),S=n(77314),D=n(42850);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var C=(0,D.bH)(S.ZP),_=function(e){var t=e.images,n=e.showPagination,i=e.height,o=(0,I.useState)(0),a=o[0],c=o[1],s=function(e){c(e)};return(0,d.jsxs)(x.Z,{width:"100%",alignItems:"center",children:[(0,d.jsx)(C,{index:a,onChangeIndex:s,enableMouseEvents:!0,interval:1e4,children:t.map(function(e){return(0,d.jsx)(v.Z,{component:"img",sx:{height:i,display:"block",overflow:"hidden",width:"100%",objectFit:"cover"},src:e.filename,alt:e.caption},e.caption)})}),n&&t.length>1&&(0,d.jsx)(M,{page:a+1,count:t.length,onChange:function(e,t){return s(t-1)},variant:"outlined",shape:"rounded",renderItem:function(e){return(0,d.jsx)(w.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})]})};_.defaultProps={images:[],showPagination:!0};var M=(0,P.ZP)(Z.Z)(function(e){e.hidePrevButton,e.hideNextButton;var t,n=e.theme;return t={},(0,r.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(t,"& button.Mui-selected",{color:n.palette.white.main,backgroundColor:n.palette.secondary.main}),t}),A=n(27434),E=n(26143),T=n(9164),$=n(58095);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z=function(e){var t=e.carousel,n=e.category,r=e.data,u=e.entity,w=e.entityId,P=e.filters,Z=e.listView,I=e.mediaMeta,S=e.onMediaAdd,D=e.onMediaRemove,k=e.showActionButtons,C=e.showEntityColumn,M=e.showItemActions,N=e.title,z=e.type,F=e.expanded,L=e.onChangeExpanded,U=e.hideExpandIcon,R=e.mediaFormProps,Y=e.offCanvasProps,W=e.onlySingleMedia,B=(0,f.x)({filters:P}),Q=B.initialData,V=B.ref,G=(0,m.x)(),H=G.hasRole,X=G.user,J=(0,$.a)(),K=(0,i.a)(o.t,{variables:q(q({},Q),{},{entity:u,entityId:w,category:n,adminId:X.adminId,meta:I})}),ee=K.data,et=(ee=void 0===ee?{items:[],meta:{aggregate:{totalCount:0}}}:ee).items,en=ee.meta,er=K.loading,ei=K.refetch,eo=function(e){J.close(),r.length||ei();var t=e.map(function(e){return q(q({},e),{},{link:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.filename)})});S&&S(t)},ea=function(e){J.close(),r.length||ei(),D&&D(e)},ec=function(e){e.stopPropagation(),J.show(q({content:(0,d.jsx)(l.z,q({accept:"image/*",adminId:X.adminId,category:n,entity:u,entityId:w,expiryShow:!1,mediaMeta:I,multiple:!0,onSuccess:eo,type:"image"},R)),title:"Upload Photos"},Y))},es=function(e){e.stopPropagation(),J.show(q({content:(0,d.jsx)(l.z,q({accept:".pdf, .doc, .docx, .xlsx",adminId:X.adminId,category:n,entity:u,entityId:w,expiryShow:!1,mediaMeta:I,onSuccess:eo,type:"document"},R)),title:"Upload Documents"},Y))},el=function(e){J.show({content:(0,d.jsx)(c.d,{mediaId:e.data.id,onSuccess:ea}),submit:!1,title:"Delete Media"})},eu=function(e){J.show({content:(0,d.jsx)(s.z,{media:e.data,toggleShow:J.close}),title:"Media Details",width:"50%"})},ed=function(e){return[{context:"primary",icon:"info",onClick:function(t){return eu(e)},tooltip:"Details"},{context:"danger",icon:"delete",onClick:function(t){return el(e)},tooltip:"Delete"}]},ep=[{field:"file",headerName:"File",flex:1,sortable:!1,renderCell:function(e){var t=e.row,n=e.value;return(0,d.jsx)(T.r,{color:"secondary",onClick:function(e){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t.filename))},children:n})}},{field:"visibility",headerName:"Visible to",flex:1,sortable:!1},{hide:!C,field:"entity",headerName:"Entity",flex:1,sortable:!1},{field:"authority",headerName:"",width:50,sortable:!1,renderCell:function(e){var t=e.value;return(0,d.jsx)(d.Fragment,{children:(null==t?void 0:t.adminOnly)&&(0,d.jsx)(h.Z,{title:"Admin user only",children:(0,d.jsx)(v.Z,{component:"img",alt:"Admin Only",src:"/messaging/admin-only.svg",sx:{height:"24px"}})})})}},{field:"uploaded",headerName:"Uploaded by",flex:1,sortable:!1},{hide:!Z,field:"thumbnails",headerName:"Thumbnails",flex:1,sortable:!1,renderCell:function(e){var t=e.value;return"function"==typeof t?t():t}},{hide:!M,field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var t=e.row;return H("admin")?(0,d.jsx)(E.C,{actionsData:ed,row:t}):X.id===t.userId?(0,d.jsx)(E.C,{actionsData:ed,row:t}):null}}],ef=[],em=et.filter(function(e){var t=e.item;return(null==t?void 0:t.visibility)&&H(null==t?void 0:t.visibility)}).map(function(e){var t=e.entity,n=e.entityId,r=e.id,i=e.item,o=i.caption,a=i.filename,c=i.meta,s=i.name,l=i.type,u=i.user,d=i.visibility;return{data:i,id:r,userId:null==u?void 0:u.id,filename:a,visibility:d.join(", "),file:o||s||a,entity:t&&"".concat(t,"#").concat(n),authority:c,uploaded:"".concat(null==u?void 0:u.nameFirst," ").concat(null==u?void 0:u.nameLast),thumbnails:p(l,c),actions:""}}),eh=(et.filter(function(e){var t=e.item;return(null==t?void 0:t.visibility)&&H(null==t?void 0:t.visibility)}).forEach(function(e){var t=e.item,n=t.caption,r=t.filename;"image"===t.type&&ef.push({caption:n,filename:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r)})}),ef),ev=eh.length;return(0,d.jsxs)(b.Z,{expanded:F,onChange:L,children:[(0,d.jsx)(y.Z,q(q({},U?{}:{expandIcon:(0,d.jsx)(A.Z,{})}),{},{children:(0,d.jsx)(g.Z,{variant:"h6",children:N})})),(0,d.jsxs)(j.Z,{children:[t&&ev>0&&(0,d.jsx)(_,{height:"200px",images:eh}),(0,d.jsx)(a.i,{columns:ep,rows:em,loading:er,meta:en,ref:V,refetch:ei,columnVisibilityModel:{entity:C,thumbnails:Z,actions:M}}),k&&!(W&&em.length>0)&&(0,d.jsxs)(x.Z,{direction:"row",justifyContent:"center",spacing:2,mt:2,children:[(!z||"document"===z)&&(0,d.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:es,children:"Add Document"}),(!z||"image"===z||"avatar"===z)&&(0,d.jsxs)(O.Z,{variant:"contained",color:"secondary",onClick:ec,children:["Add ",z?"".concat(z.charAt(0).toUpperCase()).concat(z.slice(1)):"Image"]})]})]})]})};z.defaultProps={carousel:!0,data:[],filters:{},listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,title:"Media",type:null,onChangeExpanded:function(){},mediaFormProps:{},offCanvasProps:{},category:"media",onlySingleMedia:!1}},86901:function(e,t,n){"use strict";n.d(t,{S:function(){return o}});var r=n(40826),i=n(85893),o=function(e,t){var n=function(){return(0,i.jsx)(r.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},o=function(){return(0,i.jsx)(r.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},a=function(){return(0,i.jsx)(r.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?null!=t&&t.thumbnails&&null!=t&&t.thumbnails.length?n:o:a}},12603:function(e,t,n){"use strict";n.d(t,{O:function(){return s},t:function(){return c}});var r,i,o=n(71383),a=n(75063),c=(0,a.Ps)(r||(r=(0,o.Z)(["\n  query MEDIAS(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $type: String\n    $adminId: Int\n    $meta: jsonb\n  ) {\n    items: Media_Entity(\n      limit: $limit\n      offset: $offset\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n      order_by: { Medium: { createdAt: desc } }\n    ) {\n      id\n      entity\n      entityId\n      mediaId\n      item: Medium {\n        id\n        visibility\n        caption\n        category\n        createdAt\n        expiryAt\n        filename\n        name\n        type\n        meta\n        userId\n        user: User {\n          id\n          nameFirst\n          nameLast\n        }\n      }\n    }\n    meta: Media_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),s=(0,a.Ps)(i||(i=(0,o.Z)(["\n  query GetPreloadedMediaByEntity(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $adminId: Int\n  ) {\n    items: Media_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: { adminId: { _eq: $adminId }, category: { _eq: $category } }\n      }\n    ) {\n      mediaId\n      media: Medium {\n        id\n        filename\n        caption\n      }\n    }\n  }\n"])))},4788:function(e,t,n){"use strict";n.d(t,{d:function(){return p}});var r=n(16835),i=n(50319),o=n(75847),a=n(84808),c=n(98456),s=n(15861),l=n(26447),u=n(11057),d=n(85893),p=function(e){var t=e.mediaId,n=e.onSuccess,p=(0,i.D)(o.CI,{variables:{id:t},refetchQueries:["MEDIAS"],onCompleted:function(){return n(t)}}),f=(0,r.Z)(p,2),m=f[0],h=f[1].loading;return h?(0,d.jsx)(a.Z,{sx:{zIndex:1e5},open:!0,children:(0,d.jsx)(c.Z,{color:"secondary"})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.Z,{children:"Are you sure you want to delete this?"}),(0,d.jsx)(l.Z,{alignItems:"flex-end",children:(0,d.jsx)(u.Z,{variant:"contained",color:"danger",disabled:h,onClick:function(){return m()},children:"Delete"})})]})}},94784:function(e,t,n){"use strict";n.d(t,{z:function(){return D}});var r=n(59499),i=n(50029),o=n(16835),a=n(64687),c=n.n(a),s=n(67294),l=n(50319),u=n(75847),d=n(84808),p=n(98456),f=n(26186),m=n(76600),h=n(34953),v=n(16540),b=n(55843),y=n(86901),g=n(47159),j=n(39496),x=n(60036),O=n(72936),w=n(42283),P=n(6911),Z=n(85893);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D=function(e){var t,n=e.media,r=e.toggleShow,a=(0,s.useState)(!1),I=a[0],D=a[1],k=(0,O.x)().hasRole,C=n.caption,_=n.createdAt,M=n.entity,A=n.entityId,E=n.filename,T=n.mediaId,$=n.meta,N=n.name,q=n.id,z=n.visibility,F=n.type,L=n.user,U=(0,w.cI)({defaultValues:{visibility:(0,j.c)(z)}}),R=U.control,Y=U.handleSubmit,W=(0,l.D)(u.o7,{refetchQueries:["MEDIAS"],onCompleted:function(e){D(!1),e&&r&&r()}}),B=(0,o.Z)(W,2),Q=B[0];B[1].error;var V,G=(t=(0,i.Z)(c().mark(function e(t){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Q({variables:{changes:{visibility:t.visibility.value},id:q}}).then(function(){return r()});case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),H=[{key:"ID",value:T,hidden:!0},{key:"Name",value:N||E},{key:"Visible to",value:z.join(", ")},{key:"Caption",value:C},{key:"Entity",value:M?"".concat(M,"#").concat(A):"-",hidden:!0},{key:"Type",value:F},{key:"Uploaded by",value:"".concat(null==L?void 0:L.nameFirst," ").concat(null==L?void 0:L.nameLast)},{key:"Created at",value:(0,f.Z)(_)}];"image"===F&&H.push({key:"Thumbnails",value:(0,y.S)(F,$),hidden:!0}),(0,i.Z)(c().mark(function e(){var t,n,r,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),n="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null!=$&&null!==(t=$.original)&&void 0!==t&&t.relativePath?$.original.relativePath:E),r=(0,g.V)(),(i=new window.FormData).append("sizes",r),i.append("url",n),e.next=8,window.fetch("https://aws.cleverly.works/image/process",{method:"POST",body:i}).then(function(e){return e.json()}).then(function(e){var t,n=null,r=S({},$)||{},i=e.key,o=e.data.find(function(e){return"large"===e.name});i.startsWith("https://cleverly-media.s3.eu-west-2.amazonaws.com")&&(i=i.replace("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/"),"")),n=o?o.relativePath:i,r.original={relativePath:i},r.thumbnails=e.data||null;var a={extension:null===(t=n)||void 0===t?void 0:t.split(".").pop(),filename:n,meta:r};Q({variables:{changes:a,id:T}})}).catch(function(e){(0,x.Tb)({message:e,section:"fetch"})});case 8:case"end":return e.stop()}},e)})),null!=$&&$.thumbnails;var X=(0,j.z)(k).options;return I?(0,Z.jsx)(d.Z,{sx:{zIndex:1e5},open:!0,children:(0,Z.jsx)(p.Z,{color:"secondary"})}):(0,Z.jsxs)(m.Z,{id:"offCanvasForm",handleSubmit:Y(G),children:["image"===F&&(0,Z.jsx)(h.Z,{alt:C||E,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(E)}),(0,Z.jsx)(v.Z,{rows:H}),(0,Z.jsx)(w.Qr,{name:"visibility",control:R,render:function(e){var t=e.value,n=e.onChange;return(0,Z.jsx)(P.q,{value:t,disableClearable:!0,textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,t){return n(t)},options:X})}}),!1,(0,Z.jsx)(b.Z,{}),!1]})};D.defaultProps={type:"image"}},85011:function(e,t,n){"use strict";n.d(t,{z:function(){return T}});var r=n(59499),i=n(50029),o=n(16835),a=n(64687),c=n.n(a),s=n(67294),l=n(42283),u=n(79665),d=n(30381),p=n.n(d),f=n(50319),m=n(75847),h=n(73987),v=n(76600),b=n(49501),y=n(55563),g=n(13439),j=n(51466),x=n(92264),O=n(52220),w=n(49088),P=n(74231),Z=(0,P.Ry)().shape({caption:(0,P.Z_)(),dropzone:(0,P.nK)().required()}),I=n(72936),S=n(6911),D=n(60036),k=n(84808),C=n(98456),_=n(39496),M=n(85893);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var T=function(e){var t,n=e.accept,r=e.adminId,a=e.category,d=e.entity,P=e.entityId,A=e.expiryShow,T=e.mediaMeta,$=e.multiple,N=e.onSuccess,q=e.type,z=e.showSubmitButton,F=(0,s.useState)(!1),L=F[0],U=F[1],R=(0,s.useState)(!1),Y=R[0],W=R[1],B=(0,I.x)().hasRole,Q=(0,_.z)(B),V=Q.defaultOption,G=Q.options,H=(0,l.cI)({resolver:(0,u.S)(Z),defaultValues:{visibility:V}}),X=H.control,J=H.errors,K=H.handleSubmit,ee=H.register,et=H.reset,en=(0,s.useContext)(h.Z).user,er=(0,f.D)(m.xM,{refetchQueries:["MEDIAS"]}),ei=(0,o.Z)(er,2),eo=ei[0],ea=ei[1].loading,ec=(0,f.D)(m.tv,{refetchQueries:["MEDIAS"]}),es=(0,o.Z)(ec,2),el=es[0],eu=es[1].loading,ed=(t=(0,i.Z)(c().mark(function e(t){var n,o,s,l,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.caption,o=t.visibility,s=t.dropzone,l=t.expiryAt,e.prev=1,U(!0),W(!1),e.t0=Promise,e.next=7,s.map(function(){var e=(0,i.Z)(c().mark(function e(t){var i,s,u,d,f,m,h;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return e.next=3,(0,w.V)(t,q);case 3:return s=e.sent,u=null,d=null,"image"===q?(f=s.key,u=(m=s.data.find(function(e){return"large"===e.name}))?m.relativePath:f,d={original:{relativePath:f},thumbnails:s.data||null}):u=s.key,h={adminId:r,category:a,caption:n,expiryAt:l?p()(l).utc().format():null,extension:null===(i=u)||void 0===i?void 0:i.split(".").pop(),userId:en.id,filename:u,meta:E(E({},d),T),type:q,visibility:o.value},e.abrupt("return",h);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:return e.t1=e.sent,e.next=10,e.t0.all.call(e.t0,e.t1);case 10:eo({variables:{objects:e.sent}}).then(function(){var e=(0,i.Z)(c().mark(function e(t){var n,r,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data.insert_Media.returning,!(d&&P)){e.next=6;break}return i=r.map(function(e){return{mediaId:e.id,entity:d,entityId:P}}),e.next=6,el({variables:{objects:i}});case 6:et(),U(!1),N&&N(r);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=19;break;case 14:e.prev=14,e.t2=e.catch(1),U(!1),W(!0),(0,D.Tb)({message:e.t2,section:"upload"});case 19:case"end":return e.stop()}},e,null,[[1,14]])})),function(e){return t.apply(this,arguments)}),ep={control:X,errors:J,register:ee};return L||ea||eu?(0,M.jsx)(k.Z,{sx:{zIndex:1e5},open:!0,children:(0,M.jsx)(C.Z,{color:"secondary"})}):(0,M.jsxs)(v.Z,{id:"offCanvasForm",handleSubmit:K(ed),children:[(0,M.jsx)(b.Z,{label:"Caption",children:(0,M.jsx)(y.Z,E(E({},ep),{},{name:"caption"}))}),A&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(b.Z,{label:"Expiry"}),(0,M.jsx)(O.M,E(E({},ep),{},{name:"expiryAt"}))]}),(0,M.jsx)(b.Z,{label:"Media"}),(0,M.jsx)(l.Qr,E(E({},ep),{},{as:(0,M.jsx)(g.Z,{accept:"image/*"===n?n+", .heic":n,multiple:$}),name:"dropzone"})),(0,M.jsx)(l.Qr,{name:"visibility",control:X,render:function(e){var t=e.value,n=e.onChange;return(0,M.jsx)(S.q,{value:t,disableClearable:!0,getOptionLabel:function(e){return e.label},textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,t){return n(t)},options:G})}}),Y&&(0,M.jsx)(j.Z,{context:"danger",content:"Can not upload Media"}),z&&(0,M.jsx)(x.H,{content:"Submit",type:"submit"})]})};T.defaultProps={accept:g.Z.defaultProps.accept,category:null,expiryShow:!0,mediaMeta:null,showSubmitButton:!1,showAdminOnly:!0,type:"image"}},75847:function(e,t,n){"use strict";n.d(t,{CI:function(){return d},o7:function(){return p},tv:function(){return u},xM:function(){return l}});var r,i,o,a,c=n(71383),s=n(75063),l=(0,s.Ps)(r||(r=(0,c.Z)(["\n  mutation AddMedia($objects: [Media_insert_input!]!) {\n    insert_Media(objects: $objects) {\n      returning {\n        id\n        filename\n      }\n    }\n  }\n"]))),u=(0,s.Ps)(i||(i=(0,c.Z)(["\n  mutation AddMediaEntity($objects: [Media_Entity_insert_input!]!) {\n    insert_Media_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),d=(0,s.Ps)(o||(o=(0,c.Z)(["\n  mutation DeleteMedia($id: Int!) {\n    delete_Media_by_pk(id: $id) {\n      id\n    }\n  }\n"]))),p=(0,s.Ps)(a||(a=(0,c.Z)(["\n  mutation UpdateMedia($changes: Media_set_input, $id: Int!) {\n    update_Media_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},47159:function(e,t,n){"use strict";n.d(t,{V:function(){return r}});var r=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])}},49088:function(e,t,n){"use strict";n.d(t,{V:function(){return s}});var r,i=n(50029),o=n(64687),a=n.n(o),c=n(47159),s=(r=(0,i.Z)(a().mark(function e(t,n){var r,i,o,s,l;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r="cleverly-media",i="https://aws.cleverly.works/aws/s3/upload",(o=new window.FormData).append("file",t,t.name),e.t0=n,e.next="image"===e.t0?7:"document"===e.t0?10:"audio"===e.t0?14:18;break;case 7:return s="https://aws.cleverly.works/image/process",o.append("sizes",(0,c.V)()),e.abrupt("break",19);case 10:case 14:return o.append("bucket",r),o.append("folder","".concat(n,"s")),s=i,e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:return e.next=21,window.fetch(s,{method:"POST",body:o});case 21:return l=e.sent,e.abrupt("return",l.json());case 23:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})},77010:function(e,t,n){"use strict";n.d(t,{E:function(){return h}});var r=n(59499),i=n(94054),o=n(26447),a=n(40476),c=n(79717),s=n(50480),l=n(36872),u=n(15861),d=n(56815),p=n(85893);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){var t=e.label,n=e.options,r=e.error,f=e.helperText,h=e.stackProps,b=e.formControlProps,y=e.labelLeft,g=function(e){var t=e.children;return(0,p.jsx)(p.Fragment,{children:t})};return(0,p.jsxs)(i.Z,m(m({sx:{m:3},error:r,variant:"standard"},void 0===b?{}:b),{},{children:[(0,p.jsxs)(o.Z,m(m({},y&&v),{},{children:[t&&(0,p.jsx)(a.Z,{id:"radio-group",color:"secondary",children:t}),(0,p.jsx)(c.Z,m(m({},e),{},{"aria-labelledby":"radio-group",children:(0,p.jsx)(o.Z,m(m({},void 0===h?{}:h),{},{children:n.map(function(e){var t=e.value,n=e.label,r=e.icon,i=e.ParentComponent;return(0,p.jsx)(void 0===i?g:i,{children:(0,p.jsx)(s.Z,{value:t,control:(0,p.jsx)(l.Z,{color:"secondary"}),label:(0,p.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[r,(0,p.jsx)(u.Z,{children:n})]})})})})}))}))]})),(0,p.jsx)(d.Z,{children:f})]}))};h.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1};var v={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},67432:function(e,t,n){"use strict";n.d(t,{P:function(){return x}});var r=n(59499),i=n(10166),o=n(26447),a=n(15861),c=n(87918),s=n(69368),l=n(18360),u=n(5616),d=n(18972),p=n(56815),f=n(94054),m=n(47312),h=n(85893),v=n(67294);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g={text:function(e){var t=e.option,n=e.multiple,r=e.index;return n&&r>0?", ".concat(t.label):t.label},textWithIcon:function(e){var t=e.option;return(0,h.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,(0,h.jsxs)(a.Z,{children:[" ",t.label]})]})},chip:function(e){var t=e.chipProps,n=e.option;return(0,v.createElement)(c.Z,y(y({},t),{},{key:n.value,label:n.label,icon:n.icon,sx:{color:n.color,bgcolor:n.bgcolor}}))}},j={text:function(e){return e.option.label},textWithIcon:function(e){var t=e.option;return(0,h.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,(0,h.jsxs)(a.Z,{children:[" ",t.label]})]})},chip:function(e){var t=e.chipProps,n=e.option;return(0,v.createElement)(c.Z,y(y({},t),{},{key:n.value,label:n.label,icon:n.icon,sx:{color:n.color,bgcolor:n.bgcolor}}))},checkbox:function(e){var t=e.option,n=e.value;return(0,h.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,h.jsx)(s.Z,{color:"secondary",sx:{height:"10px"},checked:n.indexOf(t.value)>-1}),(0,h.jsxs)(a.Z,{children:[" ",t.label]})]})}},x=function(e){var t=e.label,n=e.value,r=e.onChange,i=e.leftSideLabel,o=e.options,c=e.inputComponent,s=e.selectComponent,f=e.withoutSelectIcon,m=e.formControl,v=e.chipProps,b=e.selectProps,x=function(e){return o.find(function(t){return t.value===e})};return(0,h.jsxs)(O,y(y({},m),{},{leftSideLabel:i,withoutSelectIcon:f,children:[t&&i&&(0,h.jsx)(a.Z,{children:t}),t&&!i&&(0,h.jsx)(w,{shrink:""!==n&&void 0!==n,children:t}),(0,h.jsx)(l.Z,y(y({displayEmpty:!0},b),{},{value:n,onChange:r,inputProps:{shrink:!0},renderValue:function(){if(Array.isArray(n))return(0,h.jsx)(u.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(function(e,t){var n=x(e);return n?g[c]({chipProps:v,option:n,multiple:!0,index:t}):""})});var e=x(n);return e?(0,h.jsx)(u.Z,{children:g[c]({chipProps:v,option:e})}):""},children:o.map(function(e){return(0,h.jsx)(d.Z,{value:e.value,children:j[s]({chipProps:v,option:e,value:n})},e.value)})})),(null==m?void 0:m.helperText)&&(0,h.jsx)(p.Z,{children:m.helperText})]}))};x.defaultProps={label:"",onChange:function(){},leftSideLabel:!1,options:[],inputComponent:"text",selectComponent:"text",withoutSelectIcon:!1,formControl:{error:!1,helperText:""},chipProps:{size:"small"},selectProps:{}};var O=(0,i.Z)(f.Z)(function(e){e.theme;var t=e.leftSideLabel,n=e.withoutSelectIcon;return{"&.MuiFormControl-root":y({display:"flex",flexDirection:"column",alignItems:"flex-start"},t&&{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"}),"& .MuiSelect-icon":y({},n&&{display:"none"})}}),w=(0,i.Z)(m.Z)(function(e){return{"&.MuiFormLabel-root.MuiInputLabel-root.Mui-focused":{color:e.theme.palette.secondary.main}}})},42846:function(e,t,n){"use strict";n.d(t,{x:function(){return u}});var r=n(59499),i=n(67294),o=n(96486),a=n(87043),c=function(e){try{return JSON.parse(e)}catch(t){return!1}};function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u=function(e){var t,n,s,u,d,p,f,m,h,v,b,y=e.filters,g=e.newFilters,j=e.initialSort,x=(0,i.useRef)(),O=(0,i.useState)({}),w=O[0],P=O[1],Z=(0,i.useState)({}),I=Z[0],S=Z[1],D=j||{item:"createdAt",order:"desc"},k=(0,r.Z)({},(null===(t=x.current)||void 0===t?void 0:t.sort.item)||D.item,D.inneritem?(0,r.Z)({},D.inneritem,(null===(n=x.current)||void 0===n?void 0:n.sort.order)||D.order):(null===(s=x.current)||void 0===s?void 0:s.sort.order)||D.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(w,y),t=!(0,o.isEqual)(I,g);if(e&&(P(y),null==x||null===(r=x.current)||void 0===r||r.resetPagination()),t&&(S(g),null==x||null===(i=x.current)||void 0===i||i.resetPagination()),null!=x&&null!==(n=x.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,i,a,c,s,l,u,d,p,f,m=null!==(a=x.current)&&void 0!==a&&null!==(c=a.sort)&&void 0!==c&&c.item&&null!==(s=x.current)&&void 0!==s&&null!==(l=s.sort)&&void 0!==l&&l.order?{item:null===(u=x.current)||void 0===u?void 0:null===(d=u.sort)||void 0===d?void 0:d.item,order:null===(p=x.current)||void 0===p?void 0:null===(f=p.sort)||void 0===f?void 0:f.order}:k;x.current.setSort(m)}},[y,g]),{initialData:l(l({},y),{},{newFilters:(null==g?void 0:g.length)>0?g:void 0,limit:(null===(u=x.current)||void 0===u?void 0:u.pageSize)==="Infinity"?null:parseInt(null===(d=x.current)||void 0===d?void 0:d.pageSize,10)||a.C1.paginationSize,offset:((null===(p=x.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(f=x.current)||void 0===f?void 0:f.pageSize)||a.C1.paginationSize),orderBy:c(null===(m=x.current)||void 0===m?void 0:null===(h=m.sort)||void 0===h?void 0:null===(v=h.item)||void 0===v?void 0:v.replace(/ORDER/i,null===(b=x.current)||void 0===b?void 0:b.sort.order))||k}),initialSort:j,ref:x}}},64951:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var r=function(e){switch(e){case"ppm":return"PM";case"quote":return"Q";case"reactive":return"J";case"cppm":return"C";default:return""}}},39496:function(e,t,n){"use strict";n.d(t,{z:function(){return a},c:function(){return c}});var r=n(27812),i=n(96486),o={ALL:["admin","customer","supplier","tenant"],ADMIN_ONLY:["admin"],ADMIN_CUSTOMER:["admin","customer"],ADMIN_SUPPLIER:["admin","supplier"]},a=function(e){return e("admin")?{defaultOption:{label:"All",value:o.ALL},options:[{label:"All",value:o.ALL},{label:"Admin only",value:o.ADMIN_ONLY},{label:"Admin+customer",value:o.ADMIN_CUSTOMER},{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}]}:e("customer")?{defaultOption:{label:"Admin+customer",value:o.ADMIN_CUSTOMER},options:[{label:"All",value:o.ALL},{label:"Admin+customer",value:o.ADMIN_CUSTOMER}]}:e("supplier")?{defaultOption:{label:"Admin+supplier",value:o.ADMIN_SUPPLIER},options:[{label:"All",value:o.ALL},{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}]}:void 0},c=function(e){var t=(0,r.Z)(e).sort();return i.isEqual(t,o.ALL)?{label:"All",value:o.ALL}:i.isEqual(t,o.ADMIN_ONLY)?{label:"Admin only",value:o.ADMIN_ONLY}:i.isEqual(t,o.ADMIN_CUSTOMER)?{label:"Admin+customer",value:o.ADMIN_CUSTOMER}:i.isEqual(t,o.ADMIN_SUPPLIER)?{label:"Admin+supplier",value:o.ADMIN_SUPPLIER}:void 0}},32715:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var r=n(11994),i=n(67294),o=n(85893);function a(){var e=(0,i.useState)(null),t=e[0],n=e[1],a=(0,i.useCallback)(function(){n(null)},[]),c=(0,i.useMemo)(function(){if(null===t)return null;var e=t.content,n=t.keepMounted;return(0,o.jsx)(r.Z,{open:!0,keepMounted:n,onClose:a,children:e})},[t,a]),s=(0,i.useCallback)(function(e){var t=e.content,r=e.keepMounted;n({keepMounted:void 0===r||r,content:t({onClose:a})})},[a]);return[c,s]}},82144:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eu}});var r,i,o,a,c=n(16835),s=n(59499),l=n(67294),u=n(30381),d=n.n(u),p=n(8602),f=n(2869),m=n(26447),h=n(15861),v=n(11057),b=n(90629),y=n(6812),g=n(50319),j=n(71383),x=n(75063),O=(0,x.Ps)(r||(r=(0,j.Z)(['\n  query GetTasksTable(\n    $where: Task_bool_exp\n    $limit: Int! = 50\n    $offset: Int\n    $orderBy: Task_order_by!\n  ) {\n    tasks: Task(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      id\n      archived\n      status\n      priority\n      statusLog\n      meta\n      relatedLinks\n      title\n      content\n      dueDate\n      createdAt\n      updatedAt\n      adminId\n      userId\n      assignedAccountId\n      assignedUser: AssignedUser {\n        id\n        fullName\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Task" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n        }\n      }\n      jobId\n    }\n    meta: Task_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),w=(0,x.Ps)(i||(i=(0,j.Z)(["\n  mutation TaskPartialUpdate($id: Int!, $object: Task_set_input!) {\n    update_Task_by_pk(pk_columns: { id: $id }, _set: $object) {\n      id\n      status\n      priority\n    }\n  }\n"]))),P=(0,x.Ps)(o||(o=(0,j.Z)(['\n  query GetAssingedToForSelect($accountId: Int, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n'])));(0,x.Ps)(a||(a=(0,j.Z)(['\n  query GetTagsForTask($taskId: Int!, $q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: "active" }\n        type: { _eq: "tags" }\n        _not: { Taxonomy_Entities: { entity: { _eq: "Task" }, entityId: { _eq: $taskId } } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n'])));var Z=n(32836),I=n(67432),S=n(26143),D=n(24770),k=n(61730),C=n(86886),_=n(50135),M=n(23776),A=n(18972),E=n(87918),T=n(50480),$=n(69368),N=n(11994),q=n(3896),z=n(42283),F=n(73359),L=n(18574),U=n(88085),R=n(10166),Y=n(72936),W=n(33754),B=n(89077),Q=n(15050),V=n(85893);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var X=function(e){var t=e.open,n=e.setOpen,r=e.initialFilters,i=e.filters,o=e.setFilters,a=(0,Y.x)().user,s=(0,k.Z)("(max-width: 400px)")?4:0,u=(0,q.X)("form_data_".concat(r.filterType),r),d=(0,c.Z)(u,2),p=d[0],f=d[1],m=(0,z.cI)({defaultValues:p}),b=m.control,y=m.handleSubmit,g=m.register,j=m.reset,x=(0,m.watch)(),O=(0,F.t)(P,{variables:{accountId:a.adminId}}),w=(0,c.Z)(O,2),Z=w[0],I=w[1],S=I.loading,D=I.data,N=(D=void 0===D?{items:[]}:D).items;(0,l.useEffect)(function(){t&&j(p)},[t]),(0,l.useEffect)(function(){var e=H(H({},x),{},{filterType:r.filterType});f(e)},[i]);var R=function(e){try{var t,r,i,c,s,l,u,d={status:(null===(t=e.status)||void 0===t?void 0:t.length)>0?null===(r=e.status)||void 0===r?void 0:r.map(function(e){return e.value}):null,assignedUserId:e.assignedToMe?a.id:null===(i=e.assignedUser)||void 0===i?void 0:i.value,priority:null!==(c=e.priority)&&void 0!==c&&c.length?null===(s=e.priority)||void 0===s?void 0:s.map(function(e){return e.value}):null,dueDate:e.dueDate,archived:e.archived,tags:(null===(l=e.tags)||void 0===l?void 0:l.length)>0?null===(u=e.tags)||void 0===u?void 0:u.map(function(e){return e.value}):null,q:e.search?"%".concat(e.search,"%"):null};o(function(e){return H(H({},e),d)})}finally{n(!1)}},G=function(){o(r),j(r),n(!1)};return(0,V.jsx)(J,{keepMounted:!0,open:t,onClose:function(){return n(!1)},children:(0,V.jsx)("form",{onSubmit:y(R),children:(0,V.jsx)(K,{children:(0,V.jsxs)(C.ZP,{container:!0,rowGap:4,children:[(0,V.jsx)(C.ZP,{container:!0,children:(0,V.jsx)(C.ZP,{item:!0,xs:12,children:(0,V.jsx)(_.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"search",inputRef:g})})}),(0,V.jsxs)(C.ZP,{container:!0,columnSpacing:4,rowGap:s,children:[(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{control:b,name:"status",render:function(e){var t=e.value,n=e.onChange;return(0,V.jsx)(M.Z,{multiple:!0,limitTags:1,color:"secondary",options:B.jb,value:t||[],onChange:function(e,t){n(t)},renderOption:function(e,t){return(0,V.jsx)(A.Z,H(H({},e),{},{children:(0,V.jsx)(E.Z,{size:"small",label:t.label,icon:t.icon,sx:{color:t.color,bgcolor:t.bgcolor}})}))},renderTags:function(e,t){return e.map(function(e,n){return(0,V.jsx)(E.Z,H({size:"small",label:e.label,icon:e.icon,sx:{color:e.color,bgcolor:e.bgcolor}},t({index:n})))})},renderInput:function(e){return(0,V.jsx)(_.Z,H(H({},e),{},{variant:"standard",color:"secondary",label:"Select status"}))}})}})}),(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{name:"assignedUser",control:b,render:function(e){var t=e.value,n=e.onChange;return(0,V.jsx)(L.F,{value:t||null,onChange:function(e,t){return n(t)},label:"Select Assigned user",loading:S,onOpen:function(){return Z()},options:N})}})})]}),(0,V.jsxs)(C.ZP,{container:!0,columnSpacing:4,rowGap:s,children:[(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{control:b,name:"priority",render:function(e){var t=e.value,n=e.onChange;return(0,V.jsx)(M.Z,{multiple:!0,limitTags:1,color:"secondary",options:B.FX,value:t||[],onChange:function(e,t){n(t)},renderOption:function(e,t,n){return(0,V.jsx)(A.Z,H(H({},e),{},{children:(0,V.jsxs)(U.Z,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,(0,V.jsxs)(h.Z,{children:[" ",t.label]})]})}))},renderTags:function(e){return e.map(function(e){return(0,V.jsxs)(U.Z,{direction:"row",alignItems:"center",spacing:1,mr:1,children:[e.icon,(0,V.jsxs)(h.Z,{children:[" ",e.label]})]})})},renderInput:function(e){return(0,V.jsx)(_.Z,H(H({},e),{},{variant:"standard",color:"secondary",label:"Select priority"}))}})}})}),(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{control:b,name:"dueDate",defaultValue:null,render:function(e){return(0,V.jsx)(W.M,H(H({},e),{},{label:"Due date",inputFormat:"Do MMM YYYY",renderInput:function(e){return(0,V.jsx)(_.Z,H(H({},e),{},{fullWidth:!0,color:"secondary",variant:"standard"}))}}))}})})]}),(0,V.jsx)(C.ZP,{container:!0,columnSpacing:4,rowGap:s,children:(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(Q.r,{control:b})})}),(0,V.jsxs)(C.ZP,{container:!0,columnSpacing:4,rowGap:s,children:[(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{name:"assignedToMe",control:b,render:function(e){var t=e.value,n=e.onChange;return(0,V.jsx)(T.Z,{control:(0,V.jsx)($.Z,{color:"secondary",checked:t,onChange:function(e){return n(e.target.checked)}}),label:"Assigned to me"})}})}),(0,V.jsx)(C.ZP,{item:!0,xs:12,xs2:6,children:(0,V.jsx)(z.Qr,{name:"archived",control:b,render:function(e){var t=e.value,n=e.onChange;return(0,V.jsx)(T.Z,{control:(0,V.jsx)($.Z,{color:"secondary",checked:t,onChange:function(e){return n(e.target.checked)}}),label:"Show archived tasks"})}})})]}),(0,V.jsx)(C.ZP,{container:!0,item:!0,xs:12,children:(0,V.jsxs)(U.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,V.jsx)(v.Z,{variant:"contained",color:"danger",onClick:function(){return G()},children:"Cancel"}),(0,V.jsx)(v.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})})]})})})})};X.defaultProps={open:!1,setOpen:function(){},initialFilters:{},filters:{},setFilters:function(){}};var J=(0,R.Z)(N.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}}),K=(0,R.Z)(b.Z)(function(){return{padding:"24px",maxWidth:"700px",maxHeight:"100vh",overflowY:"scroll"}}),ee=n(55733),et=n(24437),en=n(42846),er=n(58095);function ei(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var eo=function(e){var t=e.q,n=e.archived,r=e.status,i=e.priority,o=e.dueDate,a=e.assignedUserId,c=e.tags,l=e.limit,u=e.offset,d=e.orderBy;return{where:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ei(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({_or:[{title:{_ilike:t}},{content:{_ilike:t}}],archived:{_eq:n},status:r?{_in:r}:{_nin:[B.cj.DONE]},priority:{_in:i},dueDate:{_eq:o},assignedUserId:{_eq:a}},c&&c.length>0&&{Taxonomy:{Taxonomy:{id:{_in:c}}}}),limit:l,offset:u,orderBy:d}};function ea(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ec=function(e){var t=e.initialFilters,n=(0,er.a)(),r=(0,l.useState)(!1),i=r[0],o=r[1],a=(0,l.useState)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ea(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ea(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t)),u=a[0],j=a[1],x=(0,en.x)({filters:u}),P=x.initialData,k=x.ref,C=eo(P),_=(0,y.a)(O,{variables:C}),M=_.data,A=(M=void 0===M?{tasks:[],meta:{aggregate:{totalCount:0}}}:M).tasks,E=M.meta,T=_.refetch,$=(0,g.D)(w,{refetchQueries:["GetTasksTable"]}),N=(0,c.Z)($,1)[0],q=function(e){e.stopPropagation(),n.show({content:(0,V.jsx)(ee.G,{close:n.close}),title:"Create Task",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},z=function(e){n.show({content:(0,V.jsx)(et.J,{id:e.id,close:n.close}),title:"Task Details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"100vw",lg:"90vw",lg2:"80vw"})},F=function(e,t){N({variables:{id:e.id,object:{archived:t}}})},L=A.map(function(e){return{id:e.id,archived:e.archived,priority:e.priority,title:e.title,createdAt:e.createdAt,dueDate:e.dueDate,assignedTo:e.assignedUser.fullName,status:e.status,tags:e.tags}});return(0,V.jsxs)(m.Z,{width:"100%",spacing:2,sx:{height:"calc(100% - 58px)"},children:[(0,V.jsxs)(m.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,V.jsx)(v.Z,{variant:"contained",startIcon:(0,V.jsx)(p.Z,{}),onClick:function(){return o(!0)},children:"Filters"}),(0,V.jsx)(m.Z,{direction:"row",spacing:2,children:(0,V.jsx)(v.Z,{variant:"contained",color:"secondary",onClick:q,children:"Create Task"})})]}),(0,V.jsxs)(b.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:"100%"},children:[(0,V.jsx)(m.Z,{direction:"row",justifyContent:"space-between",children:(0,V.jsx)(h.Z,{ml:2,variant:"h5",sx:{fontWeight:600},children:"Tasks"})}),(0,V.jsx)(X,{initialFilters:t,filters:u,setFilters:j,open:i,setOpen:o}),(0,V.jsx)(Z.i,{autoHeight:!1,ref:k,columns:[{minWidth:120,field:"priority",headerName:"Priority",sortable:!0,renderCell:function(e){var t,n=e.row;return(0,V.jsx)(I.P,{selectProps:{input:(0,V.jsx)(f.ZP,{})},withoutSelectIcon:!0,inputComponent:"textWithIcon",selectComponent:"textWithIcon",options:B.FX,value:n.priority,onChange:function(e){e.stopPropagation(),N({variables:{id:n.id,object:{priority:e.target.value}}})}})}},{minWidth:200,flex:1,field:"title",headerName:"Task",sortable:!1,renderCell:function(e){var t=e.row;return(0,V.jsxs)(m.Z,{direction:"row",alignItems:"center",children:[(0,V.jsx)(h.Z,{mr:1,children:t.title}),(0,V.jsx)(D.K,{row:t,entity:"Task",refetchQueries:["GetTasksTable"]})]})}},{minWidth:160,field:"createdAt",headerName:"Created date",sortable:!0,renderCell:function(e){var t=e.row;return d()(t.createdAt).format("YYYY-MM-DD")}},{minWidth:160,field:"dueDate",headerName:"Due date",sortable:!0,renderCell:function(e){var t=e.row;return d()(t.dueDate).isSame(d()(),"day")?(0,V.jsx)(h.Z,{sx:{color:"info.main"},children:d()(t.dueDate).format("YYYY-MM-DD")}):d()(t.dueDate).isBefore(d()(),"day")?(0,V.jsx)(h.Z,{sx:{color:"danger.main"},children:d()(t.dueDate).format("YYYY-MM-DD")}):(0,V.jsx)(h.Z,{children:d()(t.dueDate).format("YYYY-MM-DD")})}},{minWidth:120,field:"assignedTo",headerName:"Assigned to",sortable:!0,sortName:'{"AssignedUser": {"nameFirst": "ORDER"}}'},{minWidth:120,field:"status",headerName:"Status",sortable:!0,renderCell:function(e){var t,n=e.row;return(0,V.jsx)(I.P,{selectProps:{input:(0,V.jsx)(f.ZP,{})},withoutSelectIcon:!0,inputComponent:"chip",selectComponent:"chip",options:B.jb,value:n.status,onChange:function(e){e.stopPropagation(),N({variables:{id:n.id,object:{status:e.target.value}}})}})}},{width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var t=e.row;return(0,V.jsx)(S.C,{row:t,actionsData:function(e){var t=[];return t.push({icon:"info",onClick:function(t){t.stopPropagation(),z(e)},tooltip:"Info"}),e.archived?t.push({icon:"unarchive",onClick:function(t){t.stopPropagation(),F(e,!1)},tooltip:"Unarchive"}):t.push({icon:"archive",onClick:function(t){t.stopPropagation(),F(e,!0)},tooltip:"Archive"}),t}})}}],rows:L,meta:E,refetch:T,onRowClick:z,containerHeight:"calc(100% - 32px)",columnVisibilityModel:{}})]})]})};ec.defaultProps={initialFilters:{}};var es=n(38033),el=function(){return(0,V.jsx)(ec,{initialFilters:{archived:!1,filterType:"task_table"}})};el.getLayout=function(e){return(0,V.jsx)(es.Z,{children:e})};var eu=el},61510:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/tasks",function(){return n(82144)}])}},function(e){e.O(0,[3662,2283,212,8890,619,1100,4135,5020,6043,4244,5370,3911,3776,6540,2329,778,4046,1023,4253,3148,2797,653,8062,7328,4061,597,4930,6515,8033,26,2161,9774,2888,179],function(){return e(e.s=61510)}),_N_E=e.O()}]);