(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7130],{92264:function(e,t,n){"use strict";n.d(t,{H:function(){return u}});var r=n(59499),i=n(55377),o=n(16551),a=n(77439),c=n(85893);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var u=function(e){var t=e.children,n=e.content,u=e.context,l=e.data,d=e.disabled,f=e.handleClick,p=e.size,g=e.type;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.Z,{size:"sm"}),(0,c.jsxs)(o.Z,{align:"flex-end",children:[t,(0,c.jsx)(a.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({content:n,context:u,disabled:d,onClick:f,size:p,type:g},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},75420:function(e,t,n){"use strict";n.d(t,{r:function(){return o}});var r=n(95103),i=n(85893),o=function(e){var t=e.errors,n=e.name,o=e.onChange,a=e.options,c=e.register;return(0,i.jsx)(r.Z,{errors:t,name:n,onChange:o,options:a,register:c})};o.defaultProps={name:"status"}},67872:function(e,t,n){"use strict";n.d(t,{t:function(){return s}});var r=n(67294),i=n(11163),o=n(87043),a=n(16540),c=n(85893),s=(0,r.forwardRef)(function(e,t){var n=e.columns,s=e.history,u=e.initialSort,l=e.loading,d=e.meta,f=e.paginationSize,p=e.refetch,g=e.rowClick,v=e.rows,y=e.xeroPageSize,b=(0,i.useRouter)(),m=b.query,O=void 0===m?{}:m,j=(0,r.useState)(parseInt(null==O?void 0:O.page,10)||1),h=j[0],w=j[1],P=(0,r.useState)(y||o.C1.paginationSize),S=P[0],x=P[1];u||(u={item:"createdAt",order:"desc"});var _=(0,r.useState)({item:u.item,order:u.order}),Z=_[0],C=_[1],k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=b.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},$=function(){C({item:u.item,order:u.order}),w(1);var e=k();b.push(e),x(y||o.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:h,pageSize:S,sort:Z,resetPagination:function(){$()}}});var A=function(e){var t=k(e);s&&b.push(t),w(e),!s&&p&&p()},D=function(e){e!==o.C1.paginationSize&&(x(e),p&&p())},E=function(e){var t;C({item:e.item,order:e.order}),p&&p()};return(0,c.jsx)(a.Z,{columns:n,loading:l,paginationSize:f,pagination:d&&!0,paginationProps:d&&{currentPage:h,onPageChange:A,onPageSizeChange:D,pageCount:Math.ceil(d.aggregate.totalCount/S),perPage:S},rowClick:g,rows:v,sort:Z,setSort:E})});s.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,n){"use strict";n.d(t,{x:function(){return l}});var r=n(59499),i=n(67294),o=n(96486),a=n(87043),c=function(e){try{return JSON.parse(e)}catch(t){return!1}};function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l=function(e){var t,n,s,l,d,f,p,g,v,y,b,m=e.filters,O=e.newFilters,j=e.initialSort,h=(0,i.useRef)(),w=(0,i.useState)({}),P=w[0],S=w[1],x=(0,i.useState)({}),_=x[0],Z=x[1],C=j||{item:"createdAt",order:"desc"},k=(0,r.Z)({},(null===(t=h.current)||void 0===t?void 0:t.sort.item)||C.item,C.inneritem?(0,r.Z)({},C.inneritem,(null===(n=h.current)||void 0===n?void 0:n.sort.order)||C.order):(null===(s=h.current)||void 0===s?void 0:s.sort.order)||C.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(P,m),t=!(0,o.isEqual)(_,O);if(e&&(S(m),null==h||null===(r=h.current)||void 0===r||r.resetPagination()),t&&(Z(O),null==h||null===(i=h.current)||void 0===i||i.resetPagination()),null!=h&&null!==(n=h.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,i,a,c,s,u,l,d,f,p,g=null!==(a=h.current)&&void 0!==a&&null!==(c=a.sort)&&void 0!==c&&c.item&&null!==(s=h.current)&&void 0!==s&&null!==(u=s.sort)&&void 0!==u&&u.order?{item:null===(l=h.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(f=h.current)||void 0===f?void 0:null===(p=f.sort)||void 0===p?void 0:p.order}:k;h.current.setSort(g)}},[m,O]),{initialData:u(u({},m),{},{newFilters:(null==O?void 0:O.length)>0?O:void 0,limit:(null===(l=h.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=h.current)||void 0===d?void 0:d.pageSize,10)||a.C1.paginationSize,offset:((null===(f=h.current)||void 0===f?void 0:f.currentPage)-1||0)*((null===(p=h.current)||void 0===p?void 0:p.pageSize)||a.C1.paginationSize),orderBy:c(null===(g=h.current)||void 0===g?void 0:null===(v=g.sort)||void 0===v?void 0:null===(y=v.item)||void 0===y?void 0:y.replace(/ORDER/i,null===(b=h.current)||void 0===b?void 0:b.sort.order))||k}),initialSort:j,ref:h}}},3896:function(e,t,n){"use strict";n.d(t,{X:function(){return p}});var r,i,o=n(71383),a=n(16835),c=n(59499),s=n(67294),u=n(6812),l=n(50319),d=n(75063),f=n(55863);function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,f.q)().user,i=(0,s.useState)(function(){try{switch(n){case"network":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),o=i[0],d=i[1],p=function(t){try{var i=t instanceof Function?t(o):t;switch(d(i),n){case"network":b({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,c.Z)({},e,i)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(i))}}catch(a){}};(0,u.a)(g,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&d(r.filters[e]||t)}});var y=(0,l.D)(v),b=(0,a.Z)(y,1)[0];return[o,p]}var g=(0,d.Ps)(r||(r=(0,o.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]))),v=(0,d.Ps)(i||(i=(0,o.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"])))},62929:function(e,t,n){"use strict";n.d(t,{Y:function(){return i},l:function(){return r}});var r=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],i=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},26380:function(e,t,n){"use strict";n.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},12964:function(e,t,n){"use strict";n.d(t,{J:function(){return x}});var r=n(59499),i=n(16835),o=n(4730),a=n(11163),c=n(67294),s=n(9270),u=n(62140),l=n(42283),d=n(76600),f=n(58965),p=n(49501),g=n(75903),v=n(77439),y=n(92264),b=n(3896),m=n(85893);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=function(e){var t=e.initialValues,n=e.renderFilters,r=e.setFilters,o=e.lastQuery,a=e.filters,O=(0,b.X)("form_data_".concat(t.filterType),t),h=(0,i.Z)(O,2),w=h[0],P=h[1],S=(0,l.cI)({defaultValues:w||t}),x=S.control,_=S.errors,Z=S.handleSubmit,C=S.register,k=S.reset,$=S.watch,A=S.setValue,D=$(),E=j(j({},D),{},{filterType:t.filterType});(0,c.useEffect)(function(){k(E)},[k]),(0,c.useEffect)(function(){P(E)},[a]);var I=function(e){var n=e.query;if(n!==o){var i={q:"%".concat(n,"%")||0},a=/^\d+$/.test(n);"id"in t&&(i.id=a?Number(n):null),"meta"in t&&(i.meta=a?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(i.jobNumber=a?String(n):null,i.invoiceNumber=a?Number(n):null),r(function(e){return j(j({},e),i)})}},q=function(e){Object.keys(t).map(function(e){return A(e,null)}),r(t),k(t),I("")};return(0,m.jsx)(d.Z,{handleSubmit:Z(I),children:(0,m.jsxs)(f.Z,{title:"Filters",children:[(0,m.jsxs)(s.Z,{children:[(0,m.jsx)(u.Z,{sm:12,lg:12,children:(0,m.jsx)(p.Z,{label:"",children:(0,m.jsx)(g.Z,{errors:_,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:C,type:"search"})})}),(0,m.jsx)(u.Z,{sm:12,lg:12,children:n({control:x,errors:_,initialValues:t,register:C,setFilters:r,watch:$,setValue:A,reset:k})})]}),(0,m.jsx)(y.H,{content:"Search",context:"secondary",handleClick:I,type:"submit",children:(0,m.jsx)(v.Z,{content:"Clear",context:"danger",onClick:q,size:"sm"})})]})})},w=["FiltersComp","initialFilters","TableComp"];function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x=function(e){var t=e.FiltersComp,n=e.initialFilters,r=e.TableComp,l=(0,o.Z)(e,w),d=(0,b.X)("form_data_".concat(n.filterType),n),f=(0,i.Z)(d,2),p=f[0],g=f[1],v=(0,c.useState)(p||n),y=v[0],O=v[1],j=(0,a.useRouter)().query.show;return(0,c.useEffect)(function(){g(y)},[y,g]),(0,m.jsx)(s.Z,{children:(0,m.jsxs)(u.Z,{sm:12,lg:12,children:[(0,m.jsx)(h,{initialValues:n,renderFilters:function(e){return(0,m.jsx)(t,S(S(S({},e),l),{},{show:j}))},setFilters:O,filters:y}),(0,m.jsx)(r,S({filters:y,initialFilters:n},l))]})})}},7622:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r,i=n(19076),o=n(12964),a=n(6812),c=n(71383),s=(0,n(75063).Ps)(r||(r=(0,c.Z)(['\n  query Accounts(\n    $assignedUser: Int\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Account_order_by!\n    $q: String\n    $status: String\n    $type: String\n  ) {\n    accounts: Account(\n      limit: $limit\n      offset: $offset\n      where: {\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name\n      type\n      createdAt\n      status\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(\n      where: {\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),u=n(62466),l=n(74297),d=n(26186),f=n(58965),p=n(9205),g=n(67872),v=n(42846),y=n(85893),b=function(e){var t=e.filters,n=(0,v.x)({filters:t}),r=n.initialData,i=n.ref,o=(0,a.a)(s,{variables:r}),c=o.data,b=(c=void 0===c?{accounts:[],meta:{aggregate:{totalCount:0}}}:c).accounts,m=c.meta,O=o.loading,j=o.refetch,h=[{hidden:!0},{formatter:(0,u.Z)("","id","name","url"),text:"Name"},{text:"Type"},{text:"City"},{sortable:!0,sortName:"createdAt",text:"Created"},{text:"Status"},{hidden:!0}];return(0,y.jsx)(f.Z,{open:!0,title:"Accounts",children:(0,y.jsx)(g.t,{columns:h,loading:O,meta:m,ref:i,refetch:j,rows:b.map(function(e){var t,n=(0,p.WE)(e,"registered"),r=null==n?void 0:null===(t=n.address)||void 0===t?void 0:t.city;return{id:e.id,name:e.name,type:(0,l.Z)(e.type),city:r||"",createdAt:(0,d.Z)(e.createdAt),status:(0,l.Z)(e.status),url:["superadmin","tenant"].includes(e.type.toLowerCase())?"":"/dashboard/".concat(e.type.toLowerCase(),"s/view")}})})})},m=n(59499),O=n(75420),j=n(62929),h=n(26380),w=n(9270),P=n(62140);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,m.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _=function(e){var t=e.errors,n=e.register,r=e.setFilters,i={errors:t,register:n};return(0,y.jsxs)(w.Z,{children:[(0,y.jsx)(P.Z,{md:6,children:(0,y.jsx)(O.r,x(x({},i),{},{onChange:function(e){return r(function(t){return x(x({},t),{},{status:e.target.value||null})})},options:h.bg}))}),(0,y.jsx)(P.Z,{md:6,children:(0,y.jsx)(O.r,x(x({},i),{},{name:"type",onChange:function(e){return r(function(t){return x(x({},t),{},{type:e.target.value||null})})},options:j.l}))})]})},Z={q:null,status:"active",type:null,filterType:"account_table"},C=function(){return(0,y.jsx)(o.J,{FiltersComp:_,initialFilters:Z,TableComp:b})},k=function(){return(0,y.jsx)(i.Z,{pageHeading:{heading:"Accounts"},View:(0,y.jsx)(C,{})})}},6174:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/account",function(){return n(7622)}])}},function(e){e.O(0,[3662,2283,1336,6540,3752,9774,2888,179],function(){return e(e.s=6174)}),_N_E=e.O()}]);