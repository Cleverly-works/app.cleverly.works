(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7908],{42012:function(e,t,n){"use strict";n.d(t,{C:function(){return m}});var r=n(59499),i=n(4730),o=n(89345),a=n(9270),s=n(62140),c=n(99505),u=n(55843),d=n(85893),l=["control","errors","nameEnd","nameStart","placeholderEnd","placeholderStart","space"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=function(e){var t=e.control,n=e.errors,r=e.nameEnd,p=e.nameStart,m=e.placeholderEnd,h=e.placeholderStart,v=e.space,g=(0,i.Z)(e,l);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(a.Z,{children:[(0,d.jsx)(s.Z,{md:6,children:(0,d.jsx)(c.Z,f({control:t,errors:n,locale:o.Z,name:p,placeholder:h},g))}),(0,d.jsx)(s.Z,{md:6,children:(0,d.jsx)(c.Z,f({control:t,errors:n,locale:o.Z,name:r,placeholder:m},g))})]}),v&&(0,d.jsx)(u.Z,{marginBottom:"sm"})]})};m.defaultProps={placeholderStart:"Start date",placeholderEnd:"End date",space:!0}},61497:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=[{text:"All work orders",value:""},{text:"All outstanding invoices",value:"0-"},{text:"1 - 30",value:"1-30"},{text:"31 - 60",value:"31-60"},{text:"61 - 90",value:"61-90"},{text:"> 90",value:"90-"}]},33816:function(e,t,n){"use strict";n.d(t,{By:function(){return p},Rm:function(){return d},WG:function(){return l},bK:function(){return f}});var r,i,o,a,s,c=n(71383),u=n(75063),d=(0,u.Ps)(r||(r=(0,c.Z)(['\n  query getInvoices($jobId: Int!, $locationId: Int!) {\n    invoices: Invoice(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { entity: { _eq: "Job" } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n      }\n    ) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { AccountEntry: { jobId: { _eq: $jobId } } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n        invoiceType: { _in: ["ProformaInvoiceCustomer", "ProformaInvoiceSupplier"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])));(0,u.Ps)(i||(i=(0,c.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n'])));var l=(0,u.Ps)(o||(o=(0,c.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),p=(0,u.Ps)(a||(a=(0,c.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: { entityId: { _eq: $jobId }, invoiceType: { _eq: $invoiceType } }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),f=(0,u.Ps)(s||(s=(0,c.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      data\n      success\n    }\n  }\n"])))},33234:function(e,t,n){"use strict";n.d(t,{_Z:function(){return f}});var r,i,o,a=n(71383),s=n(50029),c=n(64687),u=n.n(c),d=n(75063),l=n(60036),p=n(94568),f=(o=(0,s.Z)(u().mark(function e(t){var n,r,i,o,a,s,c,d;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.client,r=t.jobId,i=t.type,o=t.getUrl,a=t.preview,s="",e.t0=i,e.next="supplier"===e.t0?5:"customerVat"===e.t0?7:9;break;case 5:return s=h,e.abrupt("break",10);case 7:return s=m,e.abrupt("break",10);case 9:return e.abrupt("return");case 10:return(0,p.a)()||o||(c=window.open("/download","_blank")),d="",e.next=14,n.mutate({mutation:s,variables:{jobId:r,preview:a}}).then(function(e){var t,n,r,i,a,s=e.data.invoice.key;o?d="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(s):(null===(t=c)||void 0===t||null===(n=t.location)||void 0===n||n.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(s)),null!==(r=window)&&void 0!==r&&null!==(i=r.Capacitor)&&void 0!==i&&null!==(a=i.Plugins)&&void 0!==a&&a.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(s)}))}).catch(function(e){(0,l.Tb)({message:e,section:"fetch"})});case 14:return e.abrupt("return",d);case 15:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),m=(0,d.Ps)(r||(r=(0,a.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]))),h=(0,d.Ps)(i||(i=(0,a.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"])))},46718:function(e,t,n){"use strict";n.d(t,{$:function(){return u}});var r,i=n(50029),o=n(64687),a=n.n(o),s=n(94568),c=n(60036),u=(r=(0,i.Z)(a().mark(function e(t){var n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(0,s.a)()||(n=window.open("/download","_blank")),e.next=3,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){var t,r,i,o,a;null===(t=n)||void 0===t||null===(r=t.location)||void 0===r||r.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),null!==(i=window)&&void 0!==i&&null!==(o=i.Capacitor)&&void 0!==o&&null!==(a=o.Plugins)&&void 0!==a&&a.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,c.Tb)({message:e,section:"fetch"})});case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},19149:function(e,t,n){"use strict";n.d(t,{u:function(){return p}});var r=n(59499),i=n(50029),o=n(64687),a=n.n(o),s=n(60036),c=n(94568);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var l,p=(l=(0,i.Z)(a().mark(function e(t){var n,r,i,o,u,l,p,f,m,h,v,g,b,y,_,x;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b=t.meta,y=t.invoice,_=d(d({},b),{},{title:"Proforma Invoice",amountPaid:null==y?void 0:null===(n=y.amountPaid)||void 0===n?void 0:null===(r=n.reconciliations)||void 0===r?void 0:null===(i=r.aggregate)||void 0===i?void 0:null===(o=i.sum)||void 0===o?void 0:o.amount,amountDeducted:null==y?void 0:null===(u=y.amountDeducted)||void 0===u?void 0:null===(l=u.reconciliations)||void 0===l?void 0:null===(p=l.aggregate)||void 0===p?void 0:null===(f=p.sum)||void 0===f?void 0:f.amount,reconciledAmount:null==y?void 0:null===(m=y.reconciledAmount)||void 0===m?void 0:null===(h=m.reconciliations)||void 0===h?void 0:null===(v=h.aggregate)||void 0===v?void 0:null===(g=v.sum)||void 0===g?void 0:g.amount}),(0,c.a)()||(x=window.open("/download","_blank")),e.next=5,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(_)}).then(function(e){return e.json()}).then(function(e){var t,n,r,i,o;null===(t=x)||void 0===t||null===(n=t.location)||void 0===n||n.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),null!==(r=window)&&void 0!==r&&null!==(i=r.Capacitor)&&void 0!==i&&null!==(o=i.Plugins)&&void 0!==o&&o.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,s.Tb)({message:e,section:"fetch"})});case 5:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},67872:function(e,t,n){"use strict";n.d(t,{t:function(){return c}});var r=n(67294),i=n(11163),o=n(87043),a=n(16540),s=n(85893),c=(0,r.forwardRef)(function(e,t){var n=e.columns,c=e.history,u=e.initialSort,d=e.loading,l=e.meta,p=e.paginationSize,f=e.refetch,m=e.rowClick,h=e.rows,v=e.xeroPageSize,g=(0,i.useRouter)(),b=g.query,y=void 0===b?{}:b,_=(0,r.useState)(parseInt(null==y?void 0:y.page,10)||1),x=_[0],j=_[1],w=(0,r.useState)(v||o.C1.paginationSize),I=w[0],S=w[1];u||(u={item:"createdAt",order:"desc"});var O=(0,r.useState)({item:u.item,order:u.order}),k=O[0],E=O[1],P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=g.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},D=function(){E({item:u.item,order:u.order}),j(1);var e=P();g.push(e),S(v||o.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:x,pageSize:I,sort:k,resetPagination:function(){D()}}});var C=function(e){var t=P(e);c&&g.push(t),j(e),!c&&f&&f()},Z=function(e){e!==o.C1.paginationSize&&(S(e),f&&f())},A=function(e){var t;E({item:e.item,order:e.order}),f&&f()};return(0,s.jsx)(a.Z,{columns:n,loading:d,paginationSize:p,pagination:l&&!0,paginationProps:l&&{currentPage:x,onPageChange:C,onPageSizeChange:Z,pageCount:Math.ceil(l.aggregate.totalCount/I),perPage:I},rowClick:m,rows:h,sort:k,setSort:A})});c.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,n){"use strict";n.d(t,{x:function(){return d}});var r=n(59499),i=n(67294),o=n(96486),a=n(87043),s=function(e){try{return JSON.parse(e)}catch(t){return!1}};function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d=function(e){var t,n,c,d,l,p,f,m,h,v,g,b=e.filters,y=e.newFilters,_=e.initialSort,x=(0,i.useRef)(),j=(0,i.useState)({}),w=j[0],I=j[1],S=(0,i.useState)({}),O=S[0],k=S[1],E=_||{item:"createdAt",order:"desc"},P=(0,r.Z)({},(null===(t=x.current)||void 0===t?void 0:t.sort.item)||E.item,E.inneritem?(0,r.Z)({},E.inneritem,(null===(n=x.current)||void 0===n?void 0:n.sort.order)||E.order):(null===(c=x.current)||void 0===c?void 0:c.sort.order)||E.order);return(0,i.useEffect)(function(){var e=!(0,o.isEqual)(w,b),t=!(0,o.isEqual)(O,y);if(e&&(I(b),null==x||null===(r=x.current)||void 0===r||r.resetPagination()),t&&(k(y),null==x||null===(i=x.current)||void 0===i||i.resetPagination()),null!=x&&null!==(n=x.current)&&void 0!==n&&n.setSort&&!(e||t)){var n,r,i,a,s,c,u,d,l,p,f,m=null!==(a=x.current)&&void 0!==a&&null!==(s=a.sort)&&void 0!==s&&s.item&&null!==(c=x.current)&&void 0!==c&&null!==(u=c.sort)&&void 0!==u&&u.order?{item:null===(d=x.current)||void 0===d?void 0:null===(l=d.sort)||void 0===l?void 0:l.item,order:null===(p=x.current)||void 0===p?void 0:null===(f=p.sort)||void 0===f?void 0:f.order}:P;x.current.setSort(m)}},[b,y]),{initialData:u(u({},b),{},{newFilters:(null==y?void 0:y.length)>0?y:void 0,limit:(null===(d=x.current)||void 0===d?void 0:d.pageSize)==="Infinity"?null:parseInt(null===(l=x.current)||void 0===l?void 0:l.pageSize,10)||a.C1.paginationSize,offset:((null===(p=x.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(f=x.current)||void 0===f?void 0:f.pageSize)||a.C1.paginationSize),orderBy:s(null===(m=x.current)||void 0===m?void 0:null===(h=m.sort)||void 0===h?void 0:null===(v=h.item)||void 0===v?void 0:v.replace(/ORDER/i,null===(g=x.current)||void 0===g?void 0:g.sort.order))||P}),initialSort:_,ref:x}}},48829:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r=function(e,t){var n=document.createElement("a");"string"==typeof n.download?(document.body.appendChild(n),n.download=t,n.href=e,n.click(),document.body.removeChild(n)):location.replace(e)}},58681:function(e,t,n){"use strict";n.d(t,{SR:function(){return a},Tq:function(){return s},YK:function(){return o},cJ:function(){return i},pX:function(){return r}});var r=["customerVat","supplier"],i=["ProformaInvoiceCustomer","ProformaInvoiceSupplier"],o=["customerPpmInvoice","supplierPpmInvoice"],a={customer:["customerVat","ProformaInvoiceCustomer","customerPpmInvoice"],supplier:["supplier","ProformaInvoiceSupplier","supplierPpmInvoice"]},s={customerVat:"Customer VAT Invoice",supplier:"Supplier Invoice",ProformaInvoiceCustomer:"Customer ad-hoc Invoice",ProformaInvoiceSupplier:"Supplier ad-hoc Invoice",customerPpmInvoice:"PPM Customer Invoice",supplierPpmInvoice:"PPM Supplier Invoice"}},61748:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eh}});var r,i=n(19076),o=n(59499),a=n(50029),s=n(64687),c=n.n(s),u=n(67294),d=n(66252),l=n(6812),p=n(71383),f=(0,n(75063).Ps)(r||(r=(0,p.Z)(["\n  query getFinancialList(\n    $adminId: Int!\n    $customerId: Int\n    $invoiceNumber: jsonb\n    $jobId: String\n    $durationStatus: String\n    $durationEndDate: timestamptz\n    $durationStartDate: timestamptz\n    $limit: Int\n    $managerId: Int\n    $locationId: Int\n    $sublocationId: Int\n    $offset: Int\n    $supplierId: Int\n    $outstandingdays: jsonb\n    $orderBy: jsonb\n  ) {\n    getFinancialList(\n      adminId: $adminId\n      customerId: $customerId\n      invoiceNumber: $invoiceNumber\n      jobId: $jobId\n      durationStatus: $durationStatus\n      durationEndDate: $durationEndDate\n      durationStartDate: $durationStartDate\n      limit: $limit\n      locationId: $locationId\n      managerId: $managerId\n      sublocationId: $sublocationId\n      offset: $offset\n      supplierId: $supplierId\n      outstandingdays: $outstandingdays\n      order_by: $orderBy\n    ) {\n      jobFinancial\n      meta\n      __typename\n    }\n  }\n"]))),m=n(42283),h=n(57460),v=n.n(h),g=n(43703),b=n(4135),y=n(69119),_=n(83894),x=n(10367),j=n(40826),w=n(26186),I=n(11082),S=n(68956),O=n(58965),k=n(76600),E=n(9270),P=n(62140),D=n(95103),C=n(55843),Z=n(55563),A=n(77439),R=n(11587),T=n(98456),N=n(77651),$=n(46901),F=n(67872),z=n(42012),q=n(48829),L=n(69532),B=n(61497),M=n(825),U=n(71772),J=n(72936),K=n(42846),H=n(94568),W=n(55863),V=n(64951),Q=n(4730),X=["outstandingLevel"];function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){(0,o.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ee=function(e){var t=e.outstandingLevel,n=(0,Q.Z)(e,X),r={};return t&&(r.outstandingdays={_gte:t.split("-")[0]||null,_lte:t.split("-")[1]||null}),G(G({},n),r)},et=function(e){var t=e.jobFinancial,n=e.getJobPrefix,r=e.numberPrefix,i=e.numberSuffix;return t.map(function(e){return{invoiceNumber:e.invoiceNumber||"-",jobNumber:"".concat(n(e.jobType||null)," ").concat(r," ").concat(e.jobNumber," ").concat(i),jobType:e.jobType||"-",jobStatus:e.jobStatus||"-",account:e.account||"-",address:e.address||"-",sublocation:e.sublocation||"-",serviceLine:e.serviceLine||"-",startDate:e.startDate||"-",completedDate:e.completedDate||"-",invoicedDate:e.invoicedDate||"-",outstandingdays:e.outstandingdays||"-",outstandingAmount:e.outstandingamount||0,payDate:e.payDate||"-",closedDate:e.closedDate||"-",jobTotal:e.jobTotal||0,supplierAmount:e.supplierAmount||0,expensesAmount:e.expensesAmount||0,expensesAmountSupplier:e.expensesAmountSupplier||0,revenue:e.revenue||0,supplierName:e.supplierName||"-"}})},en=n(58681),er=n(33816),ei=n(33234),eo=n(46718),ea=n(19149),es=n(85893);function ec(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ec(Object(n),!0).forEach(function(t){(0,o.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ec(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ed=[{text:"Job date",value:"job"},{text:"Payment date",value:"payment"},{text:"Completed date",value:"completed"},{text:"Invoiced date",value:"invoiceSent"},{text:"Closed date",value:"closed"}],el={endDate:(0,b.Z)(new Date),startDate:(0,g.Z)(new Date)},ep=function(){var e,t,n,r,i,o=(0,J.x)(),s=o.user,p=o.hasRole,h=(0,d.x)(),g=(0,W.q)(),b=null===(e=g.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,x=null===(n=g.admin)||void 0===n?void 0:null===(r=n.jobSetting)||void 0===r?void 0:r.jobNumberSuffix,Q={item:"outstandingdays",order:"desc"},X=(0,u.useState)(el),Y=X[0],G=X[1],ec=(0,u.useState)({error:!1,message:null}),ep=ec[0],eh=ec[1],ev=(0,K.x)({filters:Y,initialSort:Q}),eg=ev.initialData,eb=ev.ref,ey=(0,m.cI)({defaultValues:Y}),e_=ey.control,ex=ey.errors,ej=ey.handleSubmit,ew=ey.register,eI=(0,ey.watch)("locationId"),eS=(0,u.useState)(!1),eO=eS[0],ek=eS[1],eE=(0,l.a)(f,{variables:eu({adminId:s.accountId},ee(eg))}),eP=eE.data,eD=(eP=void 0===eP?{getFinancialList:{jobFinancial:[],meta:{aggregate:{avg:{customer_amount:0,supplier_amount:0,job_expenses_customer:0,job_expenses_supplier:0},sum:{customer_amount:0,supplier_amount:0,job_expenses_customer:0,job_expenses_supplier:0},totalCount:0}}}}:eP).getFinancialList,eC=eD.jobFinancial,eZ=eD.meta,eA=eE.loading,eR=eE.refetch,eT=(i=(0,a.Z)(c().mark(function e(t,n,r){var i,o,a,s,u,d,l,p;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),e.prev=1,!en.pX.includes(r)){e.next=6;break}(0,ei._Z)({client:h,jobId:n.jobId,type:r}),e.next=26;break;case 6:if(!en.YK.includes(r)){e.next=17;break}return e.next=9,h.query({query:er.By,variables:{jobId:n.jobId,invoiceType:r}});case 9:if(null!=(a=e.sent.data.invoices)&&a.length){e.next=13;break}throw Error("Invoice of this type has not been generated");case 13:s=null==a?void 0:a[0],(0,eo.$)(null==s?void 0:null===(i=s.accountEntry)||void 0===i?void 0:i.meta),e.next=26;break;case 17:if(!en.cJ.includes(r)){e.next=26;break}return e.next=20,h.query({query:er.By,variables:{jobId:n.jobId,invoiceType:r}});case 20:if(null!=(l=e.sent.data.invoices)&&l.length){e.next=24;break}throw Error("Invoice of this type has not been generated");case 24:p=null==l?void 0:l[0],(0,ea.u)({meta:null==p?void 0:null===(u=p.accountEntry)||void 0===u?void 0:u.meta,invoice:p});case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(1),eh({error:!0,message:e.t0.message});case 31:case"end":return e.stop()}},e,null,[[1,28]])})),function(e,t,n){return i.apply(this,arguments)}),eN=function(e){e.adminId;var t,n=e.filterVariable,r=(t=(0,a.Z)(c().mark(function e(t){var r,i,o,a,u,d;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),ek(!0),e.next=4,h.query({fetchPolicy:"no-cache",query:f,variables:eu({adminId:s.accountId,orderBy:eg.orderBy},ee(n))}).finally(function(){return ek(!1)});case 4:a=et({jobFinancial:(i=void 0===(i=e.sent.data)?{getFinancialList:{jobFinancial:[]}}:i).getFinancialList.jobFinancial,getJobPrefix:V.y,numberPrefix:b,numberSuffix:x}),u=v().unparse(a),d="data:application/octet-stream,"+encodeURIComponent(u),(0,q.S)(d,"FinancialData.csv");case 12:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,es.jsx)(ef,{children:(0,es.jsx)(em,{disabled:eO,context:"white",onClick:r,title:"Export to CSV",size:"md",children:eO?(0,es.jsx)(T.Z,{size:30}):(0,es.jsx)(j.Z,{context:"secondary",icon:"file-csv",size:"lg"})})})},e$=[{text:"Job ID",formatter:function(e){var t=e.row;return(0,es.jsx)(M.D,{id:t.jobId,number:t.jobNumber,numberPrefix:b,numberSuffix:x,openCanvas:!0,type:t.jobType})},sortable:!0,sortName:"job_id"},{text:"Invoice Number",sortable:!0,sortName:"invoice_number"},{hidden:!0},{hidden:!0},{text:"Customer",sortable:!0,sortName:"customer_name"},{text:"Address",sortable:!0,sortName:"location_name"},{text:"Outstanding Days",sortable:!0,sortName:"outstandingdays"},{text:"Job Date",formatter:function(e){var t=e.row;return(0,w.Z)(t.startDate)},sortable:!0,sortName:"job_date"},{text:"Pay Date",formatter:function(e){var t=e.row;return t.payDate&&(0,w.Z)(t.payDate)},sortable:!0,sortName:"pay_date"},{text:"Completed Date",formatter:function(e){var t=e.row;return t.completedDate&&(0,w.Z)(t.completedDate)},sortable:!0,sortName:"completed_date"},{text:"Invoiced Date",formatter:function(e){var t=e.row;return t.invoicedDate&&(0,w.Z)(t.invoicedDate)},sortable:!0,sortName:"invoiced_date"},{text:"Closed Date",formatter:function(e){var t=e.row;return t.closedDate&&(0,w.Z)(t.closedDate)},sortable:!0,sortName:"closed_date"},{text:"Customer Amount",formatter:function(e){var t=e.row;return(0,I.Z)(t.jobTotal)},sortable:!0,sortName:"customer_amount"},{text:"Outstanding Amount",formatter:function(e){var t=e.row;return(0,I.Z)(t.outstandingAmount)},sortable:!0,sortName:"outstandingamount"},{text:"Supplier Amount",formatter:function(e){var t=e.row;return(0,I.Z)(t.supplierAmount)},sortable:!0,sortName:"supplier_amount"},{text:"Customer Expenses",formatter:function(e){var t=e.row;return(0,I.Z)(t.expensesAmount)},sortable:!0,sortName:"job_expenses_customer"},{text:"Supplier Expenses",formatter:function(e){var t=e.row;return(0,I.Z)(t.expensesAmountSupplier)},sortable:!0,sortName:"job_expenses_supplier"},{text:"Revenue",formatter:function(e){var t=e.row;return(0,I.Z)(t.revenue)},sortable:!0,sortName:"invoice_revenue",hidden:p(["customer"])},{text:"Status",formatter:function(e){var t=e.row;return(0,L.B)({value:t.jobStatus})},sortName:"job_status",sortable:!0},{text:"Service",sortName:"service_name",sortable:!0},{formatter:S.Z,formatterData:function(e){var t;return en.cJ.includes(e.invoiceType)?[{context:"info",icon:["fas","download"],onClick:function(t){return eT(t,e,e.invoiceType)},tooltip:"Proforma Invoice"}]:[{context:"secondary",icon:["fas","download"],onClick:function(t){return eT(t,e,"ppm"===e.jobType?"customerPpmInvoice":"customerVat")},tooltip:"ppm"===e.jobType?"PPM Customer Invoice":"Customer Invoice"},{context:"primary",icon:["fas","download"],onClick:function(t){return eT(t,e,"ppm"===e.jobType?"supplierPpmInvoice":"supplier")},tooltip:"Supplier Invoice"}]},text:"Actions"}],eF={control:e_,errors:ex,register:ew},ez=function(e){var t,n,r,i,o;G({customerId:null===(t=e.customerId)||void 0===t?void 0:t.value,invoiceNumber:e.invoiceNumber?+e.invoiceNumber:null,jobId:e.invoiceNumber||null,durationStatus:e.durationStatus,durationEndDate:(0,_.Z)(e.durationEndDate),durationStartDate:(0,y.Z)(e.durationStartDate),locationId:null===(n=e.locationId)||void 0===n?void 0:n.value,sublocationId:null===(r=e.sublocationId)||void 0===r?void 0:r.value,outstandingLevel:e.outstandingLevel,supplierId:null===(i=e.supplierId)||void 0===i?void 0:i.value,managerId:null===(o=e.managerId)||void 0===o?void 0:o.value})};return(0,es.jsxs)(es.Fragment,{children:[(0,es.jsx)(N.Z,{open:null==ep?void 0:ep.error,autoHideDuration:6e3,onClose:function(){eh({error:!1,message:null})},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,es.jsx)($.Z,{onClose:function(){return eh({error:!1,message:null})},severity:"error",variant:"filled",sx:{width:"500px"},children:(null==ep?void 0:ep.message)||"Oops some error occurred. Please try again later"})}),(0,es.jsx)(O.Z,{title:"Filters",children:(0,es.jsxs)(k.Z,{handleSubmit:ej(ez),children:[(0,es.jsx)(E.Z,{children:(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(D.Z,eu(eu({},eF),{},{name:"durationStatus",options:ed}))})}),(0,es.jsx)(C.Z,{marginBottom:"sm"}),(0,es.jsx)(z.C,eu(eu({},eF),{},{nameEnd:"durationEndDate",nameStart:"durationStartDate",placeholderEnd:"End date",placeholderStart:"Start date"})),(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(Z.Z,eu(eu({},eF),{},{name:"invoiceNumber",placeholder:"Id / Invoice"}))}),(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(D.Z,eu(eu({},eF),{},{name:"outstandingLevel",options:B.r}))})]}),(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(U.P,eu(eu({},eF),{},{label:"",name:"customerId",placeholder:"Select customer",type:"customer"}))}),(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(U.P,eu(eu({},eF),{},{label:"",name:"locationId",placeholder:"Select location",type:"property"}))})]}),eI&&(0,es.jsx)(E.Z,{children:(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(U.P,eu(eu({},eF),{},{locationId:eI.value,label:"",name:"sublocationId",placeholder:"Select sublocation",type:"sublocation"}))})}),(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(U.P,eu(eu({},eF),{},{label:"",name:"supplierId",placeholder:"Select supplier",type:"supplier"}))}),(0,es.jsx)(P.Z,{md:6,children:(0,es.jsx)(U.P,eu(eu({},eF),{},{accountId:s.accountId,label:"",name:"managerId",placeholder:"Select user",type:"user"}))})]}),(0,es.jsx)(C.Z,{marginBottom:"sm"}),(0,es.jsx)(A.Z,{content:"Filter",context:"secondary",size:"sm",type:"submit"})]})}),(0,es.jsxs)(O.Z,{dataSet:{"data-cy":"Financial Data"},open:!0,title:"Financial Data",toolbar:!(0,H.s)()&&(0,es.jsx)(eN,{adminId:s.accountId,filterVariable:Y}),children:[(0,es.jsx)(F.t,{history:!0,columns:e$,loading:eA,initialSort:Q,meta:eZ,ref:eb,refetch:eR,rows:eC.map(function(e){return{jobId:e.jobId,invoiceNumber:e.invoiceNumber,jobNumber:e.jobNumber,jobType:e.jobType,account:e.account,address:e.address,outstandingdays:e.outstandingdays,outstandingAmount:e.outstandingamount,startDate:e.startDate,payDate:e.payDate,completedDate:e.completedDate,invoicedDate:e.invoicedDate,closedDate:e.closedDate,jobTotal:e.jobTotal,supplierAmount:e.supplierAmount,expensesAmount:e.expensesAmount,expensesAmountSupplier:e.expensesAmountSupplier,revenue:e.revenue,jobStatus:e.jobStatus,serviceLine:e.serviceLine,invoiceType:e.invoiceType,actions:""}})}),(0,es.jsx)(C.Z,{}),eZ&&(0,es.jsxs)(es.Fragment,{children:[(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:1,children:"Total:"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Customer Amount: ",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.sum.customer_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Supplier Amount:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.sum.supplier_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Customer Expense:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.sum.job_expenses_customer)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Supplier Expense:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.sum.job_expenses_supplier)})]}),context:"secondary",shape:"round",size:"sm"})]}),(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:1,children:"Average:"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Customer Amount:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.avg.customer_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Supplier Amount:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.avg.supplier_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Customer Expense:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.avg.job_expenses_customer)})]}),context:"secondary",shape:"round",size:"sm"}),(0,es.jsx)(R.Z,{content:(0,es.jsxs)(es.Fragment,{children:["Supplier Expense:",(0,es.jsx)("b",{children:(0,I.Z)(eZ.aggregate.avg.job_expenses_supplier)})]}),context:"secondary",shape:"round",size:"sm"})]}),eZ&&(0,es.jsxs)(E.Z,{children:[(0,es.jsx)(P.Z,{md:1,children:"Total Jobs:"}),(0,es.jsx)(R.Z,{content:"".concat(eZ.aggregate.totalCount),context:"success"})]})]})]})]})},ef=x.ZP.div.withConfig({displayName:"list__StyledToolbar",componentId:"sc-s7sqjl-0"})(["float:right;"]),em=(0,x.ZP)(A.Z).withConfig({displayName:"list__StyledButton",componentId:"sc-s7sqjl-1"})(["&[disabled]{background-color:#f2f2f2;opacity:1;}"]),eh=function(){return(0,es.jsx)(i.Z,{pageHeading:{heading:"Financial Data"},View:(0,es.jsx)(ep,{})})}},31129:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/data/financial",function(){return n(61748)}])},57460:function(e,t){var n,r,i,o; /* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/ o=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},n=!t.document&&!!t.postMessage,r=n&&/blob:/i.test((t.location||{}).protocol),i={},o=0,a={parse:function(n,r){var s=(r=r||{}).dynamicTyping||!1;if(x(s)&&(r.dynamicTypingFunction=s,s={}),r.dynamicTyping=s,r.transform=!!x(r.transform)&&r.transform,r.worker&&a.WORKERS_SUPPORTED){var c=function(){if(!a.WORKERS_SUPPORTED)return!1;var n,r,s=(n=t.URL||t.webkitURL||null,r=e.toString(),a.BLOB_URL||(a.BLOB_URL=n.createObjectURL(new Blob(["(",r,")();"],{type:"text/javascript"})))),c=new t.Worker(s);return c.onmessage=v,c.id=o++,i[c.id]=c}();return c.userStep=r.step,c.userChunk=r.chunk,c.userComplete=r.complete,c.userError=r.error,r.step=x(r.step),r.chunk=x(r.chunk),r.complete=x(r.complete),r.error=x(r.error),delete r.worker,void c.postMessage({input:n,config:r,workerId:c.id})}var f=null;return a.NODE_STREAM_INPUT,"string"==typeof n?f=r.download?new u(r):new l(r):!0===n.readable&&x(n.read)&&x(n.on)?f=new p(r):(t.File&&n instanceof File||n instanceof Object)&&(f=new d(r)),f.stream(n)},unparse:function(e,t){var n=!1,r=!0,i=",",o="\r\n",s='"',c=s+s,u=!1,d=null,l=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return -1!==t.delimiter.indexOf(e)}).length||(i=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw Error("Option columns is empty");d=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+s),"boolean"==typeof t.escapeFormulae&&(l=t.escapeFormulae)}}();var p=RegExp(m(s),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return h(null,e,u);if("object"==typeof e[0])return h(d||f(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:f(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),h(e.fields||[],e.data||[],u);throw Error("Unable to serialize unrecognized input");function f(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function h(e,t,n){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,c=!Array.isArray(t[0]);if(s&&r){for(var u=0;u<e.length;u++)0<u&&(a+=i),a+=v(e[u],u);0<t.length&&(a+=o)}for(var d=0;d<t.length;d++){var l=s?e.length:t[d].length,p=!1,f=s?0===Object.keys(t[d]).length:0===t[d].length;if(n&&!s&&(p="greedy"===n?""===t[d].join("").trim():1===t[d].length&&0===t[d][0].length),"greedy"===n&&s){for(var m=[],h=0;h<l;h++){var g=c?e[h]:h;m.push(t[d][g])}p=""===m.join("").trim()}if(!p){for(var b=0;b<l;b++){0<b&&!f&&(a+=i);var y=s&&c?e[b]:b;a+=v(t[d][y],b)}d<t.length-1&&(!n||0<l&&!f)&&(a+=o)}}return a}function v(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);!0===l&&"string"==typeof e&&null!==e.match(/^[=+\-@].*$/)&&(e="'"+e);var r=e.toString().replace(p,c);return"boolean"==typeof n&&n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(r,a.BAD_DELIMITERS)||-1<r.indexOf(i)||" "===r.charAt(0)||" "===r.charAt(r.length-1)?s+r+s:r}}};if(a.RECORD_SEP="\x1e",a.UNIT_SEP="\x1f",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!n&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=h,a.ParserHandle=f,a.NetworkStreamer=u,a.FileStreamer=d,a.StringStreamer=l,a.ReadableStreamStreamer=p,t.jQuery){var s=t.jQuery;s.fn.parse=function(e){var n=e.config||{},r=[];return this.each(function(e){if(!("INPUT"===s(this).prop("tagName").toUpperCase()&&"file"===s(this).attr("type").toLowerCase()&&t.FileReader)||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)r.push({file:this.files[i],inputElem:this,instanceConfig:s.extend({},n)})}),i(),this;function i(){if(0!==r.length){var t,n,i,c,u=r[0];if(x(e.before)){var d=e.before(u.file,u.inputElem);if("object"==typeof d){if("abort"===d.action)return t="AbortError",n=u.file,i=u.inputElem,c=d.reason,void(x(e.error)&&e.error({name:t},n,i,c));if("skip"===d.action)return void o();"object"==typeof d.config&&(u.instanceConfig=s.extend(u.instanceConfig,d.config))}else if("skip"===d)return void o()}var l=u.instanceConfig.complete;u.instanceConfig.complete=function(e){x(l)&&l(e,u.file,u.inputElem),o()},a.parse(u.file,u.instanceConfig)}else x(e.complete)&&e.complete()}function o(){r.splice(0,1),i()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var t=y(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}).call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&x(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+e;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=s.meta.cursor;this._finished||(this._partialLine=o.substring(c-this._baseIndex),this._baseIndex=c),s&&s.data&&(this._rowCount+=s.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)t.postMessage({results:s,workerId:a.WORKER_ID,finished:u});else if(x(this._config.chunk)&&!n){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!u||!x(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){x(this._config.error)?this._config.error(e):r&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),c.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=_(this._chunkLoaded,this),t.onerror=_(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var r in e)t.setRequestHeader(r,e[r])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{t.send(this._config.downloadRequestBody)}catch(o){this._chunkError(o.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){var e,n;4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(n=(e=t).getResponseHeader("Content-Range"))?-1:parseInt(n.substring(n.lastIndexOf("/")+1))),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(Error(n))}}function d(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),c.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=_(this._chunkLoaded,this),t.onerror=_(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,i)}var o=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function l(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function p(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=_(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(r){this._streamError(r)}},this),this._streamError=_(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=_(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=_(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(e){var t,n,r,i=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,s=this,c=0,u=0,d=!1,l=!1,p=[],f={data:[],errors:[],meta:{}};if(x(e.step)){var v=e.step;e.step=function(t){if(f=t,_())b();else{if(b(),0===f.data.length)return;c+=t.data.length,e.preview&&c>e.preview?n.abort():(f.data=f.data[0],v(f,s))}}}function g(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function b(){if(f&&r&&(w("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines)for(var t=0;t<f.data.length;t++)g(f.data[t])&&f.data.splice(t--,1);return _()&&function(){if(f){if(Array.isArray(f.data[0])){for(var t=0;_()&&t<f.data.length;t++)f.data[t].forEach(n);f.data.splice(0,1)}else f.data.forEach(n)}function n(t,n){x(e.transformHeader)&&(t=e.transformHeader(t,n)),p.push(t)}}(),function(){if(!f||!e.header&&!e.dynamicTyping&&!e.transform)return f;function t(t,n){var r,i=e.header?{}:[];for(r=0;r<t.length;r++){var o=r,a=t[r];e.header&&(o=r>=p.length?"__parsed_extra":p[r]),e.transform&&(a=e.transform(a,o)),a=j(o,a),"__parsed_extra"===o?(i[o]=i[o]||[],i[o].push(a)):i[o]=a}return e.header&&(r>p.length?w("FieldMismatch","TooManyFields","Too many fields: expected "+p.length+" fields but parsed "+r,u+n):r<p.length&&w("FieldMismatch","TooFewFields","Too few fields: expected "+p.length+" fields but parsed "+r,u+n)),i}var n=1;return!f.data.length||Array.isArray(f.data[0])?(f.data=f.data.map(t),n=f.data.length):f.data=t(f.data,0),e.header&&f.meta&&(f.meta.fields=p),u+=n,f}()}function _(){return e.header&&0===p.length}function j(t,n){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(!function(e){if(i.test(e)){var t=parseFloat(e);if(-9007199254740992<t&&t<9007199254740992)return!0}return!1}(n)?o.test(n)?new Date(n):""===n?null:n:parseFloat(n)):n}function w(e,t,n,r){var i={type:e,code:t,message:n};void 0!==r&&(i.row=r),f.errors.push(i)}this.parse=function(i,o,s){var c=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var n=RegExp(m(t)+"([^]*?)"+m(t),"gm"),r=(e=e.replace(n,"")).split("\r"),i=e.split("\n"),o=1<i.length&&i[0].length<r[0].length;if(1===r.length||o)return"\n";for(var a=0,s=0;s<r.length;s++)"\n"===r[s][0]&&a++;return a>=r.length/2?"\r\n":"\r"}(i,c)),r=!1,e.delimiter)x(e.delimiter)&&(e.delimiter=e.delimiter(i),f.meta.delimiter=e.delimiter);else{var u=function(t,n,r,i,o){var s,c,u,d;o=o||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var l=0;l<o.length;l++){var p=o[l],f=0,m=0,v=0;u=void 0;for(var b=new h({comments:i,delimiter:p,newline:n,preview:10}).parse(t),y=0;y<b.data.length;y++)if(r&&g(b.data[y]))v++;else{var _=b.data[y].length;m+=_,void 0!==u?0<_&&(f+=Math.abs(_-u),u=_):u=_}0<b.data.length&&(m/=b.data.length-v),(void 0===c||f<=c)&&(void 0===d||d<m)&&1.99<m&&(c=f,s=p,d=m)}return{successful:!!(e.delimiter=s),bestDelimiter:s}}(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(r=!0,e.delimiter=a.DefaultDelimiter),f.meta.delimiter=e.delimiter}var l=y(e);return e.preview&&e.header&&l.preview++,t=i,f=(n=new h(l)).parse(t,o,s),b(),d?{meta:{paused:!0}}:f||{meta:{paused:!1}}},this.paused=function(){return d},this.pause=function(){d=!0,n.abort(),t=x(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){s.streamer._halted?(d=!1,s.streamer.parseChunk(t,!0)):setTimeout(s.resume,3)},this.aborted=function(){return l},this.abort=function(){l=!0,n.abort(),f.meta.aborted=!0,x(e.complete)&&e.complete(f),t=""}}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function h(e){var t,n=(e=e||{}).delimiter,r=e.newline,i=e.comments,o=e.step,s=e.preview,c=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof n||-1<a.BAD_DELIMITERS.indexOf(n))&&(n=","),i===n)throw Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var d=0,l=!1;this.parse=function(e,a,p){if("string"!=typeof e)throw Error("Input must be a string");var f=e.length,h=n.length,v=r.length,g=i.length,b=x(o),y=[],_=[],j=[],w=d=0;if(!e)return $();if(c||!1!==c&&-1===e.indexOf(t)){for(var I=e.split(r),S=0;S<I.length;S++){if(d+=(j=I[S]).length,S!==I.length-1)d+=r.length;else if(p)break;if(!i||j.substring(0,g)!==i){if(b){if(y=[],A(j.split(n)),F(),l)return $()}else A(j.split(n));if(s&&s<=S)return y=y.slice(0,s),$(!0)}}return $()}for(var O=e.indexOf(n,d),k=e.indexOf(r,d),E=RegExp(m(u)+m(t),"g"),P=e.indexOf(t,d);;)if(e[d]!==t){if(i&&0===j.length&&e.substring(d,d+g)===i){if(-1===k)return $();d=k+v,k=e.indexOf(r,d),O=e.indexOf(n,d)}else{if(-1!==O&&(O<k||-1===k)){if(!(O<P)){j.push(e.substring(d,O)),d=O+h,O=e.indexOf(n,d);continue}var D=z(O,P,k);if(D&&void 0!==D.nextDelim){O=D.nextDelim,P=D.quoteSearch,j.push(e.substring(d,O)),d=O+h,O=e.indexOf(n,d);continue}}if(-1===k)break;if(j.push(e.substring(d,k)),N(k+v),b&&(F(),l))return $();if(s&&y.length>=s)return $(!0)}}else for(P=d,d++;;){if(-1===(P=e.indexOf(t,P+1)))return p||_.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:y.length,index:d}),T();if(P===f-1)return T(e.substring(d,P).replace(E,t));if(t!==u||e[P+1]!==u){if(t===u||0===P||e[P-1]!==u){-1!==O&&O<P+1&&(O=e.indexOf(n,P+1)),-1!==k&&k<P+1&&(k=e.indexOf(r,P+1));var C=R(-1===k?O:Math.min(O,k));if(e[P+1+C]===n){j.push(e.substring(d,P).replace(E,t)),e[d=P+1+C+h]!==t&&(P=e.indexOf(t,d)),O=e.indexOf(n,d),k=e.indexOf(r,d);break}var Z=R(k);if(e.substring(P+1+Z,P+1+Z+v)===r){if(j.push(e.substring(d,P).replace(E,t)),N(P+1+Z+v),O=e.indexOf(n,d),P=e.indexOf(t,d),b&&(F(),l))return $();if(s&&y.length>=s)return $(!0);break}_.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:y.length,index:d}),P++}}else P++}return T();function A(e){y.push(e),w=d}function R(t){var n=0;if(-1!==t){var r=e.substring(P+1,t);r&&""===r.trim()&&(n=r.length)}return n}function T(t){return p||(void 0===t&&(t=e.substring(d)),j.push(t),d=f,A(j),b&&F()),$()}function N(t){d=t,A(j),j=[],k=e.indexOf(r,d)}function $(e){return{data:y,errors:_,meta:{delimiter:n,linebreak:r,aborted:l,truncated:!!e,cursor:w+(a||0)}}}function F(){o($()),y=[],_=[]}function z(r,i,o){var a={nextDelim:void 0,quoteSearch:void 0},s=e.indexOf(t,i+1);if(i<r&&r<s&&(s<o||-1===o)){var c=e.indexOf(n,s);if(-1===c)return a;s<c&&(s=e.indexOf(t,s+1)),a=z(c,s,o)}else a={nextDelim:r,quoteSearch:i};return a}},this.abort=function(){l=!0},this.getCharIndex=function(){return d}}function v(e){var t=e.data,n=i[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){r=!0,g(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:b,resume:b};if(x(n.userStep)){for(var a=0;a<t.results.data.length&&(n.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},o),!r);a++);delete t.results}else x(n.userChunk)&&(n.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!r&&g(t.workerId,t.results)}function g(e,t){var n=i[e];x(n.userComplete)&&n.userComplete(t),n.terminate(),delete i[e]}function b(){throw Error("Not implemented.")}function y(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=y(e[n]);return t}function _(e,t){return function(){e.apply(t,arguments)}}function x(e){return"function"==typeof e}return r&&(t.onmessage=function(e){var n=e.data;if(void 0===a.WORKER_ID&&n&&(a.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var r=a.parse(n.input,n.config);r&&t.postMessage({workerId:a.WORKER_ID,results:r,finished:!0})}}),(u.prototype=Object.create(c.prototype)).constructor=u,(d.prototype=Object.create(c.prototype)).constructor=d,(l.prototype=Object.create(l.prototype)).constructor=l,(p.prototype=Object.create(c.prototype)).constructor=p,a},void 0!==(i=o.apply(t,[]))&&(e.exports=i)}},function(e){e.O(0,[3662,2283,212,8890,619,1100,1336,4135,5020,1564,4244,5370,3911,6540,4046,2797,9241,8060,7725,1772,9774,2888,179],function(){return e(e.s=31129)}),_N_E=e.O()}]);