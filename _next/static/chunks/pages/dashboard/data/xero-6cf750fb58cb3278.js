(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1031],{52220:function(n,e,t){"use strict";t.d(e,{M:function(){return s}});var o=t(59499),i=t(4730),r=t(89345),a=t(99505),c=t(55843),u=t(85893),d=["control","errors","name","space"];function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,o)}return t}var s=function(n){var e=n.control,t=n.errors,s=n.name,v=n.space,m=(0,i.Z)(n,d);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.Z,function(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach(function(e){(0,o.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}({control:e,errors:t,locale:r.Z,name:s},m)),v&&(0,u.jsx)(c.Z,{marginBottom:"sm"})]})};s.defaultProps={space:!0}},61497:function(n,e,t){"use strict";t.d(e,{r:function(){return o}});var o=[{text:"All work orders",value:""},{text:"All outstanding invoices",value:"0-"},{text:"1 - 30",value:"1-30"},{text:"31 - 60",value:"31-60"},{text:"61 - 90",value:"61-90"},{text:"> 90",value:"90-"}]},33816:function(n,e,t){"use strict";t.d(e,{By:function(){return v},Rm:function(){return l},WG:function(){return s},bK:function(){return m}});var o,i,r,a,c,u=t(71383),d=t(75063),l=(0,d.Ps)(o||(o=(0,u.Z)(['\n  query getInvoices($jobId: Int!, $locationId: Int!) {\n    invoices: Invoice(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { entity: { _eq: "Job" } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n      }\n    ) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(\n      where: {\n        _or: [\n          { _and: [{ Job: { id: { _eq: $jobId } } }, { AccountEntry: { jobId: { _eq: $jobId } } }] }\n          {\n            _and: [\n              { entity: { _eq: "Location" } }\n              { entityId: { _eq: $locationId } }\n              { AccountEntry: { jobId: { _eq: $jobId } } }\n            ]\n          }\n        ]\n        invoiceType: { _in: ["ProformaInvoiceCustomer", "ProformaInvoiceSupplier"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])));(0,d.Ps)(i||(i=(0,u.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n'])));var s=(0,d.Ps)(r||(r=(0,u.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),v=(0,d.Ps)(a||(a=(0,u.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: { entityId: { _eq: $jobId }, invoiceType: { _eq: $invoiceType } }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']))),m=(0,d.Ps)(c||(c=(0,u.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      data\n      success\n    }\n  }\n"])))},33234:function(n,e,t){"use strict";t.d(e,{_Z:function(){return m}});var o,i,r,a=t(71383),c=t(50029),u=t(64687),d=t.n(u),l=t(75063),s=t(60036),v=t(94568),m=(r=(0,c.Z)(d().mark(function n(e){var t,o,i,r,a,c,u,l;return d().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=e.client,o=e.jobId,i=e.type,r=e.getUrl,a=e.preview,c="",n.t0=i,n.next="supplier"===n.t0?5:"customerVat"===n.t0?7:9;break;case 5:return c=f,n.abrupt("break",10);case 7:return c=p,n.abrupt("break",10);case 9:return n.abrupt("return");case 10:return(0,v.a)()||r||(u=window.open("/download","_blank")),l="",n.next=14,t.mutate({mutation:c,variables:{jobId:o,preview:a}}).then(function(n){var e,t,o,i,a,c=n.data.invoice.key;r?l="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(c):(null===(e=u)||void 0===e||null===(t=e.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(c)),null!==(o=window)&&void 0!==o&&null!==(i=o.Capacitor)&&void 0!==i&&null!==(a=i.Plugins)&&void 0!==a&&a.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(c)}))}).catch(function(n){(0,s.Tb)({message:n,section:"fetch"})});case 14:return n.abrupt("return",l);case 15:case"end":return n.stop()}},n)})),function(n){return r.apply(this,arguments)}),p=(0,l.Ps)(o||(o=(0,a.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]))),f=(0,l.Ps)(i||(i=(0,a.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"])))},46718:function(n,e,t){"use strict";t.d(e,{$:function(){return d}});var o,i=t(50029),r=t(64687),a=t.n(r),c=t(94568),u=t(60036),d=(o=(0,i.Z)(a().mark(function n(e){var t;return a().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(0,c.a)()||(t=window.open("/download","_blank")),n.next=3,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(n){return n.json()}).then(function(n){var e,o,i,r,a;null===(e=t)||void 0===e||null===(o=e.location)||void 0===o||o.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),null!==(i=window)&&void 0!==i&&null!==(r=i.Capacitor)&&void 0!==r&&null!==(a=r.Plugins)&&void 0!==a&&a.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,u.Tb)({message:n,section:"fetch"})});case 3:case"end":return n.stop()}},n)})),function(n){return o.apply(this,arguments)})},19149:function(n,e,t){"use strict";t.d(e,{u:function(){return v}});var o=t(59499),i=t(50029),r=t(64687),a=t.n(r),c=t(60036),u=t(94568);function d(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,o)}return t}function l(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?d(Object(t),!0).forEach(function(e){(0,o.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var s,v=(s=(0,i.Z)(a().mark(function n(e){var t,o,i,r,d,s,v,m,p,f,g,y,b,h,j,I;return a().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return b=e.meta,h=e.invoice,j=l(l({},b),{},{title:"Proforma Invoice",amountPaid:null==h?void 0:null===(t=h.amountPaid)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(i=o.aggregate)||void 0===i?void 0:null===(r=i.sum)||void 0===r?void 0:r.amount,amountDeducted:null==h?void 0:null===(d=h.amountDeducted)||void 0===d?void 0:null===(s=d.reconciliations)||void 0===s?void 0:null===(v=s.aggregate)||void 0===v?void 0:null===(m=v.sum)||void 0===m?void 0:m.amount,reconciledAmount:null==h?void 0:null===(p=h.reconciledAmount)||void 0===p?void 0:null===(f=p.reconciliations)||void 0===f?void 0:null===(g=f.aggregate)||void 0===g?void 0:null===(y=g.sum)||void 0===y?void 0:y.amount}),(0,u.a)()||(I=window.open("/download","_blank")),n.next=5,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(j)}).then(function(n){return n.json()}).then(function(n){var e,t,o,i,r;null===(e=I)||void 0===e||null===(t=e.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),null!==(o=window)&&void 0!==o&&null!==(i=o.Capacitor)&&void 0!==i&&null!==(r=i.Plugins)&&void 0!==r&&r.Browser&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,c.Tb)({message:n,section:"fetch"})});case 5:case"end":return n.stop()}},n)})),function(n){return s.apply(this,arguments)})},67872:function(n,e,t){"use strict";t.d(e,{t:function(){return u}});var o=t(67294),i=t(11163),r=t(87043),a=t(16540),c=t(85893),u=(0,o.forwardRef)(function(n,e){var t=n.columns,u=n.history,d=n.initialSort,l=n.loading,s=n.meta,v=n.paginationSize,m=n.refetch,p=n.rowClick,f=n.rows,g=n.xeroPageSize,y=(0,i.useRouter)(),b=y.query,h=void 0===b?{}:b,j=(0,o.useState)(parseInt(null==h?void 0:h.page,10)||1),I=j[0],w=j[1],x=(0,o.useState)(g||r.C1.paginationSize),_=x[0],P=x[1];d||(d={item:"createdAt",order:"desc"});var O=(0,o.useState)({item:d.item,order:d.order}),S=O[0],Z=O[1],C=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=y.query,t=void 0===e?{}:e;if(n>1?t.page=n:delete t.page,!(Object.keys(t).length>0))return{};var o=Object.keys(t).map(function(e){return"page"===e?"".concat(e,"=").concat(n):"".concat(e,"=").concat(t[e])}).join("&");return"?".concat(o)},E=function(){Z({item:d.item,order:d.order}),w(1);var n=C();y.push(n),P(g||r.C1.paginationSize)};(0,o.useImperativeHandle)(e,function(){return{currentPage:I,pageSize:_,sort:S,resetPagination:function(){E()}}});var D=function(n){var e=C(n);u&&y.push(e),w(n),!u&&m&&m()},T=function(n){n!==r.C1.paginationSize&&(P(n),m&&m())},k=function(n){var e;Z({item:n.item,order:n.order}),m&&m()};return(0,c.jsx)(a.Z,{columns:t,loading:l,paginationSize:v,pagination:s&&!0,paginationProps:s&&{currentPage:I,onPageChange:D,onPageSizeChange:T,pageCount:Math.ceil(s.aggregate.totalCount/_),perPage:_},rowClick:p,rows:f,sort:S,setSort:k})});u.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(n,e,t){"use strict";t.d(e,{x:function(){return l}});var o=t(59499),i=t(67294),r=t(96486),a=t(87043),c=function(n){try{return JSON.parse(n)}catch(e){return!1}};function u(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,o)}return t}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?u(Object(t),!0).forEach(function(e){(0,o.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var l=function(n){var e,t,u,l,s,v,m,p,f,g,y,b=n.filters,h=n.newFilters,j=n.initialSort,I=(0,i.useRef)(),w=(0,i.useState)({}),x=w[0],_=w[1],P=(0,i.useState)({}),O=P[0],S=P[1],Z=j||{item:"createdAt",order:"desc"},C=(0,o.Z)({},(null===(e=I.current)||void 0===e?void 0:e.sort.item)||Z.item,Z.inneritem?(0,o.Z)({},Z.inneritem,(null===(t=I.current)||void 0===t?void 0:t.sort.order)||Z.order):(null===(u=I.current)||void 0===u?void 0:u.sort.order)||Z.order);return(0,i.useEffect)(function(){var n=!(0,r.isEqual)(x,b),e=!(0,r.isEqual)(O,h);if(n&&(_(b),null==I||null===(o=I.current)||void 0===o||o.resetPagination()),e&&(S(h),null==I||null===(i=I.current)||void 0===i||i.resetPagination()),null!=I&&null!==(t=I.current)&&void 0!==t&&t.setSort&&!(n||e)){var t,o,i,a,c,u,d,l,s,v,m,p=null!==(a=I.current)&&void 0!==a&&null!==(c=a.sort)&&void 0!==c&&c.item&&null!==(u=I.current)&&void 0!==u&&null!==(d=u.sort)&&void 0!==d&&d.order?{item:null===(l=I.current)||void 0===l?void 0:null===(s=l.sort)||void 0===s?void 0:s.item,order:null===(v=I.current)||void 0===v?void 0:null===(m=v.sort)||void 0===m?void 0:m.order}:C;I.current.setSort(p)}},[b,h]),{initialData:d(d({},b),{},{newFilters:(null==h?void 0:h.length)>0?h:void 0,limit:(null===(l=I.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(s=I.current)||void 0===s?void 0:s.pageSize,10)||a.C1.paginationSize,offset:((null===(v=I.current)||void 0===v?void 0:v.currentPage)-1||0)*((null===(m=I.current)||void 0===m?void 0:m.pageSize)||a.C1.paginationSize),orderBy:c(null===(p=I.current)||void 0===p?void 0:null===(f=p.sort)||void 0===f?void 0:null===(g=f.item)||void 0===g?void 0:g.replace(/ORDER/i,null===(y=I.current)||void 0===y?void 0:y.sort.order))||C}),initialSort:j,ref:I}}},48829:function(n,e,t){"use strict";t.d(e,{S:function(){return o}});var o=function(n,e){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=e,t.href=n,t.click(),document.body.removeChild(t)):location.replace(n)}},54258:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return nf}});var o,i,r=t(19076),a=t(50029),c=t(27812),u=t(16835),d=t(59499),l=t(64687),s=t.n(l),v=t(67294),m=t(11163),p=t(66252),f=t(6812),g=t(73359),y=t(71383),b=t(75063),h=(0,b.Ps)(o||(o=(0,y.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      meta\n      paymentStatus\n      createdAt\n      balance\n      debit\n      credit\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n          Customer {\n            id\n            name\n          }\n          Supplier {\n            id\n            name\n          }\n        }\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]))),j=(0,b.Ps)(i||(i=(0,y.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      meta\n      paymentStatus\n      createdAt\n      balance\n      debit\n      credit\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n          Customer {\n            id\n            name\n          }\n          Supplier {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]))),I=t(33816),w=t(40755),x=t(42283),_=t(57460),P=t.n(_),O=t(10367),S=t(62047),Z=t(11082),C=t(68956),E=t(26186),D=t(58965),T=t(76600),k=t(9270),A=t(62140),$=t(55563),N=t(95103),z=t(77439),R=t(55843),q=t(11587),L=t(84808),B=t(98456),J=t(67872),X=t(52220),F=t(48829),U=t(33234),M=t(19149),G=t(46718),V=t(69532),W=t(61497),H=t(825),K=t(72936),Q=t(42846),Y=t(94568),nn=t(55863);function ne(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,o)}return t}function nt(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ne(Object(t),!0).forEach(function(e){(0,d.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ne(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var no=function(n,e){var t=n.itemType,o=n.paymentStatus;return"paymentReceipt"===t?e.COLOUR.black:"creditNote"===t?e.COLOUR.dark:"paid"===o?e.COLOUR.success:"partial"===o?e.COLOUR.female:e.COLOUR.danger},ni=function(n){var e=n.from,t=void 0===e?null:e,o=n.outstandingLevel,i=n.to,r=void 0===i?null:i,a=n.type,u=n.jobNumber,d={},l={},s=[],v=[],m=[];return a&&(d.type={_in:[].concat((0,c.Z)(a),["invoice"])},d.paymentStatus={_in:(0,c.Z)(a)},a.includes("synced")||(v=[{_or:[{_and:[{meta:{_is_null:!1}},{_not:{meta:{_has_key:"xeroInvoiceId"}}},{_not:{meta:{_has_key:"xeroCreditNoteId"}}}]},{meta:{_is_null:!0}}]}])),o&&(d.outstandingdays={_gte:o.split("-")[0]||null,_lte:o.split("-")[1]||null}),(r||t)&&(m=[{_and:[{_or:[{_and:[{createdAt:{_gte:t}},{createdAt:{_lte:r}}]}]}]}]),u&&(s=[{_or:[{Invoices:{invoiceNumber:{_eq:u}}},{Invoices:{Job:{number:{_ilike:u}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{invoiceNumber:{_eq:u}}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{Job:{number:{_ilike:u}}}}}}]}]),(s.length>0||m.length>0||v.length>0)&&(l={_and:[].concat((0,c.Z)(s),(0,c.Z)(m),(0,c.Z)(v))}),nt(nt({},d),l)},nr=t(51466),na=t(85893),nc=function(n){var e=n.onFilter,t=(0,v.useState)(["ppmInvoice","partial","paid","proformaInvoice","unpaid","synced"]),o=t[0],i=t[1],r=function(n,t){var r;r=t?[].concat((0,c.Z)(o),[n]):o.filter(function(e){return e!==n}),e(r),i(r)};return(0,na.jsxs)(k.Z,{children:[(0,na.jsxs)(nu,{md:2,children:[(0,na.jsx)(S.Z,{context:"danger",onToggle:function(n){return r("proformaInvoice",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"Proforma Invoice"})]}),(0,na.jsxs)(nu,{md:1.6,children:[(0,na.jsx)(S.Z,{context:"danger",onToggle:function(n){return r("ppmInvoice",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"PPM Invoice"})]}),(0,na.jsxs)(nu,{md:1.7,children:[(0,na.jsx)(S.Z,{context:"danger",onToggle:function(n){return r("unpaid",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"Unpaid"})]}),(0,na.jsxs)(nu,{md:1.7,children:[(0,na.jsx)(S.Z,{context:"female",onToggle:function(n){return r("partial",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"Partially Paid"})]}),(0,na.jsxs)(nu,{md:1.7,children:[(0,na.jsx)(S.Z,{context:"success",onToggle:function(n){return r("paid",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"Paid"})]}),(0,na.jsxs)(nu,{md:1.7,children:[(0,na.jsx)(S.Z,{context:"success",onToggle:function(n){return r("synced",n)},size:"sm",toggled:!0}),(0,na.jsx)(R.Z,{marginLeft:"sm"}),(0,na.jsx)(nr.Z,{size:"sm",children:"Synced"})]})]})},nu=(0,O.ZP)(A.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-1d9ji0y-0"})(["align-items:center;display:flex;"]);function nd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,o)}return t}function nl(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?nd(Object(t),!0).forEach(function(e){(0,d.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):nd(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var ns=function(){var n,e,t,o,i=(0,K.x)().user,r=(0,w.RM)(i.id),d=(0,p.x)(),l=(0,nn.q)(),y=(0,v.useState)(!1),b=y[0],_=y[1],O=(0,v.useState)([]),q=O[0],ne=O[1],nt=(0,v.useState)([]),no=nt[0],nr=nt[1],nu=(0,m.useRouter)().query,nd=null===(n=l.admin)||void 0===n?void 0:null===(e=n.jobSetting)||void 0===e?void 0:e.jobNumberPrefix,ns=null===(t=l.admin)||void 0===t?void 0:null===(o=t.jobSetting)||void 0===o?void 0:o.jobNumberSuffix,nf=i.id,ng={endDate:nu.endDate&&new Date(nu.endDate),outstandingLevel:nu.outstandingLevel,startDate:nu.startDate&&new Date(nu.startDate),type:["synced","ppmInvoice","proformaInvoice","partial","paid","unpaid"]},ny=(0,v.useState)(ng),nb=ny[0],nh=ny[1],nj=(0,v.useState)(!1),nI=nj[0],nw=nj[1],nx=nb.endDate,n_=nb.invoiceNumber,nP=nb.outstandingLevel,nO=nb.startDate,nS=nb.type,nZ=(0,Q.x)({filters:nb}),nC=nZ.initialData,nE=nZ.ref,nD=(0,x.cI)({defaultValues:{endDate:nx,invoiceNumber:n_,outstandingLevel:nP,startDate:nO}}),nT=nD.control,nk=nD.errors,nA=nD.handleSubmit,n$=nD.register,nN=(0,v.useState)(!1)[1],nz=nl(nl({},nC),{},{limit:25}),nR=(0,f.a)(h,{variables:nl(nl({},nz),{},{where:nl({},ni({outstandingLevel:nP,to:nx,from:nO,jobNumber:n_,type:nS}))})}),nq=nR.data,nL=(nq=void 0===nq?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0},balance:{balance:0}}}}:nq).accountEntries,nB=nq.meta,nJ=nR.loading,nX=nR.refetch,nF=(0,g.t)(j,{fetchPolicy:"no-cache",variables:nl(nl({},nC),{},{where:nl({},ni({outstandingLevel:nP,to:nx,from:nO,jobNumber:n_,type:nS})),limit:1e3,offset:q.length}),onCompleted:function(n){var e,t=n.accountEntries,o=[].concat((0,c.Z)(q),(0,c.Z)(t));if(o.length<(null==nB?void 0:null===(e=nB.aggregate)||void 0===e?void 0:e.totalCount))ne(o),nU();else try{var i,r=P().unparse(q.map(function(n){var e,t,o,i,r,a,c,u,d,l,s,v,m,p,f,g,y,b,h,j,I,w,x,_,P="creditNote"!==n.type&&"paymentReceipt"!==n.type?n.outstandingdays:"-";return{jobNumber:(null==n?void 0:null===(e=n.invoices)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:null===(o=t.Job)||void 0===o?void 0:o.number)||"-",jobType:(null==n?void 0:null===(i=n.invoices)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:null===(a=r.Job)||void 0===a?void 0:a.type)||"-",invoiceNumber:(null==n?void 0:null===(c=n.invoices)||void 0===c?void 0:null===(u=c[0])||void 0===u?void 0:u.invoiceNumber)||"-",itemType:n.type||"-",paymentStatus:n.paymentStatus||"-",customer:(null==n?void 0:null===(d=n.invoices)||void 0===d?void 0:null===(l=d[0])||void 0===l?void 0:null===(s=l.Job)||void 0===s?void 0:null===(v=s.Customer)||void 0===v?void 0:v.name)||"-",supplier:(null==n?void 0:null===(m=n.invoices)||void 0===m?void 0:null===(p=m[0])||void 0===p?void 0:null===(f=p.Job)||void 0===f?void 0:null===(g=f.Supplier)||void 0===g?void 0:g.name)||"-",xeroStatus:null!=n&&null!==(y=n.meta)&&void 0!==y&&y.xeroInvoiceId||null!=n&&null!==(b=n.meta)&&void 0!==b&&b.xeroCreditNoteId?"Synced":"Not Synced",xeroReference:(null==n?void 0:null===(h=n.meta)||void 0===h?void 0:h.xeroInvoiceId)||(null==n?void 0:null===(j=n.meta)||void 0===j?void 0:j.xeroCreditNoteId)||"-",reference:n.reference||(null===(I=n.meta)||void 0===I?void 0:I.paymentReference)||"-",date:(0,E.Z)(n.createdAt)||"-",outstandingDays:P,outstandingAmount:n.outstandingAmount||"-",status:(null==n?void 0:null===(w=n.invoices)||void 0===w?void 0:null===(x=w[0])||void 0===x?void 0:null===(_=x.Job)||void 0===_?void 0:_.status)||"-",debit:n.debit||"-",credit:n.credit||"-"}})),a="data:application/octet-stream,"+encodeURIComponent(r);(0,F.S)(a,"AccountEntriesXero.csv")}finally{nN(!1)}}}),nU=(0,u.Z)(nF,1)[0],nM=(0,w.BR)({adminId:nf,xeroClientId:null==nu?void 0:nu.clientId,onSaveXeroTokenCallback:function(){return nX()}}),nG=nM.tokenStatus,nV=nM.onCallAuthorize,nW=nM.onSendEntitiesToXero,nH=nM.onReceiveUpdatesFromXero;(0,v.useEffect)(function(){"unauthenticated"===nG?_(!0):_(!1)},[nG]);var nK,nQ,nY,n0=function(n){var e=n.row,t=n.row.itemType;return(0,na.jsx)(np,{content:t,row:e,size:"sm"})},n1=function(n,e){var t=n.id;nr(no.map(function(n){return n.id===t&&(n.assigned=e),n}))},n2=(nK=(0,a.Z)(s().mark(function n(e,t){var o,i,r,a,c,u,l,v,m;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.preventDefault(),e.stopPropagation(),i=void 0===(o=t.invoice)?{}:o,n.t0=t.itemType,n.next="proformaInvoice"===n.t0?6:"invoice"===n.t0?12:"ppmInvoice"===n.t0?14:21;break;case 6:return n.next=8,d.query({query:I.WG,variables:{id:i.id}});case 8:return c=n.sent.data.invoice,(0,M.u)({meta:null==c?void 0:null===(r=c.accountEntry)||void 0===r?void 0:r.meta,invoice:c}),n.abrupt("break",22);case 12:return(0,U._Z)({client:d,jobId:t.jobId,type:i.invoiceType}),n.abrupt("break",22);case 14:return n.next=16,d.query({query:I.By,variables:{jobId:t.jobId,invoiceType:i.invoiceType}});case 16:return m=null==(v=n.sent.data.invoices)?void 0:v[0],(0,G.$)(null==m?void 0:null===(u=m.accountEntry)||void 0===u?void 0:u.meta),n.abrupt("break",22);case 21:return n.abrupt("break",22);case 22:case"end":return n.stop()}},n)})),function(n,e){return nK.apply(this,arguments)}),n6=(nQ=(0,a.Z)(s().mark(function n(e){var t,o;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.stopPropagation(),nw(!0),(t=no.filter(function(n){var e,t;return n.assigned&&!(null!==(e=n.meta)&&void 0!==e&&e.xeroInvoiceId||null!==(t=n.meta)&&void 0!==t&&t.xeroCreditNoteId)})).length){n.next=5;break}return n.abrupt("return");case 5:if(null!=r&&r.companyId){n.next=8;break}return _(!0),n.abrupt("return");case 8:return o={userId:nf,entities:t.map(function(n){return"creditNote"===n.itemType?{id:n.id,entity:n.itemType}:{entity:n.itemType,invoiceType:n.invoice.invoiceType||null,invoiceId:n.id||null}})},n.next=11,nW(o).then(function(){nw(!1),nX()});case 11:case"end":return n.stop()}},n)})),function(n){return nQ.apply(this,arguments)}),n5=function(){return(0,na.jsxs)(nv,{children:[b&&(0,na.jsx)(nm,{context:"info",onClick:function(){return nV(window.location.href)},title:"Refresh Token",size:"md",children:"Sign in with Xero"}),!b&&(0,na.jsx)(nm,{context:"info",onClick:n6,title:"Send invoices to Xero",size:"md",disabled:!no.some(function(n){var e,t;return n.assigned&&!(null!==(e=n.meta)&&void 0!==e&&e.xeroInvoiceId||null!==(t=n.meta)&&void 0!==t&&t.xeroCreditNoteId)})||nI,children:"Sync with Xero"})]})},n3=function(n){var e,t,o,i,r=n.row;return(0,na.jsx)(S.Z,{context:"secondary",size:"sm",onToggle:function(n){return n1(r,n)},toggled:r.assigned||(null===(e=r.meta)||void 0===e?void 0:e.xeroInvoiceId)||(null===(t=r.meta)||void 0===t?void 0:t.xeroCreditNoteId),disabled:(null===(o=r.meta)||void 0===o?void 0:o.xeroInvoiceId)||(null===(i=r.meta)||void 0===i?void 0:i.xeroCreditNoteId)})},n4=(nY=(0,a.Z)(s().mark(function n(e,t){var o,i;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),e.stopPropagation(),n.next=4,nH((null===(o=t.meta)||void 0===o?void 0:o.xeroInvoiceId)||(null===(i=t.meta)||void 0===i?void 0:i.xeroCreditNoteId),null==r?void 0:r.companyId,nf);case 4:nX();case 5:case"end":return n.stop()}},n)})),function(n,e){return nY.apply(this,arguments)}),n8=[{formatter:n3,text:(0,na.jsx)(S.Z,{context:"secondary",size:"sm",toggled:no.every(function(n){return n.assigned}),onToggle:function(n){return n7(n)}})},{formatter:n0,text:"Type"},{text:"Customer",formatter:function(n){var e,t,o,i,r=n.row;return null!==(e=r.invoice)&&void 0!==e&&null!==(t=e.invoiceType)&&void 0!==t&&t.includes("customer")||null!==(o=r.invoice)&&void 0!==o&&null!==(i=o.invoiceType)&&void 0!==i&&i.includes("Customer")?r.customer:"-"}},{text:"Supplier",formatter:function(n){var e,t,o,i,r=n.row;return null!==(e=r.invoice)&&void 0!==e&&null!==(t=e.invoiceType)&&void 0!==t&&t.includes("supplier")||null!==(o=r.invoice)&&void 0!==o&&null!==(i=o.invoiceType)&&void 0!==i&&i.includes("Supplier")?r.supplier:"-"}},{text:"Number",formatter:function(n){var e,t=n.row;return(0,na.jsx)(H.D,{id:t.jobId,number:t.number,invoiceNumber:null===(e=t.invoice)||void 0===e?void 0:e.invoiceNumber,numberPrefix:nd,numberSuffix:ns,openCanvas:!!t.jobId,type:t.jobType})}},{text:"Xero Status"},{text:"Xero Reference"},{text:"Reference"},{text:"Date"},{text:"Days Outstanding"},{text:"Amount Outstanding",formatter:function(n){var e=n.row;return"invoice"===e.itemType||"proformaInvoice"===e.itemType||"ppmInvoice"===e.itemType?(0,Z.Z)(e.outstandingAmount):"-"}},{text:"Status",formatter:function(n){var e=n.row;return e.status?(0,na.jsx)(V.B,{value:e.status}):""}},{text:"Debit",formatter:function(n){var e=n.row;return e.debit?(0,Z.Z)(e.debit):"-"}},{text:"Credit",formatter:function(n){var e=n.row;return e.credit?(0,Z.Z)(e.credit):"-"}},{formatter:C.Z,formatterData:function(n){var e,t,o=[{context:"secondary",icon:["fas","download"],onClick:function(n,e){return n2(n,e)},tooltip:"Download",disabled:"creditNote"===n.itemType||"paymentReceipt"===n.itemType}];return null!==(e=n.meta)&&void 0!==e&&e.xeroInvoiceId&&!(null!==(t=n.meta)&&void 0!==t&&t.syncedWithXero)&&o.unshift({context:"info",icon:["fas","circle"],onClick:function(n,e){return n4(n,e)},tooltip:"Invoice has changes in Xero. Click to update it in Cleverly"}),o},text:"Actions"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0}],n9=function(n){return nL.map(function(e){var t,o,i,r,a,c,u,d,l,s,v,m,p,f,g,y,b,h,j,I,w="creditNote"!==e.type&&"paymentReceipt"!==e.type?e.outstandingdays:"-";return{selector:"",itemType:e.type,customer:null==e?void 0:null===(t=e.invoices[0])||void 0===t?void 0:null===(o=t.Job)||void 0===o?void 0:null===(i=o.Customer)||void 0===i?void 0:i.name,supplier:null==e?void 0:null===(r=e.invoices[0])||void 0===r?void 0:null===(a=r.Job)||void 0===a?void 0:null===(c=a.Supplier)||void 0===c?void 0:c.name,jobId:null==e?void 0:null===(u=e.invoices[0])||void 0===u?void 0:null===(d=u.Job)||void 0===d?void 0:d.id,xeroStatus:null!=e&&null!==(l=e.meta)&&void 0!==l&&l.xeroInvoiceId||null!=e&&null!==(s=e.meta)&&void 0!==s&&s.xeroCreditNoteId?"Synced":"Not Synced",xeroReference:(null==e?void 0:null===(v=e.meta)||void 0===v?void 0:v.xeroInvoiceId)||(null==e?void 0:null===(m=e.meta)||void 0===m?void 0:m.xeroCreditNoteId),reference:e.reference||(null===(p=e.meta)||void 0===p?void 0:p.paymentReference),date:(0,E.Z)(e.createdAt),outstandingDays:w,outstandingAmount:e.outstandingAmount,status:null==e?void 0:null===(f=e.invoices[0])||void 0===f?void 0:null===(g=f.Job)||void 0===g?void 0:g.status,debit:e.debit,credit:e.credit,actions:"",number:null==e?void 0:null===(y=e.invoices[0])||void 0===y?void 0:null===(b=y.Job)||void 0===b?void 0:b.number,jobType:null==e?void 0:null===(h=e.invoices[0])||void 0===h?void 0:null===(j=h.Job)||void 0===j?void 0:j.type,invoiceNumber:null==e?void 0:null===(I=e.invoices[0])||void 0===I?void 0:I.invoiceNumber,invoice:null!=e&&e.invoices?null==e?void 0:e.invoices[0]:null,invoices:null==e?void 0:e.invoices,meta:null==e?void 0:e.meta,paymentStatus:e.paymentStatus,assigned:n,id:e.id}})},n7=function(n){nr(n9(n))},en={control:nT,errors:nk,register:n$},ee=function(n){n.invoiceNumber||n.startDate||n.endDate||n.outstandingLevel?nh(nl(nl({},nb),{},{endDate:n.endDate,invoiceNumber:n.invoiceNumber?n.invoiceNumber:null,outstandingLevel:n.outstandingLevel,startDate:n.startDate})):Array.isArray(n)?nh(nl(nl({},nb),{},{type:n})):nh(ng)};return(0,v.useEffect)(function(){nr(n9(!1))},[nJ]),(0,na.jsxs)(na.Fragment,{children:[(0,na.jsx)(L.Z,{sx:{color:"#fff",zIndex:function(n){return n.zIndex.drawer+1}},open:nI,children:(0,na.jsx)(B.Z,{color:"inherit"})}),(0,na.jsx)(D.Z,{open:!0,title:"Filters",children:(0,na.jsxs)(T.Z,{handleSubmit:nA(ee),children:[(0,na.jsxs)(k.Z,{children:[(0,na.jsx)(A.Z,{md:2,children:(0,na.jsx)(X.M,nl(nl({},en),{},{name:"startDate",placeholder:"Start date"}))}),(0,na.jsx)(A.Z,{md:2,children:(0,na.jsx)(X.M,nl(nl({},en),{},{name:"endDate",placeholder:"End date"}))}),(0,na.jsx)(A.Z,{md:3,children:(0,na.jsx)($.Z,nl(nl({},en),{},{name:"invoiceNumber",placeholder:"Id / Invoice"}))}),(0,na.jsx)(A.Z,{md:3,children:(0,na.jsx)(N.Z,nl(nl({},en),{},{name:"outstandingLevel",options:W.r}))}),(0,na.jsx)(A.Z,{md:1,children:(0,na.jsx)(z.Z,{content:"Filter",context:"secondary",size:"sm",type:"submit"})})]}),(0,na.jsx)(R.Z,{marginBottom:"md"}),(0,na.jsx)(nc,{onFilter:ee})]})}),(0,na.jsxs)(D.Z,{dataSet:{"data-cy":"Xero Data"},open:!0,title:"Account Entries",toolbar:!(0,Y.s)()&&(0,na.jsx)(n5,{}),children:[(0,na.jsx)(J.t,{history:!0,columns:n8,loading:nJ,meta:nB,ref:nE,refetch:nX,rows:no}),(0,na.jsx)(R.Z,{})]})]})},nv=O.ZP.div.withConfig({displayName:"list__StyledToolbar",componentId:"sc-g7ghbs-0"})(["float:right;"]),nm=(0,O.ZP)(z.Z).withConfig({displayName:"list__StyledButton",componentId:"sc-g7ghbs-1"})(["margin-left:10px;&[disabled]{background-color:#cbd5e0;opacity:1;}"]),np=(0,O.ZP)(q.Z).withConfig({displayName:"list__StyledBadge",componentId:"sc-g7ghbs-2"})(["background-color:",";"],function(n){return no(n.row,n.theme)}),nf=function(){return(0,na.jsx)(r.Z,{pageHeading:{heading:"Xero"},View:(0,na.jsx)(ns,{})})}},89474:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/data/xero",function(){return t(54258)}])}},function(n){n.O(0,[3662,2283,212,8890,619,1100,1336,4135,5020,1564,4244,5370,3911,6540,4046,2797,9251,7725,9774,2888,179],function(){return n(n.s=89474)}),_N_E=n.O()}]);