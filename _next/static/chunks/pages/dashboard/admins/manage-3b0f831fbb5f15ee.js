(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3445],{9316:function(e,n,a){"use strict";a.d(n,{E:function(){return c}});var t,r=a(50029),o=a(64687),i=a.n(o),s=a(69496),c=(t=(0,r.Z)(i().mark(function e(n,a){var t,r,o,c=arguments;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>2&&void 0!==c[2]&&c[2],e.prev=1,e.next=4,n.query({query:s.WF,variables:{email:a}});case 4:if(!((o=e.sent.data.users)&&o.length>0)){e.next=8;break}return e.abrupt("return",!!t&&o[0]);case 8:return e.abrupt("return",!t||null);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",!0);case 14:case"end":return e.stop()}},e,null,[[1,11]])})),function(e,n){return t.apply(this,arguments)})},69496:function(e,n,a){"use strict";a.d(n,{$E:function(){return D},AX:function(){return v},I4:function(){return g},JA:function(){return L},MT:function(){return C},Px:function(){return w},WF:function(){return q},ZA:function(){return O},a8:function(){return P},fA:function(){return j},fo:function(){return S},ge:function(){return E},iM:function(){return N},nE:function(){return k},nh:function(){return R},r1:function(){return Z},tW:function(){return W},uz:function(){return T}});var t,r,o,i,s,c,u,m,d,l,p,_,h,f,y,A,U,$,b=a(71383),I=a(75063),g=(0,I.Ps)(t||(t=(0,b.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),v=(0,I.Ps)(r||(r=(0,b.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),S=(0,I.Ps)(o||(o=(0,b.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),L=(0,I.Ps)(i||(i=(0,b.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),q=(0,I.Ps)(s||(s=(0,b.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]))),w=(0,I.Ps)(c||(c=(0,b.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]))),P=(0,I.Ps)(u||(u=(0,b.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]))),Z=(0,I.Ps)(m||(m=(0,b.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]))),C=(0,I.Ps)(d||(d=(0,b.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]))),k=(0,I.Ps)(l||(l=(0,b.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),R=(0,I.Ps)(p||(p=(0,b.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]))),N=(0,I.Ps)(_||(_=(0,b.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]))),j=(0,I.Ps)(h||(h=(0,b.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),D=(0,I.Ps)(f||(f=(0,b.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]))),T=(0,I.Ps)(y||(y=(0,b.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]))),E=(0,I.Ps)(A||(A=(0,b.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']))),O=(0,I.Ps)(U||(U=(0,b.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),W=(0,I.Ps)($||($=(0,b.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"])))},66387:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return D}});var t,r,o,i=a(19076),s=a(59499),c=a(50029),u=a(16835),m=a(64687),d=a.n(m),l=a(67294),p=a(66252),_=a(73359),h=a(50319),f=a(71383),y=a(75063),A=(0,y.Ps)(t||(t=(0,f.Z)(["\n  query GetAdmin($id: Int!) {\n    admin: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      status\n      type\n      meta\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        isContact\n        userId\n        user: User {\n          id\n          email\n          fullName\n          meta\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n        }\n      }\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n    }\n  }\n"]))),U=(0,y.Ps)(r||(r=(0,f.Z)(["\n  mutation AddAdmin($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),$=(0,y.Ps)(o||(o=(0,f.Z)(["\n  mutation UpdateAdmin($adminId: Int!, $admin: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $adminId }, _set: $admin) {\n      id\n    }\n  }\n"]))),b=a(11163),I=a.n(b),g=a(73987),v=a(74278),S=a(9316),L=a(43297),q=[{area:"AB",name:"Aberdeen"},{area:"AL",name:"St. Albans"},{area:"B",name:"Birmingham"},{area:"BA",name:"Bath"},{area:"BB",name:"Blackburn"},{area:"BD",name:"Bradford"},{area:"BH",name:"Bournemouth"},{area:"BL",name:"Bolton"},{area:"BN",name:"Brighton"},{area:"BR",name:"Bromley"},{area:"BS",name:"Bristol"},{area:"BT",name:"Belfast"},{area:"CA",name:"Carlisle"},{area:"CB",name:"Cambridge"},{area:"CF",name:"Cardiff"},{area:"CH",name:"Chester"},{area:"CM",name:"Chelmsford"},{area:"CO",name:"Colchester"},{area:"CR",name:"Croydon"},{area:"CT",name:"Canterbury"},{area:"CV",name:"Coventry"},{area:"CW",name:"Crewe"},{area:"DA",name:"Dartford"},{area:"DD",name:"Dundee"},{area:"DE",name:"Derby"},{area:"DG",name:"Dumfries"},{area:"DH",name:"Durham"},{area:"DL",name:"Darlington"},{area:"DN",name:"Doncaster"},{area:"DT",name:"Dorchester"},{area:"DY",name:"Dudley"},{area:"E",name:"London E"},{area:"EC",name:"London EC"},{area:"EH",name:"Edinburgh"},{area:"EN",name:"Enfield"},{area:"EX",name:"Exeter"},{area:"FK",name:"Falkirk"},{area:"FY",name:"Blackpool"},{area:"G",name:"Glasgow"},{area:"GL",name:"Gloucester"},{area:"GU",name:"Guildford"},{area:"GY",name:"Guernsey"},{area:"HA",name:"Harrow"},{area:"HD",name:"Huddersfield"},{area:"HG",name:"Harrogate"},{area:"HP",name:"Hemel Hempstead"},{area:"HR",name:"Hereford"},{area:"HS",name:"Western Isles"},{area:"HU",name:"Hull"},{area:"HX",name:"Halifax"},{area:"IG",name:"Ilford"},{area:"IM",name:"Isle Of Man"},{area:"IP",name:"Ipswich"},{area:"IV",name:"Inverness"},{area:"JE",name:"Jersey"},{area:"KA",name:"Kilmarnock"},{area:"KT",name:"Kingston Upon Thames"},{area:"KW",name:"Kirkwall"},{area:"KY",name:"Kirkcaldy"},{area:"L",name:"Liverpool"},{area:"LA",name:"Lancaster"},{area:"LD",name:"Llandrindod Wells"},{area:"LE",name:"Leicester"},{area:"LL",name:"Llandudno"},{area:"LN",name:"Lincoln"},{area:"LS",name:"Leeds"},{area:"LU",name:"Luton"},{area:"M",name:"Manchester"},{area:"ME",name:"Medway"},{area:"MK",name:"Milton Keynes"},{area:"ML",name:"Motherwell"},{area:"N",name:"London N"},{area:"NE",name:"Newcastle Upon Tyne"},{area:"NG",name:"Nottingham"},{area:"NN",name:"Northampton"},{area:"NP",name:"Newport"},{area:"NR",name:"Norwich"},{area:"NW",name:"London NW"},{area:"OL",name:"Oldham"},{area:"OX",name:"Oxford"},{area:"PA",name:"Paisley"},{area:"PE",name:"Peterborough"},{area:"PH",name:"Perth"},{area:"PL",name:"Plymouth"},{area:"PO",name:"Portsmouth"},{area:"PR",name:"Preston"},{area:"RG",name:"Reading"},{area:"RH",name:"Redhill"},{area:"RM",name:"Romford"},{area:"S",name:"Sheffield"},{area:"SA",name:"Swansea"},{area:"SE",name:"London SE"},{area:"SG",name:"Stevenage"},{area:"SK",name:"Stockport"},{area:"SL",name:"Slough"},{area:"SM",name:"Sutton"},{area:"SN",name:"Swindon"},{area:"SO",name:"Southampton"},{area:"SP",name:"Salisbury"},{area:"SR",name:"Sunderland"},{area:"SS",name:"Southend-On-Sea"},{area:"ST",name:"Stoke-On-Trent"},{area:"SW",name:"London SW"},{area:"SY",name:"Shrewsbury"},{area:"TA",name:"Taunton"},{area:"TD",name:"Galashiels"},{area:"TF",name:"Telford"},{area:"TN",name:"Tonbridge"},{area:"TQ",name:"Torquay"},{area:"TR",name:"Truro"},{area:"TS",name:"Cleveland"},{area:"TW",name:"Twickenham"},{area:"UB",name:"Southall"},{area:"W",name:"London W"},{area:"WA",name:"Warrington"},{area:"WC",name:"London WC"},{area:"WD",name:"Watford"},{area:"WF",name:"Wakefield"},{area:"WN",name:"Wigan"},{area:"WR",name:"Worcester"},{area:"WS",name:"Walsall"},{area:"WV",name:"Wolverhampton"},{area:"YO",name:"York"},{area:"ZE",name:"Lerwick"}],w=[{type:"priority",name:"P1",normalRate:1,oohRate:1,premiumRate:1,minimumInterval:30,minimumLength:90,onSite:60,onSiteUnit:"minutes",jobReport:4,jobReportUnit:"hours",completion:2,completionUnit:"days",notes:"Danger to life"},{type:"priority",name:"P2",normalRate:1,oohRate:1,premiumRate:1,minimumInterval:30,minimumLength:60,onSite:8,onSiteUnit:"hours",jobReport:24,jobReportUnit:"hours",completion:4,completionUnit:"days",notes:"Immediate attention required"},{type:"priority",name:"P3",normalRate:1,oohRate:1,premiumRate:1,minimumInterval:30,minimumLength:60,onSite:24,onSiteUnit:"hours",jobReport:2,jobReportUnit:"days",completion:7,completionUnit:"days",notes:"Prompt attention required"},{type:"priority",name:"P4",normalRate:1,oohRate:1,premiumRate:1,minimumInterval:30,minimumLength:60,onSite:2,onSiteUnit:"days",jobReport:5,jobReportUnit:"days",completion:10,completionUnit:"days",notes:"Next day"},{type:"priority",name:"P5",normalRate:1,oohRate:1,premiumRate:1,minimumInterval:30,minimumLength:60,onSite:7,onSiteUnit:"days",jobReport:14,jobReportUnit:"days",completion:14,completionUnit:"days",notes:"Non-urgent"}],P=a(74231),Z=function(){return(0,P.Ry)().shape({managerSelected:(0,P.Ry)().required(),availableCharts:(0,P.IX)().when("modules",{is:function(e){return e.includes("dataCharts")},then:(0,P.IX)().of((0,P.Ry)().shape({label:(0,P.Z_)().required("Please select at least one chart"),value:(0,P.Z_)().required("Please select at least one chart")}).required("Please select at least one chart")).required("Please select at least one chart"),otherwise:(0,P.IX)().notRequired()}),name:(0,P.Z_)().required(),website:(0,P.Z_)().required(),companyNumber:(0,P.Z_)(),vatId:(0,P.Z_)(),status:(0,P.Z_)().oneOf(["active","inactive"]).required(),timeZone:(0,P.Ry)().shape({label:(0,P.Z_)().required(),value:(0,P.Z_)().required()}),contactUseremail:(0,P.Z_)().when("contactUser",{is:"true",then:(0,P.Z_)().required()}),contactUsernameFirst:(0,P.Z_)().when("contactUser",{is:"true",then:(0,P.Z_)().required()}),contactUsernameLast:(0,P.Z_)().when("contactUser",{is:"true",then:(0,P.Z_)().required()}),contactUserphone:(0,P.Z_)().when("contactUser",{is:"true",then:(0,P.Z_)().required()}),contactUserstatus:(0,P.Z_)().when("contactUser",{is:"true",then:(0,P.Z_)().required()})})},C=a(85893);function k(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,t)}return a}function R(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?k(Object(a),!0).forEach(function(n){(0,s.Z)(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})}return e}var N="/dashboard/admins/",j=function(){var e,n=(0,p.x)(),a=(0,l.useContext)(g.Z).user,t=(0,b.useRouter)().query,r=void 0===t?{}:t,o=(0,l.useState)(!1),i=o[0],s=o[1],m=(0,_.t)(A,{variables:{id:r.id}}),f=(0,u.Z)(m,2),y=f[0],P=f[1],k=P.loading,j=P.data,D=(j=void 0===j?{admin:{}}:j).admin;(0,l.useEffect)(function(){r.id&&y()},[y,r.id]);var T,E=(0,h.D)(U,{onCompleted:(e=(0,c.Z)(d().mark(function e(n){var a;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=n.insert_Account.returning[0].id,I().push("".concat(N,"view?id=").concat(a));case 2:case"end":return e.stop()}},e)})),function(n){return e.apply(this,arguments)})}),O=(0,u.Z)(E,1)[0],W=(0,h.D)($,{onCompleted:function(e){var n=e.update_Account_by_pk.id;I().push("".concat(N,"view?id=").concat(n))}}),B=(0,u.Z)(W,1)[0],M=(T=(0,c.Z)(d().mark(function e(a){var t,o,i,c,u,m;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s(!0),(o={}).Admin={managerId:null==a?void 0:null===(t=a.managerSelected)||void 0===t?void 0:t.value,name:a.name,website:a.website,companyNumber:a.companyNumber,vatId:a.vatId,status:a.status,type:"admin"},i={},v.o.forEach(function(e){var n;i[e.value]=null===(n=a.modules)||void 0===n?void 0:n.includes(e.value)}),!r.id){e.next=14;break}return o.Admin.meta=R(R({},D.meta),{},{modules:i,prevAvailableCharts:(null===(c=D.meta)||void 0===c?void 0:c.availableCharts)||[],availableCharts:a.availableCharts})||{},o.Admin.meta.timeZone=R({},a.timeZone),o.Admin.meta.modules=i,e.next=12,B({variables:{adminId:D.id,admin:o.Admin}});case 12:e.next=24;break;case 14:return e.next=16,(0,S.E)(n,a.contactUseremail,!0);case 16:return m=e.sent,o.Admin.meta={modules:i,prevAvailableCharts:(null===(u=D.meta)||void 0===u?void 0:u.availableCharts)||[],availableCharts:a.availableCharts,timeZone:R({},a.timeZone)},o.AdminSLAs={data:w.map(function(e){return e.status="active",e})},o.AdminPostcodeAreas={data:q.map(function(e){return e.status="active",e.countryId=1,e})},o.Account_Users={data:[{isContact:!0,role:"owner",status:a.contactUserstatus}]},m?o.Account_Users.data[0].userId=m.id:o.Account_Users.data[0].User={data:{nameFirst:a.contactUsernameFirst,nameLast:a.contactUsernameLast,email:a.contactUseremail,phone:a.contactUserphone,status:"active",meta:{notificationSettings:{sms:!0,email:!0,toast:!0,pushNotification:!0}}}},e.next=24,O({variables:{objects:R(R({},o.Admin),{},{AdminPostcodeAreas:o.AdminPostcodeAreas,AdminSLAs:o.AdminSLAs,Account_Users:o.Account_Users})}});case 24:return e.prev=24,s(!1),e.finish(24);case 27:case"end":return e.stop()}},e,null,[[0,,24,27]])})),function(e){return T.apply(this,arguments)});return(!k||!r.id)&&(0,C.jsx)(L.P,{loading:i,account:D.id?D:null,id:r.id||null,onSubmit:M,schema:Z,type:"admin",user:a},D?D.id:"new")},D=function(){return(0,C.jsx)(i.Z,{pageHeading:{heading:"Admins - Manage"},View:(0,C.jsx)(j,{})})}},48262:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/admins/manage",function(){return a(66387)}])}},function(e){e.O(0,[2283,212,8890,619,1100,1336,6043,5370,3911,3776,9241,9781,6357,1772,3297,9774,2888,179],function(){return e(e.s=48262)}),_N_E=e.O()}]);