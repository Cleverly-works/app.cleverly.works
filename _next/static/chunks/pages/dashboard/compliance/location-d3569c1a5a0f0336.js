(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1312],{20174:function(n,t,e){"use strict";e.d(t,{Z:function(){return A}});var i,o=e(45697),r=e(11163),a=e(58965),c=e(41085),u=e(67294),l=e(6812),d=e(71383),s=(0,e(75063).Ps)(i||(i=(0,d.Z)(["\n  query GetSupplierCompliance(\n    $adminId: Int\n    $entity: String\n    $gteNow: date\n    $ltNow: date\n    $limit: Int\n    $offset: Int!\n  ) {\n    complianceEntity: Compliance_Entity(\n      limit: $limit\n      offset: $offset\n      where: {\n        entity: { _eq: $entity }\n        _and: [{ expiryAt: { _gte: $gteNow } }, { expiryAt: { _lt: $ltNow } }]\n        Compliance: { adminId: { _eq: $adminId } }\n      }\n      order_by: { expiryAt: asc }\n    ) {\n      id\n      createdAt\n      entity\n      entityId\n      expiryAt\n      regNum\n      insuranceAmount\n      compliance: Compliance {\n        id\n        type\n        name\n        status\n        hasInsuranceAmount\n        regNumExample\n      }\n      account: Account {\n        id\n        name\n        status\n      }\n      location: Location {\n        id\n        name\n        status\n      }\n    }\n    meta: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        _and: [{ expiryAt: { _gte: $gteNow } }, { expiryAt: { _lt: $ltNow } }]\n        Compliance: { adminId: { _eq: $adminId } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),m=e(78289),p=e(68956),f=e(67872),g=e(99229),x=e(6788),y=e(72936),v=e(42846),h=e(85893),_=new Date,w=function(n){var t=n.mode,e=n.entity,i=(0,u.useContext)(m.Z),o=(0,y.x)().user,r=null,a=null;"upcoming"===t?r=_:"expired"===t&&(a=_);var c,d={adminId:o.accountId,entity:e,gteNow:r,ltNow:a},w=(0,v.x)({filters:d,initialSort:{item:"expiryAt",order:"asc"}}),N=w.initialData,A=w.ref,C=(0,l.a)(s,{variables:N}),I=C.loading,E=C.refetch,$=C.data,b=($=void 0===$?{complianceEntity:[],meta:{aggregate:{totalCount:0}}}:$).complianceEntity,Z=$.meta,j=function(n){i.show({content:(0,h.jsx)(g.G,{entity:"Compliance_Entity",entityId:null==n?void 0:n.id}),submit:!1,title:"Media"})},D=[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Account",hidden:"Account"!==e},{text:"Location",hidden:"Location"!==e},{text:"Registration number"},{formatter:x.FT,text:"Expiry date"},{text:"Status",hidden:"Account"!==e,sortable:!0,sortName:'{"Account": {"status": "ORDER"}}'},{text:"Status",hidden:"Location"!==e,sortable:!0,sortName:'{"Location": {"status": "ORDER"}}'},{formatter:p.Z,formatterData:[{context:"info",icon:["fas","file-upload"],onClick:(c={mediaClick:function(n,t){return j(t)}}).mediaClick,tooltip:"Media"}],text:"Actions"}];return(0,h.jsx)(f.t,{columns:D,loading:I,meta:Z,ref:A,refetch:E,rows:b.map(function(n){var t,e,i,o,r,a,c;return{id:n.id,complianceId:{label:null===(t=n.compliance)||void 0===t?void 0:t.name,value:null===(e=n.compliance)||void 0===e?void 0:e.id},name:null===(i=n.compliance)||void 0===i?void 0:i.name,account:null===(o=n.account)||void 0===o?void 0:o.name,location:null===(r=n.location)||void 0===r?void 0:r.name,regNum:n.regNum,expiryAt:n.expiryAt,statusAccount:null===(a=n.account)||void 0===a?void 0:a.status,statusLocation:null===(c=n.location)||void 0===c?void 0:c.status,actions:""}})})},N=function(n){var t=n.entity,e=(0,r.useRouter)().query;return(0,h.jsx)(a.Z,{fitParentHeight:!0,open:!0,title:"Compliances",children:(0,h.jsxs)(c.Z,{children:[(0,h.jsx)("div",{active:"expired"===e.tab||!e.tab,label:"Expired",children:(0,h.jsx)(w,{entity:t,mode:"expired"})}),(0,h.jsx)("div",{active:"upcoming"===e.tab,label:"Upcoming",children:(0,h.jsx)(w,{entity:t,mode:"upcoming"})})]})})};w.propTypes={entity:o.string};var A=N},76727:function(n,t,e){"use strict";e.d(t,{r:function(){return o}});var i=e(29383),o=function(n){return(0,i.Z)(new Date(n),new Date)}},88424:function(n,t,e){"use strict";e.d(t,{O:function(){return i}});var i=function(n){return n?new Date(n):new Date}},6788:function(n,t,e){"use strict";e.d(t,{Bo:function(){return p},CV:function(){return d},FT:function(){return x},JB:function(){return m},iU:function(){return s},kW:function(){return f}});var i=e(10367),o=e(11587),r=e(51466),a=e(26186),c=e(76727),u=e(88424),l=e(85893),d=function(n){var t=(0,u.O)();return parseInt(n.filter(function(n){return(0,u.O)(n.expiryAt)>=t}).length/n.length*100)},s=function(n){if(!n||0===n.length)return null;var t=(0,u.O)();return parseInt(n.filter(function(n){return(0,u.O)(n.expiryAt)>=t}).length/n.length*100)||null};(0,i.ZP)(o.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-1rrgcna-0"})(["margin:0;"]),i.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-1rrgcna-1"})(["align-items:center;display:flex;"]),i.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-1rrgcna-2"})(["flex-direction:column;margin-left:1rem;"]);var m=function(n){return n.filter(function(n){return 0>(0,c.r)(n.expiryAt)}).length},p=function(n){if(!n||0===n.length||!n.nodes||n.nodes&&(null===(t=n.nodes)||void 0===t?void 0:t.length)===0)return{content:"No locations",context:"secondary"};var t,e=[];(n.nodes||n).forEach(function(n){var t,i;(null!==(t=n.location)&&void 0!==t&&t.compliance||n.compliances)&&e.push(d((null===(i=n.location)||void 0===i?void 0:i.compliance)||n.compliances))});var i=Math.round(e.reduce(function(n,t){return isNaN(t)&&(t=0),n+t},0)/e.length);return{content:"Score: ".concat(i||0," %"),context:f(i)}},f=function(n){return n>79?"success":n>49?"info":"danger"},g=function(n){var t=(0,c.r)(n);return t>14?"success":t>=0?"info":"danger"},x=function(n){var t=n.row;if(t.expiryAt)return(0,l.jsx)(r.Z,{content:(0,a.Z)(t.expiryAt),context:g(t.expiryAt),size:"sm"})}},12952:function(n,t,e){"use strict";e.r(t);var i=e(19076),o=e(20174),r=e(85893),a=function(){return(0,r.jsx)(i.Z,{pageHeading:{heading:"Location Compliance"},View:(0,r.jsx)(o.Z,{entity:"Location"})})};t.default=a},31487:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/compliance/location",function(){return e(12952)}])}},function(n){n.O(0,[3662,2283,212,8890,619,1100,1336,6043,1564,5370,3776,6540,2797,653,1207,6045,9229,9774,2888,179],function(){return n(n.s=31487)}),_N_E=n.O()}]);