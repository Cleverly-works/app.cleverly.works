(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9154],{92264:function(e,t,r){"use strict";r.d(t,{H:function(){return u}});var n=r(59499),o=r(55377),i=r(16551),s=r(77439),a=r(85893);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var u=function(e){var t=e.children,r=e.content,u=e.context,l=e.data,d=e.disabled,p=e.handleClick,f=e.size,g=e.type;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{size:"sm"}),(0,a.jsxs)(i.Z,{align:"flex-end",children:[t,(0,a.jsx)(s.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({content:r,context:u,disabled:d,onClick:p,size:f,type:g},l))]})]})};u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},52220:function(e,t,r){"use strict";r.d(t,{M:function(){return d}});var n=r(59499),o=r(4730),i=r(89345),s=r(99505),a=r(55843),c=r(85893),u=["control","errors","name","space"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var d=function(e){var t=e.control,r=e.errors,d=e.name,p=e.space,f=(0,o.Z)(e,u);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({control:t,errors:r,locale:i.Z,name:d},f)),p&&(0,c.jsx)(a.Z,{marginBottom:"sm"})]})};d.defaultProps={space:!0}},67872:function(e,t,r){"use strict";r.d(t,{t:function(){return c}});var n=r(67294),o=r(11163),i=r(87043),s=r(16540),a=r(85893),c=(0,n.forwardRef)(function(e,t){var r=e.columns,c=e.history,u=e.initialSort,l=e.loading,d=e.meta,p=e.paginationSize,f=e.refetch,g=e.rowClick,m=e.rows,v=e.xeroPageSize,y=(0,o.useRouter)(),b=y.query,j=void 0===b?{}:b,O=(0,n.useState)(parseInt(null==j?void 0:j.page,10)||1),h=O[0],P=O[1],w=(0,n.useState)(v||i.C1.paginationSize),x=w[0],S=w[1];u||(u={item:"createdAt",order:"desc"});var Z=(0,n.useState)({item:u.item,order:u.order}),D=Z[0],I=Z[1],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,r=void 0===t?{}:t;if(e>1?r.page=e:delete r.page,!(Object.keys(r).length>0))return{};var n=Object.keys(r).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(r[t])}).join("&");return"?".concat(n)},E=function(){I({item:u.item,order:u.order}),P(1);var e=C();y.push(e),S(v||i.C1.paginationSize)};(0,n.useImperativeHandle)(t,function(){return{currentPage:h,pageSize:x,sort:D,resetPagination:function(){E()}}});var _=function(e){var t=C(e);c&&y.push(t),P(e),!c&&f&&f()},k=function(e){e!==i.C1.paginationSize&&(S(e),f&&f())},z=function(e){var t;I({item:e.item,order:e.order}),f&&f()};return(0,a.jsx)(s.Z,{columns:r,loading:l,paginationSize:p,pagination:d&&!0,paginationProps:d&&{currentPage:h,onPageChange:_,onPageSizeChange:k,pageCount:Math.ceil(d.aggregate.totalCount/x),perPage:x},rowClick:g,rows:m,sort:D,setSort:z})});c.defaultProps={history:!0,loading:!0,paginationSize:!1}},42846:function(e,t,r){"use strict";r.d(t,{x:function(){return l}});var n=r(59499),o=r(67294),i=r(96486),s=r(87043),a=function(e){try{return JSON.parse(e)}catch(t){return!1}};function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var l=function(e){var t,r,c,l,d,p,f,g,m,v,y,b=e.filters,j=e.newFilters,O=e.initialSort,h=(0,o.useRef)(),P=(0,o.useState)({}),w=P[0],x=P[1],S=(0,o.useState)({}),Z=S[0],D=S[1],I=O||{item:"createdAt",order:"desc"},C=(0,n.Z)({},(null===(t=h.current)||void 0===t?void 0:t.sort.item)||I.item,I.inneritem?(0,n.Z)({},I.inneritem,(null===(r=h.current)||void 0===r?void 0:r.sort.order)||I.order):(null===(c=h.current)||void 0===c?void 0:c.sort.order)||I.order);return(0,o.useEffect)(function(){var e=!(0,i.isEqual)(w,b),t=!(0,i.isEqual)(Z,j);if(e&&(x(b),null==h||null===(n=h.current)||void 0===n||n.resetPagination()),t&&(D(j),null==h||null===(o=h.current)||void 0===o||o.resetPagination()),null!=h&&null!==(r=h.current)&&void 0!==r&&r.setSort&&!(e||t)){var r,n,o,s,a,c,u,l,d,p,f,g=null!==(s=h.current)&&void 0!==s&&null!==(a=s.sort)&&void 0!==a&&a.item&&null!==(c=h.current)&&void 0!==c&&null!==(u=c.sort)&&void 0!==u&&u.order?{item:null===(l=h.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(p=h.current)||void 0===p?void 0:null===(f=p.sort)||void 0===f?void 0:f.order}:C;h.current.setSort(g)}},[b,j]),{initialData:u(u({},b),{},{newFilters:(null==j?void 0:j.length)>0?j:void 0,limit:(null===(l=h.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(d=h.current)||void 0===d?void 0:d.pageSize,10)||s.C1.paginationSize,offset:((null===(p=h.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(f=h.current)||void 0===f?void 0:f.pageSize)||s.C1.paginationSize),orderBy:a(null===(g=h.current)||void 0===g?void 0:null===(m=g.sort)||void 0===m?void 0:null===(v=m.item)||void 0===v?void 0:v.replace(/ORDER/i,null===(y=h.current)||void 0===y?void 0:y.sort.order))||C}),initialSort:O,ref:h}}},93240:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var n,o,i=r(19076),s=r(67294),a=r(6812),c=r(71383),u=r(75063),l=(0,u.Ps)(n||(n=(0,c.Z)(['\n  query GetSensors($limit: Int, $offset: Int, $orderBy: Asset_order_by!) {\n    sensors: Asset(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: { status: { _eq: "active" }, Category: { meta: { _has_key: "sensor" } } }\n    ) {\n      id\n      name\n      type: customFields(path: "Type")\n      status\n      meters: AssetMeters {\n        id\n        name\n      }\n      lastLog: AssetLogs(limit: 1, order_by: { id: desc }) {\n        id\n        eventTime\n        type\n        value\n      }\n    }\n  }\n']))),d=(0,u.Ps)(o||(o=(0,c.Z)(["\n  mutation AddAssetLog($objects: [AssetLog_insert_input!]!) {\n    insert_AssetLog(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),p=r(78289),f=r(51466),g=r(26186),m=r(34613),v=r(58965),y=r(67872),b=r(42846),j=r(16835),O=r(50319),h=r(33006),P=r(55843),w=r(59499),x=r(50029),S=r(64687),Z=r.n(S),D=r(42283),I=r(76600),C=r(49501),E=r(58594),_=r(92264),k=r(52220),z=r(85893);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach(function(t){(0,w.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var M=function(e){var t,r=e.addAssetLog,n=e.assetId,o=e.assetMeterId,i=(0,D.cI)({defaultValues:{eventTime:new Date}}),s=i.control,a=i.errors,c=i.handleSubmit,u={control:s,errors:a,register:i.register},l=(t=(0,x.Z)(Z().mark(function e(t){return Z().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.assetId=n,t.type="motionDetected",t.value=String("yes"===t.occupied),t.assetMeterId=o,delete t.occupied,e.next=7,r({variables:{objects:[t]}});case 7:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,z.jsxs)(I.Z,{handleSubmit:c(l),children:[(0,z.jsx)(C.Z,{label:"Event Time",children:(0,z.jsx)(k.M,T(T({},u),{},{dateFormat:"d MMM yyyy HH:mm",name:"eventTime",showTimeSelect:!0,todayButton:!1}))}),(0,z.jsx)(C.Z,{label:"",children:(0,z.jsx)(E.Z,T(T({},u),{},{name:"occupied",data:[{label:"occupied",key:"occupied",value:"yes"}]}))}),(0,z.jsx)(_.H,{content:"Update",type:"submit"})]})},A=r(55563);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(t){(0,w.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var $=function(e){var t,r=e.addAssetLog,n=e.assetId,o=e.assetMeterId,i=(0,D.cI)({defaultValues:{eventTime:new Date}}),s=i.control,a=i.errors,c=i.handleSubmit,u={control:s,errors:a,register:i.register},l=(t=(0,x.Z)(Z().mark(function e(t){return Z().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.assetId=n,t.type="temperature",t.assetMeterId=o,e.next=5,r({variables:{objects:[t]}});case 5:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,z.jsxs)(I.Z,{handleSubmit:c(l),children:[(0,z.jsx)(C.Z,{label:"Event Time",children:(0,z.jsx)(k.M,F(F({},u),{},{dateFormat:"d MMM yyyy HH:mm",name:"eventTime",showTimeSelect:!0,todayButton:!1}))}),(0,z.jsx)(C.Z,{label:"Temperature",children:(0,z.jsx)(A.Z,F(F({},u),{},{name:"value",type:"number"}))}),(0,z.jsx)(_.H,{content:"Update",type:"submit"})]})},N=function(e){var t=e.offCanvas,r=e.row,n=(0,O.D)(d,{onCompleted:function(){t.close()}}),o=(0,j.Z)(n,1)[0];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(h.Z,{tag:"h3",content:r.name,noMargin:!0}),(0,z.jsx)(f.Z,{children:r.type}),(0,z.jsx)(P.Z,{}),"occupancy"===r.type&&(0,z.jsx)(M,{addAssetLog:o,assetId:r.id,assetMeterId:r.meterId,type:r.type}),"thermo"===r.type&&(0,z.jsx)($,{addAssetLog:o,assetId:r.id,assetMeterId:r.meterId,type:r.type})]})},q=function(){var e=(0,b.x)({filters:{}}),t=e.initialData,r=e.ref,n=(0,s.useContext)(p.Z),o=(0,a.a)(l,{variables:t}).data,i=(o=void 0===o?{sensors:[],meta:{aggregate:{totalCount:0}}}:o).sensors,c=function(e){n.show({content:(0,z.jsx)(N,{offCanvas:n,row:e}),submit:!1,title:"Emulator"})};return(0,z.jsx)(v.Z,{fitParentHeight:!0,open:!0,title:"Sensors",children:(0,z.jsx)(y.t,{columns:[{text:"AssetId"},{text:"Name"},{text:"Type"},{text:"State"},{formatter:function(e){var t=e.row;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(f.Z,{children:[" ",t.lastLog," "]}),t.lastLogTime&&(0,z.jsx)(f.Z,{size:"sm",children:"".concat((0,g.Z)(t.lastLogTime)," ").concat((0,m.Z)(t.lastLogTime))})]})},text:"Current Value"},{hidden:!0},{hidden:!0}],loading:!1,pagination:!1,ref:r,rowClick:c,rows:i.map(function(e){return{id:e.id,name:e.name,type:e.type,status:e.status,lastLog:e.lastLog[0]&&e.lastLog[0].value,lastLogTime:e.lastLog[0]&&e.lastLog[0].eventTime,meterId:e.meters[0]&&e.meters[0].id}})})})},B=function(){return(0,z.jsx)(i.Z,{pageHeading:{heading:"Emulator"},children:(0,z.jsx)(q,{})})}},39940:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/emulator",function(){return r(93240)}])}},function(e){e.O(0,[3662,2283,212,1336,5370,6540,2797,3912,9774,2888,179],function(){return e(e.s=39940)}),_N_E=e.O()}]);