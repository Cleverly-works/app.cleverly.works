"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4195],{58969:function(n,e,t){t.d(e,{k:function(){return _}});var i=t(59499),a=t(42283),r=t(79665),o=t(76600),s=t(9270),c=t(62140),d=t(49501),u=t(55563),l=t(6710),m=t(95103),p=t(74231),y=(0,p.Ry)().shape({name:(0,p.Z_)(),invoicingEntity:(0,p.Z_)(),addressLine1:(0,p.Z_)().required(),addressLine2:(0,p.Z_)(),addressLine3:(0,p.Z_)(),city:(0,p.Z_)().required(),postCode:(0,p.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,p.Z_)(),countryId:(0,p.Z_)().required()}),f=t(92264),x=t(77329),v=t(85893);function h(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,i)}return t}function g(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?h(Object(t),!0).forEach(function(e){(0,i.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var _=function(n){var e=n.defaultValues,t=(n.onCancel,n.onSubmit),i=n.type,p=(0,a.cI)({defaultValues:g({},e),resolver:(0,r.S)(y)}),h=p.control,_=p.errors,j=p.handleSubmit,Z={control:h,errors:_,register:p.register};return(0,v.jsxs)(o.Z,{id:"offCanvasForm",handleSubmit:j(t),children:[(0,v.jsxs)(s.Z,{children:[(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(d.Z,{label:"Address name",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"name"}))})}),"invoice"===i&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(d.Z,{label:"invoicing email",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"invoicingEmail",type:"email"}))})}),(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(d.Z,{label:"Invoicing entity",children:(0,v.jsx)(l.Z,g(g({},Z),{},{name:"invoicingEntity",rows:4}))})})]}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"Address Line 1",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"addressLine1"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"Address Line 2",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"addressLine2"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"Address Line 3",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"addressLine3"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"City",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"city"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"Post Code",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"postCode"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"County",children:(0,v.jsx)(u.Z,g(g({},Z),{},{name:"county"}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(d.Z,{label:"Country",children:(0,v.jsx)(m.Z,g(g({},Z),{},{name:"countryId",options:x.O}))})})]}),(0,v.jsx)(s.Z,{justify:"end",children:(0,v.jsx)(c.Z,{md:12,children:(0,v.jsx)(f.H,{content:"Submit",type:"submit"})})}),(null==e?void 0:e.id)&&(0,v.jsx)(u.Z,g(g({},Z),{},{name:"id",type:"hidden"})),(null==e?void 0:e.meta)&&(0,v.jsx)(u.Z,g(g({},Z),{},{name:"meta",type:"hidden"}))]})}},19056:function(n,e,t){t.d(e,{H:function(){return S}});var i=t(59499),a=t(50029),r=t(27812),o=t(16835),s=t(64687),c=t.n(s),d=t(67294),u=t(6812),l=t(50319),m=t(4431),p=t(33006),y=t(15214),f=t(68956),x=t(49501),v=t(62047),h=t(51466),g=t(2931),_=t(55843),j=t(16540),Z=t(92264),b=t(58969),I=t(60036),A=t(58095),$=t(85893);function w(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,i)}return t}function C(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?w(Object(t),!0).forEach(function(e){(0,i.Z)(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}var P=function(n){var e,t=n.addresses,i=n.entity,r=n.entityId,s=(n.id,n.loading),u=n.onSelected,p=n.refetch,y=n.selectable,w=n.selected,P=n.type,q=n.editable,L=(0,A.a)(),S=(0,d.useState)(1),k=S[0],U=S[1],N=(0,l.D)(m.BO,{onCompleted:function(){L.close(),p()}}),O=(0,o.Z)(N,1)[0],E=(0,l.D)(m._r,{onCompleted:function(){L.close(),p()}}),M=(0,o.Z)(E,1)[0],T=function(n,e){u(n,e)},D=(e=(0,a.Z)(c().mark(function n(e){var t,a,o,s,d;return c().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(t=e).countryId||(t.countryId=1),a={address:t},n.next=5,window.fetch("".concat("https://aws.cleverly.works","/google/maps/geocode"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(a)}).then(function(n){return n.json()}).catch(function(n){(0,I.Tb)({message:n,section:"fetch"})});case 5:if(o=n.sent,e.id?t.meta=C({invoicingEmail:e.invoicingEmail},e.meta):t.meta={invoicingEmail:e.invoicingEmail},delete t.invoicingEmail,null!=(s=(null==o?void 0:o.coordinates)||null)&&s.lat&&null!=s&&s.lng&&(t.geo={type:"Point",coordinates:[s.lng,s.lat]}),!e.id){n.next=16;break}return d=parseInt(e.id),n.next=14,M({variables:{id:d,changes:t}});case 14:n.next=19;break;case 16:return t.Address_Entities={data:{entity:i,entityId:r,status:"active"}},n.next=19,O({variables:{objects:[t]}});case 19:case"end":return n.stop()}},n)})),function(n){return e.apply(this,arguments)}),F=function(n){L.close()},z=function(n){var e,i={},a=t.find(function(e){return e.id===n.id}),r=a?a.address:null;r&&(i.id=r.id,i.invoicingEmail=null===(e=r.meta)||void 0===e?void 0:e.invoicingEmail,i.invoicingEntity=r.invoicingEntity,i.name=r.name,i.addressLine1=r.addressLine1,i.addressLine2=r.addressLine2,i.addressLine3=r.addressLine3,i.city=r.city,i.postCode=r.postCode,i.county=r.county,i.countryId=r.countryId),L.show({content:(0,$.jsx)(b.k,{defaultValues:i,onCancel:F,onSubmit:D,type:P}),title:r?"Edit address":"invoice"===P?"Add new invoice address":"Add new address",submit:!1})},H=[{hidden:!0},{hidden:!y||!q,text:"Select"},{text:"Address"},{hidden:"invoice"!==P,text:"Email"},{formatter:f.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(n,e){return z(e)},tooltip:"Edit"}],text:"Actions",hidden:!q}],R=(null==t?void 0:t.map(function(n,e){var t,i=n.address;return{id:n.id,select:function(){return(0,$.jsx)(x.Z,{children:(0,$.jsx)(v.Z,{context:"secondary",onToggle:function(n){return T(i.id,n)},size:"sm",toggled:Number(w)===i.id})})},address:function(){var n;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(h.Z,{content:null==i?void 0:i.name,size:"md"}),(0,$.jsx)(g.Z,{country:(null===(n=i.country)||void 0===n?void 0:n.name)||"",line1:i.addressLine1,town:i.city})]})},email:(null===(t=i.meta)||void 0===t?void 0:t.invoicingEmail)||"-",actions:""}}))||[];return(0,$.jsxs)($.Fragment,{children:[q&&(0,$.jsx)(Z.H,{content:"Add new address",handleClick:z}),(0,$.jsx)(_.Z,{marginBottom:"xs"}),(0,$.jsx)(j.Z,{columns:H,loading:s,pagination:!0,paginationProps:{currentPage:k,onPageChange:function(n){U(n)},onPageSizeChange:function(){},pageCount:Math.ceil((null==R?void 0:R.length)/50),perPage:50},rows:null==R?void 0:R.slice((k-1)*50,50*k)})]})};P.defaultProps={addresses:[],selectable:!1,selected:""};var q=t(9205),L=t(72936),S=function(n){var e,t,s,f=n.addressId,x=n.entity,v=n.entityId,h=n.id,g=n.onSubmit,_=n.type,j=(0,d.useState)(f||null),Z=j[0],b=j[1],I=(0,d.useState)(!1),A=I[0],w=I[1],C=(0,d.useState)(null),S=C[0],k=C[1],U=(0,q.DM)(_),N=(0,q.VJ)(x),O=(0,(0,L.x)().hasRole)("customer"),E=(0,u.a)(N,{variables:{id:v}}),M=E.loading,T=E.data,D=(T=void 0===T?{item:null}:T).item,F=E.refetch,z=(0,l.D)(m.x0,{onCompleted:function(n){g&&g(n)}}),H=(0,o.Z)(z,1)[0],R=(0,l.D)(m.y8,{onCompleted:function(n){g&&g(n)}}),G=(0,o.Z)(R,1)[0],J=[];D&&(D.addresses&&J.push.apply(J,(0,r.Z)(D.addresses)),D.accounts&&null!==(e=D.accounts[0])&&void 0!==e&&null!==(t=e.account)&&void 0!==t&&t.addresses&&D.accounts[0].account.addresses.forEach(function(n){J.find(function(e){return e.address.id===n.address.id})||J.push(n)}));var Y,B=(s=(0,a.Z)(c().mark(function n(e,t){return c().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(k(!1),w(!1),!t){n.next=8;break}return b(parseInt(e)),n.next=6,V(parseInt(e));case 6:n.next=9;break;case 8:w(!0);case 9:case"end":return n.stop()}},n)})),function(n,e){return s.apply(this,arguments)}),V=(Y=(0,a.Z)(c().mark(function n(e){var t,a,r,o,s;return c().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(Z!==e)){n.next=18;break}if(t=null,a=null,J.forEach(function(n){n.address.id===e&&(t=n.entity,a=n.id)}),!(a&&t===x)){n.next=11;break}return r={id:parseInt(a),changes:(0,i.Z)({},_,!0),whereOld:(0,i.Z)({entityId:{_eq:v}},_,{_eq:!0}),changesOld:(0,i.Z)({},_,!1)},n.next=8,G({variables:r});case 8:k(!0),n.next=16;break;case 11:return s={objects:[(0,i.Z)({addressId:parseInt(e),entity:x,entityId:v,status:"active"},_,!0)],whereOld:(0,i.Z)({entityId:{_eq:v}},_,{_eq:!0}),changesOld:(0,i.Z)({},_,!1)},n.next=15,H({variables:s});case 15:k(!0);case 16:n.next=19;break;case 18:g&&g(null);case 19:case"end":return n.stop()}},n)})),function(n){return Y.apply(this,arguments)});return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(p.Z,{tag:"h4",content:U}),S&&(0,$.jsx)(y.Z,{content:"Selection saved.",context:"primary"}),A&&(0,$.jsx)(y.Z,{content:"You should select at least one address.",context:"info"}),(0,$.jsx)(P,{addresses:J,entity:x,entityId:v,id:h,loading:M,refetch:F,selectable:!0,selected:Z,type:_,onSelected:B,editable:!O})]})}},16387:function(n,e,t){t.d(e,{f:function(){return j}});var i=t(87043),a=t(16551),r=t(77439),o=t(58965),s=t(93517),c=t(86036),d=t(51466),u=t(2931),l=t(9205),m=t(67294),p=t(10367),y=t(78289),f=t(94094),x=t(85893),v=function(n){var e=n.propertyId,t=n.propertyName,i=(0,m.useContext)(y.Z),a=function(){i.show({title:"Property information",content:(0,x.jsx)(f.w,{propertyId:e,toggleShow:i.close})})};return(0,x.jsx)(h,{onClick:a,children:t})},h=p.ZP.a.withConfig({displayName:"link__StyledLink",componentId:"sc-1tj5316-0"})(["cursor:pointer;text-decoration:none;"]),g=t(19056),_=t(58095),j=function(n){var e=n.access,t=n.address,m=n.edit,p=n.entity,y=n.entityId,f=n.id,h=n.name,j=n.open,Z=n.refetch,b=n.showMap,I=n.showLink,A=n.title,$=n.type,w=(0,_.a)(),C=function(n){n&&Z&&Z()},P=function(n){n.stopPropagation(),w.show({content:(0,x.jsx)(g.H,{entity:p,entityId:y,id:f,onSubmit:C,addressId:t.id,type:$}),submit:!1,title:"Manage addresses"})},q=(0,l.UC)(t),L=function(){return(0,x.jsx)(a.Z,{children:(0,x.jsx)(r.Z,{context:"secondary",content:"Edit",onClick:P,size:"sm"})})};return(0,x.jsxs)(o.Z,{handleClick:P,open:j,title:A,toolbar:m&&(0,x.jsx)(L,{}),children:[b&&i.ie.map&&(0,x.jsx)(s.Z,{apiKey:i.ie.map,center:q,location:q,markers:[q],style:{width:"100%",height:"auto"}}),h&&(0,x.jsx)(c.Z,{content:"Property",text:I?(0,x.jsx)(v,{propertyId:y,propertyName:h}):h}),"invoice"===$&&t.invoicingEntity&&(0,x.jsx)(c.Z,{content:"Invoicing Entity",text:t.invoicingEntity}),t.name&&"invoice"!==$&&(0,x.jsx)(c.Z,{content:"Name",text:t.name}),(0,x.jsx)(d.Z,{children:" Address "}),(0,x.jsx)(u.Z,{county:t.county,line1:t.addressLine1,line2:t.addressLine2,line3:t.addressLine3,postcode:t.postCode,town:t.city}),e&&(0,x.jsx)(c.Z,{content:"Access",text:e})]})};j.defaultProps={edit:!1,open:!0,showMap:!1,showLink:!0,title:"Address"}},53344:function(n,e,t){t.d(e,{Q:function(){return i}});var i=function(n){var e,t,i=n&&n.length>0&&n.find(function(n){var e;return(null===(e=n.medium)||void 0===e?void 0:e.category)==="avatar"});if(!i)return null;var a="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(i.medium.filename),r=null==i?void 0:null===(e=i.medium)||void 0===e?void 0:null===(t=e.meta)||void 0===t?void 0:t.thumbnails;if(null!=r&&r.length){var o=r.find(function(n){return"small"===n.name});null!=o&&o.relativePath&&(a="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(o.relativePath))}return a}},94094:function(n,e,t){t.d(e,{w:function(){return f}});var i=t(67294),a=t(6812),r=t(35914),o=t(11163),s=t(9205),c=t(16387),d=t(61584),u=t(53344),l=t(46165),m=t(84808),p=t(98456),y=t(85893),f=function(n){var e,t,f,x=n.propertyId,v=n.toggleShow,h=(0,o.useRouter)();(0,i.useEffect)(function(){var n=function(n){v()};return h.events.on("routeChangeComplete",n),function(){h.events.off("routeChangeComplete",n)}},[]);var g=(0,a.a)(r.t,{variables:{id:x}}),_=g.loading,j=g.data,Z=(j=void 0===j?{location:{}}:j).location;if(_)return(0,y.jsx)(m.Z,{sx:{zIndex:1e5},open:!0,children:(0,y.jsx)(p.Z,{color:"secondary"})});var b=Z.createdAt,I=Z.customer,A=Z.supplier,$=Z.user,w=(0,s.WE)(Z,"registered"),C=(0,s.WE)(Z,"invoice");return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(l.g,{avatar:(0,u.Q)(null===(e=Z.customer[0].account)||void 0===e?void 0:e.media),editable:!1,entity:{id:Z.id,description:Z.customer[0].account.name,name:Z.name},entityName:"Location",linkTitleTo:"/dashboard/properties/view?id=".concat(Z.id)}),(0,y.jsx)(d.J,{data:{accountName:I.length&&I[0].account.name||A.length&&A[0].account.name,country:null==w?void 0:null===(t=w.address)||void 0===t?void 0:null===(f=t.country)||void 0===f?void 0:f.name,createdAt:b,fullName:null==$?void 0:$.fullName,position:null==$?void 0:$.position,phone:null==$?void 0:$.phone}}),w&&(0,y.jsx)(c.f,{address:w.address,edit:!1,entity:"Location",entityId:Z.id,id:w.id,showMap:!0,title:"Address",type:"registered"}),C&&(0,y.jsx)(c.f,{address:C.address,edit:!1,entity:"Location",entityId:Z.id,id:C.id,title:"Invoice Address",type:"invoice"})]})}},35914:function(n,e,t){t.d(e,{t:function(){return s}});var i,a,r=t(71383),o=t(75063),s=(0,o.Ps)(i||(i=(0,r.Z)(['\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      status\n      meta\n      permitsRequired\n      expenses: Expenses(where: { entity: { _eq: "Location" } }) {\n        id\n        amount\n        description\n        markup\n        total\n        unit\n        vat\n        paid\n        occurredAt\n        recurring\n      }\n      addresses: Addresses(order_by: { id: asc }, where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n            code\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n      customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n        account: Account {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        createdAt\n        entity\n        entityId\n        expiryAt\n\n        insuranceAmount\n        regNum\n        meta\n        compliance: Compliance {\n          id\n          type\n          name\n          status\n          hasInsuranceAmount\n          questions: Taxonomies(where: { entity: { _eq: "Compliance" } }) {\n            id\n            name\n            meta\n          }\n        }\n      }\n      supplier: Account_Locations(where: { Account: { type: { _eq: "supplier" } } }) {\n        id\n        account: Account {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      user: User {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      assets: Assets {\n        id\n        name\n        manufacturer\n        model\n        serialNumber\n        createdAt\n        customer: Account {\n          id\n          name\n          type\n        }\n        location: Location {\n          id\n          name\n        }\n      }\n    }\n  }\n'])));(0,o.Ps)(a||(a=(0,r.Z)(['\n  query GetTaxonomys($status: String = "active") {\n    taxonomy: Taxonomy(\n      where: {\n        meta: { _contains: { sublocation: true } }\n        status: { _eq: $status }\n        type: { _eq: "assetCategory" }\n      }\n    ) {\n      id\n      meta\n      name\n      status\n      type\n    }\n  }\n'])))},61584:function(n,e,t){t.d(e,{J:function(){return s}});var i=t(58965),a=t(86036),r=t(26186),o=t(85893),s=function(n){var e=n.data,t=e.accountName,s=e.country,c=e.createdAt,d=e.fullName,u=e.position,l=e.phone,m=e.xeroContactId,p=e.permitsRequired,y=n.open;return(0,o.jsxs)(i.Z,{open:y,title:"Contact",children:[(0,o.jsx)(a.Z,{content:"Account",text:t||"Not Specified"}),(0,o.jsx)(a.Z,{content:"Name",text:d?"".concat(d):"Not Specified"}),(0,o.jsx)(a.Z,{content:"Position",text:u||"Not Specified"}),(0,o.jsx)(a.Z,{content:"Phone number",text:l||"Not Specified"}),(0,o.jsx)(a.Z,{content:"Country",text:s||"Not Specified"}),(0,o.jsx)(a.Z,{content:"Date Added",text:(0,r.Z)(c)}),(0,o.jsx)(a.Z,{content:"Permits required",text:p?"Yes":"No"}),m&&(0,o.jsx)(a.Z,{content:"Xero Contact ID",text:m})]})};s.defaultProps={open:!0}},46165:function(n,e,t){t.d(e,{g:function(){return U}});var i,a=t(67294),r=t(10367),o=t(78289),s=t(74147),c=t(9270),d=t(62140),u=t(65414),l=t(55843),m=t(45481),p=t(97303),y=t(33006),f=t(40826),x=t(55171),v=t.n(x),h=t(6812),g=t(71383),_=(0,t(75063).Ps)(i||(i=(0,g.Z)(["\n  query GetLog($entityId: bigint!, $entityName: String!) {\n    activity: audit_Activity(\n      where: { _and: [{ entityid: { _eq: $entityId } }, { entity: { _eq: $entityName } }] }\n    ) {\n      eventId\n      userId\n      user: User {\n        fullName\n      }\n      sessionUserName\n      transactionStart\n      statementStart\n      applicationName\n      clientAddr\n      clientPort\n      action\n      changedFields\n    }\n  }\n"]))),j=t(58965),Z=t(26186),b=t(86036),I=t(49501),A={U:"Update",I:"Insert",D:"Delete"},$=t(85893),w=function(n){var e=n.entityId,t=n.entityName,i=(0,h.a)(_,{variables:{entityId:e,entityName:t}}),a=i.loading,r=i.data,o=(r=void 0===r?{activity:[]}:r).activity;return!a&&(0,$.jsx)(c.Z,{children:(0,$.jsx)(d.Z,{md:12,children:o.map(function(n){var e,t;return(0,$.jsxs)(j.Z,{title:"".concat((null===(e=n.user)||void 0===e?void 0:e.fullName)||"Backend"," - ").concat((0,Z.Z)(n.transactionStart,!0)),children:[(0,$.jsx)(b.Z,{content:"Action:",text:A[t=n.action]||"-"}),(0,$.jsx)(l.Z,{}),(0,$.jsx)(I.Z,{label:"Changed:",children:(0,$.jsx)(v(),{collapsed:!0,displayDataTypes:!1,src:n.changedFields||"-"})}),(0,$.jsx)(b.Z,{content:"Application:",text:n.applicationName||"-"})]},n.userId)})})})},C=t(99229),P=t(93673),q=t(825),L=t(86559),S=t(72936),k=function(n){var e,t,i,a,r=n.job,o=n.numberPrefix,s=n.numberSuffix,c=(0,S.x)().hasRole;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(b.Z,{content:"Type",text:(null===(e=P.x.find(function(n){return n.value===r.type}))||void 0===e?void 0:e.text)||"-"}),(0,$.jsx)(b.Z,{content:"Order",text:(0,$.jsx)(q.D,{id:r.id,number:r.number,invoiceNumber:null==r?void 0:null===(t=r.invoices)||void 0===t?void 0:null===(i=t[0])||void 0===i?void 0:i.invoiceNumber,type:r.type,numberPrefix:o,numberSuffix:s,isQuote:r.quoted})}),c("admin")&&r.source&&(0,$.jsx)(b.Z,{content:"Source",text:null===(a=L.Y.find(function(n){return n.value===r.source}))||void 0===a?void 0:a.text})]})};k.defaultProps={numberPrefix:"",numberSuffix:""};var U=function(n){var e=n.avatar,t=n.editable,i=n.entity,r=n.entityName,y=n.icons,f=n.job,x=n.linkTitleTo,v=n.log,h=n.numberPrefix,g=n.numberSuffix,_=n.prefix,j=(0,a.useContext)(o.Z),Z=(0,a.useState)(e),b=Z[0],I=Z[1],A=function(n){j.close(),null!=n&&n.filename?I("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null==n?void 0:n.filename)):I(null)},P=function(){j.show({content:(0,$.jsx)(C.G,{category:"avatar",entity:r,entityId:null==i?void 0:i.id,filters:{category:"avatar"},limit:1,onMediaAdd:A,onMediaRemove:A,type:"image"}),title:"Avatar"})},q=function(){return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(T,{context:"primary",icon:"building"}),x?(0,$.jsx)(D,{border:!1,passHref:!0,to:x,children:null==i?void 0:i.name}):null==i?void 0:i.name]})},L=function(){j.show({content:(0,$.jsx)(w,{entityId:Number(null==v?void 0:v.entityId),entityName:null==v?void 0:v.entityName}),submit:!1,title:"Log Details",width:"50%"})};return(0,$.jsxs)(N,{children:[(0,$.jsx)(s.Z,{children:(0,$.jsxs)(c.Z,{children:[(0,$.jsx)(d.Z,{md:3,children:(0,$.jsx)(u.Z,{action:t?"Edit":null,actionClick:P,content:(null==i?void 0:i.name)||"test",context:"primary",gmail:null==i?void 0:i.email,src:b})}),(0,$.jsxs)(d.Z,{md:9,children:[(0,$.jsx)(O,{content:(0,$.jsx)(q,{}),noMargin:!0}),(null==i?void 0:i.description)&&(0,$.jsx)(E,{content:null==i?void 0:i.description,noMargin:!0}),(null==i?void 0:i.website)&&(0,$.jsxs)(M,{href:null==i?void 0:i.website,rel:"nofollow noopener noreferrer",target:"_blank",children:[(0,$.jsx)(T,{context:"primary",icon:"window-maximize"}),"Visit website"]})]}),f&&(0,$.jsx)(d.Z,{md:12,children:(0,$.jsx)(k,{job:f,numberPrefix:h,numberSuffix:g})})]})}),(0,$.jsx)(l.Z,{marginTop:"sm"}),y&&(0,$.jsxs)(F,{children:[y.map(function(n){var e=n.icon,t=n.onClick,i=n.to;return(0,$.jsxs)("div",{children:[t&&(0,$.jsx)(z,{onClick:t,children:(0,$.jsx)(m.Z,{icon:e,prefix:_})}),i&&(0,$.jsx)(p.Z,{border:!1,passHref:!0,to:i,children:(0,$.jsx)(m.Z,{icon:e,prefix:_})})]},e)}),v&&(0,$.jsx)(z,{onClick:L,children:(0,$.jsx)(m.Z,{icon:"history",size:"lg"})})]})]})},N=r.ZP.div.withConfig({displayName:"profileHeader__StyledHeader",componentId:"sc-ssc7qm-0"})(["background-color:#fff;border:1px solid #eee;box-shadow:rgba(45,62,80,0.12) 0 1px 5px 0;margin-bottom:0.5rem;padding:1rem 0;"]),O=(0,r.ZP)(y.Z).withConfig({displayName:"profileHeader__StyledHeading",componentId:"sc-ssc7qm-1"})(["font-size:1rem;margin-top:0.5rem;"]),E=(0,r.ZP)(y.Z).withConfig({displayName:"profileHeader__StyledDescription",componentId:"sc-ssc7qm-2"})(["font-size:0.9rem;margin-top:0.5rem;"]),M=r.ZP.a.withConfig({displayName:"profileHeader__StyledLink",componentId:"sc-ssc7qm-3"})(["margin-bottom:1rem;"]),T=(0,r.ZP)(f.Z).withConfig({displayName:"profileHeader__StyledIcon",componentId:"sc-ssc7qm-4"})(["margin-right:0.5rem;"]),D=(0,r.ZP)(p.Z).withConfig({displayName:"profileHeader__StyledTitle",componentId:"sc-ssc7qm-5"})(["display:inline;"]),F=r.ZP.div.withConfig({displayName:"profileHeader__StyledIconContainer",componentId:"sc-ssc7qm-6"})(["display:flex;justify-content:center;"]),z=r.ZP.div.withConfig({displayName:"profileHeader__Click",componentId:"sc-ssc7qm-7"})(["cursor:pointer;"]);U.defaultProps={avatar:"",editable:!0,numberPrefix:"",numberSuffix:""}},69496:function(n,e,t){t.d(e,{$E:function(){return O},AX:function(){return I},I4:function(){return b},JA:function(){return $},MT:function(){return L},Px:function(){return C},WF:function(){return w},ZA:function(){return T},a8:function(){return P},fA:function(){return N},fo:function(){return A},ge:function(){return M},iM:function(){return U},nE:function(){return S},nh:function(){return k},r1:function(){return q},tW:function(){return D},uz:function(){return E}});var i,a,r,o,s,c,d,u,l,m,p,y,f,x,v,h,g,_,j=t(71383),Z=t(75063),b=(0,Z.Ps)(i||(i=(0,j.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),I=(0,Z.Ps)(a||(a=(0,j.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),A=(0,Z.Ps)(r||(r=(0,j.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),$=(0,Z.Ps)(o||(o=(0,j.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),w=(0,Z.Ps)(s||(s=(0,j.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]))),C=(0,Z.Ps)(c||(c=(0,j.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]))),P=(0,Z.Ps)(d||(d=(0,j.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]))),q=(0,Z.Ps)(u||(u=(0,j.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]))),L=(0,Z.Ps)(l||(l=(0,j.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]))),S=(0,Z.Ps)(m||(m=(0,j.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),k=(0,Z.Ps)(p||(p=(0,j.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]))),U=(0,Z.Ps)(y||(y=(0,j.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]))),N=(0,Z.Ps)(f||(f=(0,j.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),O=(0,Z.Ps)(x||(x=(0,j.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]))),E=(0,Z.Ps)(v||(v=(0,j.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]))),M=(0,Z.Ps)(h||(h=(0,j.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']))),T=(0,Z.Ps)(g||(g=(0,j.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),D=(0,Z.Ps)(_||(_=(0,j.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"])))},77329:function(n,e,t){t.d(e,{O:function(){return i},v:function(){return a}});var i=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],a=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},93673:function(n,e,t){t.d(e,{x:function(){return i}});var i=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},86559:function(n,e,t){t.d(e,{Y:function(){return i}});var i=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]}}]);