"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7576],{34427:function(e,n,t){t.d(n,{B:function(){return P}});var r,o,i=t(26447),a=t(15861),c=t(11057),s=t(67720),u=t(42846),d=t(32836),l=t(59499),m=t(27812),p=t(72852),f=t(11994),v=t(50135),h=t(90629),b=t(10367),y=t(6812),g=t(71383),x=t(75063);(0,x.Ps)(r||(r=(0,g.Z)(['\n  query GetEntityPostcodeAreas(\n    $entityId: Int!\n    $entity: String!\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    postcodeAreas: PostcodeArea_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        PostcodeArea: { status: { _eq: "active" } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { PostcodeArea: { name: asc } }\n    ) {\n      id\n      postcode: PostcodeArea {\n        id\n        name\n        area\n      }\n    }\n  }\n'])));var j=(0,x.Ps)(o||(o=(0,g.Z)(['\n  query GetPostcodeAreasForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    postcodeAreas: PostcodeArea(\n      where: {\n        _or: [{ name: { _ilike: $q } }, { area: { _ilike: $q } }]\n        status: { _eq: "active" }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      id\n      name\n      area\n    }\n    meta: PostcodeArea_aggregate(\n      where: {\n        _or: [{ name: { _ilike: $q } }, { area: { _ilike: $q } }]\n        status: { _eq: "active" }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),I=t(67294),w=t(85893);function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach(function(n){(0,l.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var O=function(e){var n=e.open,t=e.setOpen,r=e.values,o=void 0===r?[]:r,c=e.setValues,l=(0,I.useState)(o||[]),h=l[0],b=l[1],g=(0,I.useState)(""),x=g[0],S=g[1];(0,I.useEffect)(function(){b(o||[])},[o]);var O=(0,u.x)({filters:{}}),P=O.initialData,A=O.ref,C=(0,y.a)(j,{variables:Z(Z({},P),{},{q:null,limit:null})}),T=C.data,q=(T=void 0===T?{postcodeAreas:[],meta:{aggregate:{totalCount:0}}}:T).postcodeAreas,k=C.loading,D=(0,I.useMemo)(function(){return q.filter(function(e){return!x||RegExp("".concat(x),"gmi").test(e.name)||RegExp("".concat(x),"gmi").test(e.area)}).map(function(e){return{id:e.id,name:e.name,area:e.area}})},[q,x]),$=(0,I.useCallback)(function(e){e.target.checked?b((0,m.Z)(D)):b([])},[D]),R=(0,I.useCallback)(function(e){return h.some(function(n){return n.id===e.id})},[h]),N=(0,I.useCallback)(function(e,n,t){n?b([].concat((0,m.Z)(h),[t])):b(h.filter(function(e){return e.id!==t.id}))},[h,b]),F=(0,I.useMemo)(function(){return[{flex:1,field:"name",headerName:"Area",sortable:!1},{flex:1,field:"area",headerName:"Postcode",sortable:!1},{width:80,field:"select",headerName:"",sortable:!1,renderHeader:function(){return(0,w.jsx)(p.Z,{color:"secondary",onChange:$})},renderCell:function(e){var n=e.row;return(0,w.jsx)(p.Z,{color:"secondary",checked:R(n),onChange:function(e,t){return N(e,t,n)}})}}]},[N,$,R]),E=function(){c(h),t(!1)};return(0,w.jsx)(f.Z,{open:n,onClose:E,children:(0,w.jsx)(_,{children:(0,w.jsxs)(i.Z,{children:[(0,w.jsx)(i.Z,{direction:"row",justifyContent:"space-between",children:(0,w.jsx)(a.Z,{variant:"h6",fontWeight:700,children:"Add postcode area"})}),(0,w.jsx)(s.Z,{sx:{mb:.5}}),(0,w.jsx)(v.Z,{label:"Search",color:"secondary",variant:"standard",value:x,onChange:function(e){return S(e.target.value)},sx:{mb:1}}),(0,w.jsx)(d.i,{disableRowSelectionOnClick:!0,autoHeight:!1,hideFooter:!1,loading:k,ref:A,columns:F,rows:D,pagination:!0,sortingMode:"client",paginationSize:50,initialState:{pagination:{paginationModel:{pageSize:50}}},containerHeight:"calc(90vh - 120px)"})]})})})};O.defaultProps={};var _=(0,b.ZP)(h.Z).withConfig({displayName:"selectCovarageAreas__Container",componentId:"sc-w9jz9s-0"})(function(){return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"500px",height:"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),P=function(e){var n=e.editable,t=e.paginationSize,r=e.name,o=e.values,l=e.setValue,m=(0,I.useState)(!1),p=m[0],f=m[1],v=(0,u.x)({filters:{}}).ref,h=(0,I.useMemo)(function(){return[{flex:1,field:"name",headerName:"Area",sortable:!1},{flex:1,field:"area",headerName:"Postcode",sortable:!1}]},[]),b=function(e){e.stopPropagation(),f(!0)},y=(0,I.useCallback)(function(e){l(r,e)},[r,l]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(O,{open:p,setOpen:f,values:o,setValues:y}),(0,w.jsxs)(i.Z,{children:[(0,w.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",mb:1,children:[(0,w.jsx)(a.Z,{variant:"h6",fontWeight:700,children:"Coverage areas"}),n&&(0,w.jsx)(c.Z,{color:"secondary",variant:"contained",size:"small",onClick:b,children:"Add"})]}),(0,w.jsx)(s.Z,{}),(0,w.jsx)(d.i,{autoHeight:!1,hideFooter:!1,rowSelection:!1,ref:v,columns:h,rows:o,pagination:!0,sortingMode:"client",paginationSize:t,initialState:{pagination:{paginationModel:{pageSize:t}}}})]})]})};P.defaultProps={paginationSize:5,setValues:function(){},values:[]}},77375:function(e,n,t){t.d(n,{G5:function(){return m},UB:function(){return f},Ve:function(){return h},Wn:function(){return b},bD:function(){return y},kJ:function(){return p},rM:function(){return v}});var r,o,i,a,c,s,u,d=t(71383),l=t(75063),m=(0,l.Ps)(r||(r=(0,d.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n\n      slaId\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),p=(0,l.Ps)(o||(o=(0,d.Z)(['\n  query GetCustomers(\n    $customerManagerId: Int\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Account_order_by!\n    $status: String\n  ) {\n    customers: Account(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $customerManagerId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      createdAt\n      name\n      companyNumber\n      vatId\n      website\n      status\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $customerManagerId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),f=(0,l.Ps)(i||(i=(0,d.Z)(['\n  query GetCustomer($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      clientType: ClientType {\n        id\n        name\n      }\n      structure\n      companyNumber\n      vatId\n      website\n      status\n      createdAt\n      updatedAt\n      status\n      type\n      meta\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n      propertiesMeta: Account_Locations_aggregate {\n        aggregate {\n          count\n        }\n      }\n      jobsMeta: CustomerJobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n        phone\n        email\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n      jobs: CustomerJobs {\n        id\n        title\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      accountEntries: AccountEntries(order_by: { createdAt: asc }) {\n        id\n        outstandingAmount\n        type\n        entryId\n        currencyId\n        createdAt\n        balance\n        amount\n        accountId\n        updatedAt\n      }\n    }\n  }\n']))),v=(0,l.Ps)(a||(a=(0,d.Z)(["\n  query GetCustomerManage($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      meta\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        isContact\n        userId\n        user: User {\n          id\n          email\n          fullName\n          meta\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n        }\n      }\n      clientType: ClientType {\n        id\n        label: name\n        value: id\n      }\n      status\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n    }\n  }\n"]))),h=(0,l.Ps)(c||(c=(0,d.Z)(["\n  mutation AddCustomer($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),b=(0,l.Ps)(s||(s=(0,d.Z)(["\n  mutation UpdateCustomer(\n    $customerId: Int!\n    $customer: Account_set_input\n    $userId: Int!\n    $user: User_set_input\n    $hasUpdateUser: Boolean!\n  ) {\n    update_Account_by_pk(pk_columns: { id: $customerId }, _set: $customer) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $userId }, _set: $user) @include(if: $hasUpdateUser) {\n      id\n    }\n  }\n"]))),y=(0,l.Ps)(u||(u=(0,d.Z)(["\n  mutation AddFinancial($objects: [Financial_insert_input!]!) {\n    insert_Financial(objects: $objects) {\n      returning {\n        id\n        accountId\n        locationId\n      }\n    }\n  }\n"])))},53141:function(e,n,t){t.d(n,{y:function(){return $}});var r,o,i=t(59499),a=t(68956),c=t(26186),s=t(16551),u=t(77439),d=t(58965),l=t(16540),m=t(50029),p=t(16835),f=t(64687),v=t.n(f),h=t(50319),b=t(71383),y=t(75063),g=(0,y.Ps)(r||(r=(0,b.Z)(["\n  mutation AddBankAccount($objects: [BankAccount_insert_input!]!) {\n    insert_BankAccount(objects: $objects) {\n      returning {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        createdAt\n      }\n    }\n  }\n"]))),x=(0,y.Ps)(o||(o=(0,b.Z)(["\n  mutation UpdateBankAccount($id: Int!, $changes: BankAccount_set_input) {\n    update_BankAccount_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),j=t(42283),I=t(79665),w=t(76600),S=t(49501),Z=t(55563),O=t(58594),_=t(74231),P=(0,_.Ry)().shape({bank:(0,_.Z_)().required(),accountNumber:(0,_.Z_)().required(),bic:(0,_.Z_)().required(),iban:(0,_.Z_)().required(),routingNumber:(0,_.Z_)().required()}),A=t(85893);function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach(function(n){(0,i.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var q=function(e){var n,t=e.accountId,r=e.data,o=e.refetch,i=e.toggleShow,a=(0,j.cI)({defaultValues:r,resolver:(0,I.S)(P)}),c=a.errors,s=a.handleSubmit,u=a.register,d=(0,h.D)(g,{onCompleted:function(){o()}}),l=(0,p.Z)(d,1)[0],f=(0,h.D)(x,{onCompleted:function(){o()}}),b=(0,p.Z)(f,1)[0],y=(n=(0,m.Z)(v().mark(function e(n){var o;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((o=T({},n)).stripeId="ba_42g2s45sh46jl46h",o.accountId=t,o.status="active",o.countryId=1,o.currencyId=1,o.meta={showInInvoice:Boolean(o.showInInvoice)},delete o.showInInvoice,!(null!=r&&r.id)){e.next=12;break}b({variables:{id:r.id,changes:o}}),e.next=14;break;case 12:return e.next=14,l({variables:{objects:[o]}});case 14:i();case 15:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),_={errors:c,register:u};return(0,A.jsxs)(w.Z,{id:"offCanvasForm",handleSubmit:s(y),children:[(0,A.jsx)(S.Z,{label:"Bank name",children:(0,A.jsx)(Z.Z,T(T({},_),{},{name:"bank"}))}),(0,A.jsx)(S.Z,{label:"Account number",children:(0,A.jsx)(Z.Z,T(T({},_),{},{name:"accountNumber"}))}),(0,A.jsx)(S.Z,{label:"Routing number",children:(0,A.jsx)(Z.Z,T(T({},_),{},{name:"routingNumber"}))}),(0,A.jsx)(S.Z,{label:"BIC",children:(0,A.jsx)(Z.Z,T(T({},_),{},{name:"bic"}))}),(0,A.jsx)(S.Z,{label:"IBAN",children:(0,A.jsx)(Z.Z,T(T({},_),{},{name:"iban"}))}),(0,A.jsx)(O.Z,T(T({},_),{},{data:[{id:"1",label:"Show in invoice",value:"true"}],name:"showInInvoice"}))]})},k=t(58095);function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var $=function(e){var n=e.accountId,t=e.data,r=e.edit,o=e.refetch,m=(0,k.a)(),p=[{hidden:!0},{text:"Bank"},{text:"Account number"},{text:"Routing"},{text:"BIC"},{text:"IBAN"},{text:"Stripe ID",hidden:!0},{text:"Date Added"},{formatter:function(e){return!0===e.row.showInInvoice?"True":"False"},text:"Show In Invoice"},{formatter:a.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return h(e,n)},tooltip:"Edit"}],text:"Actions"}],f=function(e){var n,t;return{id:e.id,bank:null==e?void 0:e.bank,accountNumber:null==e?void 0:e.accountNumber,routingNumber:null==e?void 0:e.routingNumber,bic:null==e?void 0:e.bic,iban:null==e?void 0:e.iban,stripeId:e.stripeId,date:(0,c.Z)(e.createdAt),showInInvoice:null!==(n=e.meta)&&void 0!==n&&!!n.showInInvoice&&(null===(t=e.meta)||void 0===t?void 0:t.showInInvoice),actions:""}},v=function(e){e.stopPropagation(),m.show({content:(0,A.jsx)(q,{accountId:n,refetch:o,toggleShow:m.close}),title:"Add Bank Account"})},h=function(e,t){e.stopPropagation(),m.show({content:(0,A.jsx)(q,{accountId:n,data:function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?D(Object(t),!0).forEach(function(n){(0,i.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},t)||{},refetch:o,toggleShow:m.close}),title:"Add Bank Account"})},b=function(){return(0,A.jsx)(s.Z,{children:(0,A.jsx)(u.Z,{context:"secondary",content:"Add",onClick:v,size:"sm"})})};return(0,A.jsx)(d.Z,{open:!0,title:"Bank Accounts",toolbar:r&&(0,A.jsx)(b,{}),children:(0,A.jsx)(l.Z,{columns:p,rows:t.map(function(e){return f(e)})})})};$.defaultProps={data:[],edit:!0}},61497:function(e,n,t){t.d(n,{r:function(){return r}});var r=[{text:"All work orders",value:""},{text:"All outstanding invoices",value:"0-"},{text:"1 - 30",value:"1-30"},{text:"31 - 60",value:"31-60"},{text:"61 - 90",value:"61-90"},{text:"> 90",value:"90-"}]},92568:function(e,n,t){t.d(n,{b:function(){return ni}});var r=t(50029),o=t(64687),i=t.n(o),a=t(67294),c=t(11163),s=t(6812),u=t(72628),d=t(78289),l=t(11082),m=t(16551),p=t(77439),f=t(9270),v=t(62140),h=t(58965),b=t(16540),y=t(53141),g=t(10367),x=t(86036),j=t(55377),I=t(11587),w=t(92264),S=t(99229),Z=t(16835),O=t(59499),_=t(50319),P=t(77375),A=t(42283),C=t(76600),T=t(28497),q=t(49501),k=t(55563),D=t(85893);function $(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var N=function(e){var n,t=e.accountId,o=e.meta,a=e.refetch,c=e.toggleShow,s=R({},null==o?void 0:o.finance)||{},u=(0,A.cI)({defaultValues:{creditLimit:s.creditLimit||0,creditRating:s.creditRating||0}}),d=u.errors,l=u.handleSubmit,m=u.register,p=(0,_.D)(P.Wn),f=(0,Z.Z)(p,1)[0],v=(n=(0,r.Z)(i().mark(function e(n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f({variables:{customerId:t,customer:h(n)}}).then(function(){a(),c()});case 1:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),h=function(e){var n={};return n.meta=R({},o)||{},n.meta.finance=s||{},n.meta.finance.creditLimit=Number(e.creditLimit),n.meta.finance.creditRating=Number(e.creditRating),n},b={errors:d,register:m};return(0,D.jsxs)(C.Z,{id:"offCanvasForm",handleSubmit:l(v),children:[(0,D.jsx)(T.Z,R(R({},b),{},{name:"creditLimit",label:"Credit Limit"})),(0,D.jsx)(q.Z,{label:"Credit Rating",children:(0,D.jsx)(k.Z,R(R({},b),{},{name:"creditRating",type:"number"}))})]})},F=function(e){var n=e.percent,t=e.breakPoints;return((!t||t.length<2)&&(t=[70,90]),n<=t[0])?"success":n<=t[1]?"warning":"danger"},E=t(22227),L=function(e){var n,t,r=e.accountId,o=e.edit,i=e.meta,a=e.offCanvas,c=e.customerBalance,s=e.refetch,u=(null==i?void 0:i.finance)||{};t=c>=0||!(null!=u&&u.creditLimit)?0:-1*(0,E.l)(c/(null==u?void 0:u.creditLimit)*100,0);var d=function(){a.show({title:"Edit Credit Details",content:(0,D.jsx)(N,{accountId:r,meta:i,refetch:s,toggleShow:a.close})})};return(0,D.jsxs)(S.G,{carousel:!1,details:!0,entity:"CreditReport",entityId:null==u?void 0:u.id,summary:"Credit Report",children:[(0,D.jsx)(x.Z,{content:"Balance",text:(0,l.Z)(null!=c?c:0)}),(0,D.jsx)(x.Z,{content:"Credit Limit",text:(0,D.jsxs)(D.Fragment,{children:["".concat((0,l.Z)(null!==(n=null==u?void 0:u.creditLimit)&&void 0!==n?n:0)," "),(0,D.jsx)(B,{size:"sm",content:"".concat(t,"%"),context:F({percent:t})})]})}),(0,D.jsx)(x.Z,{content:"Credit Rating",text:(null==u?void 0:u.creditRating)||0}),o&&(0,D.jsx)(w.H,{content:"Edit",handleClick:d}),(0,D.jsx)(j.Z,{size:"sm"})]})};L.defaultProps={edit:!0};var B=(0,g.ZP)(I.Z).withConfig({displayName:"creditReport__StyledBadge",componentId:"sc-1lef73r-0"})(["margin-bottom:0;"]),H=t(66252),z=t(73359),M=t(57460),U=t.n(M),X=t(40826),J=t(68956),V=t(26186),G=t(95103),W=t(55843),Q=t(32158),Y=t(84808),K=t(98456),ee=t(42626),en=t(62047),et=t(67872),er=t(825),eo=t(42846),ei=t(69532);function ea(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function ec(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ea(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ea(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var es,eu=function(e){var n=e.adminId,t=e.accountId,r=e.locationId,o=e.onSendEntities;e.toggleShow;var i=(0,a.useState)(!1),d=i[0],m=i[1],p=function(e,n){var t=e.id;L(E.map(function(e){return e.id===t&&(e.assigned=n),e}))},f=[{hidden:!0},{hidden:!0},{text:"Number",formatter:function(e){var n,t=e.row;return"ppmInvoice"===t.type?"PM ".concat(t.invoiceNumber):(0,D.jsx)(er.D,{id:t.jobId,number:t.number,invoiceNumber:null===(n=t.invoice)||void 0===n?void 0:n.invoiceNumber,type:t.jobType})}},{formatter:function(e){var n=e.row,t=e.row.itemType;return(0,D.jsx)(ed,{content:t,row:n,size:"sm"})},text:"Type"},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Amount Outstanding",formatter:function(e){var n=e.row;return"invoice"===n.itemType||"proformaInvoice"===n.itemType?(0,l.Z)(n.outstandingAmount):"-"}},{text:"Status",formatter:function(e){var n=e.row;return n.status?(0,D.jsx)(ei.B,{value:n.status}):""}},{hidden:!0},{hidden:!0},{formatter:function(e){var n,t,r,o,i=e.row;return(0,D.jsx)(en.Z,{context:"secondary",size:"sm",onToggle:function(e){return p(i,e)},toggled:i.assigned||(null===(n=i.meta)||void 0===n?void 0:n.xeroInvoiceId)||(null===(t=i.meta)||void 0===t?void 0:t.xeroCreditNoteId),disabled:(null===(r=i.meta)||void 0===r?void 0:r.xeroInvoiceId)||(null===(o=i.meta)||void 0===o?void 0:o.xeroCreditNoteId)})},text:(0,D.jsx)(en.Z,{context:"secondary",size:"sm",onToggle:function(e){return h(e)}})}],v=function(e){return k.map(function(n){var t,r,o,i,a,c,s,u,d,l,m,p,f,v,h;return{id:n.id,jobId:null==n?void 0:null===(t=n.invoices)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:null===(o=r.Job)||void 0===o?void 0:o.id,number:null==n?void 0:null===(i=n.invoices)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:null===(c=a.Job)||void 0===c?void 0:c.number,itemType:n.type,jobType:null==n?void 0:null===(s=n.invoices)||void 0===s?void 0:null===(u=s[0])||void 0===u?void 0:null===(d=u.Job)||void 0===d?void 0:d.type,invoiceNumber:null==n?void 0:null===(l=n.invoices)||void 0===l?void 0:null===(m=l[0])||void 0===m?void 0:m.invoiceNumber,invoice:null!=n&&n.invoices?null==n?void 0:null===(p=n.invoices)||void 0===p?void 0:p[0]:null,outstandingAmount:n.outstandingAmount,status:null==n?void 0:null===(f=n.invoices)||void 0===f?void 0:null===(v=f[0])||void 0===v?void 0:null===(h=v.Job)||void 0===h?void 0:h.status,paymentStatus:n.paymentStatus,meta:null==n?void 0:n.meta,assigned:e,actions:""}})},h=function(e){L(v(e))},b=function(){m(!1)},y=function(e){e.preventDefault(),m(!0),o(E.filter(function(e){var n,t;return e.assigned&&!(null!==(n=e.meta)&&void 0!==n&&n.xeroInvoiceId||null!==(t=e.meta)&&void 0!==t&&t.xeroCreditNoteId)}).map(function(e){return"creditNote"===e.itemType?{id:e.id,entity:e.itemType}:{entity:e.itemType,invoiceType:e.invoice.invoiceType||null,invoiceId:e.id||null}}),b)},g=(0,c.useRouter)().query,x={endDate:g.endDate&&new Date(g.endDate),outstandingLevel:g.outstandingLevel,startDate:g.startDate&&new Date(g.startDate),type:["ppmInvoice","proformaInvoice","partial","paid","unpaid"]},j=(0,a.useState)(x)[0],I=j.endDate,w=j.outstandingLevel,S=j.startDate,Z=j.type,O=(0,eo.x)({filters:j}),_=O.initialData,P=O.ref,A=ec(ec({},_),{},{limit:25}),T=(0,s.a)(u.BH,{fetchPolicy:"no-cache",variables:ec(ec({},A),{},{where:ec(ec({},(0,ee.Io)({outstandingLevel:w,adminId:n,accountId:t,to:I,from:S,locationId:r,type:Z})),{},{_or:[{_and:[{meta:{_is_null:!1}},{_not:{meta:{_has_key:"xeroInvoiceId"}}},{_not:{meta:{_has_key:"xeroCreditNoteId"}}}]},{meta:{_is_null:!0}}]}),locationId:r})}),q=T.data,k=(q=void 0===q?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0},balance:{balance:0}}}}:q).accountEntries,$=q.meta,R=T.loading,N=T.refetch,F=(0,a.useState)([]),E=F[0],L=F[1];return(0,a.useEffect)(function(){L(v(!1))},[R]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Y.Z,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:d,children:(0,D.jsx)(K.Z,{color:"inherit"})}),(0,D.jsx)(C.Z,{id:"offCanvasForm",handleSubmit:y,children:(0,D.jsx)(et.t,{columns:f,loading:R,meta:$,ref:P,refetch:N,rows:E,xeroPageSize:25})})]})},ed=(0,g.ZP)(I.Z).withConfig({displayName:"accountEntriesSyncXero__StyledBadge",componentId:"sc-1fm76l7-0"})(["background-color:",";"],function(e){return(0,ee.Lq)(e.row,e.theme)}),el=t(52220),em=t(60036),ep=(es=(0,r.Z)(i().mark(function e(n){var t,r,o,a,c,s,u,d,l,m,p;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.adminId,r=n.accountId,o=n.locationId,a=n.from,c=n.invoiceNumber,s=n.jobId,u=n.outstandingLevel,d=n.to,l=n.type,e.next=3,{adminId:t,accountId:r,currency:"\xa3",locationId:o,from:a,invoiceNumber:c,jobId:s,outstandingLevel:u,to:d,type:l};case 3:return m=e.sent,p=window.open("/download","_blank"),e.next=7,window.fetch("".concat("https://aws.cleverly.works","/pdf/statement/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(m)}).then(function(e){return e.json()}).then(function(e){p.location.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key))}).catch(function(e){(0,em.Tb)({message:e,section:"fetch"})});case 7:case"end":return e.stop()}},e)})),function(e){return es.apply(this,arguments)}),ef=t(33234),ev=t(19149),eh=t(4021),eb=t(27812),ey=t(79665),eg=t(77651),ex=t(46901),ej=t(73987),eI=t(6710),ew=t(77301),eS=t(27952),eZ=t(74231),eO=(0,eZ.Ry)().shape({dateReceived:(0,eZ.hT)().required(),amountReceived:(0,eZ.Rx)().required(),reason:(0,eZ.Z_)(),connectedAmount:(0,eZ.IX)().of((0,eZ.Ry)().shape({id:(0,eZ.Rx)().required(),outstandingAmount:(0,eZ.Rx)().required(),amount:(0,eZ.Rx)().max((0,eZ.iH)("outstandingAmount")).min(0).required()})).required()});function e_(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eP(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e_(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function eA(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return eC(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return eC(e,n)}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}function eC(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}var eT=function(e){var n,t,o=e.type,c=e.accountId,d=e.locationId,h=e.adminId,b=e.jobNumber,y=(e.refetch,e.toggleShow),g=e.numberPrefix,x=e.numberSuffix,j=e.invoicesForJobOnly,w=e.xeroCompanyId,S=e.xeroUserId,O=e.onSendCreditNotesToXero,P=(0,a.useContext)(ej.Z).user,$=(0,eo.x)({filters:null}),R=$.initialData,N=$.ref,F=(0,a.useState)(!1),E=F[0],L=F[1],B=(0,a.useState)(0),H=B[0],z=B[1],M=(0,a.useState)({error:!1,message:null}),U=M[0],J=M[1],G=(0,a.useState)(!1),W=G[0],Q=G[1],Y=(0,A.cI)({resolver:(0,ey.S)(eO)}),ei=Y.control,ea=Y.errors,ec=Y.getValues,es=Y.handleSubmit,eu=Y.register,ed=Y.setValue,em=(0,A.Dq)({control:ei,name:"connectedAmount"}).fields,ep=(0,A.qo)({control:ei,name:"amountReceived",defaultValue:0}),ef=(0,s.a)(u.v8,{variables:eP(eP({},R),{},{where:eP(eP({},(0,ee.Io)({accountId:c,locationId:d,adminId:h,jobNumber:b?"".concat(b):null,invoiceNumber:b?Number(b):null,type:["proformaInvoice","partial","unpaid"],invoicesForJobOnly:j})),{},{debit:{_gt:0},outstandingAmount:{_gt:0}}),locationId:d})}),ev=ef.data,eh=(ev=void 0===ev?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:ev).accountEntries,eZ=ev.meta,e_=ef.loading,eC=ef.refetch,eT=(0,_.D)(u.Vr,{onCompleted:(n=(0,r.Z)(i().mark(function e(n){var t,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null==n?void 0:null===(t=n.insert_AccountEntry_one)||void 0===t?void 0:t.id,!(w&&S&&r)){e.next=4;break}return e.next=4,O(r);case 4:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}),eD=(0,Z.Z)(eT,2),e$=eD[0],eR=eD[1].error,eN=(0,_.D)(u._0,{refetchQueries:function(){return["GetAccountEntries"]}}),eF=(0,Z.Z)(eN,1)[0],eE=(t=(0,r.Z)(i().mark(function e(n){var t,a,s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Q(!0),!(Number(H).toFixed(2)>Number(n.amountReceived).toFixed(2))){e.next=4;break}return e.abrupt("return",J({error:!0,message:"You can not reconcile more than credit note amount"}));case 4:if(!(Number(H).toFixed(2)<Number(n.amountReceived).toFixed(2))){e.next=6;break}return e.abrupt("return",J({error:!0,message:"You can not reconcile less than credit note amount"}));case 6:return t=n.connectedAmount.filter(function(e){return e.amount>0}),a={accountId:c,balance:0,credit:parseFloat(n.amountReceived).toFixed(2),currencyId:(0,ew.K)(c),debit:0,meta:{paymentReference:n.paymentReference,comment:n.paymentReference},type:"creditNote",paymentStatus:"creditNote",dateReceived:(0,eS.v)(n.dateReceived),PaymentReconciliations:{data:t.map(function(e){var n,t=e.amount;return{creditEntity:"CreditNote",debitEntity:"Invoice",debitEntityId:e.id,locationId:e.locationId,amount:t}})}},s=t.reduce(function(e,n){if(n.amount!==n.outstandingAmount)return e;var t=eh.find(function(e){return e.id===n.id}).invoices.map(function(e){return e.Job.id});return[].concat((0,eb.Z)(e),(0,eb.Z)(t))},[]),e.next=11,e$({variables:{object:a,jobIds:s,changes:{status:"".concat(o,"Paid"),paid:!0},timing:s.map(function(e){return{status:"".concat(o,"Paid"),jobId:e,userId:P.id}})}}).then((0,r.Z)(i().mark(function e(){var n,r,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=eA(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return o=r.value,e.next=7,eF({variables:{id:o.id,changes:{outstandingAmount:o.outstandingAmount-o.amount,balance:o.outstandingAmount-o.amount}}});case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])})));case 11:y();case 12:return e.prev=12,Q(!1),e.finish(12);case 15:case"end":return e.stop()}},e,null,[[0,,12,15]])})),function(e){return t.apply(this,arguments)}),eL={control:ei,errors:ea,register:eu},eB=function(){var e,n=ec();z((null==n?void 0:null===(e=n.connectedAmount)||void 0===e?void 0:e.reduce(function(e,n){return e+Number(n.amount)},0))||0),J({error:!1,message:""})},eH=function(e,n){ed(e,n),eB()},ez=function(e){var n=e.id,t=e.amount,r=e.index,o=e.locationId,i=e.outstandingAmount,a=e.invoices,c=Number(i).toFixed(2)===Number(t).toFixed(2)?"success":"info";return i||(c="danger"),(0,D.jsxs)(m.Z,{children:[(0,D.jsx)(k.Z,eP(eP({},eL),{},{name:"connectedAmount[".concat(r,"].id"),value:n,type:"hidden"})),(0,D.jsx)(k.Z,eP(eP({},eL),{},{name:"connectedAmount[".concat(r,"].invoices"),value:a,type:"hidden"})),(0,D.jsx)(k.Z,eP(eP({},eL),{},{name:"connectedAmount[".concat(r,"].locationId"),value:o,type:"hidden"})),(0,D.jsx)(k.Z,eP(eP({},eL),{},{name:"connectedAmount[".concat(r,"].outstandingAmount"),value:i,type:"hidden"})),(0,D.jsx)(ek,eP(eP({},eL),{},{context:E?c:null,name:"connectedAmount[".concat(r,"].amount"),onChange:eB,size:"sm",type:"number",step:"0.01",defaultValue:0})),(0,D.jsx)(p.Z,{context:"light","data-tip":"Button",onClick:function(){eH("connectedAmount[".concat(r,"].amount"),i)},size:"xs",title:"copy amount",children:(0,D.jsx)(X.Z,{context:"secondary",icon:"clone",size:"lg"})})]})},eM=(0,a.useMemo)(function(){return[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Number",formatter:function(e){var n=e.row;return"ppmInvoice"===n.type?"PM ".concat(n.invoiceNumber):(0,D.jsx)(er.D,{id:n.jobId,number:n.jobNumber,invoiceNumber:n.invoiceNumber,numberPrefix:g,numberSuffix:x,openCanvas:!0,type:n.jobType})}},{sortable:!0,sortName:"createdAt",text:"Date"},{sortable:!0,sortName:"daysOutstanding",text:"Days Outstanding"},{sortable:!0,sortName:"outstandingAmount",text:"Amount Outstanding",formatter:function(e){var n=e.row;return(0,l.Z)(n.outstandingAmount)}},{text:"Reconciled Amount",formatter:function(e){return ez(e.row)}}]},[]),eU=function(e){L(!E)};return((0,a.useEffect)(function(){ed("connectedAmount",eh.map(function(e,n){var t,r,o,i,a=null===(t=e.invoices)||void 0===t?void 0:t[0];return{index:n,id:e.id,type:e.type,jobId:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.id,locationId:e.locationId,jobNumber:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.number,jobType:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.type,invoiceNumber:null==a?void 0:a.invoiceNumber,date:(0,V.Z)(e.createdAt),daysOutstanding:e.outstandingdays,outstandingAmount:e.outstandingAmount,amount:0}}))},[eh]),(0,a.useEffect)(function(){if(E){var e=Number(ep);em.forEach(function(n,t){var r=e>=n.outstandingAmount?Number(n.outstandingAmount).toFixed(2):Number(e).toFixed(2);e-=r,ed("connectedAmount[".concat(n.index,"].amount"),r)}),eB()}},[ep,E,em]),(0,a.useEffect)(function(){eR?J({error:!0,message:null==eR?void 0:eR.message}):J(!1)},[eR]),W)?(0,D.jsx)(f.Z,{style:{justifyContent:"center",alignItems:"center"},children:(0,D.jsx)(K.Z,{size:30})}):(0,D.jsxs)(C.Z,{id:"offCanvasForm",handleSubmit:es(eE),children:[(0,D.jsx)(eg.Z,{open:null==U?void 0:U.error,autoHideDuration:6e3,onClose:function(){J({error:!1,message:null})},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,D.jsx)(ex.Z,{onClose:function(){return J({error:!1,message:null})},severity:"error",variant:"filled",sx:{width:"500px"},children:(null==U?void 0:U.message)||"Oops some error occurred. Please try again later"})}),(0,D.jsxs)(f.Z,{children:[(0,D.jsxs)(v.Z,{md:6,children:[(0,D.jsx)(q.Z,{label:"Date Received"}),(0,D.jsx)(el.M,eP(eP({},eL),{},{name:"dateReceived"}))]}),(0,D.jsx)(v.Z,{md:6,children:(0,D.jsx)(eq,{align:"center",children:(0,D.jsx)(T.Z,eP(eP({},eL),{},{name:"amountReceived",label:"Amount",vat:!0}))})})]}),(0,D.jsx)(f.Z,{children:(0,D.jsx)(v.Z,{md:6,children:(0,D.jsx)(q.Z,{label:"Reason",children:(0,D.jsx)(eI.Z,eP(eP({},eL),{},{name:"reason",rows:2}))})})}),(0,D.jsx)(q.Z,{label:"Auto reconcile",children:(0,D.jsx)(en.Z,eP(eP({},eL),{},{onToggle:function(e){return eU(e)},size:"sm",toggled:E}))}),(0,D.jsx)(et.t,{columns:eM,loading:e_,history:!1,meta:eZ,ref:N,refetch:eC,rows:em}),(0,D.jsx)(eq,{reverse:!0,pr:!0,children:(0,D.jsx)(I.Z,{content:"Sum: ".concat((0,l.Z)(H)),context:Number(H).toFixed(2)===Number(ep).toFixed(2)?"success":"danger"})})]})},eq=(0,g.ZP)(f.Z).withConfig({displayName:"creditNoteForm__StyledRow",componentId:"sc-x4vr2o-0"})(["padding-left:1rem;padding-right:",";flex-flow:",";"],function(e){return e.pr?"5rem":null},function(e){return e.reverse?"row-reverse":null}),ek=(0,g.ZP)(k.Z).withConfig({displayName:"creditNoteForm__StyledInput",componentId:"sc-x4vr2o-1"})(["border:1px solid ",";"],function(e){return e.theme.COLOUR[e.context]}),eD=t(51466),e$=function(e){var n=e.onFilter,t=(0,a.useState)(["creditNote","partial","paid","paymentReceipt","proformaInvoice","unpaid"]),r=t[0],o=t[1],i=function(e,t){var i;i=t?[].concat((0,eb.Z)(r),[e]):r.filter(function(n){return n!==e}),n(i),o(i)};return(0,D.jsxs)(f.Z,{children:[(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"dark",onToggle:function(e){return i("creditNote",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Credit Note"})]}),(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"black",onToggle:function(e){return i("paymentReceipt",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Payment"})]}),(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"danger",onToggle:function(e){return i("proformaInvoice",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Proforma Invoice"})]}),(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"danger",onToggle:function(e){return i("unpaid",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Unpaid"})]}),(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"female",onToggle:function(e){return i("partial",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Partially Paid"})]}),(0,D.jsxs)(eR,{md:2,children:[(0,D.jsx)(en.Z,{context:"success",onToggle:function(e){return i("paid",e)},size:"sm",toggled:!0}),(0,D.jsx)(W.Z,{marginLeft:"sm"}),(0,D.jsx)(eD.Z,{size:"sm",children:"Paid"})]})]})},eR=(0,g.ZP)(v.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-116hl20-0"})(["align-items:center;display:flex;"]),eN=t(61497),eF=t(48829),eE=t(72936),eL=t(55863),eB=t(94568),eH=t(33816),ez=t(46718),eM=t(58095);function eU(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function eX(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?eU(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):eU(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var eJ=function(e){var n,t,o,d,b,y,g=e.type,x=e.accountId,w=e.accountName,S=e.edit,O=e.locationId,_=e.xeroUserId,P=e.xeroCompanyId,T=e.showXeroSyncButton,q=e.onClickXeroSync,$=e.onSendEntitiesToXero,R=e.onSendPaymentToXero,N=e.onReceiveUpdatesFromXero,F=(0,a.useState)(!1),E=F[0],L=F[1],B=(0,eM.a)(),M=(0,eE.x)().user,Y=(0,H.x)(),en=M.adminId,ea=(0,eL.q)(),ec=null===(n=ea.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,es=null===(t=ea.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,ed=(0,c.useRouter)().query,em={endDate:ed.endDate&&new Date(ed.endDate),outstandingLevel:ed.outstandingLevel,startDate:ed.startDate&&new Date(ed.startDate),type:["creditNote","paymentReceipt","proformaInvoice","ppmInvoice","partial","paid","unpaid"]},eb=(0,a.useState)(em),ey=eb[0],eg=eb[1],ex=ey.endDate,ej=ey.invoiceNumber,eI=ey.outstandingLevel,ew=ey.startDate,eS=ey.type,eZ=ey.paymentStatus,eO=(0,eo.x)({filters:ey}),e_=eO.initialData,eP=eO.ref,eA=(0,A.cI)({defaultValues:{endDate:ex,invoiceNumber:ej,outstandingLevel:eI,startDate:ew}}),eC=eA.control,eq=eA.errors,ek=eA.handleSubmit,eD=eA.register,eR=/^\d+$/.test(ej),eU=(0,s.a)(u.v8,{fetchPolicy:"no-cache",variables:eX(eX({},e_),{},{where:eX({},(0,ee.Io)({outstandingLevel:eI,adminId:en,accountId:x,to:ex,from:ew,locationId:O,jobNumber:eR?"".concat(ej):null,type:eS})),locationId:O})}),eJ=eU.data,eW=(eJ=void 0===eJ?{accountEntries:[],balances:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0},balance:{balance:0}}}}:eJ).accountEntries,eQ=eJ.meta,eY=eU.loading,eK=eU.refetch,e0=eQ.aggregate.debitTotal.debit,e1=eQ.aggregate.creditTotal.credit,e2=function(){B.show({content:(0,D.jsx)(eh.q,{type:g,accountId:x,locationId:O,adminId:en,refetch:eK,numberPrefix:ec,numberSuffix:es,toggleShow:B.close,invoicesForJobOnly:!1,xeroUserId:_,xeroCompanyId:P,onSendPaymentToXero:R}),title:"Add Payment Received",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e6=function(){B.show({content:(0,D.jsx)(eT,{type:g,accountId:x,locationId:O,adminId:en,refetch:eK,toggleShow:B.close,numberPrefix:ec,numberSuffix:es,xeroUserId:_,xeroCompanyId:P,onSendCreditNotesToXero:e7}),title:"Add credit note",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e5=function(){B.show({content:(0,D.jsx)(eu,{accountId:x,locationId:O,adminId:en,toggleShow:B.close,onSendEntities:e8}),title:"Send Account Entries to Xero",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},e3=function(e){var n=e.adminId,t=e.endDate,r=e.accountId,o=e.invoiceNumber,i=e.locationId,a=e.outstandingLevel,c=e.startDate,s=e.queryIsNumber,d=e.type,l=e.showXeroSyncButton,m=e.onClickXeroSync,f=(0,z.t)(u.UA,{variables:{where:eX({},(0,ee.Io)({outstandingLevel:a,adminId:n,accountId:r,to:t,from:c,locationId:i,jobNumber:s?"".concat(o):null,type:d})),locationId:i},onCompleted:function(e){var n=(0,ee.yG)(e.accountEntries,{numberPrefix:ec,numberSuffix:es}),t=U().unparse(n),r="data:application/octet-stream,"+encodeURIComponent(t);(0,eF.S)(r,"account-entries.csv")}}),v=(0,Z.Z)(f,2),h=v[0],b=v[1].loading,y=function(){ep({adminId:n,accountId:r,locationId:i,from:c,invoiceNumber:s?Number(o):null,jobId:s?"".concat(o):null,outstandingLevel:a>0?a:null,to:t,type:d})};return(0,D.jsxs)(eG,{children:[!!_&&l&&(0,D.jsx)(p.Z,{context:"info",style:{marginRight:"10px"},onClick:function(e){e.preventDefault(),e.stopPropagation(),m()},title:"Login Xero",size:"md",children:"Connect to Xero"}),!!_&&!l&&(0,D.jsx)(p.Z,{context:"info",style:{marginRight:"10px"},onClick:function(e){e.preventDefault(),e.stopPropagation(),e5()},title:"Group sync Entries with Xero",size:"md",children:"Send Account Entries to Xero"}),!(0,eB.s)()&&(0,D.jsx)(p.Z,{disabled:b,context:"white",onClick:function(e){e.preventDefault(),e.stopPropagation(),h()},title:"Export to CSV",size:"md",children:b?(0,D.jsx)(K.Z,{size:30}):(0,D.jsx)(X.Z,{context:"secondary",icon:"file-csv",size:"lg"})}),(0,D.jsx)(p.Z,{disabled:!0,context:"white",onClick:function(e){e.preventDefault(),e.stopPropagation(),y()},title:"Export to PDF",children:(0,D.jsx)(X.Z,{context:"secondary",icon:"file-pdf",size:"lg"})})]})},e9=(o=(0,r.Z)(i().mark(function e(n,t){var r,o,a,c,s,u,d,l,m;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),n.stopPropagation(),o=void 0===(r=t.invoice)?{}:r,e.t0=t.itemType,e.next="proformaInvoice"===e.t0?6:"invoice"===e.t0?12:"ppmInvoice"===e.t0?14:21;break;case 6:return e.next=8,Y.query({query:eH.WG,variables:{id:o.id}});case 8:return s=e.sent.data.invoice,(0,ev.u)({meta:null==s?void 0:null===(a=s.accountEntry)||void 0===a?void 0:a.meta,invoice:s}),e.abrupt("break",22);case 12:return(0,ef._Z)({client:Y,jobId:t.jobId,type:o.invoiceType}),e.abrupt("break",22);case 14:return e.next=16,Y.query({query:eH.By,variables:{jobId:t.jobId,invoiceType:o.invoiceType}});case 16:return m=null==(l=e.sent.data.invoices)?void 0:l[0],(0,ez.$)(null==m?void 0:null===(u=m.accountEntry)||void 0===u?void 0:u.meta),e.abrupt("break",22);case 21:return e.abrupt("break",22);case 22:case"end":return e.stop()}},e)})),function(e,n){return o.apply(this,arguments)}),e4=(d=(0,r.Z)(i().mark(function e(n,t){var r,o,a,c,s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),n.stopPropagation(),r=t.id,o=t.itemType,c=void 0===(a=t.invoice)?[]:a,s=[],"creditNote"===o?s.push({entity:"creditNote",id:r}):s.push({entity:o,invoiceType:c.invoiceType||null,invoiceId:r||null}),e.next=7,e8(s);case 7:case"end":return e.stop()}},e)})),function(e,n){return d.apply(this,arguments)}),e7=(b=(0,r.Z)(i().mark(function e(n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return L(!0),e.next=3,e8([{entity:"creditNote",id:n}]);case 3:case"end":return e.stop()}},e)})),function(e){return b.apply(this,arguments)}),e8=(y=(0,r.Z)(i().mark(function e(n,t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:L(!0),$({accountId:x,entities:n}).then(function(){eK(),L(!1),B.close(),t&&t()});case 2:case"end":return e.stop()}},e)})),function(e,n){return y.apply(this,arguments)}),ne=[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row,t=e.row.itemType;return(0,D.jsx)(eV,{content:t,row:n,size:"sm"})},text:"Type"},{hidden:!0},{text:"Number",formatter:function(e){var n=e.row;return"ppmInvoice"===n.itemType?"PM ".concat(null==n?void 0:n.invoiceNumber):(0,D.jsx)(er.D,{id:n.jobId,number:n.number,invoiceNumber:null==n?void 0:n.invoiceNumber,numberPrefix:ec,numberSuffix:es,openCanvas:!!n.jobId,type:n.jobType})}},{hidden:!0},{text:"Reference"},{hidden:!0},{text:"Date"},{hidden:!S,text:"Days Outstanding"},{hidden:!0,text:"Service"},{hidden:!0},{text:"Amount Outstanding",formatter:function(e){var n=e.row;return"creditNote"===n.itemType||"paymentReceipt"===n.itemType?"-":(0,l.Z)(n.outstandingAmount)}},{text:"Status",formatter:function(e){var n=e.row;return n.status?(0,D.jsx)(ei.B,{value:n.status}):""}},{text:"Debit",formatter:function(e){var n=e.row;return n.debit?(0,l.Z)(n.debit):"-"}},{text:"Credit",formatter:function(e){var n=e.row;return n.credit?(0,l.Z)(n.credit):"-"}},{text:"Balance",formatter:function(e){var n=e.row;return(0,l.Z)(n.balance)}},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:J.Z,formatterData:function(e){var n,t,r,o,i=[{context:"secondary",icon:["fas","download"],onClick:function(e,n){return e9(e,n)},tooltip:"Download",disabled:"creditNote"===e.itemType||"paymentReceipt"===e.itemType}];return _&&!(null!==(n=e.meta)&&void 0!==n&&n.xeroInvoiceId||null!==(t=e.meta)&&void 0!==t&&t.xeroCreditNoteId)&&"paymentReceipt"!==e.itemType&&"creditNote"!==e.itemType&&i.unshift({context:"primary",icon:["fas","circle"],onClick:function(e,n){return e4(e,n)},tooltip:"Sync invoice with Xero",disabled:T||E}),_&&null!==(r=e.meta)&&void 0!==r&&r.xeroInvoiceId&&(i.unshift({context:"primary",icon:["fas","check"],tooltip:"Sync",disabled:!0}),null!==(o=e.meta)&&void 0!==o&&o.syncedWithXero||i.unshift({context:"info",icon:["fas","circle"],onClick:function(e,n){return N(e,n)},tooltip:"Invoice has changes in Xero. Click to update it in Cleverly"})),i},text:"Actions"}],nn=function(e){B.show({content:(0,D.jsx)(Q.u,{type:g,accountEntryType:e.itemType,data:e,numberSuffix:es,numberPrefix:ec,refetch:eK,toggleShow:B.close}),title:"Account Entry Details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},nt=function(e){e.invoiceNumber||e.startDate||e.endDate||e.outstandingLevel?eg(eX(eX({},ey),{},{endDate:e.endDate,invoiceNumber:e.invoiceNumber?e.invoiceNumber:null,outstandingLevel:e.outstandingLevel,startDate:e.startDate})):Array.isArray(e)?eg(eX(eX({},ey),{},{type:e})):eg(em)},nr={control:eC,errors:eq,register:eD};return(0,D.jsxs)(h.Z,{open:!0,title:"Account Entries",toolbar:(0,D.jsx)(e3,{adminId:en,accountId:x,accountName:w,endDate:ex,invoiceNumber:ej,locationId:O,outstandingLevel:eI,startDate:ew,queryIsNumber:eR,type:eS,paymentStatus:eZ,showXeroSyncButton:T,onClickXeroSync:q}),children:[(0,D.jsxs)(C.Z,{handleSubmit:ek(nt),children:[(0,D.jsxs)(f.Z,{children:[(0,D.jsx)(v.Z,{md:2,children:(0,D.jsx)(el.M,eX(eX({},nr),{},{name:"startDate",placeholder:"Start date"}))}),(0,D.jsx)(v.Z,{md:2,children:(0,D.jsx)(el.M,eX(eX({},nr),{},{name:"endDate",placeholder:"End date"}))}),(0,D.jsx)(v.Z,{md:3,children:(0,D.jsx)(k.Z,eX(eX({},nr),{},{name:"invoiceNumber",placeholder:"Id / Invoice"}))}),(0,D.jsx)(v.Z,{md:3,children:(0,D.jsx)(G.Z,eX(eX({},nr),{},{name:"outstandingLevel",options:eN.r}))}),(0,D.jsx)(v.Z,{md:1,children:(0,D.jsx)(p.Z,{content:"Filter",context:"secondary",size:"sm",type:"submit"})})]}),(0,D.jsx)(W.Z,{marginBottom:"md"}),(0,D.jsx)(e$,{onFilter:nt})]}),(0,D.jsx)(et.t,{columns:ne,loading:eY,meta:eQ,ref:eP,refetch:eK,rowClick:nn,rows:eW.map(function(e){var n,t,r,o,i,a,c,s,u,d,l,m,p,f="creditNote"!==e.type&&"paymentReceipt"!==e.type?e.outstandingdays:"-",v=null===(n=e.invoices)||void 0===n?void 0:n[0];return{id:e.id,jobId:null==v?void 0:null===(t=v.Job)||void 0===t?void 0:t.id,jobIds:null===(r=e.invoices)||void 0===r?void 0:r.map(function(e){var n;return null==e?void 0:null===(n=e.job)||void 0===n?void 0:n.id}),number:null==v?void 0:null===(o=v.Job)||void 0===o?void 0:o.number,itemType:e.type,jobType:null==v?void 0:null===(i=v.Job)||void 0===i?void 0:i.type,invoiceNumber:null==v?void 0:v.invoiceNumber,invoice:v,reference:e.reference||(null===(a=e.meta)||void 0===a?void 0:a.paymentReference),comment:null===(c=e.meta)||void 0===c?void 0:c.comment,date:(0,V.Z)(e.createdAt),outstandingDays:f,service:null==v?void 0:null===(s=v.Job)||void 0===s?void 0:null===(u=s.service)||void 0===u?void 0:u.name,address:null==v?void 0:null===(d=v.Job)||void 0===d?void 0:null===(l=d.location)||void 0===l?void 0:l.name,outstandingAmount:e.outstandingAmount,status:null==v?void 0:null===(m=v.Job)||void 0===m?void 0:m.status,debit:e.debit,credit:e.credit,balance:e.balance,paid:null==v?void 0:null===(p=v.Job)||void 0===p?void 0:p.paid,paymentStatus:e.paymentStatus,entryId:e.entryId,meta:e.meta,actions:""}})}),(0,D.jsx)(W.Z,{marginBottom:"md"}),(0,D.jsx)(f.Z,{children:(0,D.jsxs)(v.Z,{md:12,style:{textAlign:"end"},children:[(0,D.jsx)(I.Z,{content:"Total Debit: ".concat((0,l.Z)(e0)),context:"info",size:"sm"}),(0,D.jsx)(I.Z,{content:"Total Credit: ".concat((0,l.Z)(e1)),context:"info",size:"sm"}),(0,D.jsx)(I.Z,{content:"Balance:".concat((0,l.Z)(e0-e1)),context:"".concat(e0-e1<0?"warning":"success"),size:"sm"})]})}),(0,D.jsx)(j.Z,{size:"sm"}),(0,D.jsx)(m.Z,{align:"flex-end",children:S&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(p.Z,{content:"Add Payment Received",context:"secondary",onClick:e2,size:"sm"}),"customer"===g&&(0,D.jsx)(p.Z,{content:"Add Credit note",context:"secondary",onClick:e6,size:"sm"})]})})]})},eV=(0,g.ZP)(I.Z).withConfig({displayName:"accountEntries__StyledBadge",componentId:"sc-1ab0cpy-0"})(["background-color:",";"],function(e){return(0,ee.Lq)(e.row,e.theme)}),eG=g.ZP.div.withConfig({displayName:"accountEntries__StyledToolbar",componentId:"sc-1ab0cpy-1"})(["float:right;"]);eJ.defaultProps={edit:!0};var eW=t(4730),eQ=t(32979),eY=(0,eZ.Ry)().shape({serviceRateType:(0,eZ.Z_)().when("rateType",{is:"serviceRate",then:(0,eZ.Z_)().oneOf(["grossPercent","costPlus"]).required("This field is required!")}),serviceRateLabour:(0,eZ.Rx)().when("rateType",{is:"serviceRate",then:(0,eZ.Rx)().min(0).required()}),serviceRateExpenses:(0,eZ.Rx)().when("rateType",{is:"serviceRate",then:(0,eZ.Rx)().min(0).required()}),arrangementFee:(0,eZ.Rx)().when("rateType",{is:"rebate",then:(0,eZ.Rx)().min(0).lessThan(100,"Rebate can`t be more than 99.99%").required()}),approvalThreshold:(0,eZ.Rx)().min(0).required(),spendThreshold:(0,eZ.Rx)().min(0).required(),invoiceDueDate:(0,eZ.Rx)().min(0).required()}),eK=t(77010),e0=t(73845),e1=t(5616),e2=t(21023),e6=t(48999),e5=t(10166),e3=["className"];function e9(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function e4(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?e9(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e9(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var e7=function(e){var n,t,o=e.accountId,a=e.meta,c=e.refetch,s=e.toggleShow,u=(0,H.x)(),d=e4({},null==a?void 0:a.finance)||{},l=(0,A.cI)({defaultValues:{approvalThreshold:d.approvalThreshold||0,arrangementFee:d.arrangementFee||0,serviceRateLabour:d.serviceRateLabour||0,serviceRateExpenses:d.serviceRateExpenses||0,spendThreshold:d.spendThreshold||0,invoiceDueDate:d.invoiceDueDate||0,rateType:(d.serviceRateLabour||d.serviceRateExpenses)&&"serviceRate"||d.arrangementFee&&"rebate",serviceRateType:d.serviceRateType},resolver:(0,ey.S)(eY)}),m=l.errors,p=l.handleSubmit,f=l.register,v=l.watch,h=l.control,b=(0,_.D)(P.Wn,{onCompleted:(n=(0,r.Z)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,e0.j)({client:u,customerId:o});case 2:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})}),y=(0,Z.Z)(b,1)[0],g=(t=(0,r.Z)(i().mark(function e(n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y({variables:{customerId:o,customer:j(n),hasUpdateUser:!1,userId:o}}).then(function(){c(),s()});case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),x=v("rateType"),j=function(e){var n={};return n.meta=e4({},a)||{},n.meta.finance=d||{},"serviceRate"===x?(n.meta.finance.serviceRateType=e.serviceRateType,n.meta.finance.serviceRateLabour=e.serviceRateLabour,n.meta.finance.serviceRateExpenses=e.serviceRateExpenses,n.meta.finance.arrangementFee=0):"rebate"===x&&(n.meta.finance.serviceRateLabour=0,n.meta.finance.serviceRateExpenses=0,n.meta.finance.arrangementFee=e.arrangementFee),n.meta.finance.approvalThreshold=e.approvalThreshold,n.meta.finance.spendThreshold=e.spendThreshold,n.meta.finance.invoiceDueDate=e.invoiceDueDate,n},I={errors:m,register:f,type:"number"},w={direction:"row",sx:{"& .MuiTypography-root":{fontFamily:"Arial,sans-serif,sans-serif"}}},S=function(e){return function(n){var t=n.children;return(0,D.jsx)(e8,{title:e,children:t})}};return(0,D.jsxs)(C.Z,{id:"offCanvasForm",handleSubmit:p(g),children:[(0,D.jsx)(e1.Z,{children:(0,D.jsx)(A.Qr,{name:"rateType",control:h,render:function(e){var n,t=e.value,r=e.onChange;return(0,D.jsx)(eK.E,{stackProps:w,formControlProps:{sx:{m:0}},value:t,onChange:r,options:[{label:"Service Rate",value:"serviceRate"},{label:"Rebate",value:"rebate"}],error:m.rateType,helperText:null===(n=m.rateType)||void 0===n?void 0:n.message})}})}),"serviceRate"===x&&(0,D.jsxs)(e1.Z,{children:[(0,D.jsx)(A.Qr,{name:"serviceRateType",control:h,render:function(e){var n,t=e.value,r=e.onChange;return(0,D.jsx)(eK.E,{stackProps:w,formControlProps:{sx:{m:0}},value:t,onChange:r,options:[{label:"% of Gross",value:"grossPercent",ParentComponent:S("This will calculate your service rate as a % of the customer invoice e.g.\n                      if this is 5%, you will earn \xa35 on a \xa3100 customer invoice.")},{label:"Cost plus",value:"costPlus",ParentComponent:S("Cost plus will add the percentage indicated to the supplier amount e.g.\n                      if this is 5% on a \xa3100 supplier invoice, customer invoice will be \xa3105.")}],error:m.serviceRateType,helperText:null===(n=m.serviceRateType)||void 0===n?void 0:n.message})}}),(0,D.jsxs)(q.Z,{label:"Service Rate",children:[(0,D.jsx)(eQ.Z,e4(e4({},I),{},{label:"Labour",name:"serviceRateLabour"})),(0,D.jsx)(eQ.Z,e4(e4({},I),{},{label:"Expenses and Materials",name:"serviceRateExpenses"}))]})]}),"rebate"===x&&(0,D.jsx)(eQ.Z,e4(e4({},I),{},{label:"Rebate",name:"arrangementFee"})),(0,D.jsx)(T.Z,e4(e4({},I),{},{label:"Approval Threshold",name:"approvalThreshold"})),(0,D.jsx)(T.Z,e4(e4({},I),{},{label:"Spend Threshold",name:"spendThreshold"})),(0,D.jsx)(q.Z,{label:"Invoice Due Date",children:(0,D.jsx)(k.Z,e4(e4({},I),{},{name:"invoiceDueDate"}))})]})},e8=(0,e5.Z)(function(e){var n=e.className,t=(0,eW.Z)(e,e3);return(0,D.jsx)(e2.Z,e4(e4({},t),{},{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,O.Z)({},"& .".concat(e6.Z.tooltip),{backgroundColor:n.palette.dark.main,boxShadow:n.shadows[1],fontSize:13})}),ne=(0,eZ.Ry)().shape({code:(0,eZ.Z_)()});function nn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function nt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nn(Object(t),!0).forEach(function(n){(0,O.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var nr=function(e){var n,t=e.onSuccess,o=e.meta,a=e.accountId,c={code:null==o?void 0:o.sageCode},s=(0,A.cI)({defaultValues:c,resolver:(0,ey.S)(ne)}),u=s.control,d=s.errors,l=s.handleSubmit,m=s.register,p=(0,_.D)(P.Wn,{onCompleted:t}),f=(0,Z.Z)(p,2),v=f[0],h=f[1].error,b=(n=(0,r.Z)(i().mark(function e(n){var t,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.code,(r=nt({},o)||{}).sageCode=t,v({variables:{customerId:a,customer:{meta:r}}});case 4:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)});return(0,D.jsxs)(C.Z,{id:"offCanvasForm",handleSubmit:l(b),children:[(0,D.jsx)(q.Z,{label:"Sage Code",children:(0,D.jsx)(k.Z,nt(nt({},{control:u,errors:d,register:m}),{},{name:"code"}))}),(0,D.jsx)(eD.Z,{children:null==h?void 0:h.message})]})},no=t(40755),ni=function(e){var n=e.type,t=e.accountId,o=e.accountName,g=e.accountRefetch,x=e.locationId,j=e.meta,I=e.hasSageIntegration,w=(0,a.useState)(!1),S=w[0],Z=w[1],O=(0,c.useRouter)().query,_=(0,eE.x)(),P=_.hasRole,A=_.user,C=(0,no.RM)(null==A?void 0:A.id),T=(0,eM.a)(),q=(0,a.useContext)(d.Z),k=P("admin"),$=(0,s.a)(u.Dn,{variables:{accountId:t}}),R=$.data,N=(R=void 0===R?{financial:{}}:R).financial,F=$.loading,E=$.refetch,B=(0,no.BR)({adminId:A.id,xeroClientId:null==O?void 0:O.clientId,onSaveXeroTokenCallback:function(){return E()}},[A]),H=B.tokenStatus,z=B.onCallAuthorize,M=B.onCallRefreshToken,U=B.onSendEntitiesToXero,X=B.onSendPaymentToXero,J=B.onReceiveUpdatesFromXero;(0,a.useEffect)(function(){"unauthenticated"===H||"disconnected"===H?Z(!0):Z(!1)},[H]);var V=(null==j?void 0:j.finance)||{},G=N.bankAccounts,W=function(){q.close(),g()},Q=function(e){e.stopPropagation(),q.show({content:(0,D.jsx)(nr,{meta:j,onSuccess:W,accountId:t}),title:null!=j&&j.sageCode?"Add Sage Code":"Update Sage Code"})},Y=function(e){e.stopPropagation(),T.show({content:(0,D.jsx)(e7,{accountId:t,meta:j,refetch:g,toggleShow:T.close}),title:"Edit Finance Details"})};if(F)return null;var K,ee,en,et,er,eo=function(){return(0,D.jsx)(m.Z,{children:(0,D.jsx)(p.Z,{context:"secondary",content:"Edit",onClick:Y,size:"sm"})})},ei=function(){return(0,D.jsx)(m.Z,{children:(0,D.jsx)(p.Z,{context:"secondary",content:"Edit",onClick:Q,size:"sm"})})},ea=(K=(0,r.Z)(i().mark(function e(n,r){var o,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),n.stopPropagation(),e.next=4,J((null===(o=r.meta)||void 0===o?void 0:o.xeroInvoiceId)||(null===(a=r.meta)||void 0===a?void 0:a.xeroCreditNoteId),null==C?void 0:C.companyId,t);case 4:E();case 5:case"end":return e.stop()}},e)})),function(e,n){return K.apply(this,arguments)});return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(f.Z,{children:(0,D.jsx)(v.Z,{md:12,children:(0,D.jsx)(eJ,{type:n,accountId:t,accountName:o,edit:k,locationId:x,meta:j,xeroCompanyId:null==C?void 0:C.companyId,xeroUserId:null==C?void 0:C.clientId,refetchXeroToken:M,showXeroSyncButton:S,onSendEntitiesToXero:U,onClickXeroSync:function(){return z(window.location.href)},onSendPaymentToXero:X,onReceiveUpdatesFromXero:ea})})}),P("admin")&&(0,D.jsxs)(f.Z,{children:[(0,D.jsxs)(v.Z,{md:"customer"===n?6:12,children:["customer"===n&&(0,D.jsx)(h.Z,{toolbar:k&&(0,D.jsx)(eo,{}),title:"Overview",open:!0,children:(0,D.jsx)(b.Z,{rows:[{key:"Service Rate Labour",value:"".concat(V.serviceRateLabour||0,"%")},{key:"Service Rate Expenses and Materials",value:"".concat(V.serviceRateExpenses||0,"%")},{key:"Rebate",value:"".concat((null==V?void 0:V.arrangementFee)||0,"%")},{key:"Approval Threshold",value:(0,l.Z)(null!==(ee=null==V?void 0:V.approvalThreshold)&&void 0!==ee?ee:0)},{key:"Spend Threshold",value:(0,l.Z)(null!==(en=null==V?void 0:V.spendThreshold)&&void 0!==en?en:0)},{key:"Stripe ID",value:V.stripeId||"-"},{key:"Invoice Due Date",value:V.invoiceDueDate||"-"}]})}),(0,D.jsx)(y.y,{accountId:t,data:G,edit:k,refetch:g}),"customer"===n&&(0,D.jsx)(h.Z,{toolbar:(0,D.jsx)(ei,{}),title:"Integration",open:!0,children:(0,D.jsx)(b.Z,{rows:(er=[],I&&er.push({key:"Sage Code",value:(null==j?void 0:null===(et=j.sageCode)||void 0===et?void 0:et.length)>0?null==j?void 0:j.sageCode:"not set"}),er)})})]}),(0,D.jsxs)(v.Z,{md:6,children:["customer"===n&&(0,D.jsx)(h.Z,{title:"Balance",open:!0,children:(0,D.jsx)(b.Z,{rows:[{key:"Total Outstanding",value:(0,l.Z)(V.amountOutstanding||0)},{key:"Total Revenues",value:(0,l.Z)(V.totalRevenue||0)}]})}),"customer"===n&&(0,D.jsx)(L,{accountId:t,edit:k,meta:j,offCanvas:T,refetch:g,customerBalance:0})]})]})]})}},8633:function(e,n,t){t.d(n,{FY:function(){return r},hm:function(){return o},jT:function(){return i}});var r={status:"active",service:null,coverageAreas:[],minimumDuration:"",minimumIncrement:"",normal:{firstHour:"",subsequentHours:""},ooh:{firstHour:"",subsequentHours:""},premium:{firstHour:"",subsequentHours:""},oohTimes:{},premiumTimes:{},days:[]},o=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],i=[{value:"monday",label:"Monday"},{value:"tuesday",label:"Tuesday"},{value:"wednesday",label:"Wednesday"},{value:"thursday",label:"Thursday"},{value:"friday",label:"Friday"},{value:"saturday",label:"Saturday"},{value:"sunday",label:"Sunday"}]},31962:function(e,n,t){t.d(n,{k:function(){return v}});var r=t(59499),o=t(86886),i=t(15861),a=t(26447),c=t(50135),s=t(15772),u=t(30381),d=t.n(u),l=t(42283),m=t(85893);function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var v=function(e){var n=e.control,t=e.error,r=(e.helperText,e.name),u=e.day;return(0,m.jsxs)(o.ZP,{container:!0,children:[(0,m.jsx)(o.ZP,{item:!0,xs:2,children:(0,m.jsx)(i.Z,{children:u})}),(0,m.jsx)(o.ZP,{item:!0,xs:10,children:(0,m.jsxs)(a.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[(0,m.jsx)(l.Qr,{control:n,name:"".concat(r,".firstFrom"),render:function(e){var n=e.value,r=e.onChange;return(0,m.jsx)(s.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){return r(d()(e).toISOString())},renderInput:function(e){return(0,m.jsx)(c.Z,f(f({},e),{},{variant:"standard",color:"secondary",size:"small",sx:{width:"100px"},error:t}))}})}}),(0,m.jsx)(i.Z,{children:"to"}),(0,m.jsx)(l.Qr,{control:n,name:"".concat(r,".firstTo"),render:function(e){var n=e.value,r=e.onChange;return(0,m.jsx)(s.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){return r(d()(e).toISOString())},renderInput:function(e){return(0,m.jsx)(c.Z,f(f({},e),{},{variant:"standard",color:"secondary",size:"small",sx:{width:"100px"},error:t}))}})}}),(0,m.jsx)(i.Z,{children:"and"}),(0,m.jsx)(l.Qr,{control:n,name:"".concat(r,".secondFrom"),render:function(e){var n=e.value,r=e.onChange;return(0,m.jsx)(s.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){return r(d()(e).toISOString())},renderInput:function(e){return(0,m.jsx)(c.Z,f(f({},e),{},{variant:"standard",color:"secondary",size:"small",sx:{width:"100px"},error:t}))}})}}),(0,m.jsx)(i.Z,{children:"to"}),(0,m.jsx)(l.Qr,{control:n,name:"".concat(r,".secondTo"),render:function(e){var n=e.value,r=e.onChange;return(0,m.jsx)(s.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){return r(d()(e).toISOString())},renderInput:function(e){return(0,m.jsx)(c.Z,f(f({},e),{},{variant:"standard",color:"secondary",size:"small",sx:{width:"100px"},error:t}))}})}})]})})]})}},78913:function(e,n,t){t.d(n,{AL:function(){return i},Ty:function(){return r},_L:function(){return a},dB:function(){return c},ee:function(){return o}});var r=function(e){return{service:{value:e.service.id,label:e.service.name},schedule:{value:e.id,label:e.name},status:e.status,priority:e.slas.map(function(e){return{value:e.sla.id,label:e.sla.name}}),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,coverageAreas:e.postcodeAreas.map(function(e){return{id:e.postcode.id,name:e.postcode.name,area:e.postcode.area}}),location:e.locations.map(function(e){return{value:e.location.id,label:e.location.name}}),normal:{firstHour:e.normal.firstHour,subsequentHours:e.normal.subsequentHours},ooh:{firstHour:e.ooh.firstHour,subsequentHours:e.ooh.subsequentHours},premium:{firstHour:e.premium.firstHour,subsequentHours:e.premium.subsequentHours},oohTimes:e.oohTimes,premiumTimes:e.premiumTimes,days:e.days||[]}},o=function(e){var n,t,r,o=e.form;return{entity:e.entity,entityId:e.entityId,serviceId:o.service.value,schedule:o.scheduleName,status:o.status,priority:o.priority.map(function(e){return e.value}),minimumDuration:o.minimumDuration,minimumIncrement:o.minimumIncrement,coverageAreas:null!==(n=o.coverageAreas)&&void 0!==n&&n.length?o.coverageAreas.map(function(e){return e.id}):null,location:null===(t=o.location)||void 0===t?void 0:t.map(function(e){return e.value}),normal:{firstHour:o.normal.firstHour,subsequentHours:o.normal.subsequentHours},ooh:{firstHour:o.ooh.firstHour,subsequentHours:o.ooh.subsequentHours},premium:{firstHour:o.premium.firstHour,subsequentHours:o.premium.subsequentHours},oohTimes:o.oohTimes,premiumTimes:o.premiumTimes,days:o.days}},i=function(e){e.defaultScheduleId,e.scheduleId;var n=e.entity,t=e.entityId,r=e.editMode;return"Customer"===n?r?{entity:"Customer",entityId:t}:{entity:"System-Customer"}:"Supplier"===n?r?{entity:"Supplier",entityId:t}:{entity:"System-Supplier"}:"Location"===n?r?{entity:"Location",entityId:t}:{entity:"System-Customer"}:{}},a=function(e){var n,t,r=e.form,o=e.entity;return{entity:o,entityId:e.entityId,serviceId:r.service.value,schedule:r.schedule.label,status:r.status,priority:r.priority.map(function(e){return e.value}),minimumDuration:r.minimumDuration,minimumIncrement:r.minimumIncrement,coverageAreas:null!==(n=r.coverageAreas)&&void 0!==n&&n.length&&"Supplier"===o?r.coverageAreas.map(function(e){return e.id}):null,location:null===(t=r.location)||void 0===t?void 0:t.map(function(e){return e.value}),normal:{firstHour:r.normal.firstHour,subsequentHours:r.normal.subsequentHours},ooh:{firstHour:r.ooh.firstHour,subsequentHours:r.ooh.subsequentHours},premium:{firstHour:r.premium.firstHour,subsequentHours:r.premium.subsequentHours},oohTimes:r.oohTimes,premiumTimes:r.premiumTimes,days:r.days,parentId:r.schedule.value}},c=function(e){var n=e.areas,t=void 0===n?[]:n;return null!=t&&t.length?{Addresses:{registered:{_eq:!0},Address:{_or:t.map(function(e){return{postCode:{_iregex:"^".concat(e,"([0-9]+).*?[A-Z0-9]{3}")}}})}}}:{}}},60084:function(e,n,t){t.d(n,{r:function(){return s}});var r=t(30381),o=t.n(r),i=t(74231),a=i.Ry().shape({firstFrom:i.Z_().nullable(),firstTo:i.Z_().nullable(),secondFrom:i.Z_().nullable(),secondTo:i.Z_().nullable()}),c=i.Ry().shape({monday:a.nullable(),tuesday:a.nullable(),wednesday:a.nullable(),thursday:a.nullable(),friday:a.nullable(),saturday:a.nullable(),sunday:a.nullable()}),s=i.Ry().shape({service:i.Ry({label:i.Z_().required("Service is required"),value:i.Rx().integer().required("Service is required")}).required("Service is required").typeError("Service is required"),priority:i.IX().of(i.Ry({label:i.Z_().required("Priority is required"),value:i.Rx().integer().required("Priority is required")}).required("Priority is required").typeError("Priority is required")).required("Priority is required").typeError("Priority is required"),minimumDuration:i.Rx().integer().min(0).required(""),minimumIncrement:i.Rx().integer().min(0).required(""),normal:i.Ry({firstHour:i.Rx().integer().min(0).required(""),subsequentHours:i.Rx().integer().min(0).required("")}),ooh:i.Ry({firstHour:i.Rx().integer().min(0).required(""),subsequentHours:i.Rx().integer().min(0).required("")}),premium:i.Ry({firstHour:i.Rx().integer().min(0).required(""),subsequentHours:i.Rx().integer().min(0).required("")}),oohTimes:c,premiumTimes:c}).test("no-overlap","hours overlap",function(e){for(var n=this.createError,t=e.oohTimes,r=e.premiumTimes,i=Object.keys(t),a=Object.keys(r),c=0;c<i.length;c++){var s=i[c];if(a.includes(s)){var u=t[s],d=r[s];if(u||d){var l=u.firstFrom?o()(u.firstFrom):null,m=u.firstTo?o()(u.firstTo):null,p=u.secondFrom?o()(u.secondFrom):null,f=u.secondTo?o()(u.secondTo):null,v=d.firstFrom?o()(d.firstFrom):null,h=d.firstTo?o()(d.firstTo):null,b=d.secondFrom?o()(d.secondFrom):null,y=d.secondTo?o()(d.secondTo):null;if((l||m)&&!(l&&m)||(p||f)&&!(p&&f))return n({path:"oohTimes.".concat(s),message:"Incomplete time range"});if((v||h)&&!(v&&h)||(b||y)&&!(b&&y))return n({path:"premiumTimes.".concat(s),message:"Incomplete time range"});if(l&&m&&l.isAfter(m)||p&&f&&p.isAfter(f))return n({path:"oohTimes.".concat(s),message:"Invalid time range"});if(v&&h&&v.isAfter(h)||b&&y&&b.isAfter(y))return n({path:"premiumTimes.".concat(s),message:"Invalid time range"});if(l&&m&&p&&f&&(l.isBetween(p,f)||m.isBetween(p,f)||p.isBetween(l,m)||f.isBetween(l,m)))return n({path:"oohTimes.".concat(s),message:"hours overlap"});if(v&&h&&b&&y&&(v.isBetween(b,y)||h.isBetween(b,y)))return n({path:"premiumTimes.".concat(s),message:"hours overlap"});if(l&&m&&v&&h&&(l.isBetween(v,h)||m.isBetween(v,h))||l&&m&&b&&y&&(l.isBetween(b,y)||m.isBetween(b,y))||p&&f&&v&&h&&(p.isBetween(v,h)||f.isBetween(v,h))||p&&f&&b&&y&&(p.isBetween(b,y)||f.isBetween(b,y)))return n({path:"oohTimes.".concat(s),message:"hours overlap"})}}}return!0})},29026:function(e,n,t){t.d(n,{Ey:function(){return f},MD:function(){return g},Sx:function(){return h},WC:function(){return y},kt:function(){return b},pB:function(){return v}});var r,o,i,a,c,s,u,d,l=t(71383),m=t(75063),p=(0,m.Ps)(r||(r=(0,l.Z)(["\n  fragment ServiceScheduleFields on ServiceSchedule {\n    id\n    name\n    status\n    entity\n    entityId\n    serviceId\n    minimumDuration\n    minimumIncrement\n    normal\n    ooh\n    premium\n    oohTimes\n    premiumTimes\n    days\n    adminId\n    createdAt\n    updatedAt\n  }\n"]))),f=(0,m.Ps)(o||(o=(0,l.Z)(['\n  query GetServiceSchedule($serviceScheduleId: Int!) {\n    serviceSchedule: ServiceSchedule_by_pk(id: $serviceScheduleId) {\n      ...ServiceScheduleFields\n      postcodeAreas: PostcodeAreas(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        postcode: PostcodeArea {\n          id\n          area\n          name\n        }\n      }\n      slas: Slas {\n        id\n        sla: SLA {\n          id\n          name\n        }\n      }\n      locations: Location_Entity(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        location: Location {\n          id\n          name\n        }\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n  }\n\n  ',"\n"])),p),v=(0,m.Ps)(i||(i=(0,l.Z)(['\n  query GetServiceSchedules(\n    $q: String\n    $entity: service_schedule_entity!\n    $entityId: Int\n    $offset: Int = 0\n    $limit: Int = 50\n    $orderBy: ServiceSchedule_order_by!\n  ) {\n    schedules: ServiceSchedule(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        _or: [{ name: { _ilike: $q } }, { Service: { name: { _ilike: $q } } }]\n      }\n      offset: $offset\n      limit: $limit\n      order_by: [$orderBy]\n    ) {\n      ...ServiceScheduleFields\n      postcodeAreas: PostcodeAreas(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        postcode: PostcodeArea {\n          id\n          area\n          name\n        }\n      }\n      slas: Slas {\n        id\n        sla: SLA {\n          id\n          name\n        }\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: ServiceSchedule_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        _or: [{ name: { _ilike: $q } }, { Service: { name: { _ilike: $q } } }]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n\n  ',"\n"])),p);(0,m.Ps)(a||(a=(0,l.Z)(["\n  query GetPostCodeAreas($limit: Int = 50, $offset: Int = 0, $orderBy: PostcodeArea_order_by!) {\n    postcodeAreas: PostcodeArea(limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      id\n      area\n      name\n    }\n    meta: PostcodeArea_aggregate {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"])));var h=(0,m.Ps)(c||(c=(0,l.Z)(["\n  mutation CreateServiceSchedule($data: jsonb!) {\n    createServiceSchedule(data: $data) {\n      data\n      success\n    }\n  }\n"]))),b=(0,m.Ps)(s||(s=(0,l.Z)(["\n  mutation UpdateServiceSchedule($data: jsonb!) {\n    updateServiceSchedule(data: $data) {\n      data\n      success\n    }\n  }\n"]))),y=(0,m.Ps)(u||(u=(0,l.Z)(['\n  query GetServiceScheduleForEntity($serviceScheduleId: Int!, $includeParent: Boolean!) {\n    serviceSchedule: ServiceSchedule_by_pk(id: $serviceScheduleId) {\n      ...ServiceScheduleFields\n      postcodeAreas: PostcodeAreas(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        postcode: PostcodeArea {\n          id\n          area\n          name\n        }\n      }\n      slas: Slas {\n        id\n        sla: SLA {\n          id\n          name\n        }\n      }\n      locations: Location_Entity(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        location: Location {\n          id\n          name\n        }\n      }\n      service: Service {\n        id\n        name\n      }\n      parent: ParentServiceSchedule @include(if: $includeParent) {\n        postcodeAreas: PostcodeAreas(where: { entity: { _eq: "ServiceSchedule" } }) {\n          id\n          postcode: PostcodeArea {\n            id\n            area\n            name\n          }\n        }\n      }\n    }\n  }\n\n  ',"\n"])),p),g=(0,m.Ps)(d||(d=(0,l.Z)(['\n  query GetServiceSchedulesForEntity(\n    $q: String\n    $entity: service_schedule_entity!\n    $childEntityId: Int\n    $childEntity: service_schedule_entity!\n    $offset: Int = 0\n    $limit: Int = 50\n    $orderBy: ServiceSchedule_order_by!\n    $includeLocations: Boolean! = false\n  ) {\n    schedules: ServiceSchedule(\n      where: {\n        entity: { _eq: $entity }\n        _or: [{ name: { _ilike: $q } }, { Service: { name: { _ilike: $q } } }]\n      }\n      offset: $offset\n      limit: $limit\n      order_by: [$orderBy]\n    ) {\n      ...ServiceScheduleFields\n      postcodeAreas: PostcodeAreas(where: { entity: { _eq: "ServiceSchedule" } }) {\n        id\n        postcode: PostcodeArea {\n          id\n          area\n          name\n        }\n      }\n      slas: Slas {\n        id\n        sla: SLA {\n          id\n          name\n        }\n      }\n\n      service: Service {\n        id\n        name\n      }\n      childSchedules: ServiceSchedules(\n        where: { entity: { _eq: $childEntity }, entityId: { _eq: $childEntityId } }\n      ) {\n        ...ServiceScheduleFields\n        locations: Location_Entity(where: { entity: { _eq: "ServiceSchedule" } })\n          @include(if: $includeLocations) {\n          id\n          location: Location {\n            id\n            name\n          }\n        }\n      }\n    }\n    meta: ServiceSchedule_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        _or: [{ name: { _ilike: $q } }, { Service: { name: { _ilike: $q } } }]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n\n  ',"\n"])),p)},578:function(e,n,t){t.d(n,{X:function(){return y}});var r=t(59499),o=t(16835),i=t(61730),a=t(11994),c=t(26447),s=t(50135),u=t(11057),d=t(90629),l=t(3896),m=t(42283),p=t(10166),f=t(85893);function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var b={search:""},y=function(e){var n=e.open,t=e.close,r=e.initialFilters,d=e.setFilters,p=(0,i.Z)("(max-width: 600px)"),v=(0,l.X)("service_schedule_".concat(r.filterType),r),y=(0,o.Z)(v,2),x=y[0],j=y[1],I=(0,m.cI)({defaultValues:h(h(h({},b),r),x)}),w=I.control,S=I.handleSubmit,Z=I.reset,O=I.getValues,_=function(e){try{var n={q:e.search?"%".concat(e.search,"%"):null};d(function(e){return h(h({},e),n)});var r=O();j(function(e){return h(h({},e),r)})}finally{t()}},P=function(){var e=h(h({},b),r);Z(e),j(e),d(e),t()};return(0,f.jsx)(a.Z,{keepMounted:!0,open:n,onClose:t,children:(0,f.jsx)("form",{onSubmit:S(_),children:(0,f.jsxs)(g,{is600pxOrLess:p,children:[(0,f.jsx)(c.Z,{direction:"row",flexWrap:"wrap",justifyContent:"center",children:(0,f.jsx)(m.Qr,{control:w,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,f.jsx)(s.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or service",value:n,onChange:t})}})}),(0,f.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,f.jsx)(u.Z,{variant:"contained",color:"danger",onClick:function(){return P()},children:"Cancel"}),(0,f.jsx)(u.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};y.defaultProps={open:!1,close:function(){},initialFilters:{},setFilters:function(){}};var g=(0,p.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px"}})},12964:function(e,n,t){t.d(n,{J:function(){return Z}});var r=t(59499),o=t(16835),i=t(4730),a=t(11163),c=t(67294),s=t(9270),u=t(62140),d=t(42283),l=t(76600),m=t(58965),p=t(49501),f=t(75903),v=t(77439),h=t(92264),b=t(3896),y=t(85893);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var j=function(e){var n=e.initialValues,t=e.renderFilters,r=e.setFilters,i=e.lastQuery,a=e.filters,g=(0,b.X)("form_data_".concat(n.filterType),n),j=(0,o.Z)(g,2),I=j[0],w=j[1],S=(0,d.cI)({defaultValues:I||n}),Z=S.control,O=S.errors,_=S.handleSubmit,P=S.register,A=S.reset,C=S.watch,T=S.setValue,q=C(),k=x(x({},q),{},{filterType:n.filterType});(0,c.useEffect)(function(){A(k)},[A]),(0,c.useEffect)(function(){w(k)},[a]);var D=function(e){var t=e.query;if(t!==i){var o={q:"%".concat(t,"%")||0},a=/^\d+$/.test(t);"id"in n&&(o.id=a?Number(t):null),"meta"in n&&(o.meta=a?{invoiceNumbers:[t]}:null),"jobNumber"in n&&(o.jobNumber=a?String(t):null,o.invoiceNumber=a?Number(t):null),r(function(e){return x(x({},e),o)})}},$=function(e){Object.keys(n).map(function(e){return T(e,null)}),r(n),A(n),D("")};return(0,y.jsx)(l.Z,{handleSubmit:_(D),children:(0,y.jsxs)(m.Z,{title:"Filters",children:[(0,y.jsxs)(s.Z,{children:[(0,y.jsx)(u.Z,{sm:12,lg:12,children:(0,y.jsx)(p.Z,{label:"",children:(0,y.jsx)(f.Z,{errors:O,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:P,type:"search"})})}),(0,y.jsx)(u.Z,{sm:12,lg:12,children:t({control:Z,errors:O,initialValues:n,register:P,setFilters:r,watch:C,setValue:T,reset:A})})]}),(0,y.jsx)(h.H,{content:"Search",context:"secondary",handleClick:D,type:"submit",children:(0,y.jsx)(v.Z,{content:"Clear",context:"danger",onClick:$,size:"sm"})})]})})},I=["FiltersComp","initialFilters","TableComp"];function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach(function(n){(0,r.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Z=function(e){var n=e.FiltersComp,t=e.initialFilters,r=e.TableComp,d=(0,i.Z)(e,I),l=(0,b.X)("form_data_".concat(t.filterType),t),m=(0,o.Z)(l,2),p=m[0],f=m[1],v=(0,c.useState)(p||t),h=v[0],g=v[1],x=(0,a.useRouter)().query.show;return(0,c.useEffect)(function(){f(h)},[h,f]),(0,y.jsx)(s.Z,{children:(0,y.jsxs)(u.Z,{sm:12,lg:12,children:[(0,y.jsx)(j,{initialValues:t,renderFilters:function(e){return(0,y.jsx)(n,S(S(S({},e),d),{},{show:x}))},setFilters:g,filters:h}),(0,y.jsx)(r,S({filters:h,initialFilters:t},d))]})})}}}]);